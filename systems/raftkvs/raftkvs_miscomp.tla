-------------------------------- MODULE raftkvs --------------------------------

\* Raft consensus protocol specification based on the TLA+ spec from
\* https://github.com/ongardie/raft.tla.
\*
\* We used limited buffer sized network channels to improve model checking 
\* perofmance. Also leader election part of Raft is not live by design.
\* These two can cause deadlock, so don't check deadlocks in model checking.
\*
\* Properties are defined based on the presented properties in the original 
\* Raft paper. See figure 3 in https://raft.github.io/raft.pdf.

EXTENDS Naturals, Sequences, TLC, FiniteSets, Bags

CONSTANT ExploreFail
CONSTANT Debug

CONSTANT NumServers
CONSTANT NumClients

CONSTANT BufferSize

CONSTANT MaxTerm
CONSTANT MaxCommitIndex

CONSTANT MaxNodeFail

CONSTANT LogConcat
CONSTANT LogPop

CONSTANT LeaderTimeoutReset

\* This is only used for model checking / simulation
CONSTANT NumRequests

Nil == 0

RECURSIVE MinAcc(_, _), MaxAcc(_, _)

Min(s) ==
    LET e == CHOOSE e \in s : TRUE
    IN MinAcc(s \ { e }, e)

MinAcc(s, e1) ==
    IF s = {} THEN e1
    ELSE
        LET e2 == CHOOSE e2 \in s : TRUE
        IN MinAcc(s \ { e2 }, IF e2 < e1 THEN e2 ELSE e1)

Max(s) ==
    LET e == CHOOSE e \in s : TRUE
    IN MaxAcc(s \ { e }, e)

MaxAcc(s, e1) ==
    IF s = {} THEN e1
    ELSE
        LET e2 == CHOOSE e2 \in s : TRUE
        IN MaxAcc(s \ { e2 }, IF e2 > e1 THEN e2 ELSE e1)

RECURSIVE FindMaxAgreeIndexRec(_, _, _, _)

isQuorum(s) == Cardinality(s) * 2 > NumServers
ServerSet   == 1..NumServers

FindMaxAgreeIndex(logLocal, i, matchIndex) ==
    FindMaxAgreeIndexRec(logLocal, i, matchIndex, Len(logLocal))

FindMaxAgreeIndexRec(logLocal, i, matchIndex, index) ==
    IF index = 0 THEN Nil
    ELSE
        IF isQuorum({i} \cup {k \in ServerSet : matchIndex[k] >= index})
        THEN index
        ELSE FindMaxAgreeIndexRec(logLocal, i, matchIndex, index - 1)

RECURSIVE ApplyLog(_, _, _, _, _)

Put == "put"
Get == "get"

ApplyLogEntry(xentry, xsm, xsmDomain) ==
    LET cmd == xentry.cmd
    IN IF cmd.type = Put
       THEN <<(cmd.key :> cmd.value) @@ xsm, xsmDomain \cup {cmd.key}>>
       ELSE <<xsm, xsmDomain>>

\* applies range [start, end] from the log to the state machine
ApplyLog(xlog, start, end, xsm, xsmDomain) == 
    IF start > end
    THEN <<xsm, xsmDomain>>
    ELSE
        LET result == ApplyLogEntry(xlog[start], xsm, xsmDomain)
        IN ApplyLog(xlog, start+1, end, result[1], result[2])

CONSTANT AllStrings
ASSUME AllStrings \subseteq STRING

AllReqs == [
    type: {Put},
    key: AllStrings,
    value: AllStrings
] \cup [
    type: {Get},
    key: AllStrings
]

(********************

--mpcal raftkvs {
    define {
        Follower  == "follower"
        Candidate == "candidate"
        Leader    == "leader"

        RequestVoteRequest    == "rvq"
        RequestVoteResponse   == "rvp"
        AppendEntriesRequest  == "apq"
        AppendEntriesResponse == "app"
        ClientPutRequest      == "cpq"
        ClientPutResponse     == "cpp"
        ClientGetRequest      == "cgq"
        ClientGetResponse     == "cgp"

        LastTerm(xlog) == IF Len(xlog) = 0 THEN 0 ELSE xlog[Len(xlog)].term

        ServerRequestVoteSet        == (1*NumServers+1)..(2*NumServers)
        ServerAppendEntriesSet      == (2*NumServers+1)..(3*NumServers)
        ServerAdvanceCommitIndexSet == (3*NumServers+1)..(4*NumServers)
        ServerBecomeLeaderSet       == (4*NumServers+1)..(5*NumServers)

        ServerCrasherSet == IF ExploreFail 
                            THEN (5*NumServers+1)..(5*NumServers+MaxNodeFail)
                            ELSE {}

        ClientSet == (6*NumServers+1)..(6*NumServers+NumClients)

        NodeSet   == ServerSet \cup ClientSet

        KeySet == {}
    }

    macro checkFail(selfId, netEnabled) {
        if (ExploreFail) {
            if (\lnot netEnabled[selfId]) {
                await FALSE;
                \* goto Done;
            };
        };
    }

    macro debug(toPrint) {
        if (Debug) {
            print toPrint;
        };
    }

    macro Send(net, dest, fd, m) {
        either {
            net[dest] := m;
        } or {
            await fd[dest];
        };
    }

    macro UpdateTerm(i, m, currentTerm, state, votedFor, leader) {
        if (m.mterm > currentTerm[i]) {
            currentTerm[i] := m.mterm;
            state[i]       := Follower;
            votedFor[i]    := Nil;
            leader[i]      := Nil;
        };
    }

    mapping macro ReliableFIFOLink {
        read {
            assert $variable.enabled;
            await BagCardinality($variable.queue) > 0;
            with (readMsg \in BagToSet($variable.queue)) {
                $variable := [queue |-> $variable.queue (-) SetToBag({readMsg}), enabled |-> $variable.enabled];
                yield readMsg;
            };
        }

        write {
            await $variable.enabled;
            await BagCardinality($variable.queue) < BufferSize;
            yield [queue |-> $variable.queue (+) SetToBag({$value}), enabled |-> $variable.enabled];
        }
    }

    mapping macro NetworkToggle {
        read { yield $variable.enabled; }

        write {
            yield [queue |-> $variable.queue, enabled |-> $value];
        }
    }

    mapping macro PerfectFD {
        read {
            yield $variable;
        }

        write { yield $value; }
    }

    mapping macro UnreliableFD {
        read {
            either { yield FALSE; }
            or { yield TRUE; };
        }

        write { yield $value; }
    }

    mapping macro ClientTimeout {
        read { either { yield TRUE; } or { yield FALSE; }}
        write { assert FALSE; }
    }

    mapping macro NetworkBufferLength {
        read {
            with(len \in 0..BagCardinality($variable.queue)) {
                yield len;
            }
        }

        write {
            assert FALSE;
            yield $value;
        }
    }

    mapping macro Channel {
        read {
            either {
                await Len($variable) > 0;
                with (res = Head($variable)) {
                    $variable := Tail($variable);
                    yield res;
                };
            } or {
                \* consistent in-memory channel can check this
                await $variable = <<>>;
                yield TRUE;
            };
        }

        write {
            yield Append($variable, $value);
        }
    }

    mapping macro RequestsChannel {
        read {
            with(req \in AllReqs) {
                yield req;
            }
        }

        write {
            assert FALSE;
        }
    }

    mapping macro PersistentLog {
        read {
            yield $variable;
        }

        write {
            if ($value.cmd = LogConcat) {
                yield $variable \o $value.entries;
            } else if ($value.cmd = LogPop) {
                yield SubSeq($variable, 1, Len($variable) - $value.cnt);
            };
        }
    }

    mapping macro LeaderTimeout {
        read {
            either { yield TRUE; } or { yield FALSE; };
        }
        write {
            yield $value;
        }
    }

    archetype AServer(
        srvId,
        ref net[_], ref netLen[_], ref netEnabled[_], ref fd[_],
        ref state[_], ref currentTerm[_],
        ref log[_], ref plog[_],
        ref commitIndex[_], ref nextIndex[_], ref matchIndex[_],
        ref votedFor[_], ref votesResponded[_], ref votesGranted[_],

        \* added by Shayan
        ref leader[_],
        ref sm[_], ref smDomain[_],
        ref leaderTimeout,
        ref appendEntriesCh[_], ref becomeLeaderCh[_]
    )
    variables
        idx = 1,
        m;
    {
    serverLoop:
        while (TRUE) {
            checkFail(self, netEnabled);

            m := net[self];
            assert m.mdest = self;

        handleMsg:
            checkFail(self, netEnabled);

            if (m.mtype = RequestVoteRequest) {
                UpdateTerm(self, m, currentTerm, state, votedFor, leader);

                \* HandleRequestVoteRequest
                with (
                    i = self, j = m.msource,
                    logOK = \/ m.mlastLogTerm > LastTerm(log[i])
                            \/ /\ m.mlastLogTerm = LastTerm(log[i])
                               /\ m.mlastLogIndex >= Len(log[i]),
                    grant = /\ m.mterm = currentTerm[i]
                            /\ logOK
                            /\ votedFor[self] \in {Nil, j}
                ) {
                    assert m.mterm <= currentTerm[i];
                    if (grant) {
                        votedFor[i] := j;
                    };
                    Send(net, j, fd, [
                        mtype        |-> RequestVoteResponse,
                        mterm        |-> currentTerm[i],
                        mvoteGranted |-> grant,
                        msource      |-> i,
                        mdest        |-> j
                    ]);

                    debug(<<"HandleRequestVoteRequest", i, j, currentTerm[i], grant>>);
                };
            } else if (m.mtype = RequestVoteResponse) {
                UpdateTerm(self, m, currentTerm, state, votedFor, leader);

                \* DropStaleResponse
                if (m.mterm < currentTerm[self]) {
                    \* goto serverLoop;
                    skip;
                } else {
                    \* HandleRequestVoteResponse
                    with (i = self, j = m.msource) {
                        assert m.mterm = currentTerm[i];
                        votesResponded[i] := votesResponded[i] \cup {j};
                        if (m.mvoteGranted) {
                            leaderTimeout := LeaderTimeoutReset;
                            votesGranted[i] := votesGranted[i] \cup {j};
                            if (
                                /\ state[i] = Candidate
                                /\ isQuorum(votesGranted[i])
                            ) {
                                becomeLeaderCh[i] := TRUE;
                            };
                        }; 
                    };
                };
            } else if (m.mtype = AppendEntriesRequest) {
                UpdateTerm(self, m, currentTerm, state, votedFor, leader);

                \* HandleAppendEntriesRequest
                with (
                    i = self, j = m.msource,
                    logOK = \/ m.mprevLogIndex = 0
                            \/ /\ m.mprevLogIndex > 0
                               /\ m.mprevLogIndex <= Len(log[i])
                               /\ m.mprevLogTerm = log[i][m.mprevLogIndex].term
                ) {
                    assert m.mterm <= currentTerm[i];

                    if (m.mterm = currentTerm[i]) {
                        leader[i] := m.msource;
                        leaderTimeout := LeaderTimeoutReset;
                    };

                    \* return to follower state
                    if (
                        /\ m.mterm = currentTerm[i]
                        /\ state[i] = Candidate
                    ) {
                        state[i] := Follower;
                    };

                    \* reject request
                    if (
                        \/ m.mterm < currentTerm[i]
                        \/ /\ m.mterm = currentTerm[i]
                           /\ state[i] = Follower
                           /\ \lnot logOK
                    ) {
                        Send(net, j, fd, [
                            mtype       |-> AppendEntriesResponse,
                            mterm       |-> currentTerm[i],
                            msuccess    |-> FALSE,
                            mmatchIndex |-> 0,
                            msource     |-> i,
                            mdest       |-> j
                        ]);
                    }
                    \* accept request
                    else {
                        assert (
                            /\ m.mterm = currentTerm[i]
                            /\ state[i] = Follower
                            /\ logOK
                        );
                        with (index = m.mprevLogIndex + 1) {
                            plog[i] := [
                                cmd |-> LogPop, 
                                cnt |-> Len(log[i]) - m.mprevLogIndex
                            ];
                            log[i]  := SubSeq(log[i], 1, m.mprevLogIndex);

                            plog[i] := [
                                cmd     |-> LogConcat, 
                                entries |-> m.mentries
                            ];
                            log[i]  := log[i] \o m.mentries;

                            assert m.mcommitIndex <= Len(log[i]);
                            with (result = ApplyLog(log[i], commitIndex[i]+1, m.mcommitIndex, sm[i], smDomain[i])) {
                                sm[i]       := result[1];
                                smDomain[i] := result[2];
                            };
                            commitIndex[i] := Max({commitIndex[i], m.mcommitIndex});
                            Send(net, j, fd, [
                                mtype       |-> AppendEntriesResponse,
                                mterm       |-> currentTerm[i],
                                msuccess    |-> TRUE,
                                mmatchIndex |-> m.mprevLogIndex + Len(m.mentries),
                                msource     |-> i,
                                mdest       |-> j
                            ]);
                       };
                    };
                };
            } else if (m.mtype = AppendEntriesResponse) {
                UpdateTerm(self, m, currentTerm, state, votedFor, leader);

                \* DropStaleResponse
                if (m.mterm < currentTerm[self]) {
                    \* goto serverLoop;
                    skip;
                } else {
                    \* HandleAppendEntriesResponse
                    leaderTimeout := LeaderTimeoutReset;
                    with (i = self, j = m.msource) {
                        assert m.mterm = currentTerm[i];
                        if (m.msuccess) {
                            \* nextIndex[j]  := m.mmatchIndex + 1;
                            nextIndex[i] := [nextIndex[i] EXCEPT ![j] = m.mmatchIndex + 1];
                            \* matchIndex[j] := m.mmatchIndex;
                            matchIndex[i] := [matchIndex[i] EXCEPT ![j] = m.mmatchIndex];
                        } else {
                            nextIndex[i] := [nextIndex[i] EXCEPT ![j] = Max({nextIndex[i][j]-1, 1})];
                            \* nextIndex[j]  := Max({nextIndex[j]-1, 1});
                        };
                    };
                };
            } else if (
                \/ m.mtype = ClientPutRequest
                \/ m.mtype = ClientGetRequest
            ) {
                \* HandleClientRequest

                \* debug(<<"HandleClientRequest", self, m.msource, currentTerm[self], state[self]>>);

                if (state[self] = Leader) {
                    with (entry = [term   |-> currentTerm[self],
                                   cmd    |-> m.mcmd,
                                   client |-> m.msource]
                    ) {
                        log[self]  := Append(log[self], entry);
                        plog[self] := [cmd |-> LogConcat, entries |-> <<entry>>];

                        \* replace appendEntriesCh with a place holder resource on the Go side
                        \* to get better performance
                        appendEntriesCh[self] := TRUE;
                    };
                } else {
                    with (
                        i = self, j = m.msource,
                        respType = IF m.mcmd.type = Put
                                   THEN ClientPutResponse
                                   ELSE ClientGetResponse
                    ) {
                        net[j] := [
                            mtype       |-> respType,
                            msuccess    |-> FALSE,
                            mresponse   |-> [
                                idx |-> m.mcmd.idx,
                                key |-> m.mcmd.key
                            ],
                            mleaderHint |-> leader[i],
                            msource     |-> i,
                            mdest       |-> j
                        ];
                    };
                };
            };
        };
    }

    archetype AServerRequestVote(
        srvId,
        ref net[_], ref netLen[_], ref netEnabled[_], ref fd[_],
        ref state[_], ref currentTerm[_],
        ref log[_], ref plog[_],
        ref commitIndex[_], ref nextIndex[_], ref matchIndex[_],
        ref votedFor[_], ref votesResponded[_], ref votesGranted[_],

        \* added by Shayan
        ref leader[_],
        ref sm[_], ref smDomain[_],
        ref leaderTimeout,
        ref appendEntriesCh[_], ref becomeLeaderCh[_]
    )
    variable idx = 1;
    {
    serverRequestVoteLoop:
        while (TRUE) {
            checkFail(srvId, netEnabled);

            \* Server times out and starts a new election.
            await leaderTimeout;
            await netLen[srvId] = 0;

            await state[srvId] \in {Follower, Candidate};

            with (i = srvId) {
                state[i]          := Candidate;
                currentTerm[i]    := currentTerm[i] + 1;
                votedFor[i]       := i;
                votesResponded[i] := {i};
                votesGranted[i]   := {i};
                leader[i]         := Nil;

                debug(<<"ServerTimeout", i, currentTerm[i]>>);
            };

            idx := 1;
        requestVoteLoop:
            while (idx <= NumServers) {
                checkFail(srvId, netEnabled);

                \* RequestVote
                if (idx /= srvId) {
                    Send(net, idx, fd, [
                        mtype         |-> RequestVoteRequest,
                        mterm         |-> currentTerm[srvId],
                        mlastLogTerm  |-> LastTerm(log[srvId]),
                        mlastLogIndex |-> Len(log[srvId]),
                        msource       |-> srvId,
                        mdest         |-> idx
                    ]);
                };
                idx := idx + 1;
            };
        }
    }

    archetype AServerAppendEntries(
        srvId,
        ref net[_], ref netLen[_], ref netEnabled[_], ref fd[_],
        ref state[_], ref currentTerm[_],
        ref log[_], ref plog[_],
        ref commitIndex[_], ref nextIndex[_], ref matchIndex[_],
        ref votedFor[_], ref votesResponded[_], ref votesGranted[_],

        \* added by Shayan
        ref leader[_],
        ref sm[_], ref smDomain[_],
        ref leaderTimeout,
        ref appendEntriesCh[_], ref becomeLeaderCh[_]
    )
    variable idx;
    {
    serverAppendEntriesLoop:
        while (appendEntriesCh[srvId]) {
            checkFail(srvId, netEnabled);

            await state[srvId] = Leader;
            idx := 1;

        appendEntriesLoop:
            \* AppendEntries
            while (
                /\ state[srvId] = Leader
                /\ idx <= NumServers
            ) {
                checkFail(srvId, netEnabled);

                if (idx /= srvId) {
                    with (
                        prevLogIndex = nextIndex[srvId][idx] - 1,
                        prevLogTerm  = IF prevLogIndex > 0
                                       THEN log[srvId][prevLogIndex].term
                                       ELSE 0,
                        \* lastEntry    = Min({Len(log[srvId]), nextIndex[srvId][idx]}),
                        entries      = SubSeq(log[srvId], nextIndex[srvId][idx], Len(log[srvId]))
                    ) {
                        Send(net, idx, fd, [
                            mtype         |-> AppendEntriesRequest,
                            mterm         |-> currentTerm[srvId],
                            mprevLogIndex |-> prevLogIndex,
                            mprevLogTerm  |-> prevLogTerm,
                            mentries      |-> entries,
                            mcommitIndex  |-> commitIndex[srvId],
                            msource       |-> srvId,
                            mdest         |-> idx
                        ]);
                    };
                };
                idx := idx + 1;
            };
        };
    }

    archetype AServerAdvanceCommitIndex(
        srvId,
        ref net[_], ref netLen[_], ref netEnabled[_], ref fd[_],
        ref state[_], ref currentTerm[_],
        ref log[_], ref plog[_],
        ref commitIndex[_], ref nextIndex[_], ref matchIndex[_],
        ref votedFor[_], ref votesResponded[_], ref votesGranted[_],

        \* added by Shayan
        ref leader[_],
        ref sm[_], ref smDomain[_],
        ref leaderTimeout,
        ref appendEntriesCh[_], ref becomeLeaderCh[_]
    )
    variable newCommitIndex = 0,
    {
    serverAdvanceCommitIndexLoop:
        while (TRUE) {
            checkFail(srvId, netEnabled);

            await state[srvId] = Leader;

            \* AdvanceCommitIndex
            with (
                i = srvId,

                \* explores a much smaller space than the previous version,
                \* proportional to disagreement not the log size
                maxAgreeIndex = FindMaxAgreeIndex(log[i], i, matchIndex[i]),

                nCommitIndex =
                    IF /\ maxAgreeIndex /= Nil
                       /\ log[i][maxAgreeIndex].term = currentTerm[i]
                    THEN maxAgreeIndex
                    ELSE commitIndex[i]
            ) {
                newCommitIndex := nCommitIndex;
                assert newCommitIndex >= commitIndex[i];
            };

        applyLoop:
            while (commitIndex[srvId] < newCommitIndex) {
                checkFail(srvId, netEnabled);

                commitIndex[srvId] := commitIndex[srvId] + 1;
                with (
                    i = srvId,
                    k = commitIndex[i],
                    entry = log[i][k],
                    cmd   = entry.cmd,
                    respType = IF cmd.type = Put
                               THEN ClientPutResponse
                               ELSE ClientGetResponse
                ) {
                    if (cmd.type = Put) {
                        sm[i]       := (cmd.key :> cmd.value) @@ sm[i]; \* allows sm[i] to grow
                        smDomain[i] := smDomain[i] \cup {cmd.key};
                    };
                    with (reqOk = cmd.key \in smDomain[i]) {
                        net[entry.client] := [
                            mtype       |-> respType,
                            msuccess    |-> TRUE,
                            mresponse   |-> [
                                idx   |-> cmd.idx,
                                key   |-> cmd.key,
                                value |-> IF reqOk THEN sm[i][cmd.key] ELSE Nil,
                                ok    |-> reqOk
                            ],
                            mleaderHint |-> i,
                            msource     |-> i,
                            mdest       |-> entry.client
                        ];
                    };
                };
            };
        };
    }

    archetype AServerBecomeLeader(
        srvId,
        ref net[_], ref netLen[_], ref netEnabled[_], ref fd[_],
        ref state[_], ref currentTerm[_],
        ref log[_], ref plog[_],
        ref commitIndex[_], ref nextIndex[_], ref matchIndex[_],
        ref votedFor[_], ref votesResponded[_], ref votesGranted[_],

        \* added by Shayan
        ref leader[_],
        ref sm[_], ref smDomain[_],
        ref leaderTimeout,
        ref appendEntriesCh[_], ref becomeLeaderCh[_]
    )
    {
    serverBecomeLeaderLoop:
        while (becomeLeaderCh[srvId]) {
            checkFail(srvId, netEnabled);

            \* BecomeLeader
            await state[srvId] = Candidate;
            await isQuorum(votesGranted[srvId]);

            with (i = srvId) {
                state[i]      := Leader;
                nextIndex[i]  := [j \in ServerSet |-> Len(log[i]) + 1];
                matchIndex[i] := [j \in ServerSet |-> 0];
                leader[i]     := i;

                appendEntriesCh[srvId] := TRUE;
                debug(<<"BecomeLeader", i, currentTerm[i], state[i], leader[i]>>);
            };
        };
    }

    archetype AClient(ref net[_], ref netLen[_], ref fd[_], ref reqCh, ref respCh, ref timeout)
    variables leader = Nil, req, resp, reqIdx = 0;
    {
    clientLoop:
        while (TRUE) {
            req := reqCh;
            reqIdx := reqIdx + 1;

        sndReq:
            if (leader = Nil) {
                with (srv \in ServerSet) {
                    leader := srv;
                };
            };
            debug(<<"ClientSndReq", self, leader, reqIdx, req>>);
            if (req.type = Put) {
                Send(net, leader, fd, [
                    mtype   |-> ClientPutRequest,
                    mcmd    |-> [
                        idx   |-> reqIdx,
                        type  |-> Put,
                        key   |-> req.key,
                        value |-> req.value
                    ],
                    msource |-> self,
                    mdest   |-> leader
                ]);
            } else if (req.type = Get) {
                Send(net, leader, fd, [
                    mtype   |-> ClientGetRequest,
                    mcmd    |-> [
                        idx  |-> reqIdx,
                        type |-> Get,
                        key  |-> req.key
                    ],
                    msource |-> self,
                    mdest   |-> leader
                ]);
            };

        rcvResp:
            either {
                resp := net[self];
                debug(<<"ClientRcvResp", self, leader, reqIdx, resp>>);
                assert resp.mdest = self;

                \* it should be /very likely/ that indexed requests will help us
                \* throw out duplicate server responses.
                \* one edge case I can think of: start, do one req, immediately
                \* stop + restart, immediately get stale response to last req.
                if (resp.mresponse.idx /= reqIdx) {
                    goto rcvResp;
                } else {
                    leader := resp.mleaderHint;
                    assert /\ req.type = Get => resp.mtype = ClientGetResponse
                           /\ req.type = Put => resp.mtype = ClientPutResponse;
                    if (\lnot resp.msuccess) {
                        goto sndReq;
                    } else {
                        assert /\ resp.mresponse.idx = reqIdx
                               /\ resp.mresponse.key = req.key;
                        respCh := resp;
                        debug(<<"ClientRcvChDone", self, leader, reqIdx, resp>>);
                    };
                };
            } or {
                await \/ /\ fd[leader] 
                         /\ netLen[self] = 0
                      \/ timeout;
                debug(<<"ClientTimeout", self, leader, reqIdx>>);
                leader := Nil;
                goto sndReq;
            };
        };
    }

    archetype AServerCrasher(srvId, ref netEnabled[_], ref fd[_]) {
    serverCrash:
        netEnabled[srvId] := FALSE;
    fdUpdate:
        fd[srvId] := TRUE;
    }

    variables
        network = [i \in NodeSet |-> [queue |-> SetToBag({}), enabled |-> TRUE]];
        fd      = [i \in ServerSet |-> FALSE];

        state       = [i \in ServerSet |-> Follower];
        currentTerm = [i \in ServerSet |-> 1];

        commitIndex = [i \in ServerSet |-> 0];
        nextIndex   = [i \in ServerSet |-> [j \in ServerSet |-> 1]];
        matchIndex  = [i \in ServerSet |-> [j \in ServerSet |-> 0]];

        log  = [i \in ServerSet |-> <<>>];
        plog = [i \in ServerSet |-> <<>>];

        votedFor       = [i \in ServerSet |-> Nil];
        votesResponded = [i \in ServerSet |-> {}];
        votesGranted   = [i \in ServerSet |-> {}];

        leader = [i \in ServerSet |-> Nil];

        sm       = [i \in ServerSet |-> [k \in KeySet |-> Nil]];
        smDomain = [i \in ServerSet |-> KeySet];

        leaderTimeout   = TRUE;
        appendEntriesCh = [i \in ServerSet |-> <<>>];
        becomeLeaderCh  = [i \in ServerSet |-> 
            IF NumServers > 1 
            THEN <<>>
            ELSE <<TRUE>>
        ];

        reqCh;
        respCh;

        requestVoteSrvId        = [i \in ServerRequestVoteSet        |-> i - 1*NumServers];
        appendEntriesSrvId      = [i \in ServerAppendEntriesSet      |-> i - 2*NumServers];
        advanceCommitIndexSrvId = [i \in ServerAdvanceCommitIndexSet |-> i - 3*NumServers];
        becomeLeaderSrvId       = [i \in ServerBecomeLeaderSet       |-> i - 4*NumServers];
        crasherSrvId            = [i \in ServerCrasherSet            |-> i - 5*NumServers];

    fair process (s0 \in ServerSet) == instance AServer(
        s0,
        ref network[_], ref network[_], ref network[_], ref fd[_],
        ref state[_], ref currentTerm[_],
        ref log[_], ref plog[_],
        ref commitIndex[_], ref nextIndex[_], ref matchIndex[_],
        ref votedFor[_], ref votesResponded[_], ref votesGranted[_],

        ref leader[_],
        ref sm[_], ref smDomain[_],
        ref leaderTimeout,
        ref appendEntriesCh[_], ref becomeLeaderCh[_]
    )
        mapping @2[_] via ReliableFIFOLink
        mapping @3[_] via NetworkBufferLength
        mapping @4[_] via NetworkToggle
        mapping @5[_] via UnreliableFD
        mapping @9[_] via PersistentLog
        mapping @20[_] via Channel
        mapping @21[_] via Channel
        mapping leaderTimeout via LeaderTimeout;

    fair process (s1 \in ServerRequestVoteSet) == instance AServerRequestVote(
        requestVoteSrvId[s1],
        ref network[_], ref network[_], ref network[_], ref fd[_],
        ref state[_], ref currentTerm[_],
        ref log[_], ref plog[_],
        ref commitIndex[_], ref nextIndex[_], ref matchIndex[_],
        ref votedFor[_], ref votesResponded[_], ref votesGranted[_],

        ref leader[_],
        ref sm[_], ref smDomain[_],
        ref leaderTimeout,
        ref appendEntriesCh[_], ref becomeLeaderCh[_]
    )
        mapping @2[_] via ReliableFIFOLink
        mapping @3[_] via NetworkBufferLength
        mapping @4[_] via NetworkToggle
        mapping @5[_] via UnreliableFD
        mapping @9[_] via PersistentLog
        mapping @20[_] via Channel
        mapping @21[_] via Channel
        mapping leaderTimeout via LeaderTimeout;

    fair process (s2 \in ServerAppendEntriesSet) == instance AServerAppendEntries(
        appendEntriesSrvId[s2],
        ref network[_], ref network[_], ref network[_], ref fd[_],
        ref state[_], ref currentTerm[_],
        ref log[_], ref plog[_],
        ref commitIndex[_], ref nextIndex[_], ref matchIndex[_],
        ref votedFor[_], ref votesResponded[_], ref votesGranted[_],

        ref leader[_],
        ref sm[_], ref smDomain[_],
        ref leaderTimeout,
        ref appendEntriesCh[_], ref becomeLeaderCh[_]
    )
        mapping @2[_] via ReliableFIFOLink
        mapping @3[_] via NetworkBufferLength
        mapping @4[_] via NetworkToggle
        mapping @5[_] via UnreliableFD
        mapping @9[_] via PersistentLog
        mapping @20[_] via Channel
        mapping @21[_] via Channel
        mapping leaderTimeout via LeaderTimeout;

    fair process (s3 \in ServerAdvanceCommitIndexSet) == instance AServerAdvanceCommitIndex(
        advanceCommitIndexSrvId[s3],
        ref network[_], ref network[_], ref network[_], ref fd[_],
        ref state[_], ref currentTerm[_],
        ref log[_], ref plog[_],
        ref commitIndex[_], ref nextIndex[_], ref matchIndex[_],
        ref votedFor[_], ref votesResponded[_], ref votesGranted[_],

        ref leader[_],
        ref sm[_], ref smDomain[_],
        ref leaderTimeout,
        ref appendEntriesCh[_], ref becomeLeaderCh[_]
    )
        mapping @2[_] via ReliableFIFOLink
        mapping @3[_] via NetworkBufferLength
        mapping @4[_] via NetworkToggle
        mapping @5[_] via UnreliableFD
        mapping @9[_] via PersistentLog
        mapping @20[_] via Channel
        mapping @21[_] via Channel
        mapping leaderTimeout via LeaderTimeout;

    fair process (s4 \in ServerBecomeLeaderSet) == instance AServerBecomeLeader(
        becomeLeaderSrvId[s4],
        ref network[_], ref network[_], ref network[_], ref fd[_],
        ref state[_], ref currentTerm[_],
        ref log[_], ref plog[_],
        ref commitIndex[_], ref nextIndex[_], ref matchIndex[_],
        ref votedFor[_], ref votesResponded[_], ref votesGranted[_],

        ref leader[_],
        ref sm[_], ref smDomain[_],
        ref leaderTimeout,
        ref appendEntriesCh[_], ref becomeLeaderCh[_]
    )
        mapping @2[_] via ReliableFIFOLink
        mapping @3[_] via NetworkBufferLength
        mapping @4[_] via NetworkToggle
        mapping @5[_] via UnreliableFD
        mapping @9[_] via PersistentLog
        mapping @20[_] via Channel
        mapping @21[_] via Channel
        mapping leaderTimeout via LeaderTimeout;

    fair process (client \in ClientSet) == instance AClient(
        ref network[_], ref network[_], ref fd[_],
        ref reqCh, ref respCh, FALSE
    )
        mapping @1[_] via ReliableFIFOLink
        mapping @2[_] via NetworkBufferLength
        mapping @3[_] via UnreliableFD
        mapping @4    via RequestsChannel
        mapping @6    via ClientTimeout;
    
    fair process (crasher \in ServerCrasherSet) == instance AServerCrasher(
        crasherSrvId[crasher],
        ref network[_], ref fd[_]
    )
        mapping @2[_] via NetworkToggle
        mapping @3[_] via UnreliableFD;
}

\* BEGIN PLUSCAL TRANSLATION
--algorithm raftkvs {
  variables network = [i \in NodeSet |-> [queue |-> SetToBag({}), enabled |-> TRUE]]; fd = [i \in ServerSet |-> FALSE]; state = [i \in ServerSet |-> Follower]; currentTerm = [i \in ServerSet |-> 1]; commitIndex = [i \in ServerSet |-> 0]; nextIndex = [i \in ServerSet |-> [j \in ServerSet |-> 1]]; matchIndex = [i \in ServerSet |-> [j \in ServerSet |-> 0]]; log = [i \in ServerSet |-> <<>>]; plog = [i \in ServerSet |-> <<>>]; votedFor = [i \in ServerSet |-> Nil]; votesResponded = [i \in ServerSet |-> {}]; votesGranted = [i \in ServerSet |-> {}]; leader = [i \in ServerSet |-> Nil]; sm = [i \in ServerSet |-> [k \in KeySet |-> Nil]]; smDomain = [i \in ServerSet |-> KeySet]; leaderTimeout = TRUE; appendEntriesCh = [i \in ServerSet |-> <<>>]; becomeLeaderCh = [i \in ServerSet |-> IF (NumServers) > (1) THEN <<>> ELSE <<TRUE>>]; reqCh; respCh; requestVoteSrvId = [i \in ServerRequestVoteSet |-> (i) - ((1) * (NumServers))]; appendEntriesSrvId = [i \in ServerAppendEntriesSet |-> (i) - ((2) * (NumServers))]; advanceCommitIndexSrvId = [i \in ServerAdvanceCommitIndexSet |-> (i) - ((3) * (NumServers))]; becomeLeaderSrvId = [i \in ServerBecomeLeaderSet |-> (i) - ((4) * (NumServers))]; crasherSrvId = [i \in ServerCrasherSet |-> (i) - ((5) * (NumServers))];
  define{
    Follower == "follower"
    Candidate == "candidate"
    Leader == "leader"
    RequestVoteRequest == "rvq"
    RequestVoteResponse == "rvp"
    AppendEntriesRequest == "apq"
    AppendEntriesResponse == "app"
    ClientPutRequest == "cpq"
    ClientPutResponse == "cpp"
    ClientGetRequest == "cgq"
    ClientGetResponse == "cgp"
    LastTerm(xlog) == IF (Len(xlog)) = (0) THEN 0 ELSE ((xlog)[Len(xlog)]).term
    ServerRequestVoteSet == (((1) * (NumServers)) + (1)) .. ((2) * (NumServers))
    ServerAppendEntriesSet == (((2) * (NumServers)) + (1)) .. ((3) * (NumServers))
    ServerAdvanceCommitIndexSet == (((3) * (NumServers)) + (1)) .. ((4) * (NumServers))
    ServerBecomeLeaderSet == (((4) * (NumServers)) + (1)) .. ((5) * (NumServers))
    ServerCrasherSet == IF ExploreFail THEN (((5) * (NumServers)) + (1)) .. (((5) * (NumServers)) + (MaxNodeFail)) ELSE {}
    ClientSet == (((6) * (NumServers)) + (1)) .. (((6) * (NumServers)) + (NumClients))
    NodeSet == (ServerSet) \union (ClientSet)
    KeySet == {}
  }
  
  fair process (s0 \in ServerSet)
    variables idx = 1; m; srvId = self;
  {
    serverLoop:
      if (TRUE) {
        if (ExploreFail) {
          with (yielded_network12 = ((network)[self]).enabled) {
            if (~ (yielded_network12)) {
              await FALSE;
              assert ((network)[self]).enabled;
              await (BagCardinality(((network)[self]).queue)) > (0);
              with (readMsg00 \in BagToSet(((network)[self]).queue)) {
                network := [network EXCEPT ![self] = [queue |-> (((network)[self]).queue) (-) (SetToBag({readMsg00})), enabled |-> ((network)[self]).enabled]];
                with (yielded_network00 = readMsg00) {
                  m := yielded_network00;
                  assert ((m).mdest) = (self);
                  goto handleMsg;
                };
              };
            } else {
              assert ((network)[self]).enabled;
              await (BagCardinality(((network)[self]).queue)) > (0);
              with (readMsg01 \in BagToSet(((network)[self]).queue)) {
                network := [network EXCEPT ![self] = [queue |-> (((network)[self]).queue) (-) (SetToBag({readMsg01})), enabled |-> ((network)[self]).enabled]];
                with (yielded_network01 = readMsg01) {
                  m := yielded_network01;
                  assert ((m).mdest) = (self);
                  goto handleMsg;
                };
              };
            };
          };
        } else {
          assert ((network)[self]).enabled;
          await (BagCardinality(((network)[self]).queue)) > (0);
          with (readMsg02 \in BagToSet(((network)[self]).queue)) {
            network := [network EXCEPT ![self] = [queue |-> (((network)[self]).queue) (-) (SetToBag({readMsg02})), enabled |-> ((network)[self]).enabled]];
            with (yielded_network02 = readMsg02) {
              m := yielded_network02;
              assert ((m).mdest) = (self);
              goto handleMsg;
            };
          };
        };
      } else {
        goto Done;
      };
    handleMsg:
      if (ExploreFail) {
        with (yielded_network13 = ((network)[self]).enabled) {
          if (~ (yielded_network13)) {
            await FALSE;
            if (((m).mtype) = (RequestVoteRequest)) {
              if (((m).mterm) > ((currentTerm)[self])) {
                currentTerm := [currentTerm EXCEPT ![self] = (m).mterm];
                state := [state EXCEPT ![self] = Follower];
                with (votedFor3 = [votedFor EXCEPT ![self] = Nil]) {
                  leader := [leader EXCEPT ![self] = Nil];
                  with (
                    i = self, 
                    j = (m).msource, 
                    logOK = (((m).mlastLogTerm) > (LastTerm((log)[i]))) \/ ((((m).mlastLogTerm) = (LastTerm((log)[i]))) /\ (((m).mlastLogIndex) >= (Len((log)[i])))), 
                    grant = ((((m).mterm) = ((currentTerm)[i])) /\ (logOK)) /\ (((votedFor3)[self]) \in ({Nil, j}))
                  ) {
                    assert ((m).mterm) <= ((currentTerm)[i]);
                    if (grant) {
                      votedFor := [votedFor3 EXCEPT ![i] = j];
                      either {
                        with (value00 = [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j]) {
                          await ((network)[j]).enabled;
                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value00})), enabled |-> ((network)[j]).enabled]];
                          if (Debug) {
                            print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                            goto serverLoop;
                          } else {
                            goto serverLoop;
                          };
                        };
                      } or {
                        either {
                          with (yielded_fd15 = FALSE) {
                            await yielded_fd15;
                            if (Debug) {
                              print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                              goto serverLoop;
                            } else {
                              goto serverLoop;
                            };
                          };
                        } or {
                          with (yielded_fd00 = TRUE) {
                            await yielded_fd00;
                            if (Debug) {
                              print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                              goto serverLoop;
                            } else {
                              goto serverLoop;
                            };
                          };
                        };
                      };
                    } else {
                      either {
                        with (value01 = [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j]) {
                          await ((network)[j]).enabled;
                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value01})), enabled |-> ((network)[j]).enabled]];
                          if (Debug) {
                            print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                            votedFor := votedFor3;
                            goto serverLoop;
                          } else {
                            votedFor := votedFor3;
                            goto serverLoop;
                          };
                        };
                      } or {
                        either {
                          with (yielded_fd16 = FALSE) {
                            await yielded_fd16;
                            if (Debug) {
                              print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                              votedFor := votedFor3;
                              goto serverLoop;
                            } else {
                              votedFor := votedFor3;
                              goto serverLoop;
                            };
                          };
                        } or {
                          with (yielded_fd01 = TRUE) {
                            await yielded_fd01;
                            if (Debug) {
                              print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                              votedFor := votedFor3;
                              goto serverLoop;
                            } else {
                              votedFor := votedFor3;
                              goto serverLoop;
                            };
                          };
                        };
                      };
                    };
                  };
                };
              } else {
                with (
                  i = self, 
                  j = (m).msource, 
                  logOK = (((m).mlastLogTerm) > (LastTerm((log)[i]))) \/ ((((m).mlastLogTerm) = (LastTerm((log)[i]))) /\ (((m).mlastLogIndex) >= (Len((log)[i])))), 
                  grant = ((((m).mterm) = ((currentTerm)[i])) /\ (logOK)) /\ (((votedFor)[self]) \in ({Nil, j}))
                ) {
                  assert ((m).mterm) <= ((currentTerm)[i]);
                  if (grant) {
                    votedFor := [votedFor EXCEPT ![i] = j];
                    either {
                      with (value02 = [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j]) {
                        await ((network)[j]).enabled;
                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value02})), enabled |-> ((network)[j]).enabled]];
                        if (Debug) {
                          print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                          goto serverLoop;
                        } else {
                          goto serverLoop;
                        };
                      };
                    } or {
                      either {
                        with (yielded_fd17 = FALSE) {
                          await yielded_fd17;
                          if (Debug) {
                            print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                            goto serverLoop;
                          } else {
                            goto serverLoop;
                          };
                        };
                      } or {
                        with (yielded_fd02 = TRUE) {
                          await yielded_fd02;
                          if (Debug) {
                            print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                            goto serverLoop;
                          } else {
                            goto serverLoop;
                          };
                        };
                      };
                    };
                  } else {
                    either {
                      with (value03 = [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j]) {
                        await ((network)[j]).enabled;
                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value03})), enabled |-> ((network)[j]).enabled]];
                        if (Debug) {
                          print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                          goto serverLoop;
                        } else {
                          goto serverLoop;
                        };
                      };
                    } or {
                      either {
                        with (yielded_fd18 = FALSE) {
                          await yielded_fd18;
                          if (Debug) {
                            print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                            goto serverLoop;
                          } else {
                            goto serverLoop;
                          };
                        };
                      } or {
                        with (yielded_fd03 = TRUE) {
                          await yielded_fd03;
                          if (Debug) {
                            print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                            goto serverLoop;
                          } else {
                            goto serverLoop;
                          };
                        };
                      };
                    };
                  };
                };
              };
            } else {
              if (((m).mtype) = (RequestVoteResponse)) {
                if (((m).mterm) > ((currentTerm)[self])) {
                  currentTerm := [currentTerm EXCEPT ![self] = (m).mterm];
                  state := [state EXCEPT ![self] = Follower];
                  votedFor := [votedFor EXCEPT ![self] = Nil];
                  leader := [leader EXCEPT ![self] = Nil];
                  if (((m).mterm) < ((currentTerm)[self])) {
                    skip;
                    goto serverLoop;
                  } else {
                    with (
                      i = self, 
                      j = (m).msource
                    ) {
                      assert ((m).mterm) = ((currentTerm)[i]);
                      votesResponded := [votesResponded EXCEPT ![i] = ((votesResponded)[i]) \union ({j})];
                      if ((m).mvoteGranted) {
                        votesGranted := [votesGranted EXCEPT ![i] = ((votesGranted)[i]) \union ({j})];
                        if ((((state)[i]) = (Candidate)) /\ (isQuorum((votesGranted)[i]))) {
                          with (value18 = TRUE) {
                            becomeLeaderCh := [becomeLeaderCh EXCEPT ![i] = Append((becomeLeaderCh)[i], value18)];
                            goto serverLoop;
                          };
                        } else {
                          goto serverLoop;
                        };
                      } else {
                        goto serverLoop;
                      };
                    };
                  };
                } else {
                  if (((m).mterm) < ((currentTerm)[self])) {
                    skip;
                    goto serverLoop;
                  } else {
                    with (
                      i = self, 
                      j = (m).msource
                    ) {
                      assert ((m).mterm) = ((currentTerm)[i]);
                      votesResponded := [votesResponded EXCEPT ![i] = ((votesResponded)[i]) \union ({j})];
                      if ((m).mvoteGranted) {
                        votesGranted := [votesGranted EXCEPT ![i] = ((votesGranted)[i]) \union ({j})];
                        if ((((state)[i]) = (Candidate)) /\ (isQuorum((votesGranted)[i]))) {
                          with (value19 = TRUE) {
                            becomeLeaderCh := [becomeLeaderCh EXCEPT ![i] = Append((becomeLeaderCh)[i], value19)];
                            goto serverLoop;
                          };
                        } else {
                          goto serverLoop;
                        };
                      } else {
                        goto serverLoop;
                      };
                    };
                  };
                };
              } else {
                if (((m).mtype) = (AppendEntriesRequest)) {
                  if (((m).mterm) > ((currentTerm)[self])) {
                    currentTerm := [currentTerm EXCEPT ![self] = (m).mterm];
                    with (state3 = [state EXCEPT ![self] = Follower]) {
                      votedFor := [votedFor EXCEPT ![self] = Nil];
                      with (
                        leader3 = [leader EXCEPT ![self] = Nil], 
                        i = self, 
                        j = (m).msource, 
                        logOK = (((m).mprevLogIndex) = (0)) \/ (((((m).mprevLogIndex) > (0)) /\ (((m).mprevLogIndex) <= (Len((log)[i])))) /\ (((m).mprevLogTerm) = ((((log)[i])[(m).mprevLogIndex]).term)))
                      ) {
                        assert ((m).mterm) <= ((currentTerm)[i]);
                        if (((m).mterm) = ((currentTerm)[i])) {
                          leader := [leader3 EXCEPT ![i] = (m).msource];
                          with (value20 = LeaderTimeoutReset) {
                            leaderTimeout := value20;
                            if ((((m).mterm) = ((currentTerm)[i])) /\ (((state3)[i]) = (Candidate))) {
                              state := [state3 EXCEPT ![i] = Follower];
                              if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                                either {
                                  with (value30 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                    await ((network)[j]).enabled;
                                    await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                    network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value30})), enabled |-> ((network)[j]).enabled]];
                                    goto serverLoop;
                                  };
                                } or {
                                  either {
                                    with (yielded_fd19 = FALSE) {
                                      await yielded_fd19;
                                      goto serverLoop;
                                    };
                                  } or {
                                    with (yielded_fd20 = TRUE) {
                                      await yielded_fd20;
                                      goto serverLoop;
                                    };
                                  };
                                };
                              } else {
                                assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                                with (
                                  index = ((m).mprevLogIndex) + (1), 
                                  value40 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                                ) {
                                  if (((value40).cmd) = (LogConcat)) {
                                    with (
                                      plog24 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value40).entries)], 
                                      log24 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value50 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value50).cmd) = (LogConcat)) {
                                        plog := [plog24 EXCEPT ![i] = ((plog24)[i]) \o ((value50).entries)];
                                        log := [log24 EXCEPT ![i] = ((log24)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result24 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result24)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result24)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value60 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value60})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd30 = FALSE) {
                                                await yielded_fd30;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd40 = TRUE) {
                                                await yielded_fd40;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value50).cmd) = (LogPop)) {
                                          plog := [plog24 EXCEPT ![i] = SubSeq((plog24)[i], 1, (Len((plog24)[i])) - ((value50).cnt))];
                                          log := [log24 EXCEPT ![i] = ((log24)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result25 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result25)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result25)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value61 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value61})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd31 = FALSE) {
                                                  await yielded_fd31;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd41 = TRUE) {
                                                  await yielded_fd41;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log24 EXCEPT ![i] = ((log24)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result26 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result26)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result26)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value62 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value62})), enabled |-> ((network)[j]).enabled]];
                                                plog := plog24;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd32 = FALSE) {
                                                  await yielded_fd32;
                                                  plog := plog24;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd42 = TRUE) {
                                                  await yielded_fd42;
                                                  plog := plog24;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value40).cmd) = (LogPop)) {
                                      with (
                                        plog25 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value40).cnt))], 
                                        log25 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                        value51 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                      ) {
                                        if (((value51).cmd) = (LogConcat)) {
                                          plog := [plog25 EXCEPT ![i] = ((plog25)[i]) \o ((value51).entries)];
                                          log := [log25 EXCEPT ![i] = ((log25)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result27 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result27)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result27)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value63 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value63})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd33 = FALSE) {
                                                  await yielded_fd33;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd43 = TRUE) {
                                                  await yielded_fd43;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          if (((value51).cmd) = (LogPop)) {
                                            plog := [plog25 EXCEPT ![i] = SubSeq((plog25)[i], 1, (Len((plog25)[i])) - ((value51).cnt))];
                                            log := [log25 EXCEPT ![i] = ((log25)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result28 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result28)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result28)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value64 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value64})), enabled |-> ((network)[j]).enabled]];
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd34 = FALSE) {
                                                    await yielded_fd34;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd44 = TRUE) {
                                                    await yielded_fd44;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          } else {
                                            log := [log25 EXCEPT ![i] = ((log25)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result29 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result29)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result29)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value65 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value65})), enabled |-> ((network)[j]).enabled]];
                                                  plog := plog25;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd35 = FALSE) {
                                                    await yielded_fd35;
                                                    plog := plog25;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd45 = TRUE) {
                                                    await yielded_fd45;
                                                    plog := plog25;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      with (
                                        log26 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                        value52 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                      ) {
                                        if (((value52).cmd) = (LogConcat)) {
                                          plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value52).entries)];
                                          log := [log26 EXCEPT ![i] = ((log26)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result30 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result30)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result30)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value66 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value66})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd36 = FALSE) {
                                                  await yielded_fd36;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd46 = TRUE) {
                                                  await yielded_fd46;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          if (((value52).cmd) = (LogPop)) {
                                            plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value52).cnt))];
                                            log := [log26 EXCEPT ![i] = ((log26)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result31 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result31)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result31)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value67 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value67})), enabled |-> ((network)[j]).enabled]];
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd37 = FALSE) {
                                                    await yielded_fd37;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd47 = TRUE) {
                                                    await yielded_fd47;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          } else {
                                            log := [log26 EXCEPT ![i] = ((log26)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result32 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result32)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result32)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value68 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value68})), enabled |-> ((network)[j]).enabled]];
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd38 = FALSE) {
                                                    await yielded_fd38;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd48 = TRUE) {
                                                    await yielded_fd48;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            } else {
                              if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state3)[i]) = (Follower))) /\ (~ (logOK)))) {
                                either {
                                  with (value31 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                    await ((network)[j]).enabled;
                                    await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                    network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value31})), enabled |-> ((network)[j]).enabled]];
                                    state := state3;
                                    goto serverLoop;
                                  };
                                } or {
                                  either {
                                    with (yielded_fd110 = FALSE) {
                                      await yielded_fd110;
                                      state := state3;
                                      goto serverLoop;
                                    };
                                  } or {
                                    with (yielded_fd21 = TRUE) {
                                      await yielded_fd21;
                                      state := state3;
                                      goto serverLoop;
                                    };
                                  };
                                };
                              } else {
                                assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state3)[i]) = (Follower))) /\ (logOK);
                                with (
                                  index = ((m).mprevLogIndex) + (1), 
                                  value41 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                                ) {
                                  if (((value41).cmd) = (LogConcat)) {
                                    with (
                                      plog26 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value41).entries)], 
                                      log27 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value53 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value53).cmd) = (LogConcat)) {
                                        plog := [plog26 EXCEPT ![i] = ((plog26)[i]) \o ((value53).entries)];
                                        log := [log27 EXCEPT ![i] = ((log27)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result33 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result33)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result33)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value69 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value69})), enabled |-> ((network)[j]).enabled]];
                                              state := state3;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd39 = FALSE) {
                                                await yielded_fd39;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd49 = TRUE) {
                                                await yielded_fd49;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value53).cmd) = (LogPop)) {
                                          plog := [plog26 EXCEPT ![i] = SubSeq((plog26)[i], 1, (Len((plog26)[i])) - ((value53).cnt))];
                                          log := [log27 EXCEPT ![i] = ((log27)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result34 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result34)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result34)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value610 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value610})), enabled |-> ((network)[j]).enabled]];
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd310 = FALSE) {
                                                  await yielded_fd310;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd410 = TRUE) {
                                                  await yielded_fd410;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log27 EXCEPT ![i] = ((log27)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result35 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result35)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result35)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value611 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value611})), enabled |-> ((network)[j]).enabled]];
                                                plog := plog26;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd311 = FALSE) {
                                                  await yielded_fd311;
                                                  plog := plog26;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd411 = TRUE) {
                                                  await yielded_fd411;
                                                  plog := plog26;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value41).cmd) = (LogPop)) {
                                      with (
                                        plog27 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value41).cnt))], 
                                        log28 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                        value54 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                      ) {
                                        if (((value54).cmd) = (LogConcat)) {
                                          plog := [plog27 EXCEPT ![i] = ((plog27)[i]) \o ((value54).entries)];
                                          log := [log28 EXCEPT ![i] = ((log28)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result36 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result36)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result36)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value612 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value612})), enabled |-> ((network)[j]).enabled]];
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd312 = FALSE) {
                                                  await yielded_fd312;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd412 = TRUE) {
                                                  await yielded_fd412;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          if (((value54).cmd) = (LogPop)) {
                                            plog := [plog27 EXCEPT ![i] = SubSeq((plog27)[i], 1, (Len((plog27)[i])) - ((value54).cnt))];
                                            log := [log28 EXCEPT ![i] = ((log28)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result37 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result37)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result37)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value613 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value613})), enabled |-> ((network)[j]).enabled]];
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd313 = FALSE) {
                                                    await yielded_fd313;
                                                    state := state3;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd413 = TRUE) {
                                                    await yielded_fd413;
                                                    state := state3;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          } else {
                                            log := [log28 EXCEPT ![i] = ((log28)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result38 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result38)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result38)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value614 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value614})), enabled |-> ((network)[j]).enabled]];
                                                  plog := plog27;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd314 = FALSE) {
                                                    await yielded_fd314;
                                                    plog := plog27;
                                                    state := state3;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd414 = TRUE) {
                                                    await yielded_fd414;
                                                    plog := plog27;
                                                    state := state3;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      with (
                                        log29 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                        value55 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                      ) {
                                        if (((value55).cmd) = (LogConcat)) {
                                          plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value55).entries)];
                                          log := [log29 EXCEPT ![i] = ((log29)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result39 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result39)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result39)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value615 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value615})), enabled |-> ((network)[j]).enabled]];
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd315 = FALSE) {
                                                  await yielded_fd315;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd415 = TRUE) {
                                                  await yielded_fd415;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          if (((value55).cmd) = (LogPop)) {
                                            plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value55).cnt))];
                                            log := [log29 EXCEPT ![i] = ((log29)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result40 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result40)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result40)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value616 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value616})), enabled |-> ((network)[j]).enabled]];
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd316 = FALSE) {
                                                    await yielded_fd316;
                                                    state := state3;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd416 = TRUE) {
                                                    await yielded_fd416;
                                                    state := state3;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          } else {
                                            log := [log29 EXCEPT ![i] = ((log29)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result41 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result41)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result41)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value617 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value617})), enabled |-> ((network)[j]).enabled]];
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd317 = FALSE) {
                                                    await yielded_fd317;
                                                    state := state3;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd417 = TRUE) {
                                                    await yielded_fd417;
                                                    state := state3;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        } else {
                          if ((((m).mterm) = ((currentTerm)[i])) /\ (((state3)[i]) = (Candidate))) {
                            state := [state3 EXCEPT ![i] = Follower];
                            if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                              either {
                                with (value32 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                  await ((network)[j]).enabled;
                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value32})), enabled |-> ((network)[j]).enabled]];
                                  leader := leader3;
                                  goto serverLoop;
                                };
                              } or {
                                either {
                                  with (yielded_fd111 = FALSE) {
                                    await yielded_fd111;
                                    leader := leader3;
                                    goto serverLoop;
                                  };
                                } or {
                                  with (yielded_fd22 = TRUE) {
                                    await yielded_fd22;
                                    leader := leader3;
                                    goto serverLoop;
                                  };
                                };
                              };
                            } else {
                              assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                              with (
                                index = ((m).mprevLogIndex) + (1), 
                                value42 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                              ) {
                                if (((value42).cmd) = (LogConcat)) {
                                  with (
                                    plog28 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value42).entries)], 
                                    log30 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value56 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value56).cmd) = (LogConcat)) {
                                      plog := [plog28 EXCEPT ![i] = ((plog28)[i]) \o ((value56).entries)];
                                      log := [log30 EXCEPT ![i] = ((log30)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result42 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result42)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result42)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value618 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value618})), enabled |-> ((network)[j]).enabled]];
                                            leader := leader3;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd318 = FALSE) {
                                              await yielded_fd318;
                                              leader := leader3;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd418 = TRUE) {
                                              await yielded_fd418;
                                              leader := leader3;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value56).cmd) = (LogPop)) {
                                        plog := [plog28 EXCEPT ![i] = SubSeq((plog28)[i], 1, (Len((plog28)[i])) - ((value56).cnt))];
                                        log := [log30 EXCEPT ![i] = ((log30)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result43 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result43)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result43)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value619 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value619})), enabled |-> ((network)[j]).enabled]];
                                              leader := leader3;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd319 = FALSE) {
                                                await yielded_fd319;
                                                leader := leader3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd419 = TRUE) {
                                                await yielded_fd419;
                                                leader := leader3;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log30 EXCEPT ![i] = ((log30)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result44 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result44)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result44)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value620 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value620})), enabled |-> ((network)[j]).enabled]];
                                              plog := plog28;
                                              leader := leader3;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd320 = FALSE) {
                                                await yielded_fd320;
                                                plog := plog28;
                                                leader := leader3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd420 = TRUE) {
                                                await yielded_fd420;
                                                plog := plog28;
                                                leader := leader3;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value42).cmd) = (LogPop)) {
                                    with (
                                      plog29 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value42).cnt))], 
                                      log31 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value57 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value57).cmd) = (LogConcat)) {
                                        plog := [plog29 EXCEPT ![i] = ((plog29)[i]) \o ((value57).entries)];
                                        log := [log31 EXCEPT ![i] = ((log31)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result45 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result45)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result45)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value621 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value621})), enabled |-> ((network)[j]).enabled]];
                                              leader := leader3;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd321 = FALSE) {
                                                await yielded_fd321;
                                                leader := leader3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd421 = TRUE) {
                                                await yielded_fd421;
                                                leader := leader3;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value57).cmd) = (LogPop)) {
                                          plog := [plog29 EXCEPT ![i] = SubSeq((plog29)[i], 1, (Len((plog29)[i])) - ((value57).cnt))];
                                          log := [log31 EXCEPT ![i] = ((log31)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result46 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result46)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result46)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value622 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value622})), enabled |-> ((network)[j]).enabled]];
                                                leader := leader3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd322 = FALSE) {
                                                  await yielded_fd322;
                                                  leader := leader3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd422 = TRUE) {
                                                  await yielded_fd422;
                                                  leader := leader3;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log31 EXCEPT ![i] = ((log31)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result47 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result47)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result47)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value623 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value623})), enabled |-> ((network)[j]).enabled]];
                                                plog := plog29;
                                                leader := leader3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd323 = FALSE) {
                                                  await yielded_fd323;
                                                  plog := plog29;
                                                  leader := leader3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd423 = TRUE) {
                                                  await yielded_fd423;
                                                  plog := plog29;
                                                  leader := leader3;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    with (
                                      log32 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value58 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value58).cmd) = (LogConcat)) {
                                        plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value58).entries)];
                                        log := [log32 EXCEPT ![i] = ((log32)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result48 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result48)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result48)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value624 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value624})), enabled |-> ((network)[j]).enabled]];
                                              leader := leader3;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd324 = FALSE) {
                                                await yielded_fd324;
                                                leader := leader3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd424 = TRUE) {
                                                await yielded_fd424;
                                                leader := leader3;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value58).cmd) = (LogPop)) {
                                          plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value58).cnt))];
                                          log := [log32 EXCEPT ![i] = ((log32)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result49 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result49)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result49)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value625 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value625})), enabled |-> ((network)[j]).enabled]];
                                                leader := leader3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd325 = FALSE) {
                                                  await yielded_fd325;
                                                  leader := leader3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd425 = TRUE) {
                                                  await yielded_fd425;
                                                  leader := leader3;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log32 EXCEPT ![i] = ((log32)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result50 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result50)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result50)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value626 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value626})), enabled |-> ((network)[j]).enabled]];
                                                leader := leader3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd326 = FALSE) {
                                                  await yielded_fd326;
                                                  leader := leader3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd426 = TRUE) {
                                                  await yielded_fd426;
                                                  leader := leader3;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          } else {
                            if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state3)[i]) = (Follower))) /\ (~ (logOK)))) {
                              either {
                                with (value33 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                  await ((network)[j]).enabled;
                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value33})), enabled |-> ((network)[j]).enabled]];
                                  leader := leader3;
                                  state := state3;
                                  goto serverLoop;
                                };
                              } or {
                                either {
                                  with (yielded_fd112 = FALSE) {
                                    await yielded_fd112;
                                    leader := leader3;
                                    state := state3;
                                    goto serverLoop;
                                  };
                                } or {
                                  with (yielded_fd23 = TRUE) {
                                    await yielded_fd23;
                                    leader := leader3;
                                    state := state3;
                                    goto serverLoop;
                                  };
                                };
                              };
                            } else {
                              assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state3)[i]) = (Follower))) /\ (logOK);
                              with (
                                index = ((m).mprevLogIndex) + (1), 
                                value43 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                              ) {
                                if (((value43).cmd) = (LogConcat)) {
                                  with (
                                    plog30 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value43).entries)], 
                                    log33 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value59 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value59).cmd) = (LogConcat)) {
                                      plog := [plog30 EXCEPT ![i] = ((plog30)[i]) \o ((value59).entries)];
                                      log := [log33 EXCEPT ![i] = ((log33)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result51 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result51)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result51)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value627 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value627})), enabled |-> ((network)[j]).enabled]];
                                            leader := leader3;
                                            state := state3;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd327 = FALSE) {
                                              await yielded_fd327;
                                              leader := leader3;
                                              state := state3;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd427 = TRUE) {
                                              await yielded_fd427;
                                              leader := leader3;
                                              state := state3;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value59).cmd) = (LogPop)) {
                                        plog := [plog30 EXCEPT ![i] = SubSeq((plog30)[i], 1, (Len((plog30)[i])) - ((value59).cnt))];
                                        log := [log33 EXCEPT ![i] = ((log33)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result52 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result52)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result52)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value628 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value628})), enabled |-> ((network)[j]).enabled]];
                                              leader := leader3;
                                              state := state3;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd328 = FALSE) {
                                                await yielded_fd328;
                                                leader := leader3;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd428 = TRUE) {
                                                await yielded_fd428;
                                                leader := leader3;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log33 EXCEPT ![i] = ((log33)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result53 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result53)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result53)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value629 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value629})), enabled |-> ((network)[j]).enabled]];
                                              plog := plog30;
                                              leader := leader3;
                                              state := state3;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd329 = FALSE) {
                                                await yielded_fd329;
                                                plog := plog30;
                                                leader := leader3;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd429 = TRUE) {
                                                await yielded_fd429;
                                                plog := plog30;
                                                leader := leader3;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value43).cmd) = (LogPop)) {
                                    with (
                                      plog31 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value43).cnt))], 
                                      log34 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value510 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value510).cmd) = (LogConcat)) {
                                        plog := [plog31 EXCEPT ![i] = ((plog31)[i]) \o ((value510).entries)];
                                        log := [log34 EXCEPT ![i] = ((log34)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result54 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result54)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result54)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value630 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value630})), enabled |-> ((network)[j]).enabled]];
                                              leader := leader3;
                                              state := state3;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd330 = FALSE) {
                                                await yielded_fd330;
                                                leader := leader3;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd430 = TRUE) {
                                                await yielded_fd430;
                                                leader := leader3;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value510).cmd) = (LogPop)) {
                                          plog := [plog31 EXCEPT ![i] = SubSeq((plog31)[i], 1, (Len((plog31)[i])) - ((value510).cnt))];
                                          log := [log34 EXCEPT ![i] = ((log34)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result55 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result55)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result55)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value631 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value631})), enabled |-> ((network)[j]).enabled]];
                                                leader := leader3;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd331 = FALSE) {
                                                  await yielded_fd331;
                                                  leader := leader3;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd431 = TRUE) {
                                                  await yielded_fd431;
                                                  leader := leader3;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log34 EXCEPT ![i] = ((log34)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result56 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result56)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result56)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value632 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value632})), enabled |-> ((network)[j]).enabled]];
                                                plog := plog31;
                                                leader := leader3;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd332 = FALSE) {
                                                  await yielded_fd332;
                                                  plog := plog31;
                                                  leader := leader3;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd432 = TRUE) {
                                                  await yielded_fd432;
                                                  plog := plog31;
                                                  leader := leader3;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    with (
                                      log35 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value511 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value511).cmd) = (LogConcat)) {
                                        plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value511).entries)];
                                        log := [log35 EXCEPT ![i] = ((log35)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result57 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result57)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result57)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value633 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value633})), enabled |-> ((network)[j]).enabled]];
                                              leader := leader3;
                                              state := state3;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd333 = FALSE) {
                                                await yielded_fd333;
                                                leader := leader3;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd433 = TRUE) {
                                                await yielded_fd433;
                                                leader := leader3;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value511).cmd) = (LogPop)) {
                                          plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value511).cnt))];
                                          log := [log35 EXCEPT ![i] = ((log35)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result58 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result58)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result58)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value634 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value634})), enabled |-> ((network)[j]).enabled]];
                                                leader := leader3;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd334 = FALSE) {
                                                  await yielded_fd334;
                                                  leader := leader3;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd434 = TRUE) {
                                                  await yielded_fd434;
                                                  leader := leader3;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log35 EXCEPT ![i] = ((log35)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result59 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result59)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result59)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value635 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value635})), enabled |-> ((network)[j]).enabled]];
                                                leader := leader3;
                                                state := state3;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd335 = FALSE) {
                                                  await yielded_fd335;
                                                  leader := leader3;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd435 = TRUE) {
                                                  await yielded_fd435;
                                                  leader := leader3;
                                                  state := state3;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        };
                      };
                    };
                  } else {
                    with (
                      i = self, 
                      j = (m).msource, 
                      logOK = (((m).mprevLogIndex) = (0)) \/ (((((m).mprevLogIndex) > (0)) /\ (((m).mprevLogIndex) <= (Len((log)[i])))) /\ (((m).mprevLogTerm) = ((((log)[i])[(m).mprevLogIndex]).term)))
                    ) {
                      assert ((m).mterm) <= ((currentTerm)[i]);
                      if (((m).mterm) = ((currentTerm)[i])) {
                        leader := [leader EXCEPT ![i] = (m).msource];
                        with (value21 = LeaderTimeoutReset) {
                          leaderTimeout := value21;
                          if ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Candidate))) {
                            state := [state EXCEPT ![i] = Follower];
                            if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                              either {
                                with (value34 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                  await ((network)[j]).enabled;
                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value34})), enabled |-> ((network)[j]).enabled]];
                                  goto serverLoop;
                                };
                              } or {
                                either {
                                  with (yielded_fd113 = FALSE) {
                                    await yielded_fd113;
                                    goto serverLoop;
                                  };
                                } or {
                                  with (yielded_fd24 = TRUE) {
                                    await yielded_fd24;
                                    goto serverLoop;
                                  };
                                };
                              };
                            } else {
                              assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                              with (
                                index = ((m).mprevLogIndex) + (1), 
                                value44 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                              ) {
                                if (((value44).cmd) = (LogConcat)) {
                                  with (
                                    plog32 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value44).entries)], 
                                    log36 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value512 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value512).cmd) = (LogConcat)) {
                                      plog := [plog32 EXCEPT ![i] = ((plog32)[i]) \o ((value512).entries)];
                                      log := [log36 EXCEPT ![i] = ((log36)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result60 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result60)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result60)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value636 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value636})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd336 = FALSE) {
                                              await yielded_fd336;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd436 = TRUE) {
                                              await yielded_fd436;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value512).cmd) = (LogPop)) {
                                        plog := [plog32 EXCEPT ![i] = SubSeq((plog32)[i], 1, (Len((plog32)[i])) - ((value512).cnt))];
                                        log := [log36 EXCEPT ![i] = ((log36)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result61 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result61)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result61)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value637 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value637})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd337 = FALSE) {
                                                await yielded_fd337;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd437 = TRUE) {
                                                await yielded_fd437;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log36 EXCEPT ![i] = ((log36)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result62 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result62)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result62)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value638 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value638})), enabled |-> ((network)[j]).enabled]];
                                              plog := plog32;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd338 = FALSE) {
                                                await yielded_fd338;
                                                plog := plog32;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd438 = TRUE) {
                                                await yielded_fd438;
                                                plog := plog32;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value44).cmd) = (LogPop)) {
                                    with (
                                      plog33 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value44).cnt))], 
                                      log37 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value513 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value513).cmd) = (LogConcat)) {
                                        plog := [plog33 EXCEPT ![i] = ((plog33)[i]) \o ((value513).entries)];
                                        log := [log37 EXCEPT ![i] = ((log37)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result63 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result63)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result63)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value639 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value639})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd339 = FALSE) {
                                                await yielded_fd339;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd439 = TRUE) {
                                                await yielded_fd439;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value513).cmd) = (LogPop)) {
                                          plog := [plog33 EXCEPT ![i] = SubSeq((plog33)[i], 1, (Len((plog33)[i])) - ((value513).cnt))];
                                          log := [log37 EXCEPT ![i] = ((log37)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result64 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result64)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result64)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value640 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value640})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd340 = FALSE) {
                                                  await yielded_fd340;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd440 = TRUE) {
                                                  await yielded_fd440;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log37 EXCEPT ![i] = ((log37)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result65 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result65)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result65)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value641 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value641})), enabled |-> ((network)[j]).enabled]];
                                                plog := plog33;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd341 = FALSE) {
                                                  await yielded_fd341;
                                                  plog := plog33;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd441 = TRUE) {
                                                  await yielded_fd441;
                                                  plog := plog33;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    with (
                                      log38 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value514 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value514).cmd) = (LogConcat)) {
                                        plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value514).entries)];
                                        log := [log38 EXCEPT ![i] = ((log38)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result66 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result66)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result66)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value642 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value642})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd342 = FALSE) {
                                                await yielded_fd342;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd442 = TRUE) {
                                                await yielded_fd442;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value514).cmd) = (LogPop)) {
                                          plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value514).cnt))];
                                          log := [log38 EXCEPT ![i] = ((log38)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result67 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result67)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result67)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value643 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value643})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd343 = FALSE) {
                                                  await yielded_fd343;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd443 = TRUE) {
                                                  await yielded_fd443;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log38 EXCEPT ![i] = ((log38)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result68 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result68)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result68)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value644 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value644})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd344 = FALSE) {
                                                  await yielded_fd344;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd444 = TRUE) {
                                                  await yielded_fd444;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          } else {
                            if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                              either {
                                with (value35 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                  await ((network)[j]).enabled;
                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value35})), enabled |-> ((network)[j]).enabled]];
                                  goto serverLoop;
                                };
                              } or {
                                either {
                                  with (yielded_fd114 = FALSE) {
                                    await yielded_fd114;
                                    goto serverLoop;
                                  };
                                } or {
                                  with (yielded_fd25 = TRUE) {
                                    await yielded_fd25;
                                    goto serverLoop;
                                  };
                                };
                              };
                            } else {
                              assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                              with (
                                index = ((m).mprevLogIndex) + (1), 
                                value45 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                              ) {
                                if (((value45).cmd) = (LogConcat)) {
                                  with (
                                    plog34 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value45).entries)], 
                                    log39 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value515 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value515).cmd) = (LogConcat)) {
                                      plog := [plog34 EXCEPT ![i] = ((plog34)[i]) \o ((value515).entries)];
                                      log := [log39 EXCEPT ![i] = ((log39)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result69 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result69)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result69)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value645 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value645})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd345 = FALSE) {
                                              await yielded_fd345;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd445 = TRUE) {
                                              await yielded_fd445;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value515).cmd) = (LogPop)) {
                                        plog := [plog34 EXCEPT ![i] = SubSeq((plog34)[i], 1, (Len((plog34)[i])) - ((value515).cnt))];
                                        log := [log39 EXCEPT ![i] = ((log39)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result70 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result70)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result70)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value646 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value646})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd346 = FALSE) {
                                                await yielded_fd346;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd446 = TRUE) {
                                                await yielded_fd446;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log39 EXCEPT ![i] = ((log39)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result71 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result71)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result71)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value647 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value647})), enabled |-> ((network)[j]).enabled]];
                                              plog := plog34;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd347 = FALSE) {
                                                await yielded_fd347;
                                                plog := plog34;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd447 = TRUE) {
                                                await yielded_fd447;
                                                plog := plog34;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value45).cmd) = (LogPop)) {
                                    with (
                                      plog35 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value45).cnt))], 
                                      log40 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value516 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value516).cmd) = (LogConcat)) {
                                        plog := [plog35 EXCEPT ![i] = ((plog35)[i]) \o ((value516).entries)];
                                        log := [log40 EXCEPT ![i] = ((log40)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result72 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result72)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result72)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value648 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value648})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd348 = FALSE) {
                                                await yielded_fd348;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd448 = TRUE) {
                                                await yielded_fd448;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value516).cmd) = (LogPop)) {
                                          plog := [plog35 EXCEPT ![i] = SubSeq((plog35)[i], 1, (Len((plog35)[i])) - ((value516).cnt))];
                                          log := [log40 EXCEPT ![i] = ((log40)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result73 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result73)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result73)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value649 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value649})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd349 = FALSE) {
                                                  await yielded_fd349;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd449 = TRUE) {
                                                  await yielded_fd449;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log40 EXCEPT ![i] = ((log40)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result74 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result74)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result74)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value650 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value650})), enabled |-> ((network)[j]).enabled]];
                                                plog := plog35;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd350 = FALSE) {
                                                  await yielded_fd350;
                                                  plog := plog35;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd450 = TRUE) {
                                                  await yielded_fd450;
                                                  plog := plog35;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    with (
                                      log41 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value517 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value517).cmd) = (LogConcat)) {
                                        plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value517).entries)];
                                        log := [log41 EXCEPT ![i] = ((log41)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result75 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result75)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result75)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value651 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value651})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd351 = FALSE) {
                                                await yielded_fd351;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd451 = TRUE) {
                                                await yielded_fd451;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value517).cmd) = (LogPop)) {
                                          plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value517).cnt))];
                                          log := [log41 EXCEPT ![i] = ((log41)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result76 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result76)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result76)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value652 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value652})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd352 = FALSE) {
                                                  await yielded_fd352;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd452 = TRUE) {
                                                  await yielded_fd452;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log41 EXCEPT ![i] = ((log41)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result77 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result77)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result77)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value653 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value653})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd353 = FALSE) {
                                                  await yielded_fd353;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd453 = TRUE) {
                                                  await yielded_fd453;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        };
                      } else {
                        if ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Candidate))) {
                          state := [state EXCEPT ![i] = Follower];
                          if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                            either {
                              with (value36 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                await ((network)[j]).enabled;
                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value36})), enabled |-> ((network)[j]).enabled]];
                                goto serverLoop;
                              };
                            } or {
                              either {
                                with (yielded_fd115 = FALSE) {
                                  await yielded_fd115;
                                  goto serverLoop;
                                };
                              } or {
                                with (yielded_fd26 = TRUE) {
                                  await yielded_fd26;
                                  goto serverLoop;
                                };
                              };
                            };
                          } else {
                            assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                            with (
                              index = ((m).mprevLogIndex) + (1), 
                              value46 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                            ) {
                              if (((value46).cmd) = (LogConcat)) {
                                with (
                                  plog36 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value46).entries)], 
                                  log42 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                  value518 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                ) {
                                  if (((value518).cmd) = (LogConcat)) {
                                    plog := [plog36 EXCEPT ![i] = ((plog36)[i]) \o ((value518).entries)];
                                    log := [log42 EXCEPT ![i] = ((log42)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result78 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result78)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result78)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value654 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value654})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd354 = FALSE) {
                                            await yielded_fd354;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd454 = TRUE) {
                                            await yielded_fd454;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value518).cmd) = (LogPop)) {
                                      plog := [plog36 EXCEPT ![i] = SubSeq((plog36)[i], 1, (Len((plog36)[i])) - ((value518).cnt))];
                                      log := [log42 EXCEPT ![i] = ((log42)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result79 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result79)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result79)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value655 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value655})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd355 = FALSE) {
                                              await yielded_fd355;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd455 = TRUE) {
                                              await yielded_fd455;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      log := [log42 EXCEPT ![i] = ((log42)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result80 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result80)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result80)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value656 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value656})), enabled |-> ((network)[j]).enabled]];
                                            plog := plog36;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd356 = FALSE) {
                                              await yielded_fd356;
                                              plog := plog36;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd456 = TRUE) {
                                              await yielded_fd456;
                                              plog := plog36;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              } else {
                                if (((value46).cmd) = (LogPop)) {
                                  with (
                                    plog37 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value46).cnt))], 
                                    log43 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value519 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value519).cmd) = (LogConcat)) {
                                      plog := [plog37 EXCEPT ![i] = ((plog37)[i]) \o ((value519).entries)];
                                      log := [log43 EXCEPT ![i] = ((log43)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result81 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result81)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result81)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value657 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value657})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd357 = FALSE) {
                                              await yielded_fd357;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd457 = TRUE) {
                                              await yielded_fd457;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value519).cmd) = (LogPop)) {
                                        plog := [plog37 EXCEPT ![i] = SubSeq((plog37)[i], 1, (Len((plog37)[i])) - ((value519).cnt))];
                                        log := [log43 EXCEPT ![i] = ((log43)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result82 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result82)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result82)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value658 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value658})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd358 = FALSE) {
                                                await yielded_fd358;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd458 = TRUE) {
                                                await yielded_fd458;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log43 EXCEPT ![i] = ((log43)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result83 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result83)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result83)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value659 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value659})), enabled |-> ((network)[j]).enabled]];
                                              plog := plog37;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd359 = FALSE) {
                                                await yielded_fd359;
                                                plog := plog37;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd459 = TRUE) {
                                                await yielded_fd459;
                                                plog := plog37;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  with (
                                    log44 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value520 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value520).cmd) = (LogConcat)) {
                                      plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value520).entries)];
                                      log := [log44 EXCEPT ![i] = ((log44)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result84 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result84)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result84)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value660 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value660})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd360 = FALSE) {
                                              await yielded_fd360;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd460 = TRUE) {
                                              await yielded_fd460;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value520).cmd) = (LogPop)) {
                                        plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value520).cnt))];
                                        log := [log44 EXCEPT ![i] = ((log44)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result85 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result85)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result85)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value661 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value661})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd361 = FALSE) {
                                                await yielded_fd361;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd461 = TRUE) {
                                                await yielded_fd461;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log44 EXCEPT ![i] = ((log44)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result86 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result86)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result86)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value662 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value662})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd362 = FALSE) {
                                                await yielded_fd362;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd462 = TRUE) {
                                                await yielded_fd462;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        } else {
                          if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                            either {
                              with (value37 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                await ((network)[j]).enabled;
                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value37})), enabled |-> ((network)[j]).enabled]];
                                goto serverLoop;
                              };
                            } or {
                              either {
                                with (yielded_fd116 = FALSE) {
                                  await yielded_fd116;
                                  goto serverLoop;
                                };
                              } or {
                                with (yielded_fd27 = TRUE) {
                                  await yielded_fd27;
                                  goto serverLoop;
                                };
                              };
                            };
                          } else {
                            assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                            with (
                              index = ((m).mprevLogIndex) + (1), 
                              value47 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                            ) {
                              if (((value47).cmd) = (LogConcat)) {
                                with (
                                  plog38 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value47).entries)], 
                                  log45 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                  value521 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                ) {
                                  if (((value521).cmd) = (LogConcat)) {
                                    plog := [plog38 EXCEPT ![i] = ((plog38)[i]) \o ((value521).entries)];
                                    log := [log45 EXCEPT ![i] = ((log45)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result87 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result87)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result87)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value663 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value663})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd363 = FALSE) {
                                            await yielded_fd363;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd463 = TRUE) {
                                            await yielded_fd463;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value521).cmd) = (LogPop)) {
                                      plog := [plog38 EXCEPT ![i] = SubSeq((plog38)[i], 1, (Len((plog38)[i])) - ((value521).cnt))];
                                      log := [log45 EXCEPT ![i] = ((log45)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result88 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result88)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result88)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value664 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value664})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd364 = FALSE) {
                                              await yielded_fd364;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd464 = TRUE) {
                                              await yielded_fd464;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      log := [log45 EXCEPT ![i] = ((log45)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result89 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result89)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result89)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value665 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value665})), enabled |-> ((network)[j]).enabled]];
                                            plog := plog38;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd365 = FALSE) {
                                              await yielded_fd365;
                                              plog := plog38;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd465 = TRUE) {
                                              await yielded_fd465;
                                              plog := plog38;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              } else {
                                if (((value47).cmd) = (LogPop)) {
                                  with (
                                    plog39 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value47).cnt))], 
                                    log46 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value522 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value522).cmd) = (LogConcat)) {
                                      plog := [plog39 EXCEPT ![i] = ((plog39)[i]) \o ((value522).entries)];
                                      log := [log46 EXCEPT ![i] = ((log46)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result90 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result90)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result90)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value666 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value666})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd366 = FALSE) {
                                              await yielded_fd366;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd466 = TRUE) {
                                              await yielded_fd466;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value522).cmd) = (LogPop)) {
                                        plog := [plog39 EXCEPT ![i] = SubSeq((plog39)[i], 1, (Len((plog39)[i])) - ((value522).cnt))];
                                        log := [log46 EXCEPT ![i] = ((log46)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result91 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result91)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result91)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value667 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value667})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd367 = FALSE) {
                                                await yielded_fd367;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd467 = TRUE) {
                                                await yielded_fd467;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log46 EXCEPT ![i] = ((log46)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result92 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result92)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result92)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value668 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value668})), enabled |-> ((network)[j]).enabled]];
                                              plog := plog39;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd368 = FALSE) {
                                                await yielded_fd368;
                                                plog := plog39;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd468 = TRUE) {
                                                await yielded_fd468;
                                                plog := plog39;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  with (
                                    log47 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value523 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value523).cmd) = (LogConcat)) {
                                      plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value523).entries)];
                                      log := [log47 EXCEPT ![i] = ((log47)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result93 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result93)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result93)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value669 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value669})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd369 = FALSE) {
                                              await yielded_fd369;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd469 = TRUE) {
                                              await yielded_fd469;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value523).cmd) = (LogPop)) {
                                        plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value523).cnt))];
                                        log := [log47 EXCEPT ![i] = ((log47)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result94 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result94)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result94)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value670 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value670})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd370 = FALSE) {
                                                await yielded_fd370;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd470 = TRUE) {
                                                await yielded_fd470;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log47 EXCEPT ![i] = ((log47)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result95 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result95)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result95)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value671 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value671})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd371 = FALSE) {
                                                await yielded_fd371;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd471 = TRUE) {
                                                await yielded_fd471;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        };
                      };
                    };
                  };
                } else {
                  if (((m).mtype) = (AppendEntriesResponse)) {
                    if (((m).mterm) > ((currentTerm)[self])) {
                      currentTerm := [currentTerm EXCEPT ![self] = (m).mterm];
                      state := [state EXCEPT ![self] = Follower];
                      votedFor := [votedFor EXCEPT ![self] = Nil];
                      leader := [leader EXCEPT ![self] = Nil];
                      if (((m).mterm) < ((currentTerm)[self])) {
                        skip;
                        goto serverLoop;
                      } else {
                        with (
                          i = self, 
                          j = (m).msource
                        ) {
                          assert ((m).mterm) = ((currentTerm)[i]);
                          if ((m).msuccess) {
                            nextIndex := [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = ((m).mmatchIndex) + (1)]];
                            matchIndex := [matchIndex EXCEPT ![i] = [(matchIndex)[i] EXCEPT ![j] = (m).mmatchIndex]];
                            goto serverLoop;
                          } else {
                            nextIndex := [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = Max({(((nextIndex)[i])[j]) - (1), 1})]];
                            goto serverLoop;
                          };
                        };
                      };
                    } else {
                      if (((m).mterm) < ((currentTerm)[self])) {
                        skip;
                        goto serverLoop;
                      } else {
                        with (
                          i = self, 
                          j = (m).msource
                        ) {
                          assert ((m).mterm) = ((currentTerm)[i]);
                          if ((m).msuccess) {
                            nextIndex := [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = ((m).mmatchIndex) + (1)]];
                            matchIndex := [matchIndex EXCEPT ![i] = [(matchIndex)[i] EXCEPT ![j] = (m).mmatchIndex]];
                            goto serverLoop;
                          } else {
                            nextIndex := [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = Max({(((nextIndex)[i])[j]) - (1), 1})]];
                            goto serverLoop;
                          };
                        };
                      };
                    };
                  } else {
                    if ((((m).mtype) = (ClientPutRequest)) \/ (((m).mtype) = (ClientGetRequest))) {
                      if (((state)[self]) = (Leader)) {
                        with (entry = [term |-> (currentTerm)[self], cmd |-> (m).mcmd, client |-> (m).msource]) {
                          log := [log EXCEPT ![self] = Append((log)[self], entry)];
                          with (value70 = [cmd |-> LogConcat, entries |-> <<entry>>]) {
                            if (((value70).cmd) = (LogConcat)) {
                              plog := [plog EXCEPT ![self] = ((plog)[self]) \o ((value70).entries)];
                              with (value80 = TRUE) {
                                appendEntriesCh := [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value80)];
                                goto serverLoop;
                              };
                            } else {
                              if (((value70).cmd) = (LogPop)) {
                                plog := [plog EXCEPT ![self] = SubSeq((plog)[self], 1, (Len((plog)[self])) - ((value70).cnt))];
                                with (value81 = TRUE) {
                                  appendEntriesCh := [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value81)];
                                  goto serverLoop;
                                };
                              } else {
                                with (value82 = TRUE) {
                                  appendEntriesCh := [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value82)];
                                  goto serverLoop;
                                };
                              };
                            };
                          };
                        };
                      } else {
                        with (
                          i = self, 
                          j = (m).msource, 
                          respType = IF (((m).mcmd).type) = (Put) THEN ClientPutResponse ELSE ClientGetResponse, 
                          value90 = [mtype |-> respType, msuccess |-> FALSE, mresponse |-> [idx |-> ((m).mcmd).idx, key |-> ((m).mcmd).key], mleaderHint |-> (leader)[i], msource |-> i, mdest |-> j]
                        ) {
                          await ((network)[j]).enabled;
                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value90})), enabled |-> ((network)[j]).enabled]];
                          goto serverLoop;
                        };
                      };
                    } else {
                      goto serverLoop;
                    };
                  };
                };
              };
            };
          } else {
            if (((m).mtype) = (RequestVoteRequest)) {
              if (((m).mterm) > ((currentTerm)[self])) {
                currentTerm := [currentTerm EXCEPT ![self] = (m).mterm];
                state := [state EXCEPT ![self] = Follower];
                with (votedFor4 = [votedFor EXCEPT ![self] = Nil]) {
                  leader := [leader EXCEPT ![self] = Nil];
                  with (
                    i = self, 
                    j = (m).msource, 
                    logOK = (((m).mlastLogTerm) > (LastTerm((log)[i]))) \/ ((((m).mlastLogTerm) = (LastTerm((log)[i]))) /\ (((m).mlastLogIndex) >= (Len((log)[i])))), 
                    grant = ((((m).mterm) = ((currentTerm)[i])) /\ (logOK)) /\ (((votedFor4)[self]) \in ({Nil, j}))
                  ) {
                    assert ((m).mterm) <= ((currentTerm)[i]);
                    if (grant) {
                      votedFor := [votedFor4 EXCEPT ![i] = j];
                      either {
                        with (value04 = [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j]) {
                          await ((network)[j]).enabled;
                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value04})), enabled |-> ((network)[j]).enabled]];
                          if (Debug) {
                            print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                            goto serverLoop;
                          } else {
                            goto serverLoop;
                          };
                        };
                      } or {
                        either {
                          with (yielded_fd28 = FALSE) {
                            await yielded_fd28;
                            if (Debug) {
                              print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                              goto serverLoop;
                            } else {
                              goto serverLoop;
                            };
                          };
                        } or {
                          with (yielded_fd04 = TRUE) {
                            await yielded_fd04;
                            if (Debug) {
                              print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                              goto serverLoop;
                            } else {
                              goto serverLoop;
                            };
                          };
                        };
                      };
                    } else {
                      either {
                        with (value05 = [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j]) {
                          await ((network)[j]).enabled;
                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value05})), enabled |-> ((network)[j]).enabled]];
                          if (Debug) {
                            print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                            votedFor := votedFor4;
                            goto serverLoop;
                          } else {
                            votedFor := votedFor4;
                            goto serverLoop;
                          };
                        };
                      } or {
                        either {
                          with (yielded_fd29 = FALSE) {
                            await yielded_fd29;
                            if (Debug) {
                              print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                              votedFor := votedFor4;
                              goto serverLoop;
                            } else {
                              votedFor := votedFor4;
                              goto serverLoop;
                            };
                          };
                        } or {
                          with (yielded_fd05 = TRUE) {
                            await yielded_fd05;
                            if (Debug) {
                              print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                              votedFor := votedFor4;
                              goto serverLoop;
                            } else {
                              votedFor := votedFor4;
                              goto serverLoop;
                            };
                          };
                        };
                      };
                    };
                  };
                };
              } else {
                with (
                  i = self, 
                  j = (m).msource, 
                  logOK = (((m).mlastLogTerm) > (LastTerm((log)[i]))) \/ ((((m).mlastLogTerm) = (LastTerm((log)[i]))) /\ (((m).mlastLogIndex) >= (Len((log)[i])))), 
                  grant = ((((m).mterm) = ((currentTerm)[i])) /\ (logOK)) /\ (((votedFor)[self]) \in ({Nil, j}))
                ) {
                  assert ((m).mterm) <= ((currentTerm)[i]);
                  if (grant) {
                    votedFor := [votedFor EXCEPT ![i] = j];
                    either {
                      with (value06 = [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j]) {
                        await ((network)[j]).enabled;
                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value06})), enabled |-> ((network)[j]).enabled]];
                        if (Debug) {
                          print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                          goto serverLoop;
                        } else {
                          goto serverLoop;
                        };
                      };
                    } or {
                      either {
                        with (yielded_fd50 = FALSE) {
                          await yielded_fd50;
                          if (Debug) {
                            print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                            goto serverLoop;
                          } else {
                            goto serverLoop;
                          };
                        };
                      } or {
                        with (yielded_fd06 = TRUE) {
                          await yielded_fd06;
                          if (Debug) {
                            print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                            goto serverLoop;
                          } else {
                            goto serverLoop;
                          };
                        };
                      };
                    };
                  } else {
                    either {
                      with (value07 = [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j]) {
                        await ((network)[j]).enabled;
                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value07})), enabled |-> ((network)[j]).enabled]];
                        if (Debug) {
                          print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                          goto serverLoop;
                        } else {
                          goto serverLoop;
                        };
                      };
                    } or {
                      either {
                        with (yielded_fd51 = FALSE) {
                          await yielded_fd51;
                          if (Debug) {
                            print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                            goto serverLoop;
                          } else {
                            goto serverLoop;
                          };
                        };
                      } or {
                        with (yielded_fd07 = TRUE) {
                          await yielded_fd07;
                          if (Debug) {
                            print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                            goto serverLoop;
                          } else {
                            goto serverLoop;
                          };
                        };
                      };
                    };
                  };
                };
              };
            } else {
              if (((m).mtype) = (RequestVoteResponse)) {
                if (((m).mterm) > ((currentTerm)[self])) {
                  currentTerm := [currentTerm EXCEPT ![self] = (m).mterm];
                  state := [state EXCEPT ![self] = Follower];
                  votedFor := [votedFor EXCEPT ![self] = Nil];
                  leader := [leader EXCEPT ![self] = Nil];
                  if (((m).mterm) < ((currentTerm)[self])) {
                    skip;
                    goto serverLoop;
                  } else {
                    with (
                      i = self, 
                      j = (m).msource
                    ) {
                      assert ((m).mterm) = ((currentTerm)[i]);
                      votesResponded := [votesResponded EXCEPT ![i] = ((votesResponded)[i]) \union ({j})];
                      if ((m).mvoteGranted) {
                        votesGranted := [votesGranted EXCEPT ![i] = ((votesGranted)[i]) \union ({j})];
                        if ((((state)[i]) = (Candidate)) /\ (isQuorum((votesGranted)[i]))) {
                          with (value110 = TRUE) {
                            becomeLeaderCh := [becomeLeaderCh EXCEPT ![i] = Append((becomeLeaderCh)[i], value110)];
                            goto serverLoop;
                          };
                        } else {
                          goto serverLoop;
                        };
                      } else {
                        goto serverLoop;
                      };
                    };
                  };
                } else {
                  if (((m).mterm) < ((currentTerm)[self])) {
                    skip;
                    goto serverLoop;
                  } else {
                    with (
                      i = self, 
                      j = (m).msource
                    ) {
                      assert ((m).mterm) = ((currentTerm)[i]);
                      votesResponded := [votesResponded EXCEPT ![i] = ((votesResponded)[i]) \union ({j})];
                      if ((m).mvoteGranted) {
                        votesGranted := [votesGranted EXCEPT ![i] = ((votesGranted)[i]) \union ({j})];
                        if ((((state)[i]) = (Candidate)) /\ (isQuorum((votesGranted)[i]))) {
                          with (value111 = TRUE) {
                            becomeLeaderCh := [becomeLeaderCh EXCEPT ![i] = Append((becomeLeaderCh)[i], value111)];
                            goto serverLoop;
                          };
                        } else {
                          goto serverLoop;
                        };
                      } else {
                        goto serverLoop;
                      };
                    };
                  };
                };
              } else {
                if (((m).mtype) = (AppendEntriesRequest)) {
                  if (((m).mterm) > ((currentTerm)[self])) {
                    currentTerm := [currentTerm EXCEPT ![self] = (m).mterm];
                    with (state4 = [state EXCEPT ![self] = Follower]) {
                      votedFor := [votedFor EXCEPT ![self] = Nil];
                      with (
                        leader4 = [leader EXCEPT ![self] = Nil], 
                        i = self, 
                        j = (m).msource, 
                        logOK = (((m).mprevLogIndex) = (0)) \/ (((((m).mprevLogIndex) > (0)) /\ (((m).mprevLogIndex) <= (Len((log)[i])))) /\ (((m).mprevLogTerm) = ((((log)[i])[(m).mprevLogIndex]).term)))
                      ) {
                        assert ((m).mterm) <= ((currentTerm)[i]);
                        if (((m).mterm) = ((currentTerm)[i])) {
                          leader := [leader4 EXCEPT ![i] = (m).msource];
                          with (value22 = LeaderTimeoutReset) {
                            leaderTimeout := value22;
                            if ((((m).mterm) = ((currentTerm)[i])) /\ (((state4)[i]) = (Candidate))) {
                              state := [state4 EXCEPT ![i] = Follower];
                              if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                                either {
                                  with (value38 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                    await ((network)[j]).enabled;
                                    await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                    network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value38})), enabled |-> ((network)[j]).enabled]];
                                    goto serverLoop;
                                  };
                                } or {
                                  either {
                                    with (yielded_fd117 = FALSE) {
                                      await yielded_fd117;
                                      goto serverLoop;
                                    };
                                  } or {
                                    with (yielded_fd210 = TRUE) {
                                      await yielded_fd210;
                                      goto serverLoop;
                                    };
                                  };
                                };
                              } else {
                                assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                                with (
                                  index = ((m).mprevLogIndex) + (1), 
                                  value48 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                                ) {
                                  if (((value48).cmd) = (LogConcat)) {
                                    with (
                                      plog40 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value48).entries)], 
                                      log48 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value524 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value524).cmd) = (LogConcat)) {
                                        plog := [plog40 EXCEPT ![i] = ((plog40)[i]) \o ((value524).entries)];
                                        log := [log48 EXCEPT ![i] = ((log48)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result96 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result96)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result96)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value672 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value672})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd372 = FALSE) {
                                                await yielded_fd372;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd472 = TRUE) {
                                                await yielded_fd472;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value524).cmd) = (LogPop)) {
                                          plog := [plog40 EXCEPT ![i] = SubSeq((plog40)[i], 1, (Len((plog40)[i])) - ((value524).cnt))];
                                          log := [log48 EXCEPT ![i] = ((log48)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result97 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result97)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result97)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value673 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value673})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd373 = FALSE) {
                                                  await yielded_fd373;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd473 = TRUE) {
                                                  await yielded_fd473;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log48 EXCEPT ![i] = ((log48)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result98 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result98)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result98)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value674 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value674})), enabled |-> ((network)[j]).enabled]];
                                                plog := plog40;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd374 = FALSE) {
                                                  await yielded_fd374;
                                                  plog := plog40;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd474 = TRUE) {
                                                  await yielded_fd474;
                                                  plog := plog40;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value48).cmd) = (LogPop)) {
                                      with (
                                        plog41 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value48).cnt))], 
                                        log49 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                        value525 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                      ) {
                                        if (((value525).cmd) = (LogConcat)) {
                                          plog := [plog41 EXCEPT ![i] = ((plog41)[i]) \o ((value525).entries)];
                                          log := [log49 EXCEPT ![i] = ((log49)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result99 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result99)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result99)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value675 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value675})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd375 = FALSE) {
                                                  await yielded_fd375;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd475 = TRUE) {
                                                  await yielded_fd475;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          if (((value525).cmd) = (LogPop)) {
                                            plog := [plog41 EXCEPT ![i] = SubSeq((plog41)[i], 1, (Len((plog41)[i])) - ((value525).cnt))];
                                            log := [log49 EXCEPT ![i] = ((log49)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result100 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result100)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result100)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value676 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value676})), enabled |-> ((network)[j]).enabled]];
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd376 = FALSE) {
                                                    await yielded_fd376;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd476 = TRUE) {
                                                    await yielded_fd476;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          } else {
                                            log := [log49 EXCEPT ![i] = ((log49)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result101 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result101)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result101)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value677 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value677})), enabled |-> ((network)[j]).enabled]];
                                                  plog := plog41;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd377 = FALSE) {
                                                    await yielded_fd377;
                                                    plog := plog41;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd477 = TRUE) {
                                                    await yielded_fd477;
                                                    plog := plog41;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      with (
                                        log50 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                        value526 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                      ) {
                                        if (((value526).cmd) = (LogConcat)) {
                                          plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value526).entries)];
                                          log := [log50 EXCEPT ![i] = ((log50)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result102 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result102)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result102)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value678 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value678})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd378 = FALSE) {
                                                  await yielded_fd378;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd478 = TRUE) {
                                                  await yielded_fd478;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          if (((value526).cmd) = (LogPop)) {
                                            plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value526).cnt))];
                                            log := [log50 EXCEPT ![i] = ((log50)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result103 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result103)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result103)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value679 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value679})), enabled |-> ((network)[j]).enabled]];
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd379 = FALSE) {
                                                    await yielded_fd379;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd479 = TRUE) {
                                                    await yielded_fd479;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          } else {
                                            log := [log50 EXCEPT ![i] = ((log50)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result104 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result104)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result104)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value680 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value680})), enabled |-> ((network)[j]).enabled]];
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd380 = FALSE) {
                                                    await yielded_fd380;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd480 = TRUE) {
                                                    await yielded_fd480;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            } else {
                              if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state4)[i]) = (Follower))) /\ (~ (logOK)))) {
                                either {
                                  with (value39 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                    await ((network)[j]).enabled;
                                    await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                    network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value39})), enabled |-> ((network)[j]).enabled]];
                                    state := state4;
                                    goto serverLoop;
                                  };
                                } or {
                                  either {
                                    with (yielded_fd118 = FALSE) {
                                      await yielded_fd118;
                                      state := state4;
                                      goto serverLoop;
                                    };
                                  } or {
                                    with (yielded_fd211 = TRUE) {
                                      await yielded_fd211;
                                      state := state4;
                                      goto serverLoop;
                                    };
                                  };
                                };
                              } else {
                                assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state4)[i]) = (Follower))) /\ (logOK);
                                with (
                                  index = ((m).mprevLogIndex) + (1), 
                                  value49 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                                ) {
                                  if (((value49).cmd) = (LogConcat)) {
                                    with (
                                      plog42 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value49).entries)], 
                                      log51 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value527 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value527).cmd) = (LogConcat)) {
                                        plog := [plog42 EXCEPT ![i] = ((plog42)[i]) \o ((value527).entries)];
                                        log := [log51 EXCEPT ![i] = ((log51)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result105 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result105)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result105)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value681 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value681})), enabled |-> ((network)[j]).enabled]];
                                              state := state4;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd381 = FALSE) {
                                                await yielded_fd381;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd481 = TRUE) {
                                                await yielded_fd481;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value527).cmd) = (LogPop)) {
                                          plog := [plog42 EXCEPT ![i] = SubSeq((plog42)[i], 1, (Len((plog42)[i])) - ((value527).cnt))];
                                          log := [log51 EXCEPT ![i] = ((log51)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result106 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result106)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result106)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value682 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value682})), enabled |-> ((network)[j]).enabled]];
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd382 = FALSE) {
                                                  await yielded_fd382;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd482 = TRUE) {
                                                  await yielded_fd482;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log51 EXCEPT ![i] = ((log51)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result107 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result107)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result107)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value683 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value683})), enabled |-> ((network)[j]).enabled]];
                                                plog := plog42;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd383 = FALSE) {
                                                  await yielded_fd383;
                                                  plog := plog42;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd483 = TRUE) {
                                                  await yielded_fd483;
                                                  plog := plog42;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value49).cmd) = (LogPop)) {
                                      with (
                                        plog43 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value49).cnt))], 
                                        log52 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                        value528 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                      ) {
                                        if (((value528).cmd) = (LogConcat)) {
                                          plog := [plog43 EXCEPT ![i] = ((plog43)[i]) \o ((value528).entries)];
                                          log := [log52 EXCEPT ![i] = ((log52)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result108 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result108)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result108)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value684 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value684})), enabled |-> ((network)[j]).enabled]];
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd384 = FALSE) {
                                                  await yielded_fd384;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd484 = TRUE) {
                                                  await yielded_fd484;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          if (((value528).cmd) = (LogPop)) {
                                            plog := [plog43 EXCEPT ![i] = SubSeq((plog43)[i], 1, (Len((plog43)[i])) - ((value528).cnt))];
                                            log := [log52 EXCEPT ![i] = ((log52)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result109 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result109)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result109)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value685 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value685})), enabled |-> ((network)[j]).enabled]];
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd385 = FALSE) {
                                                    await yielded_fd385;
                                                    state := state4;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd485 = TRUE) {
                                                    await yielded_fd485;
                                                    state := state4;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          } else {
                                            log := [log52 EXCEPT ![i] = ((log52)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result110 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result110)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result110)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value686 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value686})), enabled |-> ((network)[j]).enabled]];
                                                  plog := plog43;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd386 = FALSE) {
                                                    await yielded_fd386;
                                                    plog := plog43;
                                                    state := state4;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd486 = TRUE) {
                                                    await yielded_fd486;
                                                    plog := plog43;
                                                    state := state4;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      with (
                                        log53 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                        value529 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                      ) {
                                        if (((value529).cmd) = (LogConcat)) {
                                          plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value529).entries)];
                                          log := [log53 EXCEPT ![i] = ((log53)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result111 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result111)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result111)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value687 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value687})), enabled |-> ((network)[j]).enabled]];
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd387 = FALSE) {
                                                  await yielded_fd387;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd487 = TRUE) {
                                                  await yielded_fd487;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          if (((value529).cmd) = (LogPop)) {
                                            plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value529).cnt))];
                                            log := [log53 EXCEPT ![i] = ((log53)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result112 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result112)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result112)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value688 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value688})), enabled |-> ((network)[j]).enabled]];
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd388 = FALSE) {
                                                    await yielded_fd388;
                                                    state := state4;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd488 = TRUE) {
                                                    await yielded_fd488;
                                                    state := state4;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          } else {
                                            log := [log53 EXCEPT ![i] = ((log53)[i]) \o ((m).mentries)];
                                            assert ((m).mcommitIndex) <= (Len((log)[i]));
                                            with (result113 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                              sm := [sm EXCEPT ![i] = (result113)[1]];
                                              smDomain := [smDomain EXCEPT ![i] = (result113)[2]];
                                              commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                              either {
                                                with (value689 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                  await ((network)[j]).enabled;
                                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value689})), enabled |-> ((network)[j]).enabled]];
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                either {
                                                  with (yielded_fd389 = FALSE) {
                                                    await yielded_fd389;
                                                    state := state4;
                                                    goto serverLoop;
                                                  };
                                                } or {
                                                  with (yielded_fd489 = TRUE) {
                                                    await yielded_fd489;
                                                    state := state4;
                                                    goto serverLoop;
                                                  };
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        } else {
                          if ((((m).mterm) = ((currentTerm)[i])) /\ (((state4)[i]) = (Candidate))) {
                            state := [state4 EXCEPT ![i] = Follower];
                            if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                              either {
                                with (value310 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                  await ((network)[j]).enabled;
                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value310})), enabled |-> ((network)[j]).enabled]];
                                  leader := leader4;
                                  goto serverLoop;
                                };
                              } or {
                                either {
                                  with (yielded_fd119 = FALSE) {
                                    await yielded_fd119;
                                    leader := leader4;
                                    goto serverLoop;
                                  };
                                } or {
                                  with (yielded_fd212 = TRUE) {
                                    await yielded_fd212;
                                    leader := leader4;
                                    goto serverLoop;
                                  };
                                };
                              };
                            } else {
                              assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                              with (
                                index = ((m).mprevLogIndex) + (1), 
                                value410 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                              ) {
                                if (((value410).cmd) = (LogConcat)) {
                                  with (
                                    plog44 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value410).entries)], 
                                    log54 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value530 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value530).cmd) = (LogConcat)) {
                                      plog := [plog44 EXCEPT ![i] = ((plog44)[i]) \o ((value530).entries)];
                                      log := [log54 EXCEPT ![i] = ((log54)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result114 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result114)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result114)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value690 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value690})), enabled |-> ((network)[j]).enabled]];
                                            leader := leader4;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd390 = FALSE) {
                                              await yielded_fd390;
                                              leader := leader4;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd490 = TRUE) {
                                              await yielded_fd490;
                                              leader := leader4;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value530).cmd) = (LogPop)) {
                                        plog := [plog44 EXCEPT ![i] = SubSeq((plog44)[i], 1, (Len((plog44)[i])) - ((value530).cnt))];
                                        log := [log54 EXCEPT ![i] = ((log54)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result115 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result115)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result115)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value691 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value691})), enabled |-> ((network)[j]).enabled]];
                                              leader := leader4;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd391 = FALSE) {
                                                await yielded_fd391;
                                                leader := leader4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd491 = TRUE) {
                                                await yielded_fd491;
                                                leader := leader4;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log54 EXCEPT ![i] = ((log54)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result116 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result116)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result116)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value692 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value692})), enabled |-> ((network)[j]).enabled]];
                                              plog := plog44;
                                              leader := leader4;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd392 = FALSE) {
                                                await yielded_fd392;
                                                plog := plog44;
                                                leader := leader4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd492 = TRUE) {
                                                await yielded_fd492;
                                                plog := plog44;
                                                leader := leader4;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value410).cmd) = (LogPop)) {
                                    with (
                                      plog45 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value410).cnt))], 
                                      log55 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value531 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value531).cmd) = (LogConcat)) {
                                        plog := [plog45 EXCEPT ![i] = ((plog45)[i]) \o ((value531).entries)];
                                        log := [log55 EXCEPT ![i] = ((log55)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result117 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result117)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result117)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value693 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value693})), enabled |-> ((network)[j]).enabled]];
                                              leader := leader4;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd393 = FALSE) {
                                                await yielded_fd393;
                                                leader := leader4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd493 = TRUE) {
                                                await yielded_fd493;
                                                leader := leader4;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value531).cmd) = (LogPop)) {
                                          plog := [plog45 EXCEPT ![i] = SubSeq((plog45)[i], 1, (Len((plog45)[i])) - ((value531).cnt))];
                                          log := [log55 EXCEPT ![i] = ((log55)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result118 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result118)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result118)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value694 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value694})), enabled |-> ((network)[j]).enabled]];
                                                leader := leader4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd394 = FALSE) {
                                                  await yielded_fd394;
                                                  leader := leader4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd494 = TRUE) {
                                                  await yielded_fd494;
                                                  leader := leader4;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log55 EXCEPT ![i] = ((log55)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result119 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result119)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result119)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value695 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value695})), enabled |-> ((network)[j]).enabled]];
                                                plog := plog45;
                                                leader := leader4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd395 = FALSE) {
                                                  await yielded_fd395;
                                                  plog := plog45;
                                                  leader := leader4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd495 = TRUE) {
                                                  await yielded_fd495;
                                                  plog := plog45;
                                                  leader := leader4;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    with (
                                      log56 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value532 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value532).cmd) = (LogConcat)) {
                                        plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value532).entries)];
                                        log := [log56 EXCEPT ![i] = ((log56)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result120 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result120)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result120)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value696 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value696})), enabled |-> ((network)[j]).enabled]];
                                              leader := leader4;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd396 = FALSE) {
                                                await yielded_fd396;
                                                leader := leader4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd496 = TRUE) {
                                                await yielded_fd496;
                                                leader := leader4;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value532).cmd) = (LogPop)) {
                                          plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value532).cnt))];
                                          log := [log56 EXCEPT ![i] = ((log56)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result121 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result121)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result121)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value697 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value697})), enabled |-> ((network)[j]).enabled]];
                                                leader := leader4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd397 = FALSE) {
                                                  await yielded_fd397;
                                                  leader := leader4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd497 = TRUE) {
                                                  await yielded_fd497;
                                                  leader := leader4;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log56 EXCEPT ![i] = ((log56)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result122 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result122)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result122)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value698 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value698})), enabled |-> ((network)[j]).enabled]];
                                                leader := leader4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd398 = FALSE) {
                                                  await yielded_fd398;
                                                  leader := leader4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd498 = TRUE) {
                                                  await yielded_fd498;
                                                  leader := leader4;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          } else {
                            if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state4)[i]) = (Follower))) /\ (~ (logOK)))) {
                              either {
                                with (value311 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                  await ((network)[j]).enabled;
                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value311})), enabled |-> ((network)[j]).enabled]];
                                  leader := leader4;
                                  state := state4;
                                  goto serverLoop;
                                };
                              } or {
                                either {
                                  with (yielded_fd120 = FALSE) {
                                    await yielded_fd120;
                                    leader := leader4;
                                    state := state4;
                                    goto serverLoop;
                                  };
                                } or {
                                  with (yielded_fd213 = TRUE) {
                                    await yielded_fd213;
                                    leader := leader4;
                                    state := state4;
                                    goto serverLoop;
                                  };
                                };
                              };
                            } else {
                              assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state4)[i]) = (Follower))) /\ (logOK);
                              with (
                                index = ((m).mprevLogIndex) + (1), 
                                value411 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                              ) {
                                if (((value411).cmd) = (LogConcat)) {
                                  with (
                                    plog46 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value411).entries)], 
                                    log57 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value533 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value533).cmd) = (LogConcat)) {
                                      plog := [plog46 EXCEPT ![i] = ((plog46)[i]) \o ((value533).entries)];
                                      log := [log57 EXCEPT ![i] = ((log57)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result123 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result123)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result123)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value699 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value699})), enabled |-> ((network)[j]).enabled]];
                                            leader := leader4;
                                            state := state4;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd399 = FALSE) {
                                              await yielded_fd399;
                                              leader := leader4;
                                              state := state4;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd499 = TRUE) {
                                              await yielded_fd499;
                                              leader := leader4;
                                              state := state4;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value533).cmd) = (LogPop)) {
                                        plog := [plog46 EXCEPT ![i] = SubSeq((plog46)[i], 1, (Len((plog46)[i])) - ((value533).cnt))];
                                        log := [log57 EXCEPT ![i] = ((log57)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result124 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result124)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result124)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6100 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6100})), enabled |-> ((network)[j]).enabled]];
                                              leader := leader4;
                                              state := state4;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3100 = FALSE) {
                                                await yielded_fd3100;
                                                leader := leader4;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4100 = TRUE) {
                                                await yielded_fd4100;
                                                leader := leader4;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log57 EXCEPT ![i] = ((log57)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result125 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result125)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result125)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6101 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6101})), enabled |-> ((network)[j]).enabled]];
                                              plog := plog46;
                                              leader := leader4;
                                              state := state4;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3101 = FALSE) {
                                                await yielded_fd3101;
                                                plog := plog46;
                                                leader := leader4;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4101 = TRUE) {
                                                await yielded_fd4101;
                                                plog := plog46;
                                                leader := leader4;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value411).cmd) = (LogPop)) {
                                    with (
                                      plog47 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value411).cnt))], 
                                      log58 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value534 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value534).cmd) = (LogConcat)) {
                                        plog := [plog47 EXCEPT ![i] = ((plog47)[i]) \o ((value534).entries)];
                                        log := [log58 EXCEPT ![i] = ((log58)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result126 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result126)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result126)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6102 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6102})), enabled |-> ((network)[j]).enabled]];
                                              leader := leader4;
                                              state := state4;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3102 = FALSE) {
                                                await yielded_fd3102;
                                                leader := leader4;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4102 = TRUE) {
                                                await yielded_fd4102;
                                                leader := leader4;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value534).cmd) = (LogPop)) {
                                          plog := [plog47 EXCEPT ![i] = SubSeq((plog47)[i], 1, (Len((plog47)[i])) - ((value534).cnt))];
                                          log := [log58 EXCEPT ![i] = ((log58)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result127 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result127)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result127)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value6103 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6103})), enabled |-> ((network)[j]).enabled]];
                                                leader := leader4;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd3103 = FALSE) {
                                                  await yielded_fd3103;
                                                  leader := leader4;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd4103 = TRUE) {
                                                  await yielded_fd4103;
                                                  leader := leader4;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log58 EXCEPT ![i] = ((log58)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result128 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result128)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result128)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value6104 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6104})), enabled |-> ((network)[j]).enabled]];
                                                plog := plog47;
                                                leader := leader4;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd3104 = FALSE) {
                                                  await yielded_fd3104;
                                                  plog := plog47;
                                                  leader := leader4;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd4104 = TRUE) {
                                                  await yielded_fd4104;
                                                  plog := plog47;
                                                  leader := leader4;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    with (
                                      log59 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value535 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value535).cmd) = (LogConcat)) {
                                        plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value535).entries)];
                                        log := [log59 EXCEPT ![i] = ((log59)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result129 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result129)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result129)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6105 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6105})), enabled |-> ((network)[j]).enabled]];
                                              leader := leader4;
                                              state := state4;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3105 = FALSE) {
                                                await yielded_fd3105;
                                                leader := leader4;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4105 = TRUE) {
                                                await yielded_fd4105;
                                                leader := leader4;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value535).cmd) = (LogPop)) {
                                          plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value535).cnt))];
                                          log := [log59 EXCEPT ![i] = ((log59)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result130 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result130)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result130)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value6106 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6106})), enabled |-> ((network)[j]).enabled]];
                                                leader := leader4;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd3106 = FALSE) {
                                                  await yielded_fd3106;
                                                  leader := leader4;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd4106 = TRUE) {
                                                  await yielded_fd4106;
                                                  leader := leader4;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log59 EXCEPT ![i] = ((log59)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result131 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result131)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result131)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value6107 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6107})), enabled |-> ((network)[j]).enabled]];
                                                leader := leader4;
                                                state := state4;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd3107 = FALSE) {
                                                  await yielded_fd3107;
                                                  leader := leader4;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd4107 = TRUE) {
                                                  await yielded_fd4107;
                                                  leader := leader4;
                                                  state := state4;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        };
                      };
                    };
                  } else {
                    with (
                      i = self, 
                      j = (m).msource, 
                      logOK = (((m).mprevLogIndex) = (0)) \/ (((((m).mprevLogIndex) > (0)) /\ (((m).mprevLogIndex) <= (Len((log)[i])))) /\ (((m).mprevLogTerm) = ((((log)[i])[(m).mprevLogIndex]).term)))
                    ) {
                      assert ((m).mterm) <= ((currentTerm)[i]);
                      if (((m).mterm) = ((currentTerm)[i])) {
                        leader := [leader EXCEPT ![i] = (m).msource];
                        with (value23 = LeaderTimeoutReset) {
                          leaderTimeout := value23;
                          if ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Candidate))) {
                            state := [state EXCEPT ![i] = Follower];
                            if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                              either {
                                with (value312 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                  await ((network)[j]).enabled;
                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value312})), enabled |-> ((network)[j]).enabled]];
                                  goto serverLoop;
                                };
                              } or {
                                either {
                                  with (yielded_fd121 = FALSE) {
                                    await yielded_fd121;
                                    goto serverLoop;
                                  };
                                } or {
                                  with (yielded_fd214 = TRUE) {
                                    await yielded_fd214;
                                    goto serverLoop;
                                  };
                                };
                              };
                            } else {
                              assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                              with (
                                index = ((m).mprevLogIndex) + (1), 
                                value412 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                              ) {
                                if (((value412).cmd) = (LogConcat)) {
                                  with (
                                    plog48 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value412).entries)], 
                                    log60 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value536 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value536).cmd) = (LogConcat)) {
                                      plog := [plog48 EXCEPT ![i] = ((plog48)[i]) \o ((value536).entries)];
                                      log := [log60 EXCEPT ![i] = ((log60)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result132 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result132)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result132)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6108 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6108})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3108 = FALSE) {
                                              await yielded_fd3108;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4108 = TRUE) {
                                              await yielded_fd4108;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value536).cmd) = (LogPop)) {
                                        plog := [plog48 EXCEPT ![i] = SubSeq((plog48)[i], 1, (Len((plog48)[i])) - ((value536).cnt))];
                                        log := [log60 EXCEPT ![i] = ((log60)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result133 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result133)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result133)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6109 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6109})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3109 = FALSE) {
                                                await yielded_fd3109;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4109 = TRUE) {
                                                await yielded_fd4109;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log60 EXCEPT ![i] = ((log60)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result134 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result134)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result134)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6110 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6110})), enabled |-> ((network)[j]).enabled]];
                                              plog := plog48;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3110 = FALSE) {
                                                await yielded_fd3110;
                                                plog := plog48;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4110 = TRUE) {
                                                await yielded_fd4110;
                                                plog := plog48;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value412).cmd) = (LogPop)) {
                                    with (
                                      plog49 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value412).cnt))], 
                                      log61 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value537 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value537).cmd) = (LogConcat)) {
                                        plog := [plog49 EXCEPT ![i] = ((plog49)[i]) \o ((value537).entries)];
                                        log := [log61 EXCEPT ![i] = ((log61)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result135 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result135)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result135)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6111 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6111})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3111 = FALSE) {
                                                await yielded_fd3111;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4111 = TRUE) {
                                                await yielded_fd4111;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value537).cmd) = (LogPop)) {
                                          plog := [plog49 EXCEPT ![i] = SubSeq((plog49)[i], 1, (Len((plog49)[i])) - ((value537).cnt))];
                                          log := [log61 EXCEPT ![i] = ((log61)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result136 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result136)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result136)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value6112 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6112})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd3112 = FALSE) {
                                                  await yielded_fd3112;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd4112 = TRUE) {
                                                  await yielded_fd4112;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log61 EXCEPT ![i] = ((log61)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result137 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result137)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result137)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value6113 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6113})), enabled |-> ((network)[j]).enabled]];
                                                plog := plog49;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd3113 = FALSE) {
                                                  await yielded_fd3113;
                                                  plog := plog49;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd4113 = TRUE) {
                                                  await yielded_fd4113;
                                                  plog := plog49;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    with (
                                      log62 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value538 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value538).cmd) = (LogConcat)) {
                                        plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value538).entries)];
                                        log := [log62 EXCEPT ![i] = ((log62)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result138 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result138)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result138)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6114 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6114})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3114 = FALSE) {
                                                await yielded_fd3114;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4114 = TRUE) {
                                                await yielded_fd4114;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value538).cmd) = (LogPop)) {
                                          plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value538).cnt))];
                                          log := [log62 EXCEPT ![i] = ((log62)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result139 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result139)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result139)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value6115 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6115})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd3115 = FALSE) {
                                                  await yielded_fd3115;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd4115 = TRUE) {
                                                  await yielded_fd4115;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log62 EXCEPT ![i] = ((log62)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result140 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result140)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result140)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value6116 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6116})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd3116 = FALSE) {
                                                  await yielded_fd3116;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd4116 = TRUE) {
                                                  await yielded_fd4116;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          } else {
                            if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                              either {
                                with (value313 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                  await ((network)[j]).enabled;
                                  await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                  network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value313})), enabled |-> ((network)[j]).enabled]];
                                  goto serverLoop;
                                };
                              } or {
                                either {
                                  with (yielded_fd122 = FALSE) {
                                    await yielded_fd122;
                                    goto serverLoop;
                                  };
                                } or {
                                  with (yielded_fd215 = TRUE) {
                                    await yielded_fd215;
                                    goto serverLoop;
                                  };
                                };
                              };
                            } else {
                              assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                              with (
                                index = ((m).mprevLogIndex) + (1), 
                                value413 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                              ) {
                                if (((value413).cmd) = (LogConcat)) {
                                  with (
                                    plog50 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value413).entries)], 
                                    log63 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value539 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value539).cmd) = (LogConcat)) {
                                      plog := [plog50 EXCEPT ![i] = ((plog50)[i]) \o ((value539).entries)];
                                      log := [log63 EXCEPT ![i] = ((log63)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result141 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result141)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result141)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6117 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6117})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3117 = FALSE) {
                                              await yielded_fd3117;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4117 = TRUE) {
                                              await yielded_fd4117;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value539).cmd) = (LogPop)) {
                                        plog := [plog50 EXCEPT ![i] = SubSeq((plog50)[i], 1, (Len((plog50)[i])) - ((value539).cnt))];
                                        log := [log63 EXCEPT ![i] = ((log63)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result142 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result142)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result142)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6118 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6118})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3118 = FALSE) {
                                                await yielded_fd3118;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4118 = TRUE) {
                                                await yielded_fd4118;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log63 EXCEPT ![i] = ((log63)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result143 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result143)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result143)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6119 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6119})), enabled |-> ((network)[j]).enabled]];
                                              plog := plog50;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3119 = FALSE) {
                                                await yielded_fd3119;
                                                plog := plog50;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4119 = TRUE) {
                                                await yielded_fd4119;
                                                plog := plog50;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value413).cmd) = (LogPop)) {
                                    with (
                                      plog51 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value413).cnt))], 
                                      log64 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value540 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value540).cmd) = (LogConcat)) {
                                        plog := [plog51 EXCEPT ![i] = ((plog51)[i]) \o ((value540).entries)];
                                        log := [log64 EXCEPT ![i] = ((log64)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result144 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result144)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result144)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6120 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6120})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3120 = FALSE) {
                                                await yielded_fd3120;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4120 = TRUE) {
                                                await yielded_fd4120;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value540).cmd) = (LogPop)) {
                                          plog := [plog51 EXCEPT ![i] = SubSeq((plog51)[i], 1, (Len((plog51)[i])) - ((value540).cnt))];
                                          log := [log64 EXCEPT ![i] = ((log64)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result145 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result145)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result145)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value6121 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6121})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd3121 = FALSE) {
                                                  await yielded_fd3121;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd4121 = TRUE) {
                                                  await yielded_fd4121;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log64 EXCEPT ![i] = ((log64)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result146 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result146)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result146)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value6122 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6122})), enabled |-> ((network)[j]).enabled]];
                                                plog := plog51;
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd3122 = FALSE) {
                                                  await yielded_fd3122;
                                                  plog := plog51;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd4122 = TRUE) {
                                                  await yielded_fd4122;
                                                  plog := plog51;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    with (
                                      log65 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                      value541 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                    ) {
                                      if (((value541).cmd) = (LogConcat)) {
                                        plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value541).entries)];
                                        log := [log65 EXCEPT ![i] = ((log65)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result147 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result147)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result147)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6123 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6123})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3123 = FALSE) {
                                                await yielded_fd3123;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4123 = TRUE) {
                                                await yielded_fd4123;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        if (((value541).cmd) = (LogPop)) {
                                          plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value541).cnt))];
                                          log := [log65 EXCEPT ![i] = ((log65)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result148 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result148)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result148)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value6124 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6124})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd3124 = FALSE) {
                                                  await yielded_fd3124;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd4124 = TRUE) {
                                                  await yielded_fd4124;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        } else {
                                          log := [log65 EXCEPT ![i] = ((log65)[i]) \o ((m).mentries)];
                                          assert ((m).mcommitIndex) <= (Len((log)[i]));
                                          with (result149 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                            sm := [sm EXCEPT ![i] = (result149)[1]];
                                            smDomain := [smDomain EXCEPT ![i] = (result149)[2]];
                                            commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                            either {
                                              with (value6125 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                                await ((network)[j]).enabled;
                                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6125})), enabled |-> ((network)[j]).enabled]];
                                                goto serverLoop;
                                              };
                                            } or {
                                              either {
                                                with (yielded_fd3125 = FALSE) {
                                                  await yielded_fd3125;
                                                  goto serverLoop;
                                                };
                                              } or {
                                                with (yielded_fd4125 = TRUE) {
                                                  await yielded_fd4125;
                                                  goto serverLoop;
                                                };
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        };
                      } else {
                        if ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Candidate))) {
                          state := [state EXCEPT ![i] = Follower];
                          if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                            either {
                              with (value314 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                await ((network)[j]).enabled;
                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value314})), enabled |-> ((network)[j]).enabled]];
                                goto serverLoop;
                              };
                            } or {
                              either {
                                with (yielded_fd123 = FALSE) {
                                  await yielded_fd123;
                                  goto serverLoop;
                                };
                              } or {
                                with (yielded_fd216 = TRUE) {
                                  await yielded_fd216;
                                  goto serverLoop;
                                };
                              };
                            };
                          } else {
                            assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                            with (
                              index = ((m).mprevLogIndex) + (1), 
                              value414 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                            ) {
                              if (((value414).cmd) = (LogConcat)) {
                                with (
                                  plog52 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value414).entries)], 
                                  log66 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                  value542 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                ) {
                                  if (((value542).cmd) = (LogConcat)) {
                                    plog := [plog52 EXCEPT ![i] = ((plog52)[i]) \o ((value542).entries)];
                                    log := [log66 EXCEPT ![i] = ((log66)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result150 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result150)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result150)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6126 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6126})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3126 = FALSE) {
                                            await yielded_fd3126;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4126 = TRUE) {
                                            await yielded_fd4126;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value542).cmd) = (LogPop)) {
                                      plog := [plog52 EXCEPT ![i] = SubSeq((plog52)[i], 1, (Len((plog52)[i])) - ((value542).cnt))];
                                      log := [log66 EXCEPT ![i] = ((log66)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result151 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result151)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result151)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6127 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6127})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3127 = FALSE) {
                                              await yielded_fd3127;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4127 = TRUE) {
                                              await yielded_fd4127;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      log := [log66 EXCEPT ![i] = ((log66)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result152 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result152)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result152)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6128 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6128})), enabled |-> ((network)[j]).enabled]];
                                            plog := plog52;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3128 = FALSE) {
                                              await yielded_fd3128;
                                              plog := plog52;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4128 = TRUE) {
                                              await yielded_fd4128;
                                              plog := plog52;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              } else {
                                if (((value414).cmd) = (LogPop)) {
                                  with (
                                    plog53 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value414).cnt))], 
                                    log67 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value543 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value543).cmd) = (LogConcat)) {
                                      plog := [plog53 EXCEPT ![i] = ((plog53)[i]) \o ((value543).entries)];
                                      log := [log67 EXCEPT ![i] = ((log67)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result153 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result153)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result153)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6129 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6129})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3129 = FALSE) {
                                              await yielded_fd3129;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4129 = TRUE) {
                                              await yielded_fd4129;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value543).cmd) = (LogPop)) {
                                        plog := [plog53 EXCEPT ![i] = SubSeq((plog53)[i], 1, (Len((plog53)[i])) - ((value543).cnt))];
                                        log := [log67 EXCEPT ![i] = ((log67)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result154 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result154)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result154)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6130 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6130})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3130 = FALSE) {
                                                await yielded_fd3130;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4130 = TRUE) {
                                                await yielded_fd4130;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log67 EXCEPT ![i] = ((log67)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result155 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result155)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result155)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6131 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6131})), enabled |-> ((network)[j]).enabled]];
                                              plog := plog53;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3131 = FALSE) {
                                                await yielded_fd3131;
                                                plog := plog53;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4131 = TRUE) {
                                                await yielded_fd4131;
                                                plog := plog53;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  with (
                                    log68 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value544 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value544).cmd) = (LogConcat)) {
                                      plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value544).entries)];
                                      log := [log68 EXCEPT ![i] = ((log68)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result156 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result156)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result156)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6132 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6132})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3132 = FALSE) {
                                              await yielded_fd3132;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4132 = TRUE) {
                                              await yielded_fd4132;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value544).cmd) = (LogPop)) {
                                        plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value544).cnt))];
                                        log := [log68 EXCEPT ![i] = ((log68)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result157 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result157)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result157)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6133 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6133})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3133 = FALSE) {
                                                await yielded_fd3133;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4133 = TRUE) {
                                                await yielded_fd4133;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log68 EXCEPT ![i] = ((log68)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result158 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result158)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result158)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6134 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6134})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3134 = FALSE) {
                                                await yielded_fd3134;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4134 = TRUE) {
                                                await yielded_fd4134;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        } else {
                          if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                            either {
                              with (value315 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                await ((network)[j]).enabled;
                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value315})), enabled |-> ((network)[j]).enabled]];
                                goto serverLoop;
                              };
                            } or {
                              either {
                                with (yielded_fd124 = FALSE) {
                                  await yielded_fd124;
                                  goto serverLoop;
                                };
                              } or {
                                with (yielded_fd217 = TRUE) {
                                  await yielded_fd217;
                                  goto serverLoop;
                                };
                              };
                            };
                          } else {
                            assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                            with (
                              index = ((m).mprevLogIndex) + (1), 
                              value415 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                            ) {
                              if (((value415).cmd) = (LogConcat)) {
                                with (
                                  plog54 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value415).entries)], 
                                  log69 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                  value545 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                ) {
                                  if (((value545).cmd) = (LogConcat)) {
                                    plog := [plog54 EXCEPT ![i] = ((plog54)[i]) \o ((value545).entries)];
                                    log := [log69 EXCEPT ![i] = ((log69)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result159 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result159)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result159)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6135 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6135})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3135 = FALSE) {
                                            await yielded_fd3135;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4135 = TRUE) {
                                            await yielded_fd4135;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value545).cmd) = (LogPop)) {
                                      plog := [plog54 EXCEPT ![i] = SubSeq((plog54)[i], 1, (Len((plog54)[i])) - ((value545).cnt))];
                                      log := [log69 EXCEPT ![i] = ((log69)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result160 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result160)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result160)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6136 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6136})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3136 = FALSE) {
                                              await yielded_fd3136;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4136 = TRUE) {
                                              await yielded_fd4136;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      log := [log69 EXCEPT ![i] = ((log69)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result161 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result161)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result161)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6137 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6137})), enabled |-> ((network)[j]).enabled]];
                                            plog := plog54;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3137 = FALSE) {
                                              await yielded_fd3137;
                                              plog := plog54;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4137 = TRUE) {
                                              await yielded_fd4137;
                                              plog := plog54;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              } else {
                                if (((value415).cmd) = (LogPop)) {
                                  with (
                                    plog55 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value415).cnt))], 
                                    log70 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value546 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value546).cmd) = (LogConcat)) {
                                      plog := [plog55 EXCEPT ![i] = ((plog55)[i]) \o ((value546).entries)];
                                      log := [log70 EXCEPT ![i] = ((log70)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result162 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result162)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result162)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6138 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6138})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3138 = FALSE) {
                                              await yielded_fd3138;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4138 = TRUE) {
                                              await yielded_fd4138;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value546).cmd) = (LogPop)) {
                                        plog := [plog55 EXCEPT ![i] = SubSeq((plog55)[i], 1, (Len((plog55)[i])) - ((value546).cnt))];
                                        log := [log70 EXCEPT ![i] = ((log70)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result163 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result163)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result163)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6139 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6139})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3139 = FALSE) {
                                                await yielded_fd3139;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4139 = TRUE) {
                                                await yielded_fd4139;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log70 EXCEPT ![i] = ((log70)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result164 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result164)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result164)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6140 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6140})), enabled |-> ((network)[j]).enabled]];
                                              plog := plog55;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3140 = FALSE) {
                                                await yielded_fd3140;
                                                plog := plog55;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4140 = TRUE) {
                                                await yielded_fd4140;
                                                plog := plog55;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  with (
                                    log71 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value547 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value547).cmd) = (LogConcat)) {
                                      plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value547).entries)];
                                      log := [log71 EXCEPT ![i] = ((log71)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result165 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result165)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result165)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6141 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6141})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3141 = FALSE) {
                                              await yielded_fd3141;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4141 = TRUE) {
                                              await yielded_fd4141;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value547).cmd) = (LogPop)) {
                                        plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value547).cnt))];
                                        log := [log71 EXCEPT ![i] = ((log71)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result166 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result166)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result166)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6142 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6142})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3142 = FALSE) {
                                                await yielded_fd3142;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4142 = TRUE) {
                                                await yielded_fd4142;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log71 EXCEPT ![i] = ((log71)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result167 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result167)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result167)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6143 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6143})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3143 = FALSE) {
                                                await yielded_fd3143;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4143 = TRUE) {
                                                await yielded_fd4143;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        };
                      };
                    };
                  };
                } else {
                  if (((m).mtype) = (AppendEntriesResponse)) {
                    if (((m).mterm) > ((currentTerm)[self])) {
                      currentTerm := [currentTerm EXCEPT ![self] = (m).mterm];
                      state := [state EXCEPT ![self] = Follower];
                      votedFor := [votedFor EXCEPT ![self] = Nil];
                      leader := [leader EXCEPT ![self] = Nil];
                      if (((m).mterm) < ((currentTerm)[self])) {
                        skip;
                        goto serverLoop;
                      } else {
                        with (
                          i = self, 
                          j = (m).msource
                        ) {
                          assert ((m).mterm) = ((currentTerm)[i]);
                          if ((m).msuccess) {
                            nextIndex := [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = ((m).mmatchIndex) + (1)]];
                            matchIndex := [matchIndex EXCEPT ![i] = [(matchIndex)[i] EXCEPT ![j] = (m).mmatchIndex]];
                            goto serverLoop;
                          } else {
                            nextIndex := [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = Max({(((nextIndex)[i])[j]) - (1), 1})]];
                            goto serverLoop;
                          };
                        };
                      };
                    } else {
                      if (((m).mterm) < ((currentTerm)[self])) {
                        skip;
                        goto serverLoop;
                      } else {
                        with (
                          i = self, 
                          j = (m).msource
                        ) {
                          assert ((m).mterm) = ((currentTerm)[i]);
                          if ((m).msuccess) {
                            nextIndex := [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = ((m).mmatchIndex) + (1)]];
                            matchIndex := [matchIndex EXCEPT ![i] = [(matchIndex)[i] EXCEPT ![j] = (m).mmatchIndex]];
                            goto serverLoop;
                          } else {
                            nextIndex := [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = Max({(((nextIndex)[i])[j]) - (1), 1})]];
                            goto serverLoop;
                          };
                        };
                      };
                    };
                  } else {
                    if ((((m).mtype) = (ClientPutRequest)) \/ (((m).mtype) = (ClientGetRequest))) {
                      if (((state)[self]) = (Leader)) {
                        with (entry = [term |-> (currentTerm)[self], cmd |-> (m).mcmd, client |-> (m).msource]) {
                          log := [log EXCEPT ![self] = Append((log)[self], entry)];
                          with (value71 = [cmd |-> LogConcat, entries |-> <<entry>>]) {
                            if (((value71).cmd) = (LogConcat)) {
                              plog := [plog EXCEPT ![self] = ((plog)[self]) \o ((value71).entries)];
                              with (value83 = TRUE) {
                                appendEntriesCh := [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value83)];
                                goto serverLoop;
                              };
                            } else {
                              if (((value71).cmd) = (LogPop)) {
                                plog := [plog EXCEPT ![self] = SubSeq((plog)[self], 1, (Len((plog)[self])) - ((value71).cnt))];
                                with (value84 = TRUE) {
                                  appendEntriesCh := [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value84)];
                                  goto serverLoop;
                                };
                              } else {
                                with (value85 = TRUE) {
                                  appendEntriesCh := [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value85)];
                                  goto serverLoop;
                                };
                              };
                            };
                          };
                        };
                      } else {
                        with (
                          i = self, 
                          j = (m).msource, 
                          respType = IF (((m).mcmd).type) = (Put) THEN ClientPutResponse ELSE ClientGetResponse, 
                          value91 = [mtype |-> respType, msuccess |-> FALSE, mresponse |-> [idx |-> ((m).mcmd).idx, key |-> ((m).mcmd).key], mleaderHint |-> (leader)[i], msource |-> i, mdest |-> j]
                        ) {
                          await ((network)[j]).enabled;
                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value91})), enabled |-> ((network)[j]).enabled]];
                          goto serverLoop;
                        };
                      };
                    } else {
                      goto serverLoop;
                    };
                  };
                };
              };
            };
          };
        };
      } else {
        if (((m).mtype) = (RequestVoteRequest)) {
          if (((m).mterm) > ((currentTerm)[self])) {
            currentTerm := [currentTerm EXCEPT ![self] = (m).mterm];
            state := [state EXCEPT ![self] = Follower];
            with (votedFor5 = [votedFor EXCEPT ![self] = Nil]) {
              leader := [leader EXCEPT ![self] = Nil];
              with (
                i = self, 
                j = (m).msource, 
                logOK = (((m).mlastLogTerm) > (LastTerm((log)[i]))) \/ ((((m).mlastLogTerm) = (LastTerm((log)[i]))) /\ (((m).mlastLogIndex) >= (Len((log)[i])))), 
                grant = ((((m).mterm) = ((currentTerm)[i])) /\ (logOK)) /\ (((votedFor5)[self]) \in ({Nil, j}))
              ) {
                assert ((m).mterm) <= ((currentTerm)[i]);
                if (grant) {
                  votedFor := [votedFor5 EXCEPT ![i] = j];
                  either {
                    with (value08 = [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j]) {
                      await ((network)[j]).enabled;
                      await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                      network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value08})), enabled |-> ((network)[j]).enabled]];
                      if (Debug) {
                        print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                        goto serverLoop;
                      } else {
                        goto serverLoop;
                      };
                    };
                  } or {
                    either {
                      with (yielded_fd52 = FALSE) {
                        await yielded_fd52;
                        if (Debug) {
                          print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                          goto serverLoop;
                        } else {
                          goto serverLoop;
                        };
                      };
                    } or {
                      with (yielded_fd08 = TRUE) {
                        await yielded_fd08;
                        if (Debug) {
                          print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                          goto serverLoop;
                        } else {
                          goto serverLoop;
                        };
                      };
                    };
                  };
                } else {
                  either {
                    with (value09 = [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j]) {
                      await ((network)[j]).enabled;
                      await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                      network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value09})), enabled |-> ((network)[j]).enabled]];
                      if (Debug) {
                        print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                        votedFor := votedFor5;
                        goto serverLoop;
                      } else {
                        votedFor := votedFor5;
                        goto serverLoop;
                      };
                    };
                  } or {
                    either {
                      with (yielded_fd53 = FALSE) {
                        await yielded_fd53;
                        if (Debug) {
                          print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                          votedFor := votedFor5;
                          goto serverLoop;
                        } else {
                          votedFor := votedFor5;
                          goto serverLoop;
                        };
                      };
                    } or {
                      with (yielded_fd09 = TRUE) {
                        await yielded_fd09;
                        if (Debug) {
                          print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                          votedFor := votedFor5;
                          goto serverLoop;
                        } else {
                          votedFor := votedFor5;
                          goto serverLoop;
                        };
                      };
                    };
                  };
                };
              };
            };
          } else {
            with (
              i = self, 
              j = (m).msource, 
              logOK = (((m).mlastLogTerm) > (LastTerm((log)[i]))) \/ ((((m).mlastLogTerm) = (LastTerm((log)[i]))) /\ (((m).mlastLogIndex) >= (Len((log)[i])))), 
              grant = ((((m).mterm) = ((currentTerm)[i])) /\ (logOK)) /\ (((votedFor)[self]) \in ({Nil, j}))
            ) {
              assert ((m).mterm) <= ((currentTerm)[i]);
              if (grant) {
                votedFor := [votedFor EXCEPT ![i] = j];
                either {
                  with (value010 = [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j]) {
                    await ((network)[j]).enabled;
                    await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                    network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value010})), enabled |-> ((network)[j]).enabled]];
                    if (Debug) {
                      print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                      goto serverLoop;
                    } else {
                      goto serverLoop;
                    };
                  };
                } or {
                  either {
                    with (yielded_fd54 = FALSE) {
                      await yielded_fd54;
                      if (Debug) {
                        print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                        goto serverLoop;
                      } else {
                        goto serverLoop;
                      };
                    };
                  } or {
                    with (yielded_fd010 = TRUE) {
                      await yielded_fd010;
                      if (Debug) {
                        print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                        goto serverLoop;
                      } else {
                        goto serverLoop;
                      };
                    };
                  };
                };
              } else {
                either {
                  with (value011 = [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j]) {
                    await ((network)[j]).enabled;
                    await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                    network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value011})), enabled |-> ((network)[j]).enabled]];
                    if (Debug) {
                      print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                      goto serverLoop;
                    } else {
                      goto serverLoop;
                    };
                  };
                } or {
                  either {
                    with (yielded_fd55 = FALSE) {
                      await yielded_fd55;
                      if (Debug) {
                        print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                        goto serverLoop;
                      } else {
                        goto serverLoop;
                      };
                    };
                  } or {
                    with (yielded_fd011 = TRUE) {
                      await yielded_fd011;
                      if (Debug) {
                        print <<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>;
                        goto serverLoop;
                      } else {
                        goto serverLoop;
                      };
                    };
                  };
                };
              };
            };
          };
        } else {
          if (((m).mtype) = (RequestVoteResponse)) {
            if (((m).mterm) > ((currentTerm)[self])) {
              currentTerm := [currentTerm EXCEPT ![self] = (m).mterm];
              state := [state EXCEPT ![self] = Follower];
              votedFor := [votedFor EXCEPT ![self] = Nil];
              leader := [leader EXCEPT ![self] = Nil];
              if (((m).mterm) < ((currentTerm)[self])) {
                skip;
                goto serverLoop;
              } else {
                with (
                  i = self, 
                  j = (m).msource
                ) {
                  assert ((m).mterm) = ((currentTerm)[i]);
                  votesResponded := [votesResponded EXCEPT ![i] = ((votesResponded)[i]) \union ({j})];
                  if ((m).mvoteGranted) {
                    votesGranted := [votesGranted EXCEPT ![i] = ((votesGranted)[i]) \union ({j})];
                    if ((((state)[i]) = (Candidate)) /\ (isQuorum((votesGranted)[i]))) {
                      with (value112 = TRUE) {
                        becomeLeaderCh := [becomeLeaderCh EXCEPT ![i] = Append((becomeLeaderCh)[i], value112)];
                        goto serverLoop;
                      };
                    } else {
                      goto serverLoop;
                    };
                  } else {
                    goto serverLoop;
                  };
                };
              };
            } else {
              if (((m).mterm) < ((currentTerm)[self])) {
                skip;
                goto serverLoop;
              } else {
                with (
                  i = self, 
                  j = (m).msource
                ) {
                  assert ((m).mterm) = ((currentTerm)[i]);
                  votesResponded := [votesResponded EXCEPT ![i] = ((votesResponded)[i]) \union ({j})];
                  if ((m).mvoteGranted) {
                    votesGranted := [votesGranted EXCEPT ![i] = ((votesGranted)[i]) \union ({j})];
                    if ((((state)[i]) = (Candidate)) /\ (isQuorum((votesGranted)[i]))) {
                      with (value113 = TRUE) {
                        becomeLeaderCh := [becomeLeaderCh EXCEPT ![i] = Append((becomeLeaderCh)[i], value113)];
                        goto serverLoop;
                      };
                    } else {
                      goto serverLoop;
                    };
                  } else {
                    goto serverLoop;
                  };
                };
              };
            };
          } else {
            if (((m).mtype) = (AppendEntriesRequest)) {
              if (((m).mterm) > ((currentTerm)[self])) {
                currentTerm := [currentTerm EXCEPT ![self] = (m).mterm];
                with (state5 = [state EXCEPT ![self] = Follower]) {
                  votedFor := [votedFor EXCEPT ![self] = Nil];
                  with (
                    leader5 = [leader EXCEPT ![self] = Nil], 
                    i = self, 
                    j = (m).msource, 
                    logOK = (((m).mprevLogIndex) = (0)) \/ (((((m).mprevLogIndex) > (0)) /\ (((m).mprevLogIndex) <= (Len((log)[i])))) /\ (((m).mprevLogTerm) = ((((log)[i])[(m).mprevLogIndex]).term)))
                  ) {
                    assert ((m).mterm) <= ((currentTerm)[i]);
                    if (((m).mterm) = ((currentTerm)[i])) {
                      leader := [leader5 EXCEPT ![i] = (m).msource];
                      with (value24 = LeaderTimeoutReset) {
                        leaderTimeout := value24;
                        if ((((m).mterm) = ((currentTerm)[i])) /\ (((state5)[i]) = (Candidate))) {
                          state := [state5 EXCEPT ![i] = Follower];
                          if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                            either {
                              with (value316 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                await ((network)[j]).enabled;
                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value316})), enabled |-> ((network)[j]).enabled]];
                                goto serverLoop;
                              };
                            } or {
                              either {
                                with (yielded_fd125 = FALSE) {
                                  await yielded_fd125;
                                  goto serverLoop;
                                };
                              } or {
                                with (yielded_fd218 = TRUE) {
                                  await yielded_fd218;
                                  goto serverLoop;
                                };
                              };
                            };
                          } else {
                            assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                            with (
                              index = ((m).mprevLogIndex) + (1), 
                              value416 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                            ) {
                              if (((value416).cmd) = (LogConcat)) {
                                with (
                                  plog56 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value416).entries)], 
                                  log72 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                  value548 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                ) {
                                  if (((value548).cmd) = (LogConcat)) {
                                    plog := [plog56 EXCEPT ![i] = ((plog56)[i]) \o ((value548).entries)];
                                    log := [log72 EXCEPT ![i] = ((log72)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result168 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result168)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result168)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6144 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6144})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3144 = FALSE) {
                                            await yielded_fd3144;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4144 = TRUE) {
                                            await yielded_fd4144;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value548).cmd) = (LogPop)) {
                                      plog := [plog56 EXCEPT ![i] = SubSeq((plog56)[i], 1, (Len((plog56)[i])) - ((value548).cnt))];
                                      log := [log72 EXCEPT ![i] = ((log72)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result169 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result169)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result169)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6145 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6145})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3145 = FALSE) {
                                              await yielded_fd3145;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4145 = TRUE) {
                                              await yielded_fd4145;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      log := [log72 EXCEPT ![i] = ((log72)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result170 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result170)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result170)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6146 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6146})), enabled |-> ((network)[j]).enabled]];
                                            plog := plog56;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3146 = FALSE) {
                                              await yielded_fd3146;
                                              plog := plog56;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4146 = TRUE) {
                                              await yielded_fd4146;
                                              plog := plog56;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              } else {
                                if (((value416).cmd) = (LogPop)) {
                                  with (
                                    plog57 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value416).cnt))], 
                                    log73 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value549 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value549).cmd) = (LogConcat)) {
                                      plog := [plog57 EXCEPT ![i] = ((plog57)[i]) \o ((value549).entries)];
                                      log := [log73 EXCEPT ![i] = ((log73)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result171 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result171)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result171)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6147 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6147})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3147 = FALSE) {
                                              await yielded_fd3147;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4147 = TRUE) {
                                              await yielded_fd4147;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value549).cmd) = (LogPop)) {
                                        plog := [plog57 EXCEPT ![i] = SubSeq((plog57)[i], 1, (Len((plog57)[i])) - ((value549).cnt))];
                                        log := [log73 EXCEPT ![i] = ((log73)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result172 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result172)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result172)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6148 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6148})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3148 = FALSE) {
                                                await yielded_fd3148;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4148 = TRUE) {
                                                await yielded_fd4148;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log73 EXCEPT ![i] = ((log73)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result173 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result173)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result173)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6149 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6149})), enabled |-> ((network)[j]).enabled]];
                                              plog := plog57;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3149 = FALSE) {
                                                await yielded_fd3149;
                                                plog := plog57;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4149 = TRUE) {
                                                await yielded_fd4149;
                                                plog := plog57;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  with (
                                    log74 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value550 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value550).cmd) = (LogConcat)) {
                                      plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value550).entries)];
                                      log := [log74 EXCEPT ![i] = ((log74)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result174 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result174)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result174)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6150 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6150})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3150 = FALSE) {
                                              await yielded_fd3150;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4150 = TRUE) {
                                              await yielded_fd4150;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value550).cmd) = (LogPop)) {
                                        plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value550).cnt))];
                                        log := [log74 EXCEPT ![i] = ((log74)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result175 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result175)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result175)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6151 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6151})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3151 = FALSE) {
                                                await yielded_fd3151;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4151 = TRUE) {
                                                await yielded_fd4151;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log74 EXCEPT ![i] = ((log74)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result176 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result176)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result176)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6152 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6152})), enabled |-> ((network)[j]).enabled]];
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3152 = FALSE) {
                                                await yielded_fd3152;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4152 = TRUE) {
                                                await yielded_fd4152;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        } else {
                          if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state5)[i]) = (Follower))) /\ (~ (logOK)))) {
                            either {
                              with (value317 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                                await ((network)[j]).enabled;
                                await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value317})), enabled |-> ((network)[j]).enabled]];
                                state := state5;
                                goto serverLoop;
                              };
                            } or {
                              either {
                                with (yielded_fd126 = FALSE) {
                                  await yielded_fd126;
                                  state := state5;
                                  goto serverLoop;
                                };
                              } or {
                                with (yielded_fd219 = TRUE) {
                                  await yielded_fd219;
                                  state := state5;
                                  goto serverLoop;
                                };
                              };
                            };
                          } else {
                            assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state5)[i]) = (Follower))) /\ (logOK);
                            with (
                              index = ((m).mprevLogIndex) + (1), 
                              value417 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                            ) {
                              if (((value417).cmd) = (LogConcat)) {
                                with (
                                  plog58 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value417).entries)], 
                                  log75 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                  value551 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                ) {
                                  if (((value551).cmd) = (LogConcat)) {
                                    plog := [plog58 EXCEPT ![i] = ((plog58)[i]) \o ((value551).entries)];
                                    log := [log75 EXCEPT ![i] = ((log75)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result177 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result177)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result177)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6153 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6153})), enabled |-> ((network)[j]).enabled]];
                                          state := state5;
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3153 = FALSE) {
                                            await yielded_fd3153;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4153 = TRUE) {
                                            await yielded_fd4153;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value551).cmd) = (LogPop)) {
                                      plog := [plog58 EXCEPT ![i] = SubSeq((plog58)[i], 1, (Len((plog58)[i])) - ((value551).cnt))];
                                      log := [log75 EXCEPT ![i] = ((log75)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result178 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result178)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result178)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6154 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6154})), enabled |-> ((network)[j]).enabled]];
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3154 = FALSE) {
                                              await yielded_fd3154;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4154 = TRUE) {
                                              await yielded_fd4154;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      log := [log75 EXCEPT ![i] = ((log75)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result179 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result179)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result179)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6155 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6155})), enabled |-> ((network)[j]).enabled]];
                                            plog := plog58;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3155 = FALSE) {
                                              await yielded_fd3155;
                                              plog := plog58;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4155 = TRUE) {
                                              await yielded_fd4155;
                                              plog := plog58;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              } else {
                                if (((value417).cmd) = (LogPop)) {
                                  with (
                                    plog59 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value417).cnt))], 
                                    log76 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value552 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value552).cmd) = (LogConcat)) {
                                      plog := [plog59 EXCEPT ![i] = ((plog59)[i]) \o ((value552).entries)];
                                      log := [log76 EXCEPT ![i] = ((log76)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result180 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result180)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result180)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6156 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6156})), enabled |-> ((network)[j]).enabled]];
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3156 = FALSE) {
                                              await yielded_fd3156;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4156 = TRUE) {
                                              await yielded_fd4156;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value552).cmd) = (LogPop)) {
                                        plog := [plog59 EXCEPT ![i] = SubSeq((plog59)[i], 1, (Len((plog59)[i])) - ((value552).cnt))];
                                        log := [log76 EXCEPT ![i] = ((log76)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result181 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result181)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result181)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6157 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6157})), enabled |-> ((network)[j]).enabled]];
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3157 = FALSE) {
                                                await yielded_fd3157;
                                                state := state5;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4157 = TRUE) {
                                                await yielded_fd4157;
                                                state := state5;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log76 EXCEPT ![i] = ((log76)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result182 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result182)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result182)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6158 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6158})), enabled |-> ((network)[j]).enabled]];
                                              plog := plog59;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3158 = FALSE) {
                                                await yielded_fd3158;
                                                plog := plog59;
                                                state := state5;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4158 = TRUE) {
                                                await yielded_fd4158;
                                                plog := plog59;
                                                state := state5;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  with (
                                    log77 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                    value553 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                  ) {
                                    if (((value553).cmd) = (LogConcat)) {
                                      plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value553).entries)];
                                      log := [log77 EXCEPT ![i] = ((log77)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result183 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result183)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result183)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6159 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6159})), enabled |-> ((network)[j]).enabled]];
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3159 = FALSE) {
                                              await yielded_fd3159;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4159 = TRUE) {
                                              await yielded_fd4159;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      if (((value553).cmd) = (LogPop)) {
                                        plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value553).cnt))];
                                        log := [log77 EXCEPT ![i] = ((log77)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result184 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result184)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result184)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6160 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6160})), enabled |-> ((network)[j]).enabled]];
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3160 = FALSE) {
                                                await yielded_fd3160;
                                                state := state5;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4160 = TRUE) {
                                                await yielded_fd4160;
                                                state := state5;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      } else {
                                        log := [log77 EXCEPT ![i] = ((log77)[i]) \o ((m).mentries)];
                                        assert ((m).mcommitIndex) <= (Len((log)[i]));
                                        with (result185 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                          sm := [sm EXCEPT ![i] = (result185)[1]];
                                          smDomain := [smDomain EXCEPT ![i] = (result185)[2]];
                                          commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                          either {
                                            with (value6161 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                              await ((network)[j]).enabled;
                                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6161})), enabled |-> ((network)[j]).enabled]];
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            either {
                                              with (yielded_fd3161 = FALSE) {
                                                await yielded_fd3161;
                                                state := state5;
                                                goto serverLoop;
                                              };
                                            } or {
                                              with (yielded_fd4161 = TRUE) {
                                                await yielded_fd4161;
                                                state := state5;
                                                goto serverLoop;
                                              };
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        };
                      };
                    } else {
                      if ((((m).mterm) = ((currentTerm)[i])) /\ (((state5)[i]) = (Candidate))) {
                        state := [state5 EXCEPT ![i] = Follower];
                        if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                          either {
                            with (value318 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                              await ((network)[j]).enabled;
                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value318})), enabled |-> ((network)[j]).enabled]];
                              leader := leader5;
                              goto serverLoop;
                            };
                          } or {
                            either {
                              with (yielded_fd127 = FALSE) {
                                await yielded_fd127;
                                leader := leader5;
                                goto serverLoop;
                              };
                            } or {
                              with (yielded_fd220 = TRUE) {
                                await yielded_fd220;
                                leader := leader5;
                                goto serverLoop;
                              };
                            };
                          };
                        } else {
                          assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                          with (
                            index = ((m).mprevLogIndex) + (1), 
                            value418 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                          ) {
                            if (((value418).cmd) = (LogConcat)) {
                              with (
                                plog60 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value418).entries)], 
                                log78 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                value554 = [cmd |-> LogConcat, entries |-> (m).mentries]
                              ) {
                                if (((value554).cmd) = (LogConcat)) {
                                  plog := [plog60 EXCEPT ![i] = ((plog60)[i]) \o ((value554).entries)];
                                  log := [log78 EXCEPT ![i] = ((log78)[i]) \o ((m).mentries)];
                                  assert ((m).mcommitIndex) <= (Len((log)[i]));
                                  with (result186 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                    sm := [sm EXCEPT ![i] = (result186)[1]];
                                    smDomain := [smDomain EXCEPT ![i] = (result186)[2]];
                                    commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                    either {
                                      with (value6162 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                        await ((network)[j]).enabled;
                                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6162})), enabled |-> ((network)[j]).enabled]];
                                        leader := leader5;
                                        goto serverLoop;
                                      };
                                    } or {
                                      either {
                                        with (yielded_fd3162 = FALSE) {
                                          await yielded_fd3162;
                                          leader := leader5;
                                          goto serverLoop;
                                        };
                                      } or {
                                        with (yielded_fd4162 = TRUE) {
                                          await yielded_fd4162;
                                          leader := leader5;
                                          goto serverLoop;
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value554).cmd) = (LogPop)) {
                                    plog := [plog60 EXCEPT ![i] = SubSeq((plog60)[i], 1, (Len((plog60)[i])) - ((value554).cnt))];
                                    log := [log78 EXCEPT ![i] = ((log78)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result187 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result187)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result187)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6163 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6163})), enabled |-> ((network)[j]).enabled]];
                                          leader := leader5;
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3163 = FALSE) {
                                            await yielded_fd3163;
                                            leader := leader5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4163 = TRUE) {
                                            await yielded_fd4163;
                                            leader := leader5;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    log := [log78 EXCEPT ![i] = ((log78)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result188 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result188)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result188)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6164 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6164})), enabled |-> ((network)[j]).enabled]];
                                          plog := plog60;
                                          leader := leader5;
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3164 = FALSE) {
                                            await yielded_fd3164;
                                            plog := plog60;
                                            leader := leader5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4164 = TRUE) {
                                            await yielded_fd4164;
                                            plog := plog60;
                                            leader := leader5;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            } else {
                              if (((value418).cmd) = (LogPop)) {
                                with (
                                  plog61 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value418).cnt))], 
                                  log79 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                  value555 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                ) {
                                  if (((value555).cmd) = (LogConcat)) {
                                    plog := [plog61 EXCEPT ![i] = ((plog61)[i]) \o ((value555).entries)];
                                    log := [log79 EXCEPT ![i] = ((log79)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result189 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result189)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result189)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6165 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6165})), enabled |-> ((network)[j]).enabled]];
                                          leader := leader5;
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3165 = FALSE) {
                                            await yielded_fd3165;
                                            leader := leader5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4165 = TRUE) {
                                            await yielded_fd4165;
                                            leader := leader5;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value555).cmd) = (LogPop)) {
                                      plog := [plog61 EXCEPT ![i] = SubSeq((plog61)[i], 1, (Len((plog61)[i])) - ((value555).cnt))];
                                      log := [log79 EXCEPT ![i] = ((log79)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result190 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result190)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result190)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6166 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6166})), enabled |-> ((network)[j]).enabled]];
                                            leader := leader5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3166 = FALSE) {
                                              await yielded_fd3166;
                                              leader := leader5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4166 = TRUE) {
                                              await yielded_fd4166;
                                              leader := leader5;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      log := [log79 EXCEPT ![i] = ((log79)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result191 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result191)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result191)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6167 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6167})), enabled |-> ((network)[j]).enabled]];
                                            plog := plog61;
                                            leader := leader5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3167 = FALSE) {
                                              await yielded_fd3167;
                                              plog := plog61;
                                              leader := leader5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4167 = TRUE) {
                                              await yielded_fd4167;
                                              plog := plog61;
                                              leader := leader5;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              } else {
                                with (
                                  log80 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                  value556 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                ) {
                                  if (((value556).cmd) = (LogConcat)) {
                                    plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value556).entries)];
                                    log := [log80 EXCEPT ![i] = ((log80)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result192 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result192)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result192)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6168 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6168})), enabled |-> ((network)[j]).enabled]];
                                          leader := leader5;
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3168 = FALSE) {
                                            await yielded_fd3168;
                                            leader := leader5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4168 = TRUE) {
                                            await yielded_fd4168;
                                            leader := leader5;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value556).cmd) = (LogPop)) {
                                      plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value556).cnt))];
                                      log := [log80 EXCEPT ![i] = ((log80)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result193 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result193)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result193)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6169 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6169})), enabled |-> ((network)[j]).enabled]];
                                            leader := leader5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3169 = FALSE) {
                                              await yielded_fd3169;
                                              leader := leader5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4169 = TRUE) {
                                              await yielded_fd4169;
                                              leader := leader5;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      log := [log80 EXCEPT ![i] = ((log80)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result194 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result194)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result194)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6170 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6170})), enabled |-> ((network)[j]).enabled]];
                                            leader := leader5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3170 = FALSE) {
                                              await yielded_fd3170;
                                              leader := leader5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4170 = TRUE) {
                                              await yielded_fd4170;
                                              leader := leader5;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        };
                      } else {
                        if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state5)[i]) = (Follower))) /\ (~ (logOK)))) {
                          either {
                            with (value319 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                              await ((network)[j]).enabled;
                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value319})), enabled |-> ((network)[j]).enabled]];
                              leader := leader5;
                              state := state5;
                              goto serverLoop;
                            };
                          } or {
                            either {
                              with (yielded_fd128 = FALSE) {
                                await yielded_fd128;
                                leader := leader5;
                                state := state5;
                                goto serverLoop;
                              };
                            } or {
                              with (yielded_fd221 = TRUE) {
                                await yielded_fd221;
                                leader := leader5;
                                state := state5;
                                goto serverLoop;
                              };
                            };
                          };
                        } else {
                          assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state5)[i]) = (Follower))) /\ (logOK);
                          with (
                            index = ((m).mprevLogIndex) + (1), 
                            value419 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                          ) {
                            if (((value419).cmd) = (LogConcat)) {
                              with (
                                plog62 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value419).entries)], 
                                log81 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                value557 = [cmd |-> LogConcat, entries |-> (m).mentries]
                              ) {
                                if (((value557).cmd) = (LogConcat)) {
                                  plog := [plog62 EXCEPT ![i] = ((plog62)[i]) \o ((value557).entries)];
                                  log := [log81 EXCEPT ![i] = ((log81)[i]) \o ((m).mentries)];
                                  assert ((m).mcommitIndex) <= (Len((log)[i]));
                                  with (result195 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                    sm := [sm EXCEPT ![i] = (result195)[1]];
                                    smDomain := [smDomain EXCEPT ![i] = (result195)[2]];
                                    commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                    either {
                                      with (value6171 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                        await ((network)[j]).enabled;
                                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6171})), enabled |-> ((network)[j]).enabled]];
                                        leader := leader5;
                                        state := state5;
                                        goto serverLoop;
                                      };
                                    } or {
                                      either {
                                        with (yielded_fd3171 = FALSE) {
                                          await yielded_fd3171;
                                          leader := leader5;
                                          state := state5;
                                          goto serverLoop;
                                        };
                                      } or {
                                        with (yielded_fd4171 = TRUE) {
                                          await yielded_fd4171;
                                          leader := leader5;
                                          state := state5;
                                          goto serverLoop;
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value557).cmd) = (LogPop)) {
                                    plog := [plog62 EXCEPT ![i] = SubSeq((plog62)[i], 1, (Len((plog62)[i])) - ((value557).cnt))];
                                    log := [log81 EXCEPT ![i] = ((log81)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result196 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result196)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result196)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6172 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6172})), enabled |-> ((network)[j]).enabled]];
                                          leader := leader5;
                                          state := state5;
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3172 = FALSE) {
                                            await yielded_fd3172;
                                            leader := leader5;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4172 = TRUE) {
                                            await yielded_fd4172;
                                            leader := leader5;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    log := [log81 EXCEPT ![i] = ((log81)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result197 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result197)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result197)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6173 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6173})), enabled |-> ((network)[j]).enabled]];
                                          plog := plog62;
                                          leader := leader5;
                                          state := state5;
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3173 = FALSE) {
                                            await yielded_fd3173;
                                            plog := plog62;
                                            leader := leader5;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4173 = TRUE) {
                                            await yielded_fd4173;
                                            plog := plog62;
                                            leader := leader5;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            } else {
                              if (((value419).cmd) = (LogPop)) {
                                with (
                                  plog63 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value419).cnt))], 
                                  log82 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                  value558 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                ) {
                                  if (((value558).cmd) = (LogConcat)) {
                                    plog := [plog63 EXCEPT ![i] = ((plog63)[i]) \o ((value558).entries)];
                                    log := [log82 EXCEPT ![i] = ((log82)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result198 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result198)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result198)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6174 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6174})), enabled |-> ((network)[j]).enabled]];
                                          leader := leader5;
                                          state := state5;
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3174 = FALSE) {
                                            await yielded_fd3174;
                                            leader := leader5;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4174 = TRUE) {
                                            await yielded_fd4174;
                                            leader := leader5;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value558).cmd) = (LogPop)) {
                                      plog := [plog63 EXCEPT ![i] = SubSeq((plog63)[i], 1, (Len((plog63)[i])) - ((value558).cnt))];
                                      log := [log82 EXCEPT ![i] = ((log82)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result199 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result199)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result199)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6175 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6175})), enabled |-> ((network)[j]).enabled]];
                                            leader := leader5;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3175 = FALSE) {
                                              await yielded_fd3175;
                                              leader := leader5;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4175 = TRUE) {
                                              await yielded_fd4175;
                                              leader := leader5;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      log := [log82 EXCEPT ![i] = ((log82)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result200 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result200)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result200)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6176 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6176})), enabled |-> ((network)[j]).enabled]];
                                            plog := plog63;
                                            leader := leader5;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3176 = FALSE) {
                                              await yielded_fd3176;
                                              plog := plog63;
                                              leader := leader5;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4176 = TRUE) {
                                              await yielded_fd4176;
                                              plog := plog63;
                                              leader := leader5;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              } else {
                                with (
                                  log83 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                  value559 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                ) {
                                  if (((value559).cmd) = (LogConcat)) {
                                    plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value559).entries)];
                                    log := [log83 EXCEPT ![i] = ((log83)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result201 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result201)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result201)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6177 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6177})), enabled |-> ((network)[j]).enabled]];
                                          leader := leader5;
                                          state := state5;
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3177 = FALSE) {
                                            await yielded_fd3177;
                                            leader := leader5;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4177 = TRUE) {
                                            await yielded_fd4177;
                                            leader := leader5;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value559).cmd) = (LogPop)) {
                                      plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value559).cnt))];
                                      log := [log83 EXCEPT ![i] = ((log83)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result202 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result202)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result202)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6178 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6178})), enabled |-> ((network)[j]).enabled]];
                                            leader := leader5;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3178 = FALSE) {
                                              await yielded_fd3178;
                                              leader := leader5;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4178 = TRUE) {
                                              await yielded_fd4178;
                                              leader := leader5;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      log := [log83 EXCEPT ![i] = ((log83)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result203 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result203)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result203)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6179 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6179})), enabled |-> ((network)[j]).enabled]];
                                            leader := leader5;
                                            state := state5;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3179 = FALSE) {
                                              await yielded_fd3179;
                                              leader := leader5;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4179 = TRUE) {
                                              await yielded_fd4179;
                                              leader := leader5;
                                              state := state5;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        };
                      };
                    };
                  };
                };
              } else {
                with (
                  i = self, 
                  j = (m).msource, 
                  logOK = (((m).mprevLogIndex) = (0)) \/ (((((m).mprevLogIndex) > (0)) /\ (((m).mprevLogIndex) <= (Len((log)[i])))) /\ (((m).mprevLogTerm) = ((((log)[i])[(m).mprevLogIndex]).term)))
                ) {
                  assert ((m).mterm) <= ((currentTerm)[i]);
                  if (((m).mterm) = ((currentTerm)[i])) {
                    leader := [leader EXCEPT ![i] = (m).msource];
                    with (value25 = LeaderTimeoutReset) {
                      leaderTimeout := value25;
                      if ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Candidate))) {
                        state := [state EXCEPT ![i] = Follower];
                        if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                          either {
                            with (value320 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                              await ((network)[j]).enabled;
                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value320})), enabled |-> ((network)[j]).enabled]];
                              goto serverLoop;
                            };
                          } or {
                            either {
                              with (yielded_fd129 = FALSE) {
                                await yielded_fd129;
                                goto serverLoop;
                              };
                            } or {
                              with (yielded_fd222 = TRUE) {
                                await yielded_fd222;
                                goto serverLoop;
                              };
                            };
                          };
                        } else {
                          assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                          with (
                            index = ((m).mprevLogIndex) + (1), 
                            value420 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                          ) {
                            if (((value420).cmd) = (LogConcat)) {
                              with (
                                plog64 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value420).entries)], 
                                log84 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                value560 = [cmd |-> LogConcat, entries |-> (m).mentries]
                              ) {
                                if (((value560).cmd) = (LogConcat)) {
                                  plog := [plog64 EXCEPT ![i] = ((plog64)[i]) \o ((value560).entries)];
                                  log := [log84 EXCEPT ![i] = ((log84)[i]) \o ((m).mentries)];
                                  assert ((m).mcommitIndex) <= (Len((log)[i]));
                                  with (result204 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                    sm := [sm EXCEPT ![i] = (result204)[1]];
                                    smDomain := [smDomain EXCEPT ![i] = (result204)[2]];
                                    commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                    either {
                                      with (value6180 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                        await ((network)[j]).enabled;
                                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6180})), enabled |-> ((network)[j]).enabled]];
                                        goto serverLoop;
                                      };
                                    } or {
                                      either {
                                        with (yielded_fd3180 = FALSE) {
                                          await yielded_fd3180;
                                          goto serverLoop;
                                        };
                                      } or {
                                        with (yielded_fd4180 = TRUE) {
                                          await yielded_fd4180;
                                          goto serverLoop;
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value560).cmd) = (LogPop)) {
                                    plog := [plog64 EXCEPT ![i] = SubSeq((plog64)[i], 1, (Len((plog64)[i])) - ((value560).cnt))];
                                    log := [log84 EXCEPT ![i] = ((log84)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result205 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result205)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result205)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6181 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6181})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3181 = FALSE) {
                                            await yielded_fd3181;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4181 = TRUE) {
                                            await yielded_fd4181;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    log := [log84 EXCEPT ![i] = ((log84)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result206 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result206)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result206)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6182 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6182})), enabled |-> ((network)[j]).enabled]];
                                          plog := plog64;
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3182 = FALSE) {
                                            await yielded_fd3182;
                                            plog := plog64;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4182 = TRUE) {
                                            await yielded_fd4182;
                                            plog := plog64;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            } else {
                              if (((value420).cmd) = (LogPop)) {
                                with (
                                  plog65 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value420).cnt))], 
                                  log85 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                  value561 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                ) {
                                  if (((value561).cmd) = (LogConcat)) {
                                    plog := [plog65 EXCEPT ![i] = ((plog65)[i]) \o ((value561).entries)];
                                    log := [log85 EXCEPT ![i] = ((log85)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result207 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result207)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result207)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6183 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6183})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3183 = FALSE) {
                                            await yielded_fd3183;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4183 = TRUE) {
                                            await yielded_fd4183;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value561).cmd) = (LogPop)) {
                                      plog := [plog65 EXCEPT ![i] = SubSeq((plog65)[i], 1, (Len((plog65)[i])) - ((value561).cnt))];
                                      log := [log85 EXCEPT ![i] = ((log85)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result208 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result208)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result208)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6184 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6184})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3184 = FALSE) {
                                              await yielded_fd3184;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4184 = TRUE) {
                                              await yielded_fd4184;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      log := [log85 EXCEPT ![i] = ((log85)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result209 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result209)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result209)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6185 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6185})), enabled |-> ((network)[j]).enabled]];
                                            plog := plog65;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3185 = FALSE) {
                                              await yielded_fd3185;
                                              plog := plog65;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4185 = TRUE) {
                                              await yielded_fd4185;
                                              plog := plog65;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              } else {
                                with (
                                  log86 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                  value562 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                ) {
                                  if (((value562).cmd) = (LogConcat)) {
                                    plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value562).entries)];
                                    log := [log86 EXCEPT ![i] = ((log86)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result210 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result210)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result210)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6186 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6186})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3186 = FALSE) {
                                            await yielded_fd3186;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4186 = TRUE) {
                                            await yielded_fd4186;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value562).cmd) = (LogPop)) {
                                      plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value562).cnt))];
                                      log := [log86 EXCEPT ![i] = ((log86)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result211 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result211)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result211)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6187 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6187})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3187 = FALSE) {
                                              await yielded_fd3187;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4187 = TRUE) {
                                              await yielded_fd4187;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      log := [log86 EXCEPT ![i] = ((log86)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result212 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result212)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result212)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6188 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6188})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3188 = FALSE) {
                                              await yielded_fd3188;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4188 = TRUE) {
                                              await yielded_fd4188;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        };
                      } else {
                        if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                          either {
                            with (value321 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                              await ((network)[j]).enabled;
                              await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                              network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value321})), enabled |-> ((network)[j]).enabled]];
                              goto serverLoop;
                            };
                          } or {
                            either {
                              with (yielded_fd130 = FALSE) {
                                await yielded_fd130;
                                goto serverLoop;
                              };
                            } or {
                              with (yielded_fd223 = TRUE) {
                                await yielded_fd223;
                                goto serverLoop;
                              };
                            };
                          };
                        } else {
                          assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                          with (
                            index = ((m).mprevLogIndex) + (1), 
                            value421 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                          ) {
                            if (((value421).cmd) = (LogConcat)) {
                              with (
                                plog66 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value421).entries)], 
                                log87 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                value563 = [cmd |-> LogConcat, entries |-> (m).mentries]
                              ) {
                                if (((value563).cmd) = (LogConcat)) {
                                  plog := [plog66 EXCEPT ![i] = ((plog66)[i]) \o ((value563).entries)];
                                  log := [log87 EXCEPT ![i] = ((log87)[i]) \o ((m).mentries)];
                                  assert ((m).mcommitIndex) <= (Len((log)[i]));
                                  with (result213 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                    sm := [sm EXCEPT ![i] = (result213)[1]];
                                    smDomain := [smDomain EXCEPT ![i] = (result213)[2]];
                                    commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                    either {
                                      with (value6189 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                        await ((network)[j]).enabled;
                                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6189})), enabled |-> ((network)[j]).enabled]];
                                        goto serverLoop;
                                      };
                                    } or {
                                      either {
                                        with (yielded_fd3189 = FALSE) {
                                          await yielded_fd3189;
                                          goto serverLoop;
                                        };
                                      } or {
                                        with (yielded_fd4189 = TRUE) {
                                          await yielded_fd4189;
                                          goto serverLoop;
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value563).cmd) = (LogPop)) {
                                    plog := [plog66 EXCEPT ![i] = SubSeq((plog66)[i], 1, (Len((plog66)[i])) - ((value563).cnt))];
                                    log := [log87 EXCEPT ![i] = ((log87)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result214 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result214)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result214)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6190 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6190})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3190 = FALSE) {
                                            await yielded_fd3190;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4190 = TRUE) {
                                            await yielded_fd4190;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    log := [log87 EXCEPT ![i] = ((log87)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result215 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result215)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result215)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6191 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6191})), enabled |-> ((network)[j]).enabled]];
                                          plog := plog66;
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3191 = FALSE) {
                                            await yielded_fd3191;
                                            plog := plog66;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4191 = TRUE) {
                                            await yielded_fd4191;
                                            plog := plog66;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            } else {
                              if (((value421).cmd) = (LogPop)) {
                                with (
                                  plog67 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value421).cnt))], 
                                  log88 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                  value564 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                ) {
                                  if (((value564).cmd) = (LogConcat)) {
                                    plog := [plog67 EXCEPT ![i] = ((plog67)[i]) \o ((value564).entries)];
                                    log := [log88 EXCEPT ![i] = ((log88)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result216 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result216)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result216)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6192 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6192})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3192 = FALSE) {
                                            await yielded_fd3192;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4192 = TRUE) {
                                            await yielded_fd4192;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value564).cmd) = (LogPop)) {
                                      plog := [plog67 EXCEPT ![i] = SubSeq((plog67)[i], 1, (Len((plog67)[i])) - ((value564).cnt))];
                                      log := [log88 EXCEPT ![i] = ((log88)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result217 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result217)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result217)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6193 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6193})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3193 = FALSE) {
                                              await yielded_fd3193;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4193 = TRUE) {
                                              await yielded_fd4193;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      log := [log88 EXCEPT ![i] = ((log88)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result218 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result218)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result218)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6194 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6194})), enabled |-> ((network)[j]).enabled]];
                                            plog := plog67;
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3194 = FALSE) {
                                              await yielded_fd3194;
                                              plog := plog67;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4194 = TRUE) {
                                              await yielded_fd4194;
                                              plog := plog67;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              } else {
                                with (
                                  log89 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                  value565 = [cmd |-> LogConcat, entries |-> (m).mentries]
                                ) {
                                  if (((value565).cmd) = (LogConcat)) {
                                    plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value565).entries)];
                                    log := [log89 EXCEPT ![i] = ((log89)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result219 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result219)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result219)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6195 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6195})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3195 = FALSE) {
                                            await yielded_fd3195;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4195 = TRUE) {
                                            await yielded_fd4195;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    if (((value565).cmd) = (LogPop)) {
                                      plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value565).cnt))];
                                      log := [log89 EXCEPT ![i] = ((log89)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result220 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result220)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result220)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6196 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6196})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3196 = FALSE) {
                                              await yielded_fd3196;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4196 = TRUE) {
                                              await yielded_fd4196;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    } else {
                                      log := [log89 EXCEPT ![i] = ((log89)[i]) \o ((m).mentries)];
                                      assert ((m).mcommitIndex) <= (Len((log)[i]));
                                      with (result221 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                        sm := [sm EXCEPT ![i] = (result221)[1]];
                                        smDomain := [smDomain EXCEPT ![i] = (result221)[2]];
                                        commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                        either {
                                          with (value6197 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                            await ((network)[j]).enabled;
                                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6197})), enabled |-> ((network)[j]).enabled]];
                                            goto serverLoop;
                                          };
                                        } or {
                                          either {
                                            with (yielded_fd3197 = FALSE) {
                                              await yielded_fd3197;
                                              goto serverLoop;
                                            };
                                          } or {
                                            with (yielded_fd4197 = TRUE) {
                                              await yielded_fd4197;
                                              goto serverLoop;
                                            };
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        };
                      };
                    };
                  } else {
                    if ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Candidate))) {
                      state := [state EXCEPT ![i] = Follower];
                      if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                        either {
                          with (value322 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                            await ((network)[j]).enabled;
                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value322})), enabled |-> ((network)[j]).enabled]];
                            goto serverLoop;
                          };
                        } or {
                          either {
                            with (yielded_fd131 = FALSE) {
                              await yielded_fd131;
                              goto serverLoop;
                            };
                          } or {
                            with (yielded_fd224 = TRUE) {
                              await yielded_fd224;
                              goto serverLoop;
                            };
                          };
                        };
                      } else {
                        assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                        with (
                          index = ((m).mprevLogIndex) + (1), 
                          value422 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                        ) {
                          if (((value422).cmd) = (LogConcat)) {
                            with (
                              plog68 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value422).entries)], 
                              log90 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                              value566 = [cmd |-> LogConcat, entries |-> (m).mentries]
                            ) {
                              if (((value566).cmd) = (LogConcat)) {
                                plog := [plog68 EXCEPT ![i] = ((plog68)[i]) \o ((value566).entries)];
                                log := [log90 EXCEPT ![i] = ((log90)[i]) \o ((m).mentries)];
                                assert ((m).mcommitIndex) <= (Len((log)[i]));
                                with (result222 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                  sm := [sm EXCEPT ![i] = (result222)[1]];
                                  smDomain := [smDomain EXCEPT ![i] = (result222)[2]];
                                  commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                  either {
                                    with (value6198 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                      await ((network)[j]).enabled;
                                      await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                      network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6198})), enabled |-> ((network)[j]).enabled]];
                                      goto serverLoop;
                                    };
                                  } or {
                                    either {
                                      with (yielded_fd3198 = FALSE) {
                                        await yielded_fd3198;
                                        goto serverLoop;
                                      };
                                    } or {
                                      with (yielded_fd4198 = TRUE) {
                                        await yielded_fd4198;
                                        goto serverLoop;
                                      };
                                    };
                                  };
                                };
                              } else {
                                if (((value566).cmd) = (LogPop)) {
                                  plog := [plog68 EXCEPT ![i] = SubSeq((plog68)[i], 1, (Len((plog68)[i])) - ((value566).cnt))];
                                  log := [log90 EXCEPT ![i] = ((log90)[i]) \o ((m).mentries)];
                                  assert ((m).mcommitIndex) <= (Len((log)[i]));
                                  with (result223 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                    sm := [sm EXCEPT ![i] = (result223)[1]];
                                    smDomain := [smDomain EXCEPT ![i] = (result223)[2]];
                                    commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                    either {
                                      with (value6199 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                        await ((network)[j]).enabled;
                                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6199})), enabled |-> ((network)[j]).enabled]];
                                        goto serverLoop;
                                      };
                                    } or {
                                      either {
                                        with (yielded_fd3199 = FALSE) {
                                          await yielded_fd3199;
                                          goto serverLoop;
                                        };
                                      } or {
                                        with (yielded_fd4199 = TRUE) {
                                          await yielded_fd4199;
                                          goto serverLoop;
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  log := [log90 EXCEPT ![i] = ((log90)[i]) \o ((m).mentries)];
                                  assert ((m).mcommitIndex) <= (Len((log)[i]));
                                  with (result224 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                    sm := [sm EXCEPT ![i] = (result224)[1]];
                                    smDomain := [smDomain EXCEPT ![i] = (result224)[2]];
                                    commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                    either {
                                      with (value6200 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                        await ((network)[j]).enabled;
                                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6200})), enabled |-> ((network)[j]).enabled]];
                                        plog := plog68;
                                        goto serverLoop;
                                      };
                                    } or {
                                      either {
                                        with (yielded_fd3200 = FALSE) {
                                          await yielded_fd3200;
                                          plog := plog68;
                                          goto serverLoop;
                                        };
                                      } or {
                                        with (yielded_fd4200 = TRUE) {
                                          await yielded_fd4200;
                                          plog := plog68;
                                          goto serverLoop;
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          } else {
                            if (((value422).cmd) = (LogPop)) {
                              with (
                                plog69 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value422).cnt))], 
                                log91 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                value567 = [cmd |-> LogConcat, entries |-> (m).mentries]
                              ) {
                                if (((value567).cmd) = (LogConcat)) {
                                  plog := [plog69 EXCEPT ![i] = ((plog69)[i]) \o ((value567).entries)];
                                  log := [log91 EXCEPT ![i] = ((log91)[i]) \o ((m).mentries)];
                                  assert ((m).mcommitIndex) <= (Len((log)[i]));
                                  with (result225 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                    sm := [sm EXCEPT ![i] = (result225)[1]];
                                    smDomain := [smDomain EXCEPT ![i] = (result225)[2]];
                                    commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                    either {
                                      with (value6201 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                        await ((network)[j]).enabled;
                                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6201})), enabled |-> ((network)[j]).enabled]];
                                        goto serverLoop;
                                      };
                                    } or {
                                      either {
                                        with (yielded_fd3201 = FALSE) {
                                          await yielded_fd3201;
                                          goto serverLoop;
                                        };
                                      } or {
                                        with (yielded_fd4201 = TRUE) {
                                          await yielded_fd4201;
                                          goto serverLoop;
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value567).cmd) = (LogPop)) {
                                    plog := [plog69 EXCEPT ![i] = SubSeq((plog69)[i], 1, (Len((plog69)[i])) - ((value567).cnt))];
                                    log := [log91 EXCEPT ![i] = ((log91)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result226 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result226)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result226)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6202 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6202})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3202 = FALSE) {
                                            await yielded_fd3202;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4202 = TRUE) {
                                            await yielded_fd4202;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    log := [log91 EXCEPT ![i] = ((log91)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result227 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result227)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result227)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6203 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6203})), enabled |-> ((network)[j]).enabled]];
                                          plog := plog69;
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3203 = FALSE) {
                                            await yielded_fd3203;
                                            plog := plog69;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4203 = TRUE) {
                                            await yielded_fd4203;
                                            plog := plog69;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            } else {
                              with (
                                log92 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                value568 = [cmd |-> LogConcat, entries |-> (m).mentries]
                              ) {
                                if (((value568).cmd) = (LogConcat)) {
                                  plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value568).entries)];
                                  log := [log92 EXCEPT ![i] = ((log92)[i]) \o ((m).mentries)];
                                  assert ((m).mcommitIndex) <= (Len((log)[i]));
                                  with (result228 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                    sm := [sm EXCEPT ![i] = (result228)[1]];
                                    smDomain := [smDomain EXCEPT ![i] = (result228)[2]];
                                    commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                    either {
                                      with (value6204 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                        await ((network)[j]).enabled;
                                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6204})), enabled |-> ((network)[j]).enabled]];
                                        goto serverLoop;
                                      };
                                    } or {
                                      either {
                                        with (yielded_fd3204 = FALSE) {
                                          await yielded_fd3204;
                                          goto serverLoop;
                                        };
                                      } or {
                                        with (yielded_fd4204 = TRUE) {
                                          await yielded_fd4204;
                                          goto serverLoop;
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value568).cmd) = (LogPop)) {
                                    plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value568).cnt))];
                                    log := [log92 EXCEPT ![i] = ((log92)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result229 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result229)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result229)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6205 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6205})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3205 = FALSE) {
                                            await yielded_fd3205;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4205 = TRUE) {
                                            await yielded_fd4205;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    log := [log92 EXCEPT ![i] = ((log92)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result230 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result230)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result230)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6206 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6206})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3206 = FALSE) {
                                            await yielded_fd3206;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4206 = TRUE) {
                                            await yielded_fd4206;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        };
                      };
                    } else {
                      if ((((m).mterm) < ((currentTerm)[i])) \/ (((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))) {
                        either {
                          with (value323 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j]) {
                            await ((network)[j]).enabled;
                            await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                            network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value323})), enabled |-> ((network)[j]).enabled]];
                            goto serverLoop;
                          };
                        } or {
                          either {
                            with (yielded_fd132 = FALSE) {
                              await yielded_fd132;
                              goto serverLoop;
                            };
                          } or {
                            with (yielded_fd225 = TRUE) {
                              await yielded_fd225;
                              goto serverLoop;
                            };
                          };
                        };
                      } else {
                        assert ((((m).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK);
                        with (
                          index = ((m).mprevLogIndex) + (1), 
                          value423 = [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m).mprevLogIndex)]
                        ) {
                          if (((value423).cmd) = (LogConcat)) {
                            with (
                              plog70 = [plog EXCEPT ![i] = ((plog)[i]) \o ((value423).entries)], 
                              log93 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                              value569 = [cmd |-> LogConcat, entries |-> (m).mentries]
                            ) {
                              if (((value569).cmd) = (LogConcat)) {
                                plog := [plog70 EXCEPT ![i] = ((plog70)[i]) \o ((value569).entries)];
                                log := [log93 EXCEPT ![i] = ((log93)[i]) \o ((m).mentries)];
                                assert ((m).mcommitIndex) <= (Len((log)[i]));
                                with (result231 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                  sm := [sm EXCEPT ![i] = (result231)[1]];
                                  smDomain := [smDomain EXCEPT ![i] = (result231)[2]];
                                  commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                  either {
                                    with (value6207 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                      await ((network)[j]).enabled;
                                      await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                      network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6207})), enabled |-> ((network)[j]).enabled]];
                                      goto serverLoop;
                                    };
                                  } or {
                                    either {
                                      with (yielded_fd3207 = FALSE) {
                                        await yielded_fd3207;
                                        goto serverLoop;
                                      };
                                    } or {
                                      with (yielded_fd4207 = TRUE) {
                                        await yielded_fd4207;
                                        goto serverLoop;
                                      };
                                    };
                                  };
                                };
                              } else {
                                if (((value569).cmd) = (LogPop)) {
                                  plog := [plog70 EXCEPT ![i] = SubSeq((plog70)[i], 1, (Len((plog70)[i])) - ((value569).cnt))];
                                  log := [log93 EXCEPT ![i] = ((log93)[i]) \o ((m).mentries)];
                                  assert ((m).mcommitIndex) <= (Len((log)[i]));
                                  with (result232 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                    sm := [sm EXCEPT ![i] = (result232)[1]];
                                    smDomain := [smDomain EXCEPT ![i] = (result232)[2]];
                                    commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                    either {
                                      with (value6208 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                        await ((network)[j]).enabled;
                                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6208})), enabled |-> ((network)[j]).enabled]];
                                        goto serverLoop;
                                      };
                                    } or {
                                      either {
                                        with (yielded_fd3208 = FALSE) {
                                          await yielded_fd3208;
                                          goto serverLoop;
                                        };
                                      } or {
                                        with (yielded_fd4208 = TRUE) {
                                          await yielded_fd4208;
                                          goto serverLoop;
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  log := [log93 EXCEPT ![i] = ((log93)[i]) \o ((m).mentries)];
                                  assert ((m).mcommitIndex) <= (Len((log)[i]));
                                  with (result233 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                    sm := [sm EXCEPT ![i] = (result233)[1]];
                                    smDomain := [smDomain EXCEPT ![i] = (result233)[2]];
                                    commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                    either {
                                      with (value6209 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                        await ((network)[j]).enabled;
                                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6209})), enabled |-> ((network)[j]).enabled]];
                                        plog := plog70;
                                        goto serverLoop;
                                      };
                                    } or {
                                      either {
                                        with (yielded_fd3209 = FALSE) {
                                          await yielded_fd3209;
                                          plog := plog70;
                                          goto serverLoop;
                                        };
                                      } or {
                                        with (yielded_fd4209 = TRUE) {
                                          await yielded_fd4209;
                                          plog := plog70;
                                          goto serverLoop;
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          } else {
                            if (((value423).cmd) = (LogPop)) {
                              with (
                                plog71 = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value423).cnt))], 
                                log94 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                value570 = [cmd |-> LogConcat, entries |-> (m).mentries]
                              ) {
                                if (((value570).cmd) = (LogConcat)) {
                                  plog := [plog71 EXCEPT ![i] = ((plog71)[i]) \o ((value570).entries)];
                                  log := [log94 EXCEPT ![i] = ((log94)[i]) \o ((m).mentries)];
                                  assert ((m).mcommitIndex) <= (Len((log)[i]));
                                  with (result234 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                    sm := [sm EXCEPT ![i] = (result234)[1]];
                                    smDomain := [smDomain EXCEPT ![i] = (result234)[2]];
                                    commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                    either {
                                      with (value6210 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                        await ((network)[j]).enabled;
                                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6210})), enabled |-> ((network)[j]).enabled]];
                                        goto serverLoop;
                                      };
                                    } or {
                                      either {
                                        with (yielded_fd3210 = FALSE) {
                                          await yielded_fd3210;
                                          goto serverLoop;
                                        };
                                      } or {
                                        with (yielded_fd4210 = TRUE) {
                                          await yielded_fd4210;
                                          goto serverLoop;
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value570).cmd) = (LogPop)) {
                                    plog := [plog71 EXCEPT ![i] = SubSeq((plog71)[i], 1, (Len((plog71)[i])) - ((value570).cnt))];
                                    log := [log94 EXCEPT ![i] = ((log94)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result235 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result235)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result235)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6211 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6211})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3211 = FALSE) {
                                            await yielded_fd3211;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4211 = TRUE) {
                                            await yielded_fd4211;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    log := [log94 EXCEPT ![i] = ((log94)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result236 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result236)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result236)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6212 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6212})), enabled |-> ((network)[j]).enabled]];
                                          plog := plog71;
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3212 = FALSE) {
                                            await yielded_fd3212;
                                            plog := plog71;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4212 = TRUE) {
                                            await yielded_fd4212;
                                            plog := plog71;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            } else {
                              with (
                                log95 = [log EXCEPT ![i] = SubSeq((log)[i], 1, (m).mprevLogIndex)], 
                                value571 = [cmd |-> LogConcat, entries |-> (m).mentries]
                              ) {
                                if (((value571).cmd) = (LogConcat)) {
                                  plog := [plog EXCEPT ![i] = ((plog)[i]) \o ((value571).entries)];
                                  log := [log95 EXCEPT ![i] = ((log95)[i]) \o ((m).mentries)];
                                  assert ((m).mcommitIndex) <= (Len((log)[i]));
                                  with (result237 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                    sm := [sm EXCEPT ![i] = (result237)[1]];
                                    smDomain := [smDomain EXCEPT ![i] = (result237)[2]];
                                    commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                    either {
                                      with (value6213 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                        await ((network)[j]).enabled;
                                        await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                        network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6213})), enabled |-> ((network)[j]).enabled]];
                                        goto serverLoop;
                                      };
                                    } or {
                                      either {
                                        with (yielded_fd3213 = FALSE) {
                                          await yielded_fd3213;
                                          goto serverLoop;
                                        };
                                      } or {
                                        with (yielded_fd4213 = TRUE) {
                                          await yielded_fd4213;
                                          goto serverLoop;
                                        };
                                      };
                                    };
                                  };
                                } else {
                                  if (((value571).cmd) = (LogPop)) {
                                    plog := [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value571).cnt))];
                                    log := [log95 EXCEPT ![i] = ((log95)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result238 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result238)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result238)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6214 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6214})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3214 = FALSE) {
                                            await yielded_fd3214;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4214 = TRUE) {
                                            await yielded_fd4214;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  } else {
                                    log := [log95 EXCEPT ![i] = ((log95)[i]) \o ((m).mentries)];
                                    assert ((m).mcommitIndex) <= (Len((log)[i]));
                                    with (result239 = ApplyLog((log)[i], ((commitIndex)[i]) + (1), (m).mcommitIndex, (sm)[i], (smDomain)[i])) {
                                      sm := [sm EXCEPT ![i] = (result239)[1]];
                                      smDomain := [smDomain EXCEPT ![i] = (result239)[2]];
                                      commitIndex := [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m).mcommitIndex})];
                                      either {
                                        with (value6215 = [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m).mprevLogIndex) + (Len((m).mentries)), msource |-> i, mdest |-> j]) {
                                          await ((network)[j]).enabled;
                                          await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                                          network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6215})), enabled |-> ((network)[j]).enabled]];
                                          goto serverLoop;
                                        };
                                      } or {
                                        either {
                                          with (yielded_fd3215 = FALSE) {
                                            await yielded_fd3215;
                                            goto serverLoop;
                                          };
                                        } or {
                                          with (yielded_fd4215 = TRUE) {
                                            await yielded_fd4215;
                                            goto serverLoop;
                                          };
                                        };
                                      };
                                    };
                                  };
                                };
                              };
                            };
                          };
                        };
                      };
                    };
                  };
                };
              };
            } else {
              if (((m).mtype) = (AppendEntriesResponse)) {
                if (((m).mterm) > ((currentTerm)[self])) {
                  currentTerm := [currentTerm EXCEPT ![self] = (m).mterm];
                  state := [state EXCEPT ![self] = Follower];
                  votedFor := [votedFor EXCEPT ![self] = Nil];
                  leader := [leader EXCEPT ![self] = Nil];
                  if (((m).mterm) < ((currentTerm)[self])) {
                    skip;
                    goto serverLoop;
                  } else {
                    with (
                      i = self, 
                      j = (m).msource
                    ) {
                      assert ((m).mterm) = ((currentTerm)[i]);
                      if ((m).msuccess) {
                        nextIndex := [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = ((m).mmatchIndex) + (1)]];
                        matchIndex := [matchIndex EXCEPT ![i] = [(matchIndex)[i] EXCEPT ![j] = (m).mmatchIndex]];
                        goto serverLoop;
                      } else {
                        nextIndex := [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = Max({(((nextIndex)[i])[j]) - (1), 1})]];
                        goto serverLoop;
                      };
                    };
                  };
                } else {
                  if (((m).mterm) < ((currentTerm)[self])) {
                    skip;
                    goto serverLoop;
                  } else {
                    with (
                      i = self, 
                      j = (m).msource
                    ) {
                      assert ((m).mterm) = ((currentTerm)[i]);
                      if ((m).msuccess) {
                        nextIndex := [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = ((m).mmatchIndex) + (1)]];
                        matchIndex := [matchIndex EXCEPT ![i] = [(matchIndex)[i] EXCEPT ![j] = (m).mmatchIndex]];
                        goto serverLoop;
                      } else {
                        nextIndex := [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = Max({(((nextIndex)[i])[j]) - (1), 1})]];
                        goto serverLoop;
                      };
                    };
                  };
                };
              } else {
                if ((((m).mtype) = (ClientPutRequest)) \/ (((m).mtype) = (ClientGetRequest))) {
                  if (((state)[self]) = (Leader)) {
                    with (entry = [term |-> (currentTerm)[self], cmd |-> (m).mcmd, client |-> (m).msource]) {
                      log := [log EXCEPT ![self] = Append((log)[self], entry)];
                      with (value72 = [cmd |-> LogConcat, entries |-> <<entry>>]) {
                        if (((value72).cmd) = (LogConcat)) {
                          plog := [plog EXCEPT ![self] = ((plog)[self]) \o ((value72).entries)];
                          with (value86 = TRUE) {
                            appendEntriesCh := [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value86)];
                            goto serverLoop;
                          };
                        } else {
                          if (((value72).cmd) = (LogPop)) {
                            plog := [plog EXCEPT ![self] = SubSeq((plog)[self], 1, (Len((plog)[self])) - ((value72).cnt))];
                            with (value87 = TRUE) {
                              appendEntriesCh := [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value87)];
                              goto serverLoop;
                            };
                          } else {
                            with (value88 = TRUE) {
                              appendEntriesCh := [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value88)];
                              goto serverLoop;
                            };
                          };
                        };
                      };
                    };
                  } else {
                    with (
                      i = self, 
                      j = (m).msource, 
                      respType = IF (((m).mcmd).type) = (Put) THEN ClientPutResponse ELSE ClientGetResponse, 
                      value92 = [mtype |-> respType, msuccess |-> FALSE, mresponse |-> [idx |-> ((m).mcmd).idx, key |-> ((m).mcmd).key], mleaderHint |-> (leader)[i], msource |-> i, mdest |-> j]
                    ) {
                      await ((network)[j]).enabled;
                      await (BagCardinality(((network)[j]).queue)) < (BufferSize);
                      network := [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value92})), enabled |-> ((network)[j]).enabled]];
                      goto serverLoop;
                    };
                  };
                } else {
                  goto serverLoop;
                };
              };
            };
          };
        };
      };
  }
  
  fair process (s1 \in ServerRequestVoteSet)
    variables idx0 = 1; srvId0 = (requestVoteSrvId)[self];
  {
    serverRequestVoteLoop:
      if (TRUE) {
        if (ExploreFail) {
          with (yielded_network20 = ((network)[srvId0]).enabled) {
            if (~ (yielded_network20)) {
              await FALSE;
              either {
                with (yielded_leaderTimeout1 = TRUE) {
                  await yielded_leaderTimeout1;
                  with (
                    len00 \in (0) .. (BagCardinality(((network)[srvId0]).queue)), 
                    yielded_network30 = len00
                  ) {
                    await (yielded_network30) = (0);
                    await ((state)[srvId0]) \in ({Follower, Candidate});
                    with (i3 = srvId0) {
                      state := [state EXCEPT ![i3] = Candidate];
                      currentTerm := [currentTerm EXCEPT ![i3] = ((currentTerm)[i3]) + (1)];
                      votedFor := [votedFor EXCEPT ![i3] = i3];
                      votesResponded := [votesResponded EXCEPT ![i3] = {i3}];
                      votesGranted := [votesGranted EXCEPT ![i3] = {i3}];
                      leader := [leader EXCEPT ![i3] = Nil];
                      if (Debug) {
                        print <<"ServerTimeout", i3, (currentTerm)[i3]>>;
                        idx0 := 1;
                        goto requestVoteLoop;
                      } else {
                        idx0 := 1;
                        goto requestVoteLoop;
                      };
                    };
                  };
                };
              } or {
                with (yielded_leaderTimeout00 = FALSE) {
                  await yielded_leaderTimeout00;
                  with (
                    len01 \in (0) .. (BagCardinality(((network)[srvId0]).queue)), 
                    yielded_network31 = len01
                  ) {
                    await (yielded_network31) = (0);
                    await ((state)[srvId0]) \in ({Follower, Candidate});
                    with (i4 = srvId0) {
                      state := [state EXCEPT ![i4] = Candidate];
                      currentTerm := [currentTerm EXCEPT ![i4] = ((currentTerm)[i4]) + (1)];
                      votedFor := [votedFor EXCEPT ![i4] = i4];
                      votesResponded := [votesResponded EXCEPT ![i4] = {i4}];
                      votesGranted := [votesGranted EXCEPT ![i4] = {i4}];
                      leader := [leader EXCEPT ![i4] = Nil];
                      if (Debug) {
                        print <<"ServerTimeout", i4, (currentTerm)[i4]>>;
                        idx0 := 1;
                        goto requestVoteLoop;
                      } else {
                        idx0 := 1;
                        goto requestVoteLoop;
                      };
                    };
                  };
                };
              };
            } else {
              either {
                with (yielded_leaderTimeout2 = TRUE) {
                  await yielded_leaderTimeout2;
                  with (
                    len02 \in (0) .. (BagCardinality(((network)[srvId0]).queue)), 
                    yielded_network32 = len02
                  ) {
                    await (yielded_network32) = (0);
                    await ((state)[srvId0]) \in ({Follower, Candidate});
                    with (i5 = srvId0) {
                      state := [state EXCEPT ![i5] = Candidate];
                      currentTerm := [currentTerm EXCEPT ![i5] = ((currentTerm)[i5]) + (1)];
                      votedFor := [votedFor EXCEPT ![i5] = i5];
                      votesResponded := [votesResponded EXCEPT ![i5] = {i5}];
                      votesGranted := [votesGranted EXCEPT ![i5] = {i5}];
                      leader := [leader EXCEPT ![i5] = Nil];
                      if (Debug) {
                        print <<"ServerTimeout", i5, (currentTerm)[i5]>>;
                        idx0 := 1;
                        goto requestVoteLoop;
                      } else {
                        idx0 := 1;
                        goto requestVoteLoop;
                      };
                    };
                  };
                };
              } or {
                with (yielded_leaderTimeout01 = FALSE) {
                  await yielded_leaderTimeout01;
                  with (
                    len03 \in (0) .. (BagCardinality(((network)[srvId0]).queue)), 
                    yielded_network33 = len03
                  ) {
                    await (yielded_network33) = (0);
                    await ((state)[srvId0]) \in ({Follower, Candidate});
                    with (i6 = srvId0) {
                      state := [state EXCEPT ![i6] = Candidate];
                      currentTerm := [currentTerm EXCEPT ![i6] = ((currentTerm)[i6]) + (1)];
                      votedFor := [votedFor EXCEPT ![i6] = i6];
                      votesResponded := [votesResponded EXCEPT ![i6] = {i6}];
                      votesGranted := [votesGranted EXCEPT ![i6] = {i6}];
                      leader := [leader EXCEPT ![i6] = Nil];
                      if (Debug) {
                        print <<"ServerTimeout", i6, (currentTerm)[i6]>>;
                        idx0 := 1;
                        goto requestVoteLoop;
                      } else {
                        idx0 := 1;
                        goto requestVoteLoop;
                      };
                    };
                  };
                };
              };
            };
          };
        } else {
          either {
            with (yielded_leaderTimeout3 = TRUE) {
              await yielded_leaderTimeout3;
              with (
                len04 \in (0) .. (BagCardinality(((network)[srvId0]).queue)), 
                yielded_network34 = len04
              ) {
                await (yielded_network34) = (0);
                await ((state)[srvId0]) \in ({Follower, Candidate});
                with (i7 = srvId0) {
                  state := [state EXCEPT ![i7] = Candidate];
                  currentTerm := [currentTerm EXCEPT ![i7] = ((currentTerm)[i7]) + (1)];
                  votedFor := [votedFor EXCEPT ![i7] = i7];
                  votesResponded := [votesResponded EXCEPT ![i7] = {i7}];
                  votesGranted := [votesGranted EXCEPT ![i7] = {i7}];
                  leader := [leader EXCEPT ![i7] = Nil];
                  if (Debug) {
                    print <<"ServerTimeout", i7, (currentTerm)[i7]>>;
                    idx0 := 1;
                    goto requestVoteLoop;
                  } else {
                    idx0 := 1;
                    goto requestVoteLoop;
                  };
                };
              };
            };
          } or {
            with (yielded_leaderTimeout02 = FALSE) {
              await yielded_leaderTimeout02;
              with (
                len05 \in (0) .. (BagCardinality(((network)[srvId0]).queue)), 
                yielded_network35 = len05
              ) {
                await (yielded_network35) = (0);
                await ((state)[srvId0]) \in ({Follower, Candidate});
                with (i8 = srvId0) {
                  state := [state EXCEPT ![i8] = Candidate];
                  currentTerm := [currentTerm EXCEPT ![i8] = ((currentTerm)[i8]) + (1)];
                  votedFor := [votedFor EXCEPT ![i8] = i8];
                  votesResponded := [votesResponded EXCEPT ![i8] = {i8}];
                  votesGranted := [votesGranted EXCEPT ![i8] = {i8}];
                  leader := [leader EXCEPT ![i8] = Nil];
                  if (Debug) {
                    print <<"ServerTimeout", i8, (currentTerm)[i8]>>;
                    idx0 := 1;
                    goto requestVoteLoop;
                  } else {
                    idx0 := 1;
                    goto requestVoteLoop;
                  };
                };
              };
            };
          };
        };
      } else {
        goto Done;
      };
    requestVoteLoop:
      if ((idx0) <= (NumServers)) {
        if (ExploreFail) {
          with (yielded_network40 = ((network)[srvId0]).enabled) {
            if (~ (yielded_network40)) {
              await FALSE;
              if ((idx0) # (srvId0)) {
                either {
                  with (value100 = [mtype |-> RequestVoteRequest, mterm |-> (currentTerm)[srvId0], mlastLogTerm |-> LastTerm((log)[srvId0]), mlastLogIndex |-> Len((log)[srvId0]), msource |-> srvId0, mdest |-> idx0]) {
                    await ((network)[idx0]).enabled;
                    await (BagCardinality(((network)[idx0]).queue)) < (BufferSize);
                    network := [network EXCEPT ![idx0] = [queue |-> (((network)[idx0]).queue) (+) (SetToBag({value100})), enabled |-> ((network)[idx0]).enabled]];
                    idx0 := (idx0) + (1);
                    goto requestVoteLoop;
                  };
                } or {
                  either {
                    with (yielded_fd56 = FALSE) {
                      await yielded_fd56;
                      idx0 := (idx0) + (1);
                      goto requestVoteLoop;
                    };
                  } or {
                    with (yielded_fd60 = TRUE) {
                      await yielded_fd60;
                      idx0 := (idx0) + (1);
                      goto requestVoteLoop;
                    };
                  };
                };
              } else {
                idx0 := (idx0) + (1);
                goto requestVoteLoop;
              };
            } else {
              if ((idx0) # (srvId0)) {
                either {
                  with (value101 = [mtype |-> RequestVoteRequest, mterm |-> (currentTerm)[srvId0], mlastLogTerm |-> LastTerm((log)[srvId0]), mlastLogIndex |-> Len((log)[srvId0]), msource |-> srvId0, mdest |-> idx0]) {
                    await ((network)[idx0]).enabled;
                    await (BagCardinality(((network)[idx0]).queue)) < (BufferSize);
                    network := [network EXCEPT ![idx0] = [queue |-> (((network)[idx0]).queue) (+) (SetToBag({value101})), enabled |-> ((network)[idx0]).enabled]];
                    idx0 := (idx0) + (1);
                    goto requestVoteLoop;
                  };
                } or {
                  either {
                    with (yielded_fd57 = FALSE) {
                      await yielded_fd57;
                      idx0 := (idx0) + (1);
                      goto requestVoteLoop;
                    };
                  } or {
                    with (yielded_fd61 = TRUE) {
                      await yielded_fd61;
                      idx0 := (idx0) + (1);
                      goto requestVoteLoop;
                    };
                  };
                };
              } else {
                idx0 := (idx0) + (1);
                goto requestVoteLoop;
              };
            };
          };
        } else {
          if ((idx0) # (srvId0)) {
            either {
              with (value102 = [mtype |-> RequestVoteRequest, mterm |-> (currentTerm)[srvId0], mlastLogTerm |-> LastTerm((log)[srvId0]), mlastLogIndex |-> Len((log)[srvId0]), msource |-> srvId0, mdest |-> idx0]) {
                await ((network)[idx0]).enabled;
                await (BagCardinality(((network)[idx0]).queue)) < (BufferSize);
                network := [network EXCEPT ![idx0] = [queue |-> (((network)[idx0]).queue) (+) (SetToBag({value102})), enabled |-> ((network)[idx0]).enabled]];
                idx0 := (idx0) + (1);
                goto requestVoteLoop;
              };
            } or {
              either {
                with (yielded_fd58 = FALSE) {
                  await yielded_fd58;
                  idx0 := (idx0) + (1);
                  goto requestVoteLoop;
                };
              } or {
                with (yielded_fd62 = TRUE) {
                  await yielded_fd62;
                  idx0 := (idx0) + (1);
                  goto requestVoteLoop;
                };
              };
            };
          } else {
            idx0 := (idx0) + (1);
            goto requestVoteLoop;
          };
        };
      } else {
        goto serverRequestVoteLoop;
      };
  }
  
  fair process (s2 \in ServerAppendEntriesSet)
    variables idx1; srvId1 = (appendEntriesSrvId)[self];
  {
    serverAppendEntriesLoop:
      either {
        await (Len((appendEntriesCh)[srvId1])) > (0);
        with (res0 = Head((appendEntriesCh)[srvId1])) {
          appendEntriesCh := [appendEntriesCh EXCEPT ![srvId1] = Tail((appendEntriesCh)[srvId1])];
          with (yielded_appendEntriesCh = res0) {
            if (yielded_appendEntriesCh) {
              if (ExploreFail) {
                with (yielded_network50 = ((network)[srvId1]).enabled) {
                  if (~ (yielded_network50)) {
                    await FALSE;
                    await ((state)[srvId1]) = (Leader);
                    idx1 := 1;
                    goto appendEntriesLoop;
                  } else {
                    await ((state)[srvId1]) = (Leader);
                    idx1 := 1;
                    goto appendEntriesLoop;
                  };
                };
              } else {
                await ((state)[srvId1]) = (Leader);
                idx1 := 1;
                goto appendEntriesLoop;
              };
            } else {
              goto Done;
            };
          };
        };
      } or {
        await ((appendEntriesCh)[srvId1]) = (<<>>);
        with (yielded_appendEntriesCh0 = TRUE) {
          if (yielded_appendEntriesCh0) {
            if (ExploreFail) {
              with (yielded_network51 = ((network)[srvId1]).enabled) {
                if (~ (yielded_network51)) {
                  await FALSE;
                  await ((state)[srvId1]) = (Leader);
                  idx1 := 1;
                  goto appendEntriesLoop;
                } else {
                  await ((state)[srvId1]) = (Leader);
                  idx1 := 1;
                  goto appendEntriesLoop;
                };
              };
            } else {
              await ((state)[srvId1]) = (Leader);
              idx1 := 1;
              goto appendEntriesLoop;
            };
          } else {
            goto Done;
          };
        };
      };
    appendEntriesLoop:
      if ((((state)[srvId1]) = (Leader)) /\ ((idx1) <= (NumServers))) {
        if (ExploreFail) {
          with (yielded_network60 = ((network)[srvId1]).enabled) {
            if (~ (yielded_network60)) {
              await FALSE;
              if ((idx1) # (srvId1)) {
                with (
                  prevLogIndex3 = (((nextIndex)[srvId1])[idx1]) - (1), 
                  prevLogTerm3 = IF (prevLogIndex3) > (0) THEN (((log)[srvId1])[prevLogIndex3]).term ELSE 0, 
                  entries3 = SubSeq((log)[srvId1], ((nextIndex)[srvId1])[idx1], Len((log)[srvId1]))
                ) {
                  either {
                    with (value114 = [mtype |-> AppendEntriesRequest, mterm |-> (currentTerm)[srvId1], mprevLogIndex |-> prevLogIndex3, mprevLogTerm |-> prevLogTerm3, mentries |-> entries3, mcommitIndex |-> (commitIndex)[srvId1], msource |-> srvId1, mdest |-> idx1]) {
                      await ((network)[idx1]).enabled;
                      await (BagCardinality(((network)[idx1]).queue)) < (BufferSize);
                      network := [network EXCEPT ![idx1] = [queue |-> (((network)[idx1]).queue) (+) (SetToBag({value114})), enabled |-> ((network)[idx1]).enabled]];
                      idx1 := (idx1) + (1);
                      goto appendEntriesLoop;
                    };
                  } or {
                    either {
                      with (yielded_fd70 = FALSE) {
                        await yielded_fd70;
                        idx1 := (idx1) + (1);
                        goto appendEntriesLoop;
                      };
                    } or {
                      with (yielded_fd80 = TRUE) {
                        await yielded_fd80;
                        idx1 := (idx1) + (1);
                        goto appendEntriesLoop;
                      };
                    };
                  };
                };
              } else {
                idx1 := (idx1) + (1);
                goto appendEntriesLoop;
              };
            } else {
              if ((idx1) # (srvId1)) {
                with (
                  prevLogIndex4 = (((nextIndex)[srvId1])[idx1]) - (1), 
                  prevLogTerm4 = IF (prevLogIndex4) > (0) THEN (((log)[srvId1])[prevLogIndex4]).term ELSE 0, 
                  entries4 = SubSeq((log)[srvId1], ((nextIndex)[srvId1])[idx1], Len((log)[srvId1]))
                ) {
                  either {
                    with (value115 = [mtype |-> AppendEntriesRequest, mterm |-> (currentTerm)[srvId1], mprevLogIndex |-> prevLogIndex4, mprevLogTerm |-> prevLogTerm4, mentries |-> entries4, mcommitIndex |-> (commitIndex)[srvId1], msource |-> srvId1, mdest |-> idx1]) {
                      await ((network)[idx1]).enabled;
                      await (BagCardinality(((network)[idx1]).queue)) < (BufferSize);
                      network := [network EXCEPT ![idx1] = [queue |-> (((network)[idx1]).queue) (+) (SetToBag({value115})), enabled |-> ((network)[idx1]).enabled]];
                      idx1 := (idx1) + (1);
                      goto appendEntriesLoop;
                    };
                  } or {
                    either {
                      with (yielded_fd71 = FALSE) {
                        await yielded_fd71;
                        idx1 := (idx1) + (1);
                        goto appendEntriesLoop;
                      };
                    } or {
                      with (yielded_fd81 = TRUE) {
                        await yielded_fd81;
                        idx1 := (idx1) + (1);
                        goto appendEntriesLoop;
                      };
                    };
                  };
                };
              } else {
                idx1 := (idx1) + (1);
                goto appendEntriesLoop;
              };
            };
          };
        } else {
          if ((idx1) # (srvId1)) {
            with (
              prevLogIndex5 = (((nextIndex)[srvId1])[idx1]) - (1), 
              prevLogTerm5 = IF (prevLogIndex5) > (0) THEN (((log)[srvId1])[prevLogIndex5]).term ELSE 0, 
              entries5 = SubSeq((log)[srvId1], ((nextIndex)[srvId1])[idx1], Len((log)[srvId1]))
            ) {
              either {
                with (value116 = [mtype |-> AppendEntriesRequest, mterm |-> (currentTerm)[srvId1], mprevLogIndex |-> prevLogIndex5, mprevLogTerm |-> prevLogTerm5, mentries |-> entries5, mcommitIndex |-> (commitIndex)[srvId1], msource |-> srvId1, mdest |-> idx1]) {
                  await ((network)[idx1]).enabled;
                  await (BagCardinality(((network)[idx1]).queue)) < (BufferSize);
                  network := [network EXCEPT ![idx1] = [queue |-> (((network)[idx1]).queue) (+) (SetToBag({value116})), enabled |-> ((network)[idx1]).enabled]];
                  idx1 := (idx1) + (1);
                  goto appendEntriesLoop;
                };
              } or {
                either {
                  with (yielded_fd72 = FALSE) {
                    await yielded_fd72;
                    idx1 := (idx1) + (1);
                    goto appendEntriesLoop;
                  };
                } or {
                  with (yielded_fd82 = TRUE) {
                    await yielded_fd82;
                    idx1 := (idx1) + (1);
                    goto appendEntriesLoop;
                  };
                };
              };
            };
          } else {
            idx1 := (idx1) + (1);
            goto appendEntriesLoop;
          };
        };
      } else {
        goto serverAppendEntriesLoop;
      };
  }
  
  fair process (s3 \in ServerAdvanceCommitIndexSet)
    variables newCommitIndex = 0; srvId2 = (advanceCommitIndexSrvId)[self];
  {
    serverAdvanceCommitIndexLoop:
      if (TRUE) {
        if (ExploreFail) {
          with (yielded_network70 = ((network)[srvId2]).enabled) {
            if (~ (yielded_network70)) {
              await FALSE;
              await ((state)[srvId2]) = (Leader);
              with (
                i = srvId2, 
                maxAgreeIndex = FindMaxAgreeIndex((log)[i], i, (matchIndex)[i]), 
                nCommitIndex = IF ((maxAgreeIndex) # (Nil)) /\ (((((log)[i])[maxAgreeIndex]).term) = ((currentTerm)[i])) THEN maxAgreeIndex ELSE (commitIndex)[i]
              ) {
                newCommitIndex := nCommitIndex;
                assert (newCommitIndex) >= ((commitIndex)[i]);
                goto applyLoop;
              };
            } else {
              await ((state)[srvId2]) = (Leader);
              with (
                i = srvId2, 
                maxAgreeIndex = FindMaxAgreeIndex((log)[i], i, (matchIndex)[i]), 
                nCommitIndex = IF ((maxAgreeIndex) # (Nil)) /\ (((((log)[i])[maxAgreeIndex]).term) = ((currentTerm)[i])) THEN maxAgreeIndex ELSE (commitIndex)[i]
              ) {
                newCommitIndex := nCommitIndex;
                assert (newCommitIndex) >= ((commitIndex)[i]);
                goto applyLoop;
              };
            };
          };
        } else {
          await ((state)[srvId2]) = (Leader);
          with (
            i = srvId2, 
            maxAgreeIndex = FindMaxAgreeIndex((log)[i], i, (matchIndex)[i]), 
            nCommitIndex = IF ((maxAgreeIndex) # (Nil)) /\ (((((log)[i])[maxAgreeIndex]).term) = ((currentTerm)[i])) THEN maxAgreeIndex ELSE (commitIndex)[i]
          ) {
            newCommitIndex := nCommitIndex;
            assert (newCommitIndex) >= ((commitIndex)[i]);
            goto applyLoop;
          };
        };
      } else {
        goto Done;
      };
    applyLoop:
      if (((commitIndex)[srvId2]) < (newCommitIndex)) {
        if (ExploreFail) {
          with (yielded_network80 = ((network)[srvId2]).enabled) {
            if (~ (yielded_network80)) {
              await FALSE;
              commitIndex := [commitIndex EXCEPT ![srvId2] = ((commitIndex)[srvId2]) + (1)];
              with (
                i = srvId2, 
                k = (commitIndex)[i], 
                entry = ((log)[i])[k], 
                cmd = (entry).cmd, 
                respType = IF ((cmd).type) = (Put) THEN ClientPutResponse ELSE ClientGetResponse
              ) {
                if (((cmd).type) = (Put)) {
                  sm := [sm EXCEPT ![i] = (((cmd).key) :> ((cmd).value)) @@ ((sm)[i])];
                  smDomain := [smDomain EXCEPT ![i] = ((smDomain)[i]) \union ({(cmd).key})];
                  with (
                    reqOk = ((cmd).key) \in ((smDomain)[i]), 
                    value120 = [mtype |-> respType, msuccess |-> TRUE, mresponse |-> [idx |-> (cmd).idx, key |-> (cmd).key, value |-> IF reqOk THEN ((sm)[i])[(cmd).key] ELSE Nil, ok |-> reqOk], mleaderHint |-> i, msource |-> i, mdest |-> (entry).client]
                  ) {
                    await ((network)[(entry).client]).enabled;
                    await (BagCardinality(((network)[(entry).client]).queue)) < (BufferSize);
                    network := [network EXCEPT ![(entry).client] = [queue |-> (((network)[(entry).client]).queue) (+) (SetToBag({value120})), enabled |-> ((network)[(entry).client]).enabled]];
                    goto applyLoop;
                  };
                } else {
                  with (
                    reqOk = ((cmd).key) \in ((smDomain)[i]), 
                    value121 = [mtype |-> respType, msuccess |-> TRUE, mresponse |-> [idx |-> (cmd).idx, key |-> (cmd).key, value |-> IF reqOk THEN ((sm)[i])[(cmd).key] ELSE Nil, ok |-> reqOk], mleaderHint |-> i, msource |-> i, mdest |-> (entry).client]
                  ) {
                    await ((network)[(entry).client]).enabled;
                    await (BagCardinality(((network)[(entry).client]).queue)) < (BufferSize);
                    network := [network EXCEPT ![(entry).client] = [queue |-> (((network)[(entry).client]).queue) (+) (SetToBag({value121})), enabled |-> ((network)[(entry).client]).enabled]];
                    goto applyLoop;
                  };
                };
              };
            } else {
              commitIndex := [commitIndex EXCEPT ![srvId2] = ((commitIndex)[srvId2]) + (1)];
              with (
                i = srvId2, 
                k = (commitIndex)[i], 
                entry = ((log)[i])[k], 
                cmd = (entry).cmd, 
                respType = IF ((cmd).type) = (Put) THEN ClientPutResponse ELSE ClientGetResponse
              ) {
                if (((cmd).type) = (Put)) {
                  sm := [sm EXCEPT ![i] = (((cmd).key) :> ((cmd).value)) @@ ((sm)[i])];
                  smDomain := [smDomain EXCEPT ![i] = ((smDomain)[i]) \union ({(cmd).key})];
                  with (
                    reqOk = ((cmd).key) \in ((smDomain)[i]), 
                    value122 = [mtype |-> respType, msuccess |-> TRUE, mresponse |-> [idx |-> (cmd).idx, key |-> (cmd).key, value |-> IF reqOk THEN ((sm)[i])[(cmd).key] ELSE Nil, ok |-> reqOk], mleaderHint |-> i, msource |-> i, mdest |-> (entry).client]
                  ) {
                    await ((network)[(entry).client]).enabled;
                    await (BagCardinality(((network)[(entry).client]).queue)) < (BufferSize);
                    network := [network EXCEPT ![(entry).client] = [queue |-> (((network)[(entry).client]).queue) (+) (SetToBag({value122})), enabled |-> ((network)[(entry).client]).enabled]];
                    goto applyLoop;
                  };
                } else {
                  with (
                    reqOk = ((cmd).key) \in ((smDomain)[i]), 
                    value123 = [mtype |-> respType, msuccess |-> TRUE, mresponse |-> [idx |-> (cmd).idx, key |-> (cmd).key, value |-> IF reqOk THEN ((sm)[i])[(cmd).key] ELSE Nil, ok |-> reqOk], mleaderHint |-> i, msource |-> i, mdest |-> (entry).client]
                  ) {
                    await ((network)[(entry).client]).enabled;
                    await (BagCardinality(((network)[(entry).client]).queue)) < (BufferSize);
                    network := [network EXCEPT ![(entry).client] = [queue |-> (((network)[(entry).client]).queue) (+) (SetToBag({value123})), enabled |-> ((network)[(entry).client]).enabled]];
                    goto applyLoop;
                  };
                };
              };
            };
          };
        } else {
          commitIndex := [commitIndex EXCEPT ![srvId2] = ((commitIndex)[srvId2]) + (1)];
          with (
            i = srvId2, 
            k = (commitIndex)[i], 
            entry = ((log)[i])[k], 
            cmd = (entry).cmd, 
            respType = IF ((cmd).type) = (Put) THEN ClientPutResponse ELSE ClientGetResponse
          ) {
            if (((cmd).type) = (Put)) {
              sm := [sm EXCEPT ![i] = (((cmd).key) :> ((cmd).value)) @@ ((sm)[i])];
              smDomain := [smDomain EXCEPT ![i] = ((smDomain)[i]) \union ({(cmd).key})];
              with (
                reqOk = ((cmd).key) \in ((smDomain)[i]), 
                value124 = [mtype |-> respType, msuccess |-> TRUE, mresponse |-> [idx |-> (cmd).idx, key |-> (cmd).key, value |-> IF reqOk THEN ((sm)[i])[(cmd).key] ELSE Nil, ok |-> reqOk], mleaderHint |-> i, msource |-> i, mdest |-> (entry).client]
              ) {
                await ((network)[(entry).client]).enabled;
                await (BagCardinality(((network)[(entry).client]).queue)) < (BufferSize);
                network := [network EXCEPT ![(entry).client] = [queue |-> (((network)[(entry).client]).queue) (+) (SetToBag({value124})), enabled |-> ((network)[(entry).client]).enabled]];
                goto applyLoop;
              };
            } else {
              with (
                reqOk = ((cmd).key) \in ((smDomain)[i]), 
                value125 = [mtype |-> respType, msuccess |-> TRUE, mresponse |-> [idx |-> (cmd).idx, key |-> (cmd).key, value |-> IF reqOk THEN ((sm)[i])[(cmd).key] ELSE Nil, ok |-> reqOk], mleaderHint |-> i, msource |-> i, mdest |-> (entry).client]
              ) {
                await ((network)[(entry).client]).enabled;
                await (BagCardinality(((network)[(entry).client]).queue)) < (BufferSize);
                network := [network EXCEPT ![(entry).client] = [queue |-> (((network)[(entry).client]).queue) (+) (SetToBag({value125})), enabled |-> ((network)[(entry).client]).enabled]];
                goto applyLoop;
              };
            };
          };
        };
      } else {
        goto serverAdvanceCommitIndexLoop;
      };
  }
  
  fair process (s4 \in ServerBecomeLeaderSet)
    variables srvId3 = (becomeLeaderSrvId)[self];
  {
    serverBecomeLeaderLoop:
      either {
        await (Len((becomeLeaderCh)[srvId3])) > (0);
        with (res1 = Head((becomeLeaderCh)[srvId3])) {
          becomeLeaderCh := [becomeLeaderCh EXCEPT ![srvId3] = Tail((becomeLeaderCh)[srvId3])];
          with (yielded_becomeLeaderCh = res1) {
            if (yielded_becomeLeaderCh) {
              if (ExploreFail) {
                with (yielded_network90 = ((network)[srvId3]).enabled) {
                  if (~ (yielded_network90)) {
                    await FALSE;
                    await ((state)[srvId3]) = (Candidate);
                    await isQuorum((votesGranted)[srvId3]);
                    with (i = srvId3) {
                      state := [state EXCEPT ![i] = Leader];
                      nextIndex := [nextIndex EXCEPT ![i] = [j \in ServerSet |-> (Len((log)[i])) + (1)]];
                      matchIndex := [matchIndex EXCEPT ![i] = [j \in ServerSet |-> 0]];
                      leader := [leader EXCEPT ![i] = i];
                      with (value130 = TRUE) {
                        appendEntriesCh := [appendEntriesCh EXCEPT ![srvId3] = Append((appendEntriesCh)[srvId3], value130)];
                        if (Debug) {
                          print <<"BecomeLeader", i, (currentTerm)[i], (state)[i], (leader)[i]>>;
                          goto serverBecomeLeaderLoop;
                        } else {
                          goto serverBecomeLeaderLoop;
                        };
                      };
                    };
                  } else {
                    await ((state)[srvId3]) = (Candidate);
                    await isQuorum((votesGranted)[srvId3]);
                    with (i = srvId3) {
                      state := [state EXCEPT ![i] = Leader];
                      nextIndex := [nextIndex EXCEPT ![i] = [j \in ServerSet |-> (Len((log)[i])) + (1)]];
                      matchIndex := [matchIndex EXCEPT ![i] = [j \in ServerSet |-> 0]];
                      leader := [leader EXCEPT ![i] = i];
                      with (value131 = TRUE) {
                        appendEntriesCh := [appendEntriesCh EXCEPT ![srvId3] = Append((appendEntriesCh)[srvId3], value131)];
                        if (Debug) {
                          print <<"BecomeLeader", i, (currentTerm)[i], (state)[i], (leader)[i]>>;
                          goto serverBecomeLeaderLoop;
                        } else {
                          goto serverBecomeLeaderLoop;
                        };
                      };
                    };
                  };
                };
              } else {
                await ((state)[srvId3]) = (Candidate);
                await isQuorum((votesGranted)[srvId3]);
                with (i = srvId3) {
                  state := [state EXCEPT ![i] = Leader];
                  nextIndex := [nextIndex EXCEPT ![i] = [j \in ServerSet |-> (Len((log)[i])) + (1)]];
                  matchIndex := [matchIndex EXCEPT ![i] = [j \in ServerSet |-> 0]];
                  leader := [leader EXCEPT ![i] = i];
                  with (value132 = TRUE) {
                    appendEntriesCh := [appendEntriesCh EXCEPT ![srvId3] = Append((appendEntriesCh)[srvId3], value132)];
                    if (Debug) {
                      print <<"BecomeLeader", i, (currentTerm)[i], (state)[i], (leader)[i]>>;
                      goto serverBecomeLeaderLoop;
                    } else {
                      goto serverBecomeLeaderLoop;
                    };
                  };
                };
              };
            } else {
              goto Done;
            };
          };
        };
      } or {
        await ((becomeLeaderCh)[srvId3]) = (<<>>);
        with (yielded_becomeLeaderCh0 = TRUE) {
          if (yielded_becomeLeaderCh0) {
            if (ExploreFail) {
              with (yielded_network91 = ((network)[srvId3]).enabled) {
                if (~ (yielded_network91)) {
                  await FALSE;
                  await ((state)[srvId3]) = (Candidate);
                  await isQuorum((votesGranted)[srvId3]);
                  with (i = srvId3) {
                    state := [state EXCEPT ![i] = Leader];
                    nextIndex := [nextIndex EXCEPT ![i] = [j \in ServerSet |-> (Len((log)[i])) + (1)]];
                    matchIndex := [matchIndex EXCEPT ![i] = [j \in ServerSet |-> 0]];
                    leader := [leader EXCEPT ![i] = i];
                    with (value133 = TRUE) {
                      appendEntriesCh := [appendEntriesCh EXCEPT ![srvId3] = Append((appendEntriesCh)[srvId3], value133)];
                      if (Debug) {
                        print <<"BecomeLeader", i, (currentTerm)[i], (state)[i], (leader)[i]>>;
                        goto serverBecomeLeaderLoop;
                      } else {
                        goto serverBecomeLeaderLoop;
                      };
                    };
                  };
                } else {
                  await ((state)[srvId3]) = (Candidate);
                  await isQuorum((votesGranted)[srvId3]);
                  with (i = srvId3) {
                    state := [state EXCEPT ![i] = Leader];
                    nextIndex := [nextIndex EXCEPT ![i] = [j \in ServerSet |-> (Len((log)[i])) + (1)]];
                    matchIndex := [matchIndex EXCEPT ![i] = [j \in ServerSet |-> 0]];
                    leader := [leader EXCEPT ![i] = i];
                    with (value134 = TRUE) {
                      appendEntriesCh := [appendEntriesCh EXCEPT ![srvId3] = Append((appendEntriesCh)[srvId3], value134)];
                      if (Debug) {
                        print <<"BecomeLeader", i, (currentTerm)[i], (state)[i], (leader)[i]>>;
                        goto serverBecomeLeaderLoop;
                      } else {
                        goto serverBecomeLeaderLoop;
                      };
                    };
                  };
                };
              };
            } else {
              await ((state)[srvId3]) = (Candidate);
              await isQuorum((votesGranted)[srvId3]);
              with (i = srvId3) {
                state := [state EXCEPT ![i] = Leader];
                nextIndex := [nextIndex EXCEPT ![i] = [j \in ServerSet |-> (Len((log)[i])) + (1)]];
                matchIndex := [matchIndex EXCEPT ![i] = [j \in ServerSet |-> 0]];
                leader := [leader EXCEPT ![i] = i];
                with (value135 = TRUE) {
                  appendEntriesCh := [appendEntriesCh EXCEPT ![srvId3] = Append((appendEntriesCh)[srvId3], value135)];
                  if (Debug) {
                    print <<"BecomeLeader", i, (currentTerm)[i], (state)[i], (leader)[i]>>;
                    goto serverBecomeLeaderLoop;
                  } else {
                    goto serverBecomeLeaderLoop;
                  };
                };
              };
            };
          } else {
            goto Done;
          };
        };
      };
  }
  
  fair process (client \in ClientSet)
    variables leader0 = Nil; req; resp; reqIdx = 0; timeout = FALSE;
  {
    clientLoop:
      if (TRUE) {
        with (
          req00 \in AllReqs, 
          yielded_reqCh0 = req00
        ) {
          req := yielded_reqCh0;
          reqIdx := (reqIdx) + (1);
          goto sndReq;
        };
      } else {
        goto Done;
      };
    sndReq:
      if ((leader0) = (Nil)) {
        with (srv1 \in ServerSet) {
          leader0 := srv1;
          if (Debug) {
            print <<"ClientSndReq", self, leader0, reqIdx, req>>;
            if (((req).type) = (Put)) {
              either {
                with (value140 = [mtype |-> ClientPutRequest, mcmd |-> [idx |-> reqIdx, type |-> Put, key |-> (req).key, value |-> (req).value], msource |-> self, mdest |-> leader0]) {
                  await ((network)[leader0]).enabled;
                  await (BagCardinality(((network)[leader0]).queue)) < (BufferSize);
                  network := [network EXCEPT ![leader0] = [queue |-> (((network)[leader0]).queue) (+) (SetToBag({value140})), enabled |-> ((network)[leader0]).enabled]];
                  goto rcvResp;
                };
              } or {
                either {
                  with (yielded_fd90 = FALSE) {
                    await yielded_fd90;
                    goto rcvResp;
                  };
                } or {
                  with (yielded_fd100 = TRUE) {
                    await yielded_fd100;
                    goto rcvResp;
                  };
                };
              };
            } else {
              if (((req).type) = (Get)) {
                either {
                  with (value150 = [mtype |-> ClientGetRequest, mcmd |-> [idx |-> reqIdx, type |-> Get, key |-> (req).key], msource |-> self, mdest |-> leader0]) {
                    await ((network)[leader0]).enabled;
                    await (BagCardinality(((network)[leader0]).queue)) < (BufferSize);
                    network := [network EXCEPT ![leader0] = [queue |-> (((network)[leader0]).queue) (+) (SetToBag({value150})), enabled |-> ((network)[leader0]).enabled]];
                    goto rcvResp;
                  };
                } or {
                  either {
                    with (yielded_fd1110 = FALSE) {
                      await yielded_fd1110;
                      goto rcvResp;
                    };
                  } or {
                    with (yielded_fd1210 = TRUE) {
                      await yielded_fd1210;
                      goto rcvResp;
                    };
                  };
                };
              } else {
                goto rcvResp;
              };
            };
          } else {
            if (((req).type) = (Put)) {
              either {
                with (value141 = [mtype |-> ClientPutRequest, mcmd |-> [idx |-> reqIdx, type |-> Put, key |-> (req).key, value |-> (req).value], msource |-> self, mdest |-> leader0]) {
                  await ((network)[leader0]).enabled;
                  await (BagCardinality(((network)[leader0]).queue)) < (BufferSize);
                  network := [network EXCEPT ![leader0] = [queue |-> (((network)[leader0]).queue) (+) (SetToBag({value141})), enabled |-> ((network)[leader0]).enabled]];
                  goto rcvResp;
                };
              } or {
                either {
                  with (yielded_fd91 = FALSE) {
                    await yielded_fd91;
                    goto rcvResp;
                  };
                } or {
                  with (yielded_fd101 = TRUE) {
                    await yielded_fd101;
                    goto rcvResp;
                  };
                };
              };
            } else {
              if (((req).type) = (Get)) {
                either {
                  with (value151 = [mtype |-> ClientGetRequest, mcmd |-> [idx |-> reqIdx, type |-> Get, key |-> (req).key], msource |-> self, mdest |-> leader0]) {
                    await ((network)[leader0]).enabled;
                    await (BagCardinality(((network)[leader0]).queue)) < (BufferSize);
                    network := [network EXCEPT ![leader0] = [queue |-> (((network)[leader0]).queue) (+) (SetToBag({value151})), enabled |-> ((network)[leader0]).enabled]];
                    goto rcvResp;
                  };
                } or {
                  either {
                    with (yielded_fd1111 = FALSE) {
                      await yielded_fd1111;
                      goto rcvResp;
                    };
                  } or {
                    with (yielded_fd1211 = TRUE) {
                      await yielded_fd1211;
                      goto rcvResp;
                    };
                  };
                };
              } else {
                goto rcvResp;
              };
            };
          };
        };
      } else {
        if (Debug) {
          print <<"ClientSndReq", self, leader0, reqIdx, req>>;
          if (((req).type) = (Put)) {
            either {
              with (value142 = [mtype |-> ClientPutRequest, mcmd |-> [idx |-> reqIdx, type |-> Put, key |-> (req).key, value |-> (req).value], msource |-> self, mdest |-> leader0]) {
                await ((network)[leader0]).enabled;
                await (BagCardinality(((network)[leader0]).queue)) < (BufferSize);
                network := [network EXCEPT ![leader0] = [queue |-> (((network)[leader0]).queue) (+) (SetToBag({value142})), enabled |-> ((network)[leader0]).enabled]];
                goto rcvResp;
              };
            } or {
              either {
                with (yielded_fd92 = FALSE) {
                  await yielded_fd92;
                  goto rcvResp;
                };
              } or {
                with (yielded_fd102 = TRUE) {
                  await yielded_fd102;
                  goto rcvResp;
                };
              };
            };
          } else {
            if (((req).type) = (Get)) {
              either {
                with (value152 = [mtype |-> ClientGetRequest, mcmd |-> [idx |-> reqIdx, type |-> Get, key |-> (req).key], msource |-> self, mdest |-> leader0]) {
                  await ((network)[leader0]).enabled;
                  await (BagCardinality(((network)[leader0]).queue)) < (BufferSize);
                  network := [network EXCEPT ![leader0] = [queue |-> (((network)[leader0]).queue) (+) (SetToBag({value152})), enabled |-> ((network)[leader0]).enabled]];
                  goto rcvResp;
                };
              } or {
                either {
                  with (yielded_fd1112 = FALSE) {
                    await yielded_fd1112;
                    goto rcvResp;
                  };
                } or {
                  with (yielded_fd1212 = TRUE) {
                    await yielded_fd1212;
                    goto rcvResp;
                  };
                };
              };
            } else {
              goto rcvResp;
            };
          };
        } else {
          if (((req).type) = (Put)) {
            either {
              with (value143 = [mtype |-> ClientPutRequest, mcmd |-> [idx |-> reqIdx, type |-> Put, key |-> (req).key, value |-> (req).value], msource |-> self, mdest |-> leader0]) {
                await ((network)[leader0]).enabled;
                await (BagCardinality(((network)[leader0]).queue)) < (BufferSize);
                network := [network EXCEPT ![leader0] = [queue |-> (((network)[leader0]).queue) (+) (SetToBag({value143})), enabled |-> ((network)[leader0]).enabled]];
                goto rcvResp;
              };
            } or {
              either {
                with (yielded_fd93 = FALSE) {
                  await yielded_fd93;
                  goto rcvResp;
                };
              } or {
                with (yielded_fd103 = TRUE) {
                  await yielded_fd103;
                  goto rcvResp;
                };
              };
            };
          } else {
            if (((req).type) = (Get)) {
              either {
                with (value153 = [mtype |-> ClientGetRequest, mcmd |-> [idx |-> reqIdx, type |-> Get, key |-> (req).key], msource |-> self, mdest |-> leader0]) {
                  await ((network)[leader0]).enabled;
                  await (BagCardinality(((network)[leader0]).queue)) < (BufferSize);
                  network := [network EXCEPT ![leader0] = [queue |-> (((network)[leader0]).queue) (+) (SetToBag({value153})), enabled |-> ((network)[leader0]).enabled]];
                  goto rcvResp;
                };
              } or {
                either {
                  with (yielded_fd1113 = FALSE) {
                    await yielded_fd1113;
                    goto rcvResp;
                  };
                } or {
                  with (yielded_fd1213 = TRUE) {
                    await yielded_fd1213;
                    goto rcvResp;
                  };
                };
              };
            } else {
              goto rcvResp;
            };
          };
        };
      };
    rcvResp:
      either {
        assert ((network)[self]).enabled;
        await (BagCardinality(((network)[self]).queue)) > (0);
        with (readMsg10 \in BagToSet(((network)[self]).queue)) {
          network := [network EXCEPT ![self] = [queue |-> (((network)[self]).queue) (-) (SetToBag({readMsg10})), enabled |-> ((network)[self]).enabled]];
          with (yielded_network100 = readMsg10) {
            resp := yielded_network100;
            if (Debug) {
              print <<"ClientRcvResp", self, leader0, reqIdx, resp>>;
              assert ((resp).mdest) = (self);
              if ((((resp).mresponse).idx) # (reqIdx)) {
                goto rcvResp;
              } else {
                leader0 := (resp).mleaderHint;
                assert ((((req).type) = (Get)) => (((resp).mtype) = (ClientGetResponse))) /\ ((((req).type) = (Put)) => (((resp).mtype) = (ClientPutResponse)));
                if (~ ((resp).msuccess)) {
                  goto sndReq;
                } else {
                  assert ((((resp).mresponse).idx) = (reqIdx)) /\ ((((resp).mresponse).key) = ((req).key));
                  respCh := resp;
                  if (Debug) {
                    print <<"ClientRcvChDone", self, leader0, reqIdx, resp>>;
                    goto clientLoop;
                  } else {
                    goto clientLoop;
                  };
                };
              };
            } else {
              assert ((resp).mdest) = (self);
              if ((((resp).mresponse).idx) # (reqIdx)) {
                goto rcvResp;
              } else {
                leader0 := (resp).mleaderHint;
                assert ((((req).type) = (Get)) => (((resp).mtype) = (ClientGetResponse))) /\ ((((req).type) = (Put)) => (((resp).mtype) = (ClientPutResponse)));
                if (~ ((resp).msuccess)) {
                  goto sndReq;
                } else {
                  assert ((((resp).mresponse).idx) = (reqIdx)) /\ ((((resp).mresponse).key) = ((req).key));
                  respCh := resp;
                  if (Debug) {
                    print <<"ClientRcvChDone", self, leader0, reqIdx, resp>>;
                    goto clientLoop;
                  } else {
                    goto clientLoop;
                  };
                };
              };
            };
          };
        };
      } or {
        either {
          with (
            yielded_fd133 = FALSE, 
            len10 \in (0) .. (BagCardinality(((network)[self]).queue)), 
            yielded_network110 = len10
          ) {
            either {
              with (yielded_timeout1 = TRUE) {
                await ((yielded_fd133) /\ ((yielded_network110) = (0))) \/ (yielded_timeout1);
                if (Debug) {
                  print <<"ClientTimeout", self, leader0, reqIdx>>;
                  leader0 := Nil;
                  goto sndReq;
                } else {
                  leader0 := Nil;
                  goto sndReq;
                };
              };
            } or {
              with (yielded_timeout00 = FALSE) {
                await ((yielded_fd133) /\ ((yielded_network110) = (0))) \/ (yielded_timeout00);
                if (Debug) {
                  print <<"ClientTimeout", self, leader0, reqIdx>>;
                  leader0 := Nil;
                  goto sndReq;
                } else {
                  leader0 := Nil;
                  goto sndReq;
                };
              };
            };
          };
        } or {
          with (
            yielded_fd140 = TRUE, 
            len11 \in (0) .. (BagCardinality(((network)[self]).queue)), 
            yielded_network111 = len11
          ) {
            either {
              with (yielded_timeout2 = TRUE) {
                await ((yielded_fd140) /\ ((yielded_network111) = (0))) \/ (yielded_timeout2);
                if (Debug) {
                  print <<"ClientTimeout", self, leader0, reqIdx>>;
                  leader0 := Nil;
                  goto sndReq;
                } else {
                  leader0 := Nil;
                  goto sndReq;
                };
              };
            } or {
              with (yielded_timeout01 = FALSE) {
                await ((yielded_fd140) /\ ((yielded_network111) = (0))) \/ (yielded_timeout01);
                if (Debug) {
                  print <<"ClientTimeout", self, leader0, reqIdx>>;
                  leader0 := Nil;
                  goto sndReq;
                } else {
                  leader0 := Nil;
                  goto sndReq;
                };
              };
            };
          };
        };
      };
  }
  
  fair process (crasher \in ServerCrasherSet)
    variables srvId4 = (crasherSrvId)[self];
  {
    serverCrash:
      with (value160 = FALSE) {
        network := [network EXCEPT ![srvId4] = [queue |-> ((network)[srvId4]).queue, enabled |-> value160]];
        goto fdUpdate;
      };
    fdUpdate:
      with (value170 = TRUE) {
        fd := [fd EXCEPT ![srvId4] = value170];
        goto Done;
      };
  }
}

\* END PLUSCAL TRANSLATION

********************)
\* BEGIN TRANSLATION (chksum(pcal) = "9f711191" /\ chksum(tla) = "de9ba418") PCal-18049938ece8066a38eb5044080cf45c
CONSTANT defaultInitValue
VARIABLES pc, network, fd, state, currentTerm, commitIndex, nextIndex, 
          matchIndex, log, plog, votedFor, votesResponded, votesGranted, 
          leader, sm, smDomain, leaderTimeout, appendEntriesCh, 
          becomeLeaderCh, reqCh, respCh, requestVoteSrvId, appendEntriesSrvId, 
          advanceCommitIndexSrvId, becomeLeaderSrvId, crasherSrvId

(* define statement *)
Follower == "follower"
Candidate == "candidate"
Leader == "leader"
RequestVoteRequest == "rvq"
RequestVoteResponse == "rvp"
AppendEntriesRequest == "apq"
AppendEntriesResponse == "app"
ClientPutRequest == "cpq"
ClientPutResponse == "cpp"
ClientGetRequest == "cgq"
ClientGetResponse == "cgp"
LastTerm(xlog) == IF (Len(xlog)) = (0) THEN 0 ELSE ((xlog)[Len(xlog)]).term
ServerRequestVoteSet == (((1) * (NumServers)) + (1)) .. ((2) * (NumServers))
ServerAppendEntriesSet == (((2) * (NumServers)) + (1)) .. ((3) * (NumServers))
ServerAdvanceCommitIndexSet == (((3) * (NumServers)) + (1)) .. ((4) * (NumServers))
ServerBecomeLeaderSet == (((4) * (NumServers)) + (1)) .. ((5) * (NumServers))
ServerCrasherSet == IF ExploreFail THEN (((5) * (NumServers)) + (1)) .. (((5) * (NumServers)) + (MaxNodeFail)) ELSE {}
ClientSet == (((6) * (NumServers)) + (1)) .. (((6) * (NumServers)) + (NumClients))
NodeSet == (ServerSet) \union (ClientSet)
KeySet == {}

VARIABLES idx, m, srvId, idx0, srvId0, idx1, srvId1, newCommitIndex, srvId2, 
          srvId3, leader0, req, resp, reqIdx, timeout, srvId4

vars == << pc, network, fd, state, currentTerm, commitIndex, nextIndex, 
           matchIndex, log, plog, votedFor, votesResponded, votesGranted, 
           leader, sm, smDomain, leaderTimeout, appendEntriesCh, 
           becomeLeaderCh, reqCh, respCh, requestVoteSrvId, 
           appendEntriesSrvId, advanceCommitIndexSrvId, becomeLeaderSrvId, 
           crasherSrvId, idx, m, srvId, idx0, srvId0, idx1, srvId1, 
           newCommitIndex, srvId2, srvId3, leader0, req, resp, reqIdx, 
           timeout, srvId4 >>

ProcSet == (ServerSet) \cup (ServerRequestVoteSet) \cup (ServerAppendEntriesSet) \cup (ServerAdvanceCommitIndexSet) \cup (ServerBecomeLeaderSet) \cup (ClientSet) \cup (ServerCrasherSet)

Init == (* Global variables *)
        /\ network = [i \in NodeSet |-> [queue |-> SetToBag({}), enabled |-> TRUE]]
        /\ fd = [i \in ServerSet |-> FALSE]
        /\ state = [i \in ServerSet |-> Follower]
        /\ currentTerm = [i \in ServerSet |-> 1]
        /\ commitIndex = [i \in ServerSet |-> 0]
        /\ nextIndex = [i \in ServerSet |-> [j \in ServerSet |-> 1]]
        /\ matchIndex = [i \in ServerSet |-> [j \in ServerSet |-> 0]]
        /\ log = [i \in ServerSet |-> <<>>]
        /\ plog = [i \in ServerSet |-> <<>>]
        /\ votedFor = [i \in ServerSet |-> Nil]
        /\ votesResponded = [i \in ServerSet |-> {}]
        /\ votesGranted = [i \in ServerSet |-> {}]
        /\ leader = [i \in ServerSet |-> Nil]
        /\ sm = [i \in ServerSet |-> [k \in KeySet |-> Nil]]
        /\ smDomain = [i \in ServerSet |-> KeySet]
        /\ leaderTimeout = TRUE
        /\ appendEntriesCh = [i \in ServerSet |-> <<>>]
        /\ becomeLeaderCh = [i \in ServerSet |-> IF (NumServers) > (1) THEN <<>> ELSE <<TRUE>>]
        /\ reqCh = defaultInitValue
        /\ respCh = defaultInitValue
        /\ requestVoteSrvId = [i \in ServerRequestVoteSet |-> (i) - ((1) * (NumServers))]
        /\ appendEntriesSrvId = [i \in ServerAppendEntriesSet |-> (i) - ((2) * (NumServers))]
        /\ advanceCommitIndexSrvId = [i \in ServerAdvanceCommitIndexSet |-> (i) - ((3) * (NumServers))]
        /\ becomeLeaderSrvId = [i \in ServerBecomeLeaderSet |-> (i) - ((4) * (NumServers))]
        /\ crasherSrvId = [i \in ServerCrasherSet |-> (i) - ((5) * (NumServers))]
        (* Process s0 *)
        /\ idx = [self \in ServerSet |-> 1]
        /\ m = [self \in ServerSet |-> defaultInitValue]
        /\ srvId = [self \in ServerSet |-> self]
        (* Process s1 *)
        /\ idx0 = [self \in ServerRequestVoteSet |-> 1]
        /\ srvId0 = [self \in ServerRequestVoteSet |-> (requestVoteSrvId)[self]]
        (* Process s2 *)
        /\ idx1 = [self \in ServerAppendEntriesSet |-> defaultInitValue]
        /\ srvId1 = [self \in ServerAppendEntriesSet |-> (appendEntriesSrvId)[self]]
        (* Process s3 *)
        /\ newCommitIndex = [self \in ServerAdvanceCommitIndexSet |-> 0]
        /\ srvId2 = [self \in ServerAdvanceCommitIndexSet |-> (advanceCommitIndexSrvId)[self]]
        (* Process s4 *)
        /\ srvId3 = [self \in ServerBecomeLeaderSet |-> (becomeLeaderSrvId)[self]]
        (* Process client *)
        /\ leader0 = [self \in ClientSet |-> Nil]
        /\ req = [self \in ClientSet |-> defaultInitValue]
        /\ resp = [self \in ClientSet |-> defaultInitValue]
        /\ reqIdx = [self \in ClientSet |-> 0]
        /\ timeout = [self \in ClientSet |-> FALSE]
        (* Process crasher *)
        /\ srvId4 = [self \in ServerCrasherSet |-> (crasherSrvId)[self]]
        /\ pc = [self \in ProcSet |-> CASE self \in ServerSet -> "serverLoop"
                                        [] self \in ServerRequestVoteSet -> "serverRequestVoteLoop"
                                        [] self \in ServerAppendEntriesSet -> "serverAppendEntriesLoop"
                                        [] self \in ServerAdvanceCommitIndexSet -> "serverAdvanceCommitIndexLoop"
                                        [] self \in ServerBecomeLeaderSet -> "serverBecomeLeaderLoop"
                                        [] self \in ClientSet -> "clientLoop"
                                        [] self \in ServerCrasherSet -> "serverCrash"]

serverLoop(self) == /\ pc[self] = "serverLoop"
                    /\ IF TRUE
                          THEN /\ IF ExploreFail
                                     THEN /\ LET yielded_network12 == ((network)[self]).enabled IN
                                               IF ~ (yielded_network12)
                                                  THEN /\ FALSE
                                                       /\ Assert(((network)[self]).enabled, 
                                                                 "Failure of assertion at line 1025, column 15.")
                                                       /\ (BagCardinality(((network)[self]).queue)) > (0)
                                                       /\ \E readMsg00 \in BagToSet(((network)[self]).queue):
                                                            /\ network' = [network EXCEPT ![self] = [queue |-> (((network)[self]).queue) (-) (SetToBag({readMsg00})), enabled |-> ((network)[self]).enabled]]
                                                            /\ LET yielded_network00 == readMsg00 IN
                                                                 /\ m' = [m EXCEPT ![self] = yielded_network00]
                                                                 /\ Assert(((m'[self]).mdest) = (self), 
                                                                           "Failure of assertion at line 1031, column 19.")
                                                                 /\ pc' = [pc EXCEPT ![self] = "handleMsg"]
                                                  ELSE /\ Assert(((network)[self]).enabled, 
                                                                 "Failure of assertion at line 1036, column 15.")
                                                       /\ (BagCardinality(((network)[self]).queue)) > (0)
                                                       /\ \E readMsg01 \in BagToSet(((network)[self]).queue):
                                                            /\ network' = [network EXCEPT ![self] = [queue |-> (((network)[self]).queue) (-) (SetToBag({readMsg01})), enabled |-> ((network)[self]).enabled]]
                                                            /\ LET yielded_network01 == readMsg01 IN
                                                                 /\ m' = [m EXCEPT ![self] = yielded_network01]
                                                                 /\ Assert(((m'[self]).mdest) = (self), 
                                                                           "Failure of assertion at line 1042, column 19.")
                                                                 /\ pc' = [pc EXCEPT ![self] = "handleMsg"]
                                     ELSE /\ Assert(((network)[self]).enabled, 
                                                    "Failure of assertion at line 1049, column 11.")
                                          /\ (BagCardinality(((network)[self]).queue)) > (0)
                                          /\ \E readMsg02 \in BagToSet(((network)[self]).queue):
                                               /\ network' = [network EXCEPT ![self] = [queue |-> (((network)[self]).queue) (-) (SetToBag({readMsg02})), enabled |-> ((network)[self]).enabled]]
                                               /\ LET yielded_network02 == readMsg02 IN
                                                    /\ m' = [m EXCEPT ![self] = yielded_network02]
                                                    /\ Assert(((m'[self]).mdest) = (self), 
                                                              "Failure of assertion at line 1055, column 15.")
                                                    /\ pc' = [pc EXCEPT ![self] = "handleMsg"]
                          ELSE /\ pc' = [pc EXCEPT ![self] = "Done"]
                               /\ UNCHANGED << network, m >>
                    /\ UNCHANGED << fd, state, currentTerm, commitIndex, 
                                    nextIndex, matchIndex, log, plog, votedFor, 
                                    votesResponded, votesGranted, leader, sm, 
                                    smDomain, leaderTimeout, appendEntriesCh, 
                                    becomeLeaderCh, reqCh, respCh, 
                                    requestVoteSrvId, appendEntriesSrvId, 
                                    advanceCommitIndexSrvId, becomeLeaderSrvId, 
                                    crasherSrvId, idx, srvId, idx0, srvId0, 
                                    idx1, srvId1, newCommitIndex, srvId2, 
                                    srvId3, leader0, req, resp, reqIdx, 
                                    timeout, srvId4 >>

handleMsg(self) == /\ pc[self] = "handleMsg"
                   /\ IF ExploreFail
                         THEN /\ LET yielded_network13 == ((network)[self]).enabled IN
                                   IF ~ (yielded_network13)
                                      THEN /\ FALSE
                                           /\ IF ((m[self]).mtype) = (RequestVoteRequest)
                                                 THEN /\ IF ((m[self]).mterm) > ((currentTerm)[self])
                                                            THEN /\ currentTerm' = [currentTerm EXCEPT ![self] = (m[self]).mterm]
                                                                 /\ state' = [state EXCEPT ![self] = Follower]
                                                                 /\ LET votedFor3 == [votedFor EXCEPT ![self] = Nil] IN
                                                                      /\ leader' = [leader EXCEPT ![self] = Nil]
                                                                      /\ LET i == self IN
                                                                           LET j == (m[self]).msource IN
                                                                             LET logOK == (((m[self]).mlastLogTerm) > (LastTerm((log)[i]))) \/ ((((m[self]).mlastLogTerm) = (LastTerm((log)[i]))) /\ (((m[self]).mlastLogIndex) >= (Len((log)[i])))) IN
                                                                               LET grant == ((((m[self]).mterm) = ((currentTerm')[i])) /\ (logOK)) /\ (((votedFor3)[self]) \in ({Nil, j})) IN
                                                                                 /\ Assert(((m[self]).mterm) <= ((currentTerm')[i]), 
                                                                                           "Failure of assertion at line 1080, column 21.")
                                                                                 /\ IF grant
                                                                                       THEN /\ votedFor' = [votedFor3 EXCEPT ![i] = j]
                                                                                            /\ \/ /\ LET value00 == [mtype |-> RequestVoteResponse, mterm |-> (currentTerm')[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j] IN
                                                                                                       /\ ((network)[j]).enabled
                                                                                                       /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                       /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value00})), enabled |-> ((network)[j]).enabled]]
                                                                                                       /\ IF Debug
                                                                                                             THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                             ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                               \/ /\ \/ /\ LET yielded_fd15 == FALSE IN
                                                                                                             /\ yielded_fd15
                                                                                                             /\ IF Debug
                                                                                                                   THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                   ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                     \/ /\ LET yielded_fd00 == TRUE IN
                                                                                                             /\ yielded_fd00
                                                                                                             /\ IF Debug
                                                                                                                   THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                   ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                  /\ UNCHANGED network
                                                                                       ELSE /\ \/ /\ LET value01 == [mtype |-> RequestVoteResponse, mterm |-> (currentTerm')[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j] IN
                                                                                                       /\ ((network)[j]).enabled
                                                                                                       /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                       /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value01})), enabled |-> ((network)[j]).enabled]]
                                                                                                       /\ IF Debug
                                                                                                             THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                                  /\ votedFor' = votedFor3
                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                             ELSE /\ votedFor' = votedFor3
                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                               \/ /\ \/ /\ LET yielded_fd16 == FALSE IN
                                                                                                             /\ yielded_fd16
                                                                                                             /\ IF Debug
                                                                                                                   THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                                        /\ votedFor' = votedFor3
                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                   ELSE /\ votedFor' = votedFor3
                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                     \/ /\ LET yielded_fd01 == TRUE IN
                                                                                                             /\ yielded_fd01
                                                                                                             /\ IF Debug
                                                                                                                   THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                                        /\ votedFor' = votedFor3
                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                   ELSE /\ votedFor' = votedFor3
                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                  /\ UNCHANGED network
                                                            ELSE /\ LET i == self IN
                                                                      LET j == (m[self]).msource IN
                                                                        LET logOK == (((m[self]).mlastLogTerm) > (LastTerm((log)[i]))) \/ ((((m[self]).mlastLogTerm) = (LastTerm((log)[i]))) /\ (((m[self]).mlastLogIndex) >= (Len((log)[i])))) IN
                                                                          LET grant == ((((m[self]).mterm) = ((currentTerm)[i])) /\ (logOK)) /\ (((votedFor)[self]) \in ({Nil, j})) IN
                                                                            /\ Assert(((m[self]).mterm) <= ((currentTerm)[i]), 
                                                                                      "Failure of assertion at line 1170, column 19.")
                                                                            /\ IF grant
                                                                                  THEN /\ votedFor' = [votedFor EXCEPT ![i] = j]
                                                                                       /\ \/ /\ LET value02 == [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j] IN
                                                                                                  /\ ((network)[j]).enabled
                                                                                                  /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                  /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value02})), enabled |-> ((network)[j]).enabled]]
                                                                                                  /\ IF Debug
                                                                                                        THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                        ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                          \/ /\ \/ /\ LET yielded_fd17 == FALSE IN
                                                                                                        /\ yielded_fd17
                                                                                                        /\ IF Debug
                                                                                                              THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                              ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                \/ /\ LET yielded_fd02 == TRUE IN
                                                                                                        /\ yielded_fd02
                                                                                                        /\ IF Debug
                                                                                                              THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                              ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                             /\ UNCHANGED network
                                                                                  ELSE /\ \/ /\ LET value03 == [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j] IN
                                                                                                  /\ ((network)[j]).enabled
                                                                                                  /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                  /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value03})), enabled |-> ((network)[j]).enabled]]
                                                                                                  /\ IF Debug
                                                                                                        THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                        ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                          \/ /\ \/ /\ LET yielded_fd18 == FALSE IN
                                                                                                        /\ yielded_fd18
                                                                                                        /\ IF Debug
                                                                                                              THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                              ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                \/ /\ LET yielded_fd03 == TRUE IN
                                                                                                        /\ yielded_fd03
                                                                                                        /\ IF Debug
                                                                                                              THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                              ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                             /\ UNCHANGED network
                                                                                       /\ UNCHANGED votedFor
                                                                 /\ UNCHANGED << state, 
                                                                                 currentTerm, 
                                                                                 leader >>
                                                      /\ UNCHANGED << commitIndex, 
                                                                      nextIndex, 
                                                                      matchIndex, 
                                                                      log, 
                                                                      plog, 
                                                                      votesResponded, 
                                                                      votesGranted, 
                                                                      sm, 
                                                                      smDomain, 
                                                                      leaderTimeout, 
                                                                      appendEntriesCh, 
                                                                      becomeLeaderCh >>
                                                 ELSE /\ IF ((m[self]).mtype) = (RequestVoteResponse)
                                                            THEN /\ IF ((m[self]).mterm) > ((currentTerm)[self])
                                                                       THEN /\ currentTerm' = [currentTerm EXCEPT ![self] = (m[self]).mterm]
                                                                            /\ state' = [state EXCEPT ![self] = Follower]
                                                                            /\ votedFor' = [votedFor EXCEPT ![self] = Nil]
                                                                            /\ leader' = [leader EXCEPT ![self] = Nil]
                                                                            /\ IF ((m[self]).mterm) < ((currentTerm')[self])
                                                                                  THEN /\ TRUE
                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                       /\ UNCHANGED << votesResponded, 
                                                                                                       votesGranted, 
                                                                                                       becomeLeaderCh >>
                                                                                  ELSE /\ LET i == self IN
                                                                                            LET j == (m[self]).msource IN
                                                                                              /\ Assert(((m[self]).mterm) = ((currentTerm')[i]), 
                                                                                                        "Failure of assertion at line 1262, column 23.")
                                                                                              /\ votesResponded' = [votesResponded EXCEPT ![i] = ((votesResponded)[i]) \union ({j})]
                                                                                              /\ IF (m[self]).mvoteGranted
                                                                                                    THEN /\ votesGranted' = [votesGranted EXCEPT ![i] = ((votesGranted)[i]) \union ({j})]
                                                                                                         /\ IF (((state')[i]) = (Candidate)) /\ (isQuorum((votesGranted')[i]))
                                                                                                               THEN /\ LET value18 == TRUE IN
                                                                                                                         /\ becomeLeaderCh' = [becomeLeaderCh EXCEPT ![i] = Append((becomeLeaderCh)[i], value18)]
                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                               ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                    /\ UNCHANGED becomeLeaderCh
                                                                                                    ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                         /\ UNCHANGED << votesGranted, 
                                                                                                                         becomeLeaderCh >>
                                                                       ELSE /\ IF ((m[self]).mterm) < ((currentTerm)[self])
                                                                                  THEN /\ TRUE
                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                       /\ UNCHANGED << votesResponded, 
                                                                                                       votesGranted, 
                                                                                                       becomeLeaderCh >>
                                                                                  ELSE /\ LET i == self IN
                                                                                            LET j == (m[self]).msource IN
                                                                                              /\ Assert(((m[self]).mterm) = ((currentTerm)[i]), 
                                                                                                        "Failure of assertion at line 1288, column 23.")
                                                                                              /\ votesResponded' = [votesResponded EXCEPT ![i] = ((votesResponded)[i]) \union ({j})]
                                                                                              /\ IF (m[self]).mvoteGranted
                                                                                                    THEN /\ votesGranted' = [votesGranted EXCEPT ![i] = ((votesGranted)[i]) \union ({j})]
                                                                                                         /\ IF (((state)[i]) = (Candidate)) /\ (isQuorum((votesGranted')[i]))
                                                                                                               THEN /\ LET value19 == TRUE IN
                                                                                                                         /\ becomeLeaderCh' = [becomeLeaderCh EXCEPT ![i] = Append((becomeLeaderCh)[i], value19)]
                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                               ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                    /\ UNCHANGED becomeLeaderCh
                                                                                                    ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                         /\ UNCHANGED << votesGranted, 
                                                                                                                         becomeLeaderCh >>
                                                                            /\ UNCHANGED << state, 
                                                                                            currentTerm, 
                                                                                            votedFor, 
                                                                                            leader >>
                                                                 /\ UNCHANGED << network, 
                                                                                 commitIndex, 
                                                                                 nextIndex, 
                                                                                 matchIndex, 
                                                                                 log, 
                                                                                 plog, 
                                                                                 sm, 
                                                                                 smDomain, 
                                                                                 leaderTimeout, 
                                                                                 appendEntriesCh >>
                                                            ELSE /\ IF ((m[self]).mtype) = (AppendEntriesRequest)
                                                                       THEN /\ IF ((m[self]).mterm) > ((currentTerm)[self])
                                                                                  THEN /\ currentTerm' = [currentTerm EXCEPT ![self] = (m[self]).mterm]
                                                                                       /\ LET state3 == [state EXCEPT ![self] = Follower] IN
                                                                                            /\ votedFor' = [votedFor EXCEPT ![self] = Nil]
                                                                                            /\ LET leader3 == [leader EXCEPT ![self] = Nil] IN
                                                                                                 LET i == self IN
                                                                                                   LET j == (m[self]).msource IN
                                                                                                     LET logOK == (((m[self]).mprevLogIndex) = (0)) \/ (((((m[self]).mprevLogIndex) > (0)) /\ (((m[self]).mprevLogIndex) <= (Len((log)[i])))) /\ (((m[self]).mprevLogTerm) = ((((log)[i])[(m[self]).mprevLogIndex]).term))) IN
                                                                                                       /\ Assert(((m[self]).mterm) <= ((currentTerm')[i]), 
                                                                                                                 "Failure of assertion at line 1318, column 25.")
                                                                                                       /\ IF ((m[self]).mterm) = ((currentTerm')[i])
                                                                                                             THEN /\ leader' = [leader3 EXCEPT ![i] = (m[self]).msource]
                                                                                                                  /\ LET value20 == LeaderTimeoutReset IN
                                                                                                                       /\ leaderTimeout' = value20
                                                                                                                       /\ IF (((m[self]).mterm) = ((currentTerm')[i])) /\ (((state3)[i]) = (Candidate))
                                                                                                                             THEN /\ state' = [state3 EXCEPT ![i] = Follower]
                                                                                                                                  /\ IF (((m[self]).mterm) < ((currentTerm')[i])) \/ (((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state')[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                                        THEN /\ \/ /\ LET value30 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value30})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                \/ /\ \/ /\ LET yielded_fd19 == FALSE IN
                                                                                                                                                              /\ yielded_fd19
                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                      \/ /\ LET yielded_fd20 == TRUE IN
                                                                                                                                                              /\ yielded_fd20
                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                             /\ UNCHANGED << commitIndex, 
                                                                                                                                                             log, 
                                                                                                                                                             plog, 
                                                                                                                                                             sm, 
                                                                                                                                                             smDomain >>
                                                                                                                                        ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state')[i]) = (Follower))) /\ (logOK), 
                                                                                                                                                       "Failure of assertion at line 1347, column 33.")
                                                                                                                                             /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                                  LET value40 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                                    IF ((value40).cmd) = (LogConcat)
                                                                                                                                                       THEN /\ LET plog24 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value40).entries)] IN
                                                                                                                                                                 LET log24 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                   LET value50 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                     IF ((value50).cmd) = (LogConcat)
                                                                                                                                                                        THEN /\ plog' = [plog24 EXCEPT ![i] = ((plog24)[i]) \o ((value50).entries)]
                                                                                                                                                                             /\ log' = [log24 EXCEPT ![i] = ((log24)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                             /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                       "Failure of assertion at line 1361, column 41.")
                                                                                                                                                                             /\ LET result24 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                  /\ sm' = [sm EXCEPT ![i] = (result24)[1]]
                                                                                                                                                                                  /\ smDomain' = [smDomain EXCEPT ![i] = (result24)[2]]
                                                                                                                                                                                  /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                  /\ \/ /\ LET value60 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                             /\ ((network)[j]).enabled
                                                                                                                                                                                             /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                             /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value60})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     \/ /\ \/ /\ LET yielded_fd30 == FALSE IN
                                                                                                                                                                                                   /\ yielded_fd30
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ LET yielded_fd40 == TRUE IN
                                                                                                                                                                                                   /\ yielded_fd40
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        /\ UNCHANGED network
                                                                                                                                                                        ELSE /\ IF ((value50).cmd) = (LogPop)
                                                                                                                                                                                   THEN /\ plog' = [plog24 EXCEPT ![i] = SubSeq((plog24)[i], 1, (Len((plog24)[i])) - ((value50).cnt))]
                                                                                                                                                                                        /\ log' = [log24 EXCEPT ![i] = ((log24)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                  "Failure of assertion at line 1391, column 43.")
                                                                                                                                                                                        /\ LET result25 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result25)[1]]
                                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result25)[2]]
                                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                             /\ \/ /\ LET value61 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value61})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd31 == FALSE IN
                                                                                                                                                                                                              /\ yielded_fd31
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ LET yielded_fd41 == TRUE IN
                                                                                                                                                                                                              /\ yielded_fd41
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                                   ELSE /\ log' = [log24 EXCEPT ![i] = ((log24)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                  "Failure of assertion at line 1419, column 43.")
                                                                                                                                                                                        /\ LET result26 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result26)[1]]
                                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result26)[2]]
                                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                             /\ \/ /\ LET value62 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value62})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                        /\ plog' = plog24
                                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd32 == FALSE IN
                                                                                                                                                                                                              /\ yielded_fd32
                                                                                                                                                                                                              /\ plog' = plog24
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ LET yielded_fd42 == TRUE IN
                                                                                                                                                                                                              /\ yielded_fd42
                                                                                                                                                                                                              /\ plog' = plog24
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                       ELSE /\ IF ((value40).cmd) = (LogPop)
                                                                                                                                                                  THEN /\ LET plog25 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value40).cnt))] IN
                                                                                                                                                                            LET log25 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                              LET value51 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                                IF ((value51).cmd) = (LogConcat)
                                                                                                                                                                                   THEN /\ plog' = [plog25 EXCEPT ![i] = ((plog25)[i]) \o ((value51).entries)]
                                                                                                                                                                                        /\ log' = [log25 EXCEPT ![i] = ((log25)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                  "Failure of assertion at line 1461, column 43.")
                                                                                                                                                                                        /\ LET result27 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result27)[1]]
                                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result27)[2]]
                                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                             /\ \/ /\ LET value63 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value63})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd33 == FALSE IN
                                                                                                                                                                                                              /\ yielded_fd33
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ LET yielded_fd43 == TRUE IN
                                                                                                                                                                                                              /\ yielded_fd43
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                                   ELSE /\ IF ((value51).cmd) = (LogPop)
                                                                                                                                                                                              THEN /\ plog' = [plog25 EXCEPT ![i] = SubSeq((plog25)[i], 1, (Len((plog25)[i])) - ((value51).cnt))]
                                                                                                                                                                                                   /\ log' = [log25 EXCEPT ![i] = ((log25)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                             "Failure of assertion at line 1491, column 45.")
                                                                                                                                                                                                   /\ LET result28 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result28)[1]]
                                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result28)[2]]
                                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                        /\ \/ /\ LET value64 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value64})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd34 == FALSE IN
                                                                                                                                                                                                                         /\ yielded_fd34
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                                 \/ /\ LET yielded_fd44 == TRUE IN
                                                                                                                                                                                                                         /\ yielded_fd44
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                                              ELSE /\ log' = [log25 EXCEPT ![i] = ((log25)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                             "Failure of assertion at line 1519, column 45.")
                                                                                                                                                                                                   /\ LET result29 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result29)[1]]
                                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result29)[2]]
                                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                        /\ \/ /\ LET value65 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value65})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                   /\ plog' = plog25
                                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd35 == FALSE IN
                                                                                                                                                                                                                         /\ yielded_fd35
                                                                                                                                                                                                                         /\ plog' = plog25
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                                 \/ /\ LET yielded_fd45 == TRUE IN
                                                                                                                                                                                                                         /\ yielded_fd45
                                                                                                                                                                                                                         /\ plog' = plog25
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                  ELSE /\ LET log26 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                            LET value52 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                              IF ((value52).cmd) = (LogConcat)
                                                                                                                                                                                 THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value52).entries)]
                                                                                                                                                                                      /\ log' = [log26 EXCEPT ![i] = ((log26)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                "Failure of assertion at line 1559, column 43.")
                                                                                                                                                                                      /\ LET result30 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result30)[1]]
                                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result30)[2]]
                                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                           /\ \/ /\ LET value66 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value66})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd36 == FALSE IN
                                                                                                                                                                                                            /\ yielded_fd36
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ LET yielded_fd46 == TRUE IN
                                                                                                                                                                                                            /\ yielded_fd46
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                                                 ELSE /\ IF ((value52).cmd) = (LogPop)
                                                                                                                                                                                            THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value52).cnt))]
                                                                                                                                                                                                 /\ log' = [log26 EXCEPT ![i] = ((log26)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                           "Failure of assertion at line 1589, column 45.")
                                                                                                                                                                                                 /\ LET result31 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result31)[1]]
                                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result31)[2]]
                                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                      /\ \/ /\ LET value67 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value67})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd37 == FALSE IN
                                                                                                                                                                                                                       /\ yielded_fd37
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                               \/ /\ LET yielded_fd47 == TRUE IN
                                                                                                                                                                                                                       /\ yielded_fd47
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                                            ELSE /\ log' = [log26 EXCEPT ![i] = ((log26)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                           "Failure of assertion at line 1617, column 45.")
                                                                                                                                                                                                 /\ LET result32 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result32)[1]]
                                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result32)[2]]
                                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                      /\ \/ /\ LET value68 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value68})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd38 == FALSE IN
                                                                                                                                                                                                                       /\ yielded_fd38
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                               \/ /\ LET yielded_fd48 == TRUE IN
                                                                                                                                                                                                                       /\ yielded_fd48
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                                                 /\ plog' = plog
                                                                                                                             ELSE /\ IF (((m[self]).mterm) < ((currentTerm')[i])) \/ (((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state3)[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                                        THEN /\ \/ /\ LET value31 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value31})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                        /\ state' = state3
                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                \/ /\ \/ /\ LET yielded_fd110 == FALSE IN
                                                                                                                                                              /\ yielded_fd110
                                                                                                                                                              /\ state' = state3
                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                      \/ /\ LET yielded_fd21 == TRUE IN
                                                                                                                                                              /\ yielded_fd21
                                                                                                                                                              /\ state' = state3
                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                             /\ UNCHANGED << commitIndex, 
                                                                                                                                                             log, 
                                                                                                                                                             plog, 
                                                                                                                                                             sm, 
                                                                                                                                                             smDomain >>
                                                                                                                                        ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state3)[i]) = (Follower))) /\ (logOK), 
                                                                                                                                                       "Failure of assertion at line 1676, column 33.")
                                                                                                                                             /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                                  LET value41 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                                    IF ((value41).cmd) = (LogConcat)
                                                                                                                                                       THEN /\ LET plog26 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value41).entries)] IN
                                                                                                                                                                 LET log27 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                   LET value53 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                     IF ((value53).cmd) = (LogConcat)
                                                                                                                                                                        THEN /\ plog' = [plog26 EXCEPT ![i] = ((plog26)[i]) \o ((value53).entries)]
                                                                                                                                                                             /\ log' = [log27 EXCEPT ![i] = ((log27)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                             /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                       "Failure of assertion at line 1690, column 41.")
                                                                                                                                                                             /\ LET result33 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                  /\ sm' = [sm EXCEPT ![i] = (result33)[1]]
                                                                                                                                                                                  /\ smDomain' = [smDomain EXCEPT ![i] = (result33)[2]]
                                                                                                                                                                                  /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                  /\ \/ /\ LET value69 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                             /\ ((network)[j]).enabled
                                                                                                                                                                                             /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                             /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value69})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                             /\ state' = state3
                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     \/ /\ \/ /\ LET yielded_fd39 == FALSE IN
                                                                                                                                                                                                   /\ yielded_fd39
                                                                                                                                                                                                   /\ state' = state3
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ LET yielded_fd49 == TRUE IN
                                                                                                                                                                                                   /\ yielded_fd49
                                                                                                                                                                                                   /\ state' = state3
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        /\ UNCHANGED network
                                                                                                                                                                        ELSE /\ IF ((value53).cmd) = (LogPop)
                                                                                                                                                                                   THEN /\ plog' = [plog26 EXCEPT ![i] = SubSeq((plog26)[i], 1, (Len((plog26)[i])) - ((value53).cnt))]
                                                                                                                                                                                        /\ log' = [log27 EXCEPT ![i] = ((log27)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                  "Failure of assertion at line 1723, column 43.")
                                                                                                                                                                                        /\ LET result34 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result34)[1]]
                                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result34)[2]]
                                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                             /\ \/ /\ LET value610 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value610})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                        /\ state' = state3
                                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd310 == FALSE IN
                                                                                                                                                                                                              /\ yielded_fd310
                                                                                                                                                                                                              /\ state' = state3
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ LET yielded_fd410 == TRUE IN
                                                                                                                                                                                                              /\ yielded_fd410
                                                                                                                                                                                                              /\ state' = state3
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                                   ELSE /\ log' = [log27 EXCEPT ![i] = ((log27)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                  "Failure of assertion at line 1754, column 43.")
                                                                                                                                                                                        /\ LET result35 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result35)[1]]
                                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result35)[2]]
                                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                             /\ \/ /\ LET value611 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value611})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                        /\ plog' = plog26
                                                                                                                                                                                                        /\ state' = state3
                                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd311 == FALSE IN
                                                                                                                                                                                                              /\ yielded_fd311
                                                                                                                                                                                                              /\ plog' = plog26
                                                                                                                                                                                                              /\ state' = state3
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ LET yielded_fd411 == TRUE IN
                                                                                                                                                                                                              /\ yielded_fd411
                                                                                                                                                                                                              /\ plog' = plog26
                                                                                                                                                                                                              /\ state' = state3
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                       ELSE /\ IF ((value41).cmd) = (LogPop)
                                                                                                                                                                  THEN /\ LET plog27 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value41).cnt))] IN
                                                                                                                                                                            LET log28 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                              LET value54 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                                IF ((value54).cmd) = (LogConcat)
                                                                                                                                                                                   THEN /\ plog' = [plog27 EXCEPT ![i] = ((plog27)[i]) \o ((value54).entries)]
                                                                                                                                                                                        /\ log' = [log28 EXCEPT ![i] = ((log28)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                  "Failure of assertion at line 1799, column 43.")
                                                                                                                                                                                        /\ LET result36 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result36)[1]]
                                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result36)[2]]
                                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                             /\ \/ /\ LET value612 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value612})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                        /\ state' = state3
                                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd312 == FALSE IN
                                                                                                                                                                                                              /\ yielded_fd312
                                                                                                                                                                                                              /\ state' = state3
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ LET yielded_fd412 == TRUE IN
                                                                                                                                                                                                              /\ yielded_fd412
                                                                                                                                                                                                              /\ state' = state3
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                                   ELSE /\ IF ((value54).cmd) = (LogPop)
                                                                                                                                                                                              THEN /\ plog' = [plog27 EXCEPT ![i] = SubSeq((plog27)[i], 1, (Len((plog27)[i])) - ((value54).cnt))]
                                                                                                                                                                                                   /\ log' = [log28 EXCEPT ![i] = ((log28)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                             "Failure of assertion at line 1832, column 45.")
                                                                                                                                                                                                   /\ LET result37 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result37)[1]]
                                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result37)[2]]
                                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                        /\ \/ /\ LET value613 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value613})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                   /\ state' = state3
                                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd313 == FALSE IN
                                                                                                                                                                                                                         /\ yielded_fd313
                                                                                                                                                                                                                         /\ state' = state3
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                                 \/ /\ LET yielded_fd413 == TRUE IN
                                                                                                                                                                                                                         /\ yielded_fd413
                                                                                                                                                                                                                         /\ state' = state3
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                                              ELSE /\ log' = [log28 EXCEPT ![i] = ((log28)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                             "Failure of assertion at line 1863, column 45.")
                                                                                                                                                                                                   /\ LET result38 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result38)[1]]
                                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result38)[2]]
                                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                        /\ \/ /\ LET value614 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value614})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                   /\ plog' = plog27
                                                                                                                                                                                                                   /\ state' = state3
                                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd314 == FALSE IN
                                                                                                                                                                                                                         /\ yielded_fd314
                                                                                                                                                                                                                         /\ plog' = plog27
                                                                                                                                                                                                                         /\ state' = state3
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                                 \/ /\ LET yielded_fd414 == TRUE IN
                                                                                                                                                                                                                         /\ yielded_fd414
                                                                                                                                                                                                                         /\ plog' = plog27
                                                                                                                                                                                                                         /\ state' = state3
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                  ELSE /\ LET log29 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                            LET value55 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                              IF ((value55).cmd) = (LogConcat)
                                                                                                                                                                                 THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value55).entries)]
                                                                                                                                                                                      /\ log' = [log29 EXCEPT ![i] = ((log29)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                "Failure of assertion at line 1906, column 43.")
                                                                                                                                                                                      /\ LET result39 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result39)[1]]
                                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result39)[2]]
                                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                           /\ \/ /\ LET value615 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value615})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                      /\ state' = state3
                                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd315 == FALSE IN
                                                                                                                                                                                                            /\ yielded_fd315
                                                                                                                                                                                                            /\ state' = state3
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ LET yielded_fd415 == TRUE IN
                                                                                                                                                                                                            /\ yielded_fd415
                                                                                                                                                                                                            /\ state' = state3
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                                                 ELSE /\ IF ((value55).cmd) = (LogPop)
                                                                                                                                                                                            THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value55).cnt))]
                                                                                                                                                                                                 /\ log' = [log29 EXCEPT ![i] = ((log29)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                           "Failure of assertion at line 1939, column 45.")
                                                                                                                                                                                                 /\ LET result40 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result40)[1]]
                                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result40)[2]]
                                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                      /\ \/ /\ LET value616 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value616})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                 /\ state' = state3
                                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd316 == FALSE IN
                                                                                                                                                                                                                       /\ yielded_fd316
                                                                                                                                                                                                                       /\ state' = state3
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                               \/ /\ LET yielded_fd416 == TRUE IN
                                                                                                                                                                                                                       /\ yielded_fd416
                                                                                                                                                                                                                       /\ state' = state3
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                                            ELSE /\ log' = [log29 EXCEPT ![i] = ((log29)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                           "Failure of assertion at line 1970, column 45.")
                                                                                                                                                                                                 /\ LET result41 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result41)[1]]
                                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result41)[2]]
                                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                      /\ \/ /\ LET value617 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value617})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                 /\ state' = state3
                                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd317 == FALSE IN
                                                                                                                                                                                                                       /\ yielded_fd317
                                                                                                                                                                                                                       /\ state' = state3
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                               \/ /\ LET yielded_fd417 == TRUE IN
                                                                                                                                                                                                                       /\ yielded_fd417
                                                                                                                                                                                                                       /\ state' = state3
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                                                 /\ plog' = plog
                                                                                                             ELSE /\ IF (((m[self]).mterm) = ((currentTerm')[i])) /\ (((state3)[i]) = (Candidate))
                                                                                                                        THEN /\ state' = [state3 EXCEPT ![i] = Follower]
                                                                                                                             /\ IF (((m[self]).mterm) < ((currentTerm')[i])) \/ (((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state')[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                                   THEN /\ \/ /\ LET value32 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value32})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                   /\ leader' = leader3
                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                           \/ /\ \/ /\ LET yielded_fd111 == FALSE IN
                                                                                                                                                         /\ yielded_fd111
                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                 \/ /\ LET yielded_fd22 == TRUE IN
                                                                                                                                                         /\ yielded_fd22
                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                              /\ UNCHANGED network
                                                                                                                                        /\ UNCHANGED << commitIndex, 
                                                                                                                                                        log, 
                                                                                                                                                        plog, 
                                                                                                                                                        sm, 
                                                                                                                                                        smDomain >>
                                                                                                                                   ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state')[i]) = (Follower))) /\ (logOK), 
                                                                                                                                                  "Failure of assertion at line 2036, column 31.")
                                                                                                                                        /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                             LET value42 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                               IF ((value42).cmd) = (LogConcat)
                                                                                                                                                  THEN /\ LET plog28 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value42).entries)] IN
                                                                                                                                                            LET log30 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                              LET value56 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                IF ((value56).cmd) = (LogConcat)
                                                                                                                                                                   THEN /\ plog' = [plog28 EXCEPT ![i] = ((plog28)[i]) \o ((value56).entries)]
                                                                                                                                                                        /\ log' = [log30 EXCEPT ![i] = ((log30)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                  "Failure of assertion at line 2050, column 39.")
                                                                                                                                                                        /\ LET result42 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result42)[1]]
                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result42)[2]]
                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                             /\ \/ /\ LET value618 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value618})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                        /\ leader' = leader3
                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd318 == FALSE IN
                                                                                                                                                                                              /\ yielded_fd318
                                                                                                                                                                                              /\ leader' = leader3
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                      \/ /\ LET yielded_fd418 == TRUE IN
                                                                                                                                                                                              /\ yielded_fd418
                                                                                                                                                                                              /\ leader' = leader3
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                   ELSE /\ IF ((value56).cmd) = (LogPop)
                                                                                                                                                                              THEN /\ plog' = [plog28 EXCEPT ![i] = SubSeq((plog28)[i], 1, (Len((plog28)[i])) - ((value56).cnt))]
                                                                                                                                                                                   /\ log' = [log30 EXCEPT ![i] = ((log30)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                             "Failure of assertion at line 2083, column 41.")
                                                                                                                                                                                   /\ LET result43 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result43)[1]]
                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result43)[2]]
                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                        /\ \/ /\ LET value619 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value619})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                   /\ leader' = leader3
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd319 == FALSE IN
                                                                                                                                                                                                         /\ yielded_fd319
                                                                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 \/ /\ LET yielded_fd419 == TRUE IN
                                                                                                                                                                                                         /\ yielded_fd419
                                                                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                              ELSE /\ log' = [log30 EXCEPT ![i] = ((log30)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                             "Failure of assertion at line 2114, column 41.")
                                                                                                                                                                                   /\ LET result44 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result44)[1]]
                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result44)[2]]
                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                        /\ \/ /\ LET value620 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value620})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                   /\ plog' = plog28
                                                                                                                                                                                                   /\ leader' = leader3
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd320 == FALSE IN
                                                                                                                                                                                                         /\ yielded_fd320
                                                                                                                                                                                                         /\ plog' = plog28
                                                                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 \/ /\ LET yielded_fd420 == TRUE IN
                                                                                                                                                                                                         /\ yielded_fd420
                                                                                                                                                                                                         /\ plog' = plog28
                                                                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                  ELSE /\ IF ((value42).cmd) = (LogPop)
                                                                                                                                                             THEN /\ LET plog29 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value42).cnt))] IN
                                                                                                                                                                       LET log31 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                         LET value57 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                           IF ((value57).cmd) = (LogConcat)
                                                                                                                                                                              THEN /\ plog' = [plog29 EXCEPT ![i] = ((plog29)[i]) \o ((value57).entries)]
                                                                                                                                                                                   /\ log' = [log31 EXCEPT ![i] = ((log31)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                             "Failure of assertion at line 2159, column 41.")
                                                                                                                                                                                   /\ LET result45 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result45)[1]]
                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result45)[2]]
                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                        /\ \/ /\ LET value621 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value621})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                   /\ leader' = leader3
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd321 == FALSE IN
                                                                                                                                                                                                         /\ yielded_fd321
                                                                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 \/ /\ LET yielded_fd421 == TRUE IN
                                                                                                                                                                                                         /\ yielded_fd421
                                                                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                              ELSE /\ IF ((value57).cmd) = (LogPop)
                                                                                                                                                                                         THEN /\ plog' = [plog29 EXCEPT ![i] = SubSeq((plog29)[i], 1, (Len((plog29)[i])) - ((value57).cnt))]
                                                                                                                                                                                              /\ log' = [log31 EXCEPT ![i] = ((log31)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                              /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                        "Failure of assertion at line 2192, column 43.")
                                                                                                                                                                                              /\ LET result46 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                   /\ sm' = [sm EXCEPT ![i] = (result46)[1]]
                                                                                                                                                                                                   /\ smDomain' = [smDomain EXCEPT ![i] = (result46)[2]]
                                                                                                                                                                                                   /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                   /\ \/ /\ LET value622 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                              /\ ((network)[j]).enabled
                                                                                                                                                                                                              /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                              /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value622})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                              /\ leader' = leader3
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ \/ /\ LET yielded_fd322 == FALSE IN
                                                                                                                                                                                                                    /\ yielded_fd322
                                                                                                                                                                                                                    /\ leader' = leader3
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            \/ /\ LET yielded_fd422 == TRUE IN
                                                                                                                                                                                                                    /\ yielded_fd422
                                                                                                                                                                                                                    /\ leader' = leader3
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         /\ UNCHANGED network
                                                                                                                                                                                         ELSE /\ log' = [log31 EXCEPT ![i] = ((log31)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                              /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                        "Failure of assertion at line 2223, column 43.")
                                                                                                                                                                                              /\ LET result47 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                   /\ sm' = [sm EXCEPT ![i] = (result47)[1]]
                                                                                                                                                                                                   /\ smDomain' = [smDomain EXCEPT ![i] = (result47)[2]]
                                                                                                                                                                                                   /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                   /\ \/ /\ LET value623 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                              /\ ((network)[j]).enabled
                                                                                                                                                                                                              /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                              /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value623})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                              /\ plog' = plog29
                                                                                                                                                                                                              /\ leader' = leader3
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ \/ /\ LET yielded_fd323 == FALSE IN
                                                                                                                                                                                                                    /\ yielded_fd323
                                                                                                                                                                                                                    /\ plog' = plog29
                                                                                                                                                                                                                    /\ leader' = leader3
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            \/ /\ LET yielded_fd423 == TRUE IN
                                                                                                                                                                                                                    /\ yielded_fd423
                                                                                                                                                                                                                    /\ plog' = plog29
                                                                                                                                                                                                                    /\ leader' = leader3
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         /\ UNCHANGED network
                                                                                                                                                             ELSE /\ LET log32 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                       LET value58 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                         IF ((value58).cmd) = (LogConcat)
                                                                                                                                                                            THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value58).entries)]
                                                                                                                                                                                 /\ log' = [log32 EXCEPT ![i] = ((log32)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 2266, column 41.")
                                                                                                                                                                                 /\ LET result48 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result48)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result48)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value624 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value624})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ leader' = leader3
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd324 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd324
                                                                                                                                                                                                       /\ leader' = leader3
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd424 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd424
                                                                                                                                                                                                       /\ leader' = leader3
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                            ELSE /\ IF ((value58).cmd) = (LogPop)
                                                                                                                                                                                       THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value58).cnt))]
                                                                                                                                                                                            /\ log' = [log32 EXCEPT ![i] = ((log32)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 2299, column 43.")
                                                                                                                                                                                            /\ LET result49 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result49)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result49)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value625 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value625})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ leader' = leader3
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd325 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd325
                                                                                                                                                                                                                  /\ leader' = leader3
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd425 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd425
                                                                                                                                                                                                                  /\ leader' = leader3
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                                       ELSE /\ log' = [log32 EXCEPT ![i] = ((log32)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 2330, column 43.")
                                                                                                                                                                                            /\ LET result50 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result50)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result50)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value626 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value626})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ leader' = leader3
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd326 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd326
                                                                                                                                                                                                                  /\ leader' = leader3
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd426 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd426
                                                                                                                                                                                                                  /\ leader' = leader3
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                                            /\ plog' = plog
                                                                                                                        ELSE /\ IF (((m[self]).mterm) < ((currentTerm')[i])) \/ (((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state3)[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                                   THEN /\ \/ /\ LET value33 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value33})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                   /\ leader' = leader3
                                                                                                                                                   /\ state' = state3
                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                           \/ /\ \/ /\ LET yielded_fd112 == FALSE IN
                                                                                                                                                         /\ yielded_fd112
                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                         /\ state' = state3
                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                 \/ /\ LET yielded_fd23 == TRUE IN
                                                                                                                                                         /\ yielded_fd23
                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                         /\ state' = state3
                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                              /\ UNCHANGED network
                                                                                                                                        /\ UNCHANGED << commitIndex, 
                                                                                                                                                        log, 
                                                                                                                                                        plog, 
                                                                                                                                                        sm, 
                                                                                                                                                        smDomain >>
                                                                                                                                   ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state3)[i]) = (Follower))) /\ (logOK), 
                                                                                                                                                  "Failure of assertion at line 2395, column 31.")
                                                                                                                                        /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                             LET value43 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                               IF ((value43).cmd) = (LogConcat)
                                                                                                                                                  THEN /\ LET plog30 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value43).entries)] IN
                                                                                                                                                            LET log33 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                              LET value59 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                IF ((value59).cmd) = (LogConcat)
                                                                                                                                                                   THEN /\ plog' = [plog30 EXCEPT ![i] = ((plog30)[i]) \o ((value59).entries)]
                                                                                                                                                                        /\ log' = [log33 EXCEPT ![i] = ((log33)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                  "Failure of assertion at line 2409, column 39.")
                                                                                                                                                                        /\ LET result51 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result51)[1]]
                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result51)[2]]
                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                             /\ \/ /\ LET value627 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value627})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                        /\ leader' = leader3
                                                                                                                                                                                        /\ state' = state3
                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd327 == FALSE IN
                                                                                                                                                                                              /\ yielded_fd327
                                                                                                                                                                                              /\ leader' = leader3
                                                                                                                                                                                              /\ state' = state3
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                      \/ /\ LET yielded_fd427 == TRUE IN
                                                                                                                                                                                              /\ yielded_fd427
                                                                                                                                                                                              /\ leader' = leader3
                                                                                                                                                                                              /\ state' = state3
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                   ELSE /\ IF ((value59).cmd) = (LogPop)
                                                                                                                                                                              THEN /\ plog' = [plog30 EXCEPT ![i] = SubSeq((plog30)[i], 1, (Len((plog30)[i])) - ((value59).cnt))]
                                                                                                                                                                                   /\ log' = [log33 EXCEPT ![i] = ((log33)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                             "Failure of assertion at line 2445, column 41.")
                                                                                                                                                                                   /\ LET result52 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result52)[1]]
                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result52)[2]]
                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                        /\ \/ /\ LET value628 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value628})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                   /\ leader' = leader3
                                                                                                                                                                                                   /\ state' = state3
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd328 == FALSE IN
                                                                                                                                                                                                         /\ yielded_fd328
                                                                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                                                                         /\ state' = state3
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 \/ /\ LET yielded_fd428 == TRUE IN
                                                                                                                                                                                                         /\ yielded_fd428
                                                                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                                                                         /\ state' = state3
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                              ELSE /\ log' = [log33 EXCEPT ![i] = ((log33)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                             "Failure of assertion at line 2479, column 41.")
                                                                                                                                                                                   /\ LET result53 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result53)[1]]
                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result53)[2]]
                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                        /\ \/ /\ LET value629 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value629})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                   /\ plog' = plog30
                                                                                                                                                                                                   /\ leader' = leader3
                                                                                                                                                                                                   /\ state' = state3
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd329 == FALSE IN
                                                                                                                                                                                                         /\ yielded_fd329
                                                                                                                                                                                                         /\ plog' = plog30
                                                                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                                                                         /\ state' = state3
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 \/ /\ LET yielded_fd429 == TRUE IN
                                                                                                                                                                                                         /\ yielded_fd429
                                                                                                                                                                                                         /\ plog' = plog30
                                                                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                                                                         /\ state' = state3
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                  ELSE /\ IF ((value43).cmd) = (LogPop)
                                                                                                                                                             THEN /\ LET plog31 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value43).cnt))] IN
                                                                                                                                                                       LET log34 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                         LET value510 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                           IF ((value510).cmd) = (LogConcat)
                                                                                                                                                                              THEN /\ plog' = [plog31 EXCEPT ![i] = ((plog31)[i]) \o ((value510).entries)]
                                                                                                                                                                                   /\ log' = [log34 EXCEPT ![i] = ((log34)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                             "Failure of assertion at line 2527, column 41.")
                                                                                                                                                                                   /\ LET result54 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result54)[1]]
                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result54)[2]]
                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                        /\ \/ /\ LET value630 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value630})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                   /\ leader' = leader3
                                                                                                                                                                                                   /\ state' = state3
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd330 == FALSE IN
                                                                                                                                                                                                         /\ yielded_fd330
                                                                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                                                                         /\ state' = state3
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 \/ /\ LET yielded_fd430 == TRUE IN
                                                                                                                                                                                                         /\ yielded_fd430
                                                                                                                                                                                                         /\ leader' = leader3
                                                                                                                                                                                                         /\ state' = state3
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                              ELSE /\ IF ((value510).cmd) = (LogPop)
                                                                                                                                                                                         THEN /\ plog' = [plog31 EXCEPT ![i] = SubSeq((plog31)[i], 1, (Len((plog31)[i])) - ((value510).cnt))]
                                                                                                                                                                                              /\ log' = [log34 EXCEPT ![i] = ((log34)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                              /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                        "Failure of assertion at line 2563, column 43.")
                                                                                                                                                                                              /\ LET result55 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                   /\ sm' = [sm EXCEPT ![i] = (result55)[1]]
                                                                                                                                                                                                   /\ smDomain' = [smDomain EXCEPT ![i] = (result55)[2]]
                                                                                                                                                                                                   /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                   /\ \/ /\ LET value631 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                              /\ ((network)[j]).enabled
                                                                                                                                                                                                              /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                              /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value631})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                              /\ leader' = leader3
                                                                                                                                                                                                              /\ state' = state3
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ \/ /\ LET yielded_fd331 == FALSE IN
                                                                                                                                                                                                                    /\ yielded_fd331
                                                                                                                                                                                                                    /\ leader' = leader3
                                                                                                                                                                                                                    /\ state' = state3
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            \/ /\ LET yielded_fd431 == TRUE IN
                                                                                                                                                                                                                    /\ yielded_fd431
                                                                                                                                                                                                                    /\ leader' = leader3
                                                                                                                                                                                                                    /\ state' = state3
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         /\ UNCHANGED network
                                                                                                                                                                                         ELSE /\ log' = [log34 EXCEPT ![i] = ((log34)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                              /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                        "Failure of assertion at line 2597, column 43.")
                                                                                                                                                                                              /\ LET result56 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                   /\ sm' = [sm EXCEPT ![i] = (result56)[1]]
                                                                                                                                                                                                   /\ smDomain' = [smDomain EXCEPT ![i] = (result56)[2]]
                                                                                                                                                                                                   /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                   /\ \/ /\ LET value632 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                              /\ ((network)[j]).enabled
                                                                                                                                                                                                              /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                              /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value632})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                              /\ plog' = plog31
                                                                                                                                                                                                              /\ leader' = leader3
                                                                                                                                                                                                              /\ state' = state3
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ \/ /\ LET yielded_fd332 == FALSE IN
                                                                                                                                                                                                                    /\ yielded_fd332
                                                                                                                                                                                                                    /\ plog' = plog31
                                                                                                                                                                                                                    /\ leader' = leader3
                                                                                                                                                                                                                    /\ state' = state3
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            \/ /\ LET yielded_fd432 == TRUE IN
                                                                                                                                                                                                                    /\ yielded_fd432
                                                                                                                                                                                                                    /\ plog' = plog31
                                                                                                                                                                                                                    /\ leader' = leader3
                                                                                                                                                                                                                    /\ state' = state3
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         /\ UNCHANGED network
                                                                                                                                                             ELSE /\ LET log35 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                       LET value511 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                         IF ((value511).cmd) = (LogConcat)
                                                                                                                                                                            THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value511).entries)]
                                                                                                                                                                                 /\ log' = [log35 EXCEPT ![i] = ((log35)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 2643, column 41.")
                                                                                                                                                                                 /\ LET result57 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result57)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result57)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value633 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value633})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ leader' = leader3
                                                                                                                                                                                                 /\ state' = state3
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd333 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd333
                                                                                                                                                                                                       /\ leader' = leader3
                                                                                                                                                                                                       /\ state' = state3
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd433 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd433
                                                                                                                                                                                                       /\ leader' = leader3
                                                                                                                                                                                                       /\ state' = state3
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                            ELSE /\ IF ((value511).cmd) = (LogPop)
                                                                                                                                                                                       THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value511).cnt))]
                                                                                                                                                                                            /\ log' = [log35 EXCEPT ![i] = ((log35)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 2679, column 43.")
                                                                                                                                                                                            /\ LET result58 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result58)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result58)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value634 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value634})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ leader' = leader3
                                                                                                                                                                                                            /\ state' = state3
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd334 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd334
                                                                                                                                                                                                                  /\ leader' = leader3
                                                                                                                                                                                                                  /\ state' = state3
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd434 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd434
                                                                                                                                                                                                                  /\ leader' = leader3
                                                                                                                                                                                                                  /\ state' = state3
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                                       ELSE /\ log' = [log35 EXCEPT ![i] = ((log35)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 2713, column 43.")
                                                                                                                                                                                            /\ LET result59 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result59)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result59)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value635 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value635})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ leader' = leader3
                                                                                                                                                                                                            /\ state' = state3
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd335 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd335
                                                                                                                                                                                                                  /\ leader' = leader3
                                                                                                                                                                                                                  /\ state' = state3
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd435 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd435
                                                                                                                                                                                                                  /\ leader' = leader3
                                                                                                                                                                                                                  /\ state' = state3
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                                            /\ plog' = plog
                                                                                                                  /\ UNCHANGED leaderTimeout
                                                                                  ELSE /\ LET i == self IN
                                                                                            LET j == (m[self]).msource IN
                                                                                              LET logOK == (((m[self]).mprevLogIndex) = (0)) \/ (((((m[self]).mprevLogIndex) > (0)) /\ (((m[self]).mprevLogIndex) <= (Len((log)[i])))) /\ (((m[self]).mprevLogTerm) = ((((log)[i])[(m[self]).mprevLogIndex]).term))) IN
                                                                                                /\ Assert(((m[self]).mterm) <= ((currentTerm)[i]), 
                                                                                                          "Failure of assertion at line 2762, column 23.")
                                                                                                /\ IF ((m[self]).mterm) = ((currentTerm)[i])
                                                                                                      THEN /\ leader' = [leader EXCEPT ![i] = (m[self]).msource]
                                                                                                           /\ LET value21 == LeaderTimeoutReset IN
                                                                                                                /\ leaderTimeout' = value21
                                                                                                                /\ IF (((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Candidate))
                                                                                                                      THEN /\ state' = [state EXCEPT ![i] = Follower]
                                                                                                                           /\ IF (((m[self]).mterm) < ((currentTerm)[i])) \/ (((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state')[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                                 THEN /\ \/ /\ LET value34 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value34})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                         \/ /\ \/ /\ LET yielded_fd113 == FALSE IN
                                                                                                                                                       /\ yielded_fd113
                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                               \/ /\ LET yielded_fd24 == TRUE IN
                                                                                                                                                       /\ yielded_fd24
                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                            /\ UNCHANGED network
                                                                                                                                      /\ UNCHANGED << commitIndex, 
                                                                                                                                                      log, 
                                                                                                                                                      plog, 
                                                                                                                                                      sm, 
                                                                                                                                                      smDomain >>
                                                                                                                                 ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state')[i]) = (Follower))) /\ (logOK), 
                                                                                                                                                "Failure of assertion at line 2791, column 31.")
                                                                                                                                      /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                           LET value44 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                             IF ((value44).cmd) = (LogConcat)
                                                                                                                                                THEN /\ LET plog32 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value44).entries)] IN
                                                                                                                                                          LET log36 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                            LET value512 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                              IF ((value512).cmd) = (LogConcat)
                                                                                                                                                                 THEN /\ plog' = [plog32 EXCEPT ![i] = ((plog32)[i]) \o ((value512).entries)]
                                                                                                                                                                      /\ log' = [log36 EXCEPT ![i] = ((log36)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                "Failure of assertion at line 2805, column 39.")
                                                                                                                                                                      /\ LET result60 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result60)[1]]
                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result60)[2]]
                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                           /\ \/ /\ LET value636 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value636})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd336 == FALSE IN
                                                                                                                                                                                            /\ yielded_fd336
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ LET yielded_fd436 == TRUE IN
                                                                                                                                                                                            /\ yielded_fd436
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                                 ELSE /\ IF ((value512).cmd) = (LogPop)
                                                                                                                                                                            THEN /\ plog' = [plog32 EXCEPT ![i] = SubSeq((plog32)[i], 1, (Len((plog32)[i])) - ((value512).cnt))]
                                                                                                                                                                                 /\ log' = [log36 EXCEPT ![i] = ((log36)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 2835, column 41.")
                                                                                                                                                                                 /\ LET result61 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result61)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result61)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value637 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value637})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd337 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd337
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd437 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd437
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                            ELSE /\ log' = [log36 EXCEPT ![i] = ((log36)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 2863, column 41.")
                                                                                                                                                                                 /\ LET result62 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result62)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result62)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value638 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value638})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ plog' = plog32
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd338 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd338
                                                                                                                                                                                                       /\ plog' = plog32
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd438 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd438
                                                                                                                                                                                                       /\ plog' = plog32
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                ELSE /\ IF ((value44).cmd) = (LogPop)
                                                                                                                                                           THEN /\ LET plog33 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value44).cnt))] IN
                                                                                                                                                                     LET log37 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                       LET value513 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                         IF ((value513).cmd) = (LogConcat)
                                                                                                                                                                            THEN /\ plog' = [plog33 EXCEPT ![i] = ((plog33)[i]) \o ((value513).entries)]
                                                                                                                                                                                 /\ log' = [log37 EXCEPT ![i] = ((log37)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 2905, column 41.")
                                                                                                                                                                                 /\ LET result63 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result63)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result63)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value639 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value639})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd339 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd339
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd439 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd439
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                            ELSE /\ IF ((value513).cmd) = (LogPop)
                                                                                                                                                                                       THEN /\ plog' = [plog33 EXCEPT ![i] = SubSeq((plog33)[i], 1, (Len((plog33)[i])) - ((value513).cnt))]
                                                                                                                                                                                            /\ log' = [log37 EXCEPT ![i] = ((log37)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 2935, column 43.")
                                                                                                                                                                                            /\ LET result64 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result64)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result64)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value640 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value640})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd340 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd340
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd440 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd440
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                                       ELSE /\ log' = [log37 EXCEPT ![i] = ((log37)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 2963, column 43.")
                                                                                                                                                                                            /\ LET result65 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result65)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result65)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value641 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value641})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ plog' = plog33
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd341 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd341
                                                                                                                                                                                                                  /\ plog' = plog33
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd441 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd441
                                                                                                                                                                                                                  /\ plog' = plog33
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                           ELSE /\ LET log38 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                     LET value514 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                       IF ((value514).cmd) = (LogConcat)
                                                                                                                                                                          THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value514).entries)]
                                                                                                                                                                               /\ log' = [log38 EXCEPT ![i] = ((log38)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                         "Failure of assertion at line 3003, column 41.")
                                                                                                                                                                               /\ LET result66 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result66)[1]]
                                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result66)[2]]
                                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                    /\ \/ /\ LET value642 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value642})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd342 == FALSE IN
                                                                                                                                                                                                     /\ yielded_fd342
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ LET yielded_fd442 == TRUE IN
                                                                                                                                                                                                     /\ yielded_fd442
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                                                          ELSE /\ IF ((value514).cmd) = (LogPop)
                                                                                                                                                                                     THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value514).cnt))]
                                                                                                                                                                                          /\ log' = [log38 EXCEPT ![i] = ((log38)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                    "Failure of assertion at line 3033, column 43.")
                                                                                                                                                                                          /\ LET result67 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result67)[1]]
                                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result67)[2]]
                                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                               /\ \/ /\ LET value643 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value643})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd343 == FALSE IN
                                                                                                                                                                                                                /\ yielded_fd343
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                        \/ /\ LET yielded_fd443 == TRUE IN
                                                                                                                                                                                                                /\ yielded_fd443
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                                                                     ELSE /\ log' = [log38 EXCEPT ![i] = ((log38)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                    "Failure of assertion at line 3061, column 43.")
                                                                                                                                                                                          /\ LET result68 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result68)[1]]
                                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result68)[2]]
                                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                               /\ \/ /\ LET value644 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value644})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd344 == FALSE IN
                                                                                                                                                                                                                /\ yielded_fd344
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                        \/ /\ LET yielded_fd444 == TRUE IN
                                                                                                                                                                                                                /\ yielded_fd444
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                                                                          /\ plog' = plog
                                                                                                                      ELSE /\ IF (((m[self]).mterm) < ((currentTerm)[i])) \/ (((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                                 THEN /\ \/ /\ LET value35 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value35})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                         \/ /\ \/ /\ LET yielded_fd114 == FALSE IN
                                                                                                                                                       /\ yielded_fd114
                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                               \/ /\ LET yielded_fd25 == TRUE IN
                                                                                                                                                       /\ yielded_fd25
                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                            /\ UNCHANGED network
                                                                                                                                      /\ UNCHANGED << commitIndex, 
                                                                                                                                                      log, 
                                                                                                                                                      plog, 
                                                                                                                                                      sm, 
                                                                                                                                                      smDomain >>
                                                                                                                                 ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK), 
                                                                                                                                                "Failure of assertion at line 3117, column 31.")
                                                                                                                                      /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                           LET value45 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                             IF ((value45).cmd) = (LogConcat)
                                                                                                                                                THEN /\ LET plog34 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value45).entries)] IN
                                                                                                                                                          LET log39 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                            LET value515 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                              IF ((value515).cmd) = (LogConcat)
                                                                                                                                                                 THEN /\ plog' = [plog34 EXCEPT ![i] = ((plog34)[i]) \o ((value515).entries)]
                                                                                                                                                                      /\ log' = [log39 EXCEPT ![i] = ((log39)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                "Failure of assertion at line 3131, column 39.")
                                                                                                                                                                      /\ LET result69 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result69)[1]]
                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result69)[2]]
                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                           /\ \/ /\ LET value645 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value645})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd345 == FALSE IN
                                                                                                                                                                                            /\ yielded_fd345
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ LET yielded_fd445 == TRUE IN
                                                                                                                                                                                            /\ yielded_fd445
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                                 ELSE /\ IF ((value515).cmd) = (LogPop)
                                                                                                                                                                            THEN /\ plog' = [plog34 EXCEPT ![i] = SubSeq((plog34)[i], 1, (Len((plog34)[i])) - ((value515).cnt))]
                                                                                                                                                                                 /\ log' = [log39 EXCEPT ![i] = ((log39)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 3161, column 41.")
                                                                                                                                                                                 /\ LET result70 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result70)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result70)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value646 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value646})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd346 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd346
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd446 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd446
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                            ELSE /\ log' = [log39 EXCEPT ![i] = ((log39)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 3189, column 41.")
                                                                                                                                                                                 /\ LET result71 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result71)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result71)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value647 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value647})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ plog' = plog34
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd347 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd347
                                                                                                                                                                                                       /\ plog' = plog34
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd447 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd447
                                                                                                                                                                                                       /\ plog' = plog34
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                ELSE /\ IF ((value45).cmd) = (LogPop)
                                                                                                                                                           THEN /\ LET plog35 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value45).cnt))] IN
                                                                                                                                                                     LET log40 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                       LET value516 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                         IF ((value516).cmd) = (LogConcat)
                                                                                                                                                                            THEN /\ plog' = [plog35 EXCEPT ![i] = ((plog35)[i]) \o ((value516).entries)]
                                                                                                                                                                                 /\ log' = [log40 EXCEPT ![i] = ((log40)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 3231, column 41.")
                                                                                                                                                                                 /\ LET result72 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result72)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result72)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value648 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value648})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd348 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd348
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd448 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd448
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                            ELSE /\ IF ((value516).cmd) = (LogPop)
                                                                                                                                                                                       THEN /\ plog' = [plog35 EXCEPT ![i] = SubSeq((plog35)[i], 1, (Len((plog35)[i])) - ((value516).cnt))]
                                                                                                                                                                                            /\ log' = [log40 EXCEPT ![i] = ((log40)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 3261, column 43.")
                                                                                                                                                                                            /\ LET result73 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result73)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result73)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value649 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value649})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd349 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd349
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd449 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd449
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                                       ELSE /\ log' = [log40 EXCEPT ![i] = ((log40)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 3289, column 43.")
                                                                                                                                                                                            /\ LET result74 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result74)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result74)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value650 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value650})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ plog' = plog35
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd350 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd350
                                                                                                                                                                                                                  /\ plog' = plog35
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd450 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd450
                                                                                                                                                                                                                  /\ plog' = plog35
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                           ELSE /\ LET log41 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                     LET value517 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                       IF ((value517).cmd) = (LogConcat)
                                                                                                                                                                          THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value517).entries)]
                                                                                                                                                                               /\ log' = [log41 EXCEPT ![i] = ((log41)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                         "Failure of assertion at line 3329, column 41.")
                                                                                                                                                                               /\ LET result75 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result75)[1]]
                                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result75)[2]]
                                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                    /\ \/ /\ LET value651 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value651})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd351 == FALSE IN
                                                                                                                                                                                                     /\ yielded_fd351
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ LET yielded_fd451 == TRUE IN
                                                                                                                                                                                                     /\ yielded_fd451
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                                                          ELSE /\ IF ((value517).cmd) = (LogPop)
                                                                                                                                                                                     THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value517).cnt))]
                                                                                                                                                                                          /\ log' = [log41 EXCEPT ![i] = ((log41)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                    "Failure of assertion at line 3359, column 43.")
                                                                                                                                                                                          /\ LET result76 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result76)[1]]
                                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result76)[2]]
                                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                               /\ \/ /\ LET value652 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value652})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd352 == FALSE IN
                                                                                                                                                                                                                /\ yielded_fd352
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                        \/ /\ LET yielded_fd452 == TRUE IN
                                                                                                                                                                                                                /\ yielded_fd452
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                                                                     ELSE /\ log' = [log41 EXCEPT ![i] = ((log41)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                    "Failure of assertion at line 3387, column 43.")
                                                                                                                                                                                          /\ LET result77 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result77)[1]]
                                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result77)[2]]
                                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                               /\ \/ /\ LET value653 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value653})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd353 == FALSE IN
                                                                                                                                                                                                                /\ yielded_fd353
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                        \/ /\ LET yielded_fd453 == TRUE IN
                                                                                                                                                                                                                /\ yielded_fd453
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                                                                          /\ plog' = plog
                                                                                                                           /\ state' = state
                                                                                                      ELSE /\ IF (((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Candidate))
                                                                                                                 THEN /\ state' = [state EXCEPT ![i] = Follower]
                                                                                                                      /\ IF (((m[self]).mterm) < ((currentTerm)[i])) \/ (((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state')[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                            THEN /\ \/ /\ LET value36 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value36})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                    \/ /\ \/ /\ LET yielded_fd115 == FALSE IN
                                                                                                                                                  /\ yielded_fd115
                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                          \/ /\ LET yielded_fd26 == TRUE IN
                                                                                                                                                  /\ yielded_fd26
                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                       /\ UNCHANGED network
                                                                                                                                 /\ UNCHANGED << commitIndex, 
                                                                                                                                                 log, 
                                                                                                                                                 plog, 
                                                                                                                                                 sm, 
                                                                                                                                                 smDomain >>
                                                                                                                            ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state')[i]) = (Follower))) /\ (logOK), 
                                                                                                                                           "Failure of assertion at line 3447, column 29.")
                                                                                                                                 /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                      LET value46 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                        IF ((value46).cmd) = (LogConcat)
                                                                                                                                           THEN /\ LET plog36 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value46).entries)] IN
                                                                                                                                                     LET log42 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                       LET value518 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                         IF ((value518).cmd) = (LogConcat)
                                                                                                                                                            THEN /\ plog' = [plog36 EXCEPT ![i] = ((plog36)[i]) \o ((value518).entries)]
                                                                                                                                                                 /\ log' = [log42 EXCEPT ![i] = ((log42)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                           "Failure of assertion at line 3461, column 37.")
                                                                                                                                                                 /\ LET result78 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result78)[1]]
                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result78)[2]]
                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                      /\ \/ /\ LET value654 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value654})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd354 == FALSE IN
                                                                                                                                                                                       /\ yielded_fd354
                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                               \/ /\ LET yielded_fd454 == TRUE IN
                                                                                                                                                                                       /\ yielded_fd454
                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                            ELSE /\ IF ((value518).cmd) = (LogPop)
                                                                                                                                                                       THEN /\ plog' = [plog36 EXCEPT ![i] = SubSeq((plog36)[i], 1, (Len((plog36)[i])) - ((value518).cnt))]
                                                                                                                                                                            /\ log' = [log42 EXCEPT ![i] = ((log42)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                      "Failure of assertion at line 3491, column 39.")
                                                                                                                                                                            /\ LET result79 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result79)[1]]
                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result79)[2]]
                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                 /\ \/ /\ LET value655 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value655})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd355 == FALSE IN
                                                                                                                                                                                                  /\ yielded_fd355
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          \/ /\ LET yielded_fd455 == TRUE IN
                                                                                                                                                                                                  /\ yielded_fd455
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                       ELSE /\ log' = [log42 EXCEPT ![i] = ((log42)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                      "Failure of assertion at line 3519, column 39.")
                                                                                                                                                                            /\ LET result80 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result80)[1]]
                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result80)[2]]
                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                 /\ \/ /\ LET value656 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value656})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                            /\ plog' = plog36
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd356 == FALSE IN
                                                                                                                                                                                                  /\ yielded_fd356
                                                                                                                                                                                                  /\ plog' = plog36
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          \/ /\ LET yielded_fd456 == TRUE IN
                                                                                                                                                                                                  /\ yielded_fd456
                                                                                                                                                                                                  /\ plog' = plog36
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                           ELSE /\ IF ((value46).cmd) = (LogPop)
                                                                                                                                                      THEN /\ LET plog37 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value46).cnt))] IN
                                                                                                                                                                LET log43 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                  LET value519 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                    IF ((value519).cmd) = (LogConcat)
                                                                                                                                                                       THEN /\ plog' = [plog37 EXCEPT ![i] = ((plog37)[i]) \o ((value519).entries)]
                                                                                                                                                                            /\ log' = [log43 EXCEPT ![i] = ((log43)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                      "Failure of assertion at line 3561, column 39.")
                                                                                                                                                                            /\ LET result81 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result81)[1]]
                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result81)[2]]
                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                 /\ \/ /\ LET value657 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value657})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd357 == FALSE IN
                                                                                                                                                                                                  /\ yielded_fd357
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          \/ /\ LET yielded_fd457 == TRUE IN
                                                                                                                                                                                                  /\ yielded_fd457
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                       ELSE /\ IF ((value519).cmd) = (LogPop)
                                                                                                                                                                                  THEN /\ plog' = [plog37 EXCEPT ![i] = SubSeq((plog37)[i], 1, (Len((plog37)[i])) - ((value519).cnt))]
                                                                                                                                                                                       /\ log' = [log43 EXCEPT ![i] = ((log43)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                       /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                 "Failure of assertion at line 3591, column 41.")
                                                                                                                                                                                       /\ LET result82 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                            /\ sm' = [sm EXCEPT ![i] = (result82)[1]]
                                                                                                                                                                                            /\ smDomain' = [smDomain EXCEPT ![i] = (result82)[2]]
                                                                                                                                                                                            /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                            /\ \/ /\ LET value658 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                       /\ ((network)[j]).enabled
                                                                                                                                                                                                       /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                       /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value658})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ \/ /\ LET yielded_fd358 == FALSE IN
                                                                                                                                                                                                             /\ yielded_fd358
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     \/ /\ LET yielded_fd458 == TRUE IN
                                                                                                                                                                                                             /\ yielded_fd458
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  /\ UNCHANGED network
                                                                                                                                                                                  ELSE /\ log' = [log43 EXCEPT ![i] = ((log43)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                       /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                 "Failure of assertion at line 3619, column 41.")
                                                                                                                                                                                       /\ LET result83 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                            /\ sm' = [sm EXCEPT ![i] = (result83)[1]]
                                                                                                                                                                                            /\ smDomain' = [smDomain EXCEPT ![i] = (result83)[2]]
                                                                                                                                                                                            /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                            /\ \/ /\ LET value659 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                       /\ ((network)[j]).enabled
                                                                                                                                                                                                       /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                       /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value659})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                       /\ plog' = plog37
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ \/ /\ LET yielded_fd359 == FALSE IN
                                                                                                                                                                                                             /\ yielded_fd359
                                                                                                                                                                                                             /\ plog' = plog37
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     \/ /\ LET yielded_fd459 == TRUE IN
                                                                                                                                                                                                             /\ yielded_fd459
                                                                                                                                                                                                             /\ plog' = plog37
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  /\ UNCHANGED network
                                                                                                                                                      ELSE /\ LET log44 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                LET value520 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                  IF ((value520).cmd) = (LogConcat)
                                                                                                                                                                     THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value520).entries)]
                                                                                                                                                                          /\ log' = [log44 EXCEPT ![i] = ((log44)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                    "Failure of assertion at line 3659, column 39.")
                                                                                                                                                                          /\ LET result84 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result84)[1]]
                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result84)[2]]
                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                               /\ \/ /\ LET value660 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value660})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd360 == FALSE IN
                                                                                                                                                                                                /\ yielded_fd360
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        \/ /\ LET yielded_fd460 == TRUE IN
                                                                                                                                                                                                /\ yielded_fd460
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                                                     ELSE /\ IF ((value520).cmd) = (LogPop)
                                                                                                                                                                                THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value520).cnt))]
                                                                                                                                                                                     /\ log' = [log44 EXCEPT ![i] = ((log44)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                     /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                               "Failure of assertion at line 3689, column 41.")
                                                                                                                                                                                     /\ LET result85 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                          /\ sm' = [sm EXCEPT ![i] = (result85)[1]]
                                                                                                                                                                                          /\ smDomain' = [smDomain EXCEPT ![i] = (result85)[2]]
                                                                                                                                                                                          /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                          /\ \/ /\ LET value661 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                     /\ ((network)[j]).enabled
                                                                                                                                                                                                     /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                     /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value661})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ \/ /\ LET yielded_fd361 == FALSE IN
                                                                                                                                                                                                           /\ yielded_fd361
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   \/ /\ LET yielded_fd461 == TRUE IN
                                                                                                                                                                                                           /\ yielded_fd461
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                /\ UNCHANGED network
                                                                                                                                                                                ELSE /\ log' = [log44 EXCEPT ![i] = ((log44)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                     /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                               "Failure of assertion at line 3717, column 41.")
                                                                                                                                                                                     /\ LET result86 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                          /\ sm' = [sm EXCEPT ![i] = (result86)[1]]
                                                                                                                                                                                          /\ smDomain' = [smDomain EXCEPT ![i] = (result86)[2]]
                                                                                                                                                                                          /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                          /\ \/ /\ LET value662 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                     /\ ((network)[j]).enabled
                                                                                                                                                                                                     /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                     /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value662})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ \/ /\ LET yielded_fd362 == FALSE IN
                                                                                                                                                                                                           /\ yielded_fd362
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   \/ /\ LET yielded_fd462 == TRUE IN
                                                                                                                                                                                                           /\ yielded_fd462
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                /\ UNCHANGED network
                                                                                                                                                                                     /\ plog' = plog
                                                                                                                 ELSE /\ IF (((m[self]).mterm) < ((currentTerm)[i])) \/ (((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                            THEN /\ \/ /\ LET value37 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value37})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                    \/ /\ \/ /\ LET yielded_fd116 == FALSE IN
                                                                                                                                                  /\ yielded_fd116
                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                          \/ /\ LET yielded_fd27 == TRUE IN
                                                                                                                                                  /\ yielded_fd27
                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                       /\ UNCHANGED network
                                                                                                                                 /\ UNCHANGED << commitIndex, 
                                                                                                                                                 log, 
                                                                                                                                                 plog, 
                                                                                                                                                 sm, 
                                                                                                                                                 smDomain >>
                                                                                                                            ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK), 
                                                                                                                                           "Failure of assertion at line 3773, column 29.")
                                                                                                                                 /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                      LET value47 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                        IF ((value47).cmd) = (LogConcat)
                                                                                                                                           THEN /\ LET plog38 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value47).entries)] IN
                                                                                                                                                     LET log45 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                       LET value521 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                         IF ((value521).cmd) = (LogConcat)
                                                                                                                                                            THEN /\ plog' = [plog38 EXCEPT ![i] = ((plog38)[i]) \o ((value521).entries)]
                                                                                                                                                                 /\ log' = [log45 EXCEPT ![i] = ((log45)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                           "Failure of assertion at line 3787, column 37.")
                                                                                                                                                                 /\ LET result87 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result87)[1]]
                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result87)[2]]
                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                      /\ \/ /\ LET value663 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value663})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd363 == FALSE IN
                                                                                                                                                                                       /\ yielded_fd363
                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                               \/ /\ LET yielded_fd463 == TRUE IN
                                                                                                                                                                                       /\ yielded_fd463
                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                            ELSE /\ IF ((value521).cmd) = (LogPop)
                                                                                                                                                                       THEN /\ plog' = [plog38 EXCEPT ![i] = SubSeq((plog38)[i], 1, (Len((plog38)[i])) - ((value521).cnt))]
                                                                                                                                                                            /\ log' = [log45 EXCEPT ![i] = ((log45)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                      "Failure of assertion at line 3817, column 39.")
                                                                                                                                                                            /\ LET result88 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result88)[1]]
                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result88)[2]]
                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                 /\ \/ /\ LET value664 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value664})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd364 == FALSE IN
                                                                                                                                                                                                  /\ yielded_fd364
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          \/ /\ LET yielded_fd464 == TRUE IN
                                                                                                                                                                                                  /\ yielded_fd464
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                       ELSE /\ log' = [log45 EXCEPT ![i] = ((log45)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                      "Failure of assertion at line 3845, column 39.")
                                                                                                                                                                            /\ LET result89 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result89)[1]]
                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result89)[2]]
                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                 /\ \/ /\ LET value665 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value665})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                            /\ plog' = plog38
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd365 == FALSE IN
                                                                                                                                                                                                  /\ yielded_fd365
                                                                                                                                                                                                  /\ plog' = plog38
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          \/ /\ LET yielded_fd465 == TRUE IN
                                                                                                                                                                                                  /\ yielded_fd465
                                                                                                                                                                                                  /\ plog' = plog38
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                           ELSE /\ IF ((value47).cmd) = (LogPop)
                                                                                                                                                      THEN /\ LET plog39 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value47).cnt))] IN
                                                                                                                                                                LET log46 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                  LET value522 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                    IF ((value522).cmd) = (LogConcat)
                                                                                                                                                                       THEN /\ plog' = [plog39 EXCEPT ![i] = ((plog39)[i]) \o ((value522).entries)]
                                                                                                                                                                            /\ log' = [log46 EXCEPT ![i] = ((log46)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                      "Failure of assertion at line 3887, column 39.")
                                                                                                                                                                            /\ LET result90 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result90)[1]]
                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result90)[2]]
                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                 /\ \/ /\ LET value666 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value666})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd366 == FALSE IN
                                                                                                                                                                                                  /\ yielded_fd366
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          \/ /\ LET yielded_fd466 == TRUE IN
                                                                                                                                                                                                  /\ yielded_fd466
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                       ELSE /\ IF ((value522).cmd) = (LogPop)
                                                                                                                                                                                  THEN /\ plog' = [plog39 EXCEPT ![i] = SubSeq((plog39)[i], 1, (Len((plog39)[i])) - ((value522).cnt))]
                                                                                                                                                                                       /\ log' = [log46 EXCEPT ![i] = ((log46)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                       /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                 "Failure of assertion at line 3917, column 41.")
                                                                                                                                                                                       /\ LET result91 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                            /\ sm' = [sm EXCEPT ![i] = (result91)[1]]
                                                                                                                                                                                            /\ smDomain' = [smDomain EXCEPT ![i] = (result91)[2]]
                                                                                                                                                                                            /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                            /\ \/ /\ LET value667 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                       /\ ((network)[j]).enabled
                                                                                                                                                                                                       /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                       /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value667})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ \/ /\ LET yielded_fd367 == FALSE IN
                                                                                                                                                                                                             /\ yielded_fd367
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     \/ /\ LET yielded_fd467 == TRUE IN
                                                                                                                                                                                                             /\ yielded_fd467
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  /\ UNCHANGED network
                                                                                                                                                                                  ELSE /\ log' = [log46 EXCEPT ![i] = ((log46)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                       /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                 "Failure of assertion at line 3945, column 41.")
                                                                                                                                                                                       /\ LET result92 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                            /\ sm' = [sm EXCEPT ![i] = (result92)[1]]
                                                                                                                                                                                            /\ smDomain' = [smDomain EXCEPT ![i] = (result92)[2]]
                                                                                                                                                                                            /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                            /\ \/ /\ LET value668 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                       /\ ((network)[j]).enabled
                                                                                                                                                                                                       /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                       /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value668})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                       /\ plog' = plog39
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ \/ /\ LET yielded_fd368 == FALSE IN
                                                                                                                                                                                                             /\ yielded_fd368
                                                                                                                                                                                                             /\ plog' = plog39
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     \/ /\ LET yielded_fd468 == TRUE IN
                                                                                                                                                                                                             /\ yielded_fd468
                                                                                                                                                                                                             /\ plog' = plog39
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  /\ UNCHANGED network
                                                                                                                                                      ELSE /\ LET log47 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                LET value523 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                  IF ((value523).cmd) = (LogConcat)
                                                                                                                                                                     THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value523).entries)]
                                                                                                                                                                          /\ log' = [log47 EXCEPT ![i] = ((log47)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                    "Failure of assertion at line 3985, column 39.")
                                                                                                                                                                          /\ LET result93 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result93)[1]]
                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result93)[2]]
                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                               /\ \/ /\ LET value669 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value669})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd369 == FALSE IN
                                                                                                                                                                                                /\ yielded_fd369
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        \/ /\ LET yielded_fd469 == TRUE IN
                                                                                                                                                                                                /\ yielded_fd469
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                                                     ELSE /\ IF ((value523).cmd) = (LogPop)
                                                                                                                                                                                THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value523).cnt))]
                                                                                                                                                                                     /\ log' = [log47 EXCEPT ![i] = ((log47)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                     /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                               "Failure of assertion at line 4015, column 41.")
                                                                                                                                                                                     /\ LET result94 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                          /\ sm' = [sm EXCEPT ![i] = (result94)[1]]
                                                                                                                                                                                          /\ smDomain' = [smDomain EXCEPT ![i] = (result94)[2]]
                                                                                                                                                                                          /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                          /\ \/ /\ LET value670 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                     /\ ((network)[j]).enabled
                                                                                                                                                                                                     /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                     /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value670})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ \/ /\ LET yielded_fd370 == FALSE IN
                                                                                                                                                                                                           /\ yielded_fd370
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   \/ /\ LET yielded_fd470 == TRUE IN
                                                                                                                                                                                                           /\ yielded_fd470
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                /\ UNCHANGED network
                                                                                                                                                                                ELSE /\ log' = [log47 EXCEPT ![i] = ((log47)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                     /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                               "Failure of assertion at line 4043, column 41.")
                                                                                                                                                                                     /\ LET result95 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                          /\ sm' = [sm EXCEPT ![i] = (result95)[1]]
                                                                                                                                                                                          /\ smDomain' = [smDomain EXCEPT ![i] = (result95)[2]]
                                                                                                                                                                                          /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                          /\ \/ /\ LET value671 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                     /\ ((network)[j]).enabled
                                                                                                                                                                                                     /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                     /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value671})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ \/ /\ LET yielded_fd371 == FALSE IN
                                                                                                                                                                                                           /\ yielded_fd371
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   \/ /\ LET yielded_fd471 == TRUE IN
                                                                                                                                                                                                           /\ yielded_fd471
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                /\ UNCHANGED network
                                                                                                                                                                                     /\ plog' = plog
                                                                                                                      /\ state' = state
                                                                                                           /\ UNCHANGED << leader, 
                                                                                                                           leaderTimeout >>
                                                                                       /\ UNCHANGED << currentTerm, 
                                                                                                       votedFor >>
                                                                            /\ UNCHANGED << nextIndex, 
                                                                                            matchIndex, 
                                                                                            appendEntriesCh >>
                                                                       ELSE /\ IF ((m[self]).mtype) = (AppendEntriesResponse)
                                                                                  THEN /\ IF ((m[self]).mterm) > ((currentTerm)[self])
                                                                                             THEN /\ currentTerm' = [currentTerm EXCEPT ![self] = (m[self]).mterm]
                                                                                                  /\ state' = [state EXCEPT ![self] = Follower]
                                                                                                  /\ votedFor' = [votedFor EXCEPT ![self] = Nil]
                                                                                                  /\ leader' = [leader EXCEPT ![self] = Nil]
                                                                                                  /\ IF ((m[self]).mterm) < ((currentTerm')[self])
                                                                                                        THEN /\ TRUE
                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                             /\ UNCHANGED << nextIndex, 
                                                                                                                             matchIndex >>
                                                                                                        ELSE /\ LET i == self IN
                                                                                                                  LET j == (m[self]).msource IN
                                                                                                                    /\ Assert(((m[self]).mterm) = ((currentTerm')[i]), 
                                                                                                                              "Failure of assertion at line 4095, column 27.")
                                                                                                                    /\ IF (m[self]).msuccess
                                                                                                                          THEN /\ nextIndex' = [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = ((m[self]).mmatchIndex) + (1)]]
                                                                                                                               /\ matchIndex' = [matchIndex EXCEPT ![i] = [(matchIndex)[i] EXCEPT ![j] = (m[self]).mmatchIndex]]
                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                          ELSE /\ nextIndex' = [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = Max({(((nextIndex)[i])[j]) - (1), 1})]]
                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                               /\ UNCHANGED matchIndex
                                                                                             ELSE /\ IF ((m[self]).mterm) < ((currentTerm)[self])
                                                                                                        THEN /\ TRUE
                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                             /\ UNCHANGED << nextIndex, 
                                                                                                                             matchIndex >>
                                                                                                        ELSE /\ LET i == self IN
                                                                                                                  LET j == (m[self]).msource IN
                                                                                                                    /\ Assert(((m[self]).mterm) = ((currentTerm)[i]), 
                                                                                                                              "Failure of assertion at line 4115, column 27.")
                                                                                                                    /\ IF (m[self]).msuccess
                                                                                                                          THEN /\ nextIndex' = [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = ((m[self]).mmatchIndex) + (1)]]
                                                                                                                               /\ matchIndex' = [matchIndex EXCEPT ![i] = [(matchIndex)[i] EXCEPT ![j] = (m[self]).mmatchIndex]]
                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                          ELSE /\ nextIndex' = [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = Max({(((nextIndex)[i])[j]) - (1), 1})]]
                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                               /\ UNCHANGED matchIndex
                                                                                                  /\ UNCHANGED << state, 
                                                                                                                  currentTerm, 
                                                                                                                  votedFor, 
                                                                                                                  leader >>
                                                                                       /\ UNCHANGED << network, 
                                                                                                       log, 
                                                                                                       plog, 
                                                                                                       appendEntriesCh >>
                                                                                  ELSE /\ IF (((m[self]).mtype) = (ClientPutRequest)) \/ (((m[self]).mtype) = (ClientGetRequest))
                                                                                             THEN /\ IF ((state)[self]) = (Leader)
                                                                                                        THEN /\ LET entry == [term |-> (currentTerm)[self], cmd |-> (m[self]).mcmd, client |-> (m[self]).msource] IN
                                                                                                                  /\ log' = [log EXCEPT ![self] = Append((log)[self], entry)]
                                                                                                                  /\ LET value70 == [cmd |-> LogConcat, entries |-> <<entry>>] IN
                                                                                                                       IF ((value70).cmd) = (LogConcat)
                                                                                                                          THEN /\ plog' = [plog EXCEPT ![self] = ((plog)[self]) \o ((value70).entries)]
                                                                                                                               /\ LET value80 == TRUE IN
                                                                                                                                    /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value80)]
                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                          ELSE /\ IF ((value70).cmd) = (LogPop)
                                                                                                                                     THEN /\ plog' = [plog EXCEPT ![self] = SubSeq((plog)[self], 1, (Len((plog)[self])) - ((value70).cnt))]
                                                                                                                                          /\ LET value81 == TRUE IN
                                                                                                                                               /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value81)]
                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                     ELSE /\ LET value82 == TRUE IN
                                                                                                                                               /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value82)]
                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                          /\ plog' = plog
                                                                                                             /\ UNCHANGED network
                                                                                                        ELSE /\ LET i == self IN
                                                                                                                  LET j == (m[self]).msource IN
                                                                                                                    LET respType == IF (((m[self]).mcmd).type) = (Put) THEN ClientPutResponse ELSE ClientGetResponse IN
                                                                                                                      LET value90 == [mtype |-> respType, msuccess |-> FALSE, mresponse |-> [idx |-> ((m[self]).mcmd).idx, key |-> ((m[self]).mcmd).key], mleaderHint |-> (leader)[i], msource |-> i, mdest |-> j] IN
                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value90})), enabled |-> ((network)[j]).enabled]]
                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                             /\ UNCHANGED << log, 
                                                                                                                             plog, 
                                                                                                                             appendEntriesCh >>
                                                                                             ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                  /\ UNCHANGED << network, 
                                                                                                                  log, 
                                                                                                                  plog, 
                                                                                                                  appendEntriesCh >>
                                                                                       /\ UNCHANGED << state, 
                                                                                                       currentTerm, 
                                                                                                       nextIndex, 
                                                                                                       matchIndex, 
                                                                                                       votedFor, 
                                                                                                       leader >>
                                                                            /\ UNCHANGED << commitIndex, 
                                                                                            sm, 
                                                                                            smDomain, 
                                                                                            leaderTimeout >>
                                                                 /\ UNCHANGED << votesResponded, 
                                                                                 votesGranted, 
                                                                                 becomeLeaderCh >>
                                      ELSE /\ IF ((m[self]).mtype) = (RequestVoteRequest)
                                                 THEN /\ IF ((m[self]).mterm) > ((currentTerm)[self])
                                                            THEN /\ currentTerm' = [currentTerm EXCEPT ![self] = (m[self]).mterm]
                                                                 /\ state' = [state EXCEPT ![self] = Follower]
                                                                 /\ LET votedFor4 == [votedFor EXCEPT ![self] = Nil] IN
                                                                      /\ leader' = [leader EXCEPT ![self] = Nil]
                                                                      /\ LET i == self IN
                                                                           LET j == (m[self]).msource IN
                                                                             LET logOK == (((m[self]).mlastLogTerm) > (LastTerm((log)[i]))) \/ ((((m[self]).mlastLogTerm) = (LastTerm((log)[i]))) /\ (((m[self]).mlastLogIndex) >= (Len((log)[i])))) IN
                                                                               LET grant == ((((m[self]).mterm) = ((currentTerm')[i])) /\ (logOK)) /\ (((votedFor4)[self]) \in ({Nil, j})) IN
                                                                                 /\ Assert(((m[self]).mterm) <= ((currentTerm')[i]), 
                                                                                           "Failure of assertion at line 4188, column 21.")
                                                                                 /\ IF grant
                                                                                       THEN /\ votedFor' = [votedFor4 EXCEPT ![i] = j]
                                                                                            /\ \/ /\ LET value04 == [mtype |-> RequestVoteResponse, mterm |-> (currentTerm')[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j] IN
                                                                                                       /\ ((network)[j]).enabled
                                                                                                       /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                       /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value04})), enabled |-> ((network)[j]).enabled]]
                                                                                                       /\ IF Debug
                                                                                                             THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                             ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                               \/ /\ \/ /\ LET yielded_fd28 == FALSE IN
                                                                                                             /\ yielded_fd28
                                                                                                             /\ IF Debug
                                                                                                                   THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                   ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                     \/ /\ LET yielded_fd04 == TRUE IN
                                                                                                             /\ yielded_fd04
                                                                                                             /\ IF Debug
                                                                                                                   THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                   ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                  /\ UNCHANGED network
                                                                                       ELSE /\ \/ /\ LET value05 == [mtype |-> RequestVoteResponse, mterm |-> (currentTerm')[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j] IN
                                                                                                       /\ ((network)[j]).enabled
                                                                                                       /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                       /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value05})), enabled |-> ((network)[j]).enabled]]
                                                                                                       /\ IF Debug
                                                                                                             THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                                  /\ votedFor' = votedFor4
                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                             ELSE /\ votedFor' = votedFor4
                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                               \/ /\ \/ /\ LET yielded_fd29 == FALSE IN
                                                                                                             /\ yielded_fd29
                                                                                                             /\ IF Debug
                                                                                                                   THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                                        /\ votedFor' = votedFor4
                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                   ELSE /\ votedFor' = votedFor4
                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                     \/ /\ LET yielded_fd05 == TRUE IN
                                                                                                             /\ yielded_fd05
                                                                                                             /\ IF Debug
                                                                                                                   THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                                        /\ votedFor' = votedFor4
                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                   ELSE /\ votedFor' = votedFor4
                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                  /\ UNCHANGED network
                                                            ELSE /\ LET i == self IN
                                                                      LET j == (m[self]).msource IN
                                                                        LET logOK == (((m[self]).mlastLogTerm) > (LastTerm((log)[i]))) \/ ((((m[self]).mlastLogTerm) = (LastTerm((log)[i]))) /\ (((m[self]).mlastLogIndex) >= (Len((log)[i])))) IN
                                                                          LET grant == ((((m[self]).mterm) = ((currentTerm)[i])) /\ (logOK)) /\ (((votedFor)[self]) \in ({Nil, j})) IN
                                                                            /\ Assert(((m[self]).mterm) <= ((currentTerm)[i]), 
                                                                                      "Failure of assertion at line 4278, column 19.")
                                                                            /\ IF grant
                                                                                  THEN /\ votedFor' = [votedFor EXCEPT ![i] = j]
                                                                                       /\ \/ /\ LET value06 == [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j] IN
                                                                                                  /\ ((network)[j]).enabled
                                                                                                  /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                  /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value06})), enabled |-> ((network)[j]).enabled]]
                                                                                                  /\ IF Debug
                                                                                                        THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                        ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                          \/ /\ \/ /\ LET yielded_fd50 == FALSE IN
                                                                                                        /\ yielded_fd50
                                                                                                        /\ IF Debug
                                                                                                              THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                              ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                \/ /\ LET yielded_fd06 == TRUE IN
                                                                                                        /\ yielded_fd06
                                                                                                        /\ IF Debug
                                                                                                              THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                              ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                             /\ UNCHANGED network
                                                                                  ELSE /\ \/ /\ LET value07 == [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j] IN
                                                                                                  /\ ((network)[j]).enabled
                                                                                                  /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                  /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value07})), enabled |-> ((network)[j]).enabled]]
                                                                                                  /\ IF Debug
                                                                                                        THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                        ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                          \/ /\ \/ /\ LET yielded_fd51 == FALSE IN
                                                                                                        /\ yielded_fd51
                                                                                                        /\ IF Debug
                                                                                                              THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                              ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                \/ /\ LET yielded_fd07 == TRUE IN
                                                                                                        /\ yielded_fd07
                                                                                                        /\ IF Debug
                                                                                                              THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                              ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                             /\ UNCHANGED network
                                                                                       /\ UNCHANGED votedFor
                                                                 /\ UNCHANGED << state, 
                                                                                 currentTerm, 
                                                                                 leader >>
                                                      /\ UNCHANGED << commitIndex, 
                                                                      nextIndex, 
                                                                      matchIndex, 
                                                                      log, 
                                                                      plog, 
                                                                      votesResponded, 
                                                                      votesGranted, 
                                                                      sm, 
                                                                      smDomain, 
                                                                      leaderTimeout, 
                                                                      appendEntriesCh, 
                                                                      becomeLeaderCh >>
                                                 ELSE /\ IF ((m[self]).mtype) = (RequestVoteResponse)
                                                            THEN /\ IF ((m[self]).mterm) > ((currentTerm)[self])
                                                                       THEN /\ currentTerm' = [currentTerm EXCEPT ![self] = (m[self]).mterm]
                                                                            /\ state' = [state EXCEPT ![self] = Follower]
                                                                            /\ votedFor' = [votedFor EXCEPT ![self] = Nil]
                                                                            /\ leader' = [leader EXCEPT ![self] = Nil]
                                                                            /\ IF ((m[self]).mterm) < ((currentTerm')[self])
                                                                                  THEN /\ TRUE
                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                       /\ UNCHANGED << votesResponded, 
                                                                                                       votesGranted, 
                                                                                                       becomeLeaderCh >>
                                                                                  ELSE /\ LET i == self IN
                                                                                            LET j == (m[self]).msource IN
                                                                                              /\ Assert(((m[self]).mterm) = ((currentTerm')[i]), 
                                                                                                        "Failure of assertion at line 4370, column 23.")
                                                                                              /\ votesResponded' = [votesResponded EXCEPT ![i] = ((votesResponded)[i]) \union ({j})]
                                                                                              /\ IF (m[self]).mvoteGranted
                                                                                                    THEN /\ votesGranted' = [votesGranted EXCEPT ![i] = ((votesGranted)[i]) \union ({j})]
                                                                                                         /\ IF (((state')[i]) = (Candidate)) /\ (isQuorum((votesGranted')[i]))
                                                                                                               THEN /\ LET value110 == TRUE IN
                                                                                                                         /\ becomeLeaderCh' = [becomeLeaderCh EXCEPT ![i] = Append((becomeLeaderCh)[i], value110)]
                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                               ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                    /\ UNCHANGED becomeLeaderCh
                                                                                                    ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                         /\ UNCHANGED << votesGranted, 
                                                                                                                         becomeLeaderCh >>
                                                                       ELSE /\ IF ((m[self]).mterm) < ((currentTerm)[self])
                                                                                  THEN /\ TRUE
                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                       /\ UNCHANGED << votesResponded, 
                                                                                                       votesGranted, 
                                                                                                       becomeLeaderCh >>
                                                                                  ELSE /\ LET i == self IN
                                                                                            LET j == (m[self]).msource IN
                                                                                              /\ Assert(((m[self]).mterm) = ((currentTerm)[i]), 
                                                                                                        "Failure of assertion at line 4396, column 23.")
                                                                                              /\ votesResponded' = [votesResponded EXCEPT ![i] = ((votesResponded)[i]) \union ({j})]
                                                                                              /\ IF (m[self]).mvoteGranted
                                                                                                    THEN /\ votesGranted' = [votesGranted EXCEPT ![i] = ((votesGranted)[i]) \union ({j})]
                                                                                                         /\ IF (((state)[i]) = (Candidate)) /\ (isQuorum((votesGranted')[i]))
                                                                                                               THEN /\ LET value111 == TRUE IN
                                                                                                                         /\ becomeLeaderCh' = [becomeLeaderCh EXCEPT ![i] = Append((becomeLeaderCh)[i], value111)]
                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                               ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                    /\ UNCHANGED becomeLeaderCh
                                                                                                    ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                         /\ UNCHANGED << votesGranted, 
                                                                                                                         becomeLeaderCh >>
                                                                            /\ UNCHANGED << state, 
                                                                                            currentTerm, 
                                                                                            votedFor, 
                                                                                            leader >>
                                                                 /\ UNCHANGED << network, 
                                                                                 commitIndex, 
                                                                                 nextIndex, 
                                                                                 matchIndex, 
                                                                                 log, 
                                                                                 plog, 
                                                                                 sm, 
                                                                                 smDomain, 
                                                                                 leaderTimeout, 
                                                                                 appendEntriesCh >>
                                                            ELSE /\ IF ((m[self]).mtype) = (AppendEntriesRequest)
                                                                       THEN /\ IF ((m[self]).mterm) > ((currentTerm)[self])
                                                                                  THEN /\ currentTerm' = [currentTerm EXCEPT ![self] = (m[self]).mterm]
                                                                                       /\ LET state4 == [state EXCEPT ![self] = Follower] IN
                                                                                            /\ votedFor' = [votedFor EXCEPT ![self] = Nil]
                                                                                            /\ LET leader4 == [leader EXCEPT ![self] = Nil] IN
                                                                                                 LET i == self IN
                                                                                                   LET j == (m[self]).msource IN
                                                                                                     LET logOK == (((m[self]).mprevLogIndex) = (0)) \/ (((((m[self]).mprevLogIndex) > (0)) /\ (((m[self]).mprevLogIndex) <= (Len((log)[i])))) /\ (((m[self]).mprevLogTerm) = ((((log)[i])[(m[self]).mprevLogIndex]).term))) IN
                                                                                                       /\ Assert(((m[self]).mterm) <= ((currentTerm')[i]), 
                                                                                                                 "Failure of assertion at line 4426, column 25.")
                                                                                                       /\ IF ((m[self]).mterm) = ((currentTerm')[i])
                                                                                                             THEN /\ leader' = [leader4 EXCEPT ![i] = (m[self]).msource]
                                                                                                                  /\ LET value22 == LeaderTimeoutReset IN
                                                                                                                       /\ leaderTimeout' = value22
                                                                                                                       /\ IF (((m[self]).mterm) = ((currentTerm')[i])) /\ (((state4)[i]) = (Candidate))
                                                                                                                             THEN /\ state' = [state4 EXCEPT ![i] = Follower]
                                                                                                                                  /\ IF (((m[self]).mterm) < ((currentTerm')[i])) \/ (((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state')[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                                        THEN /\ \/ /\ LET value38 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value38})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                \/ /\ \/ /\ LET yielded_fd117 == FALSE IN
                                                                                                                                                              /\ yielded_fd117
                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                      \/ /\ LET yielded_fd210 == TRUE IN
                                                                                                                                                              /\ yielded_fd210
                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                             /\ UNCHANGED << commitIndex, 
                                                                                                                                                             log, 
                                                                                                                                                             plog, 
                                                                                                                                                             sm, 
                                                                                                                                                             smDomain >>
                                                                                                                                        ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state')[i]) = (Follower))) /\ (logOK), 
                                                                                                                                                       "Failure of assertion at line 4455, column 33.")
                                                                                                                                             /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                                  LET value48 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                                    IF ((value48).cmd) = (LogConcat)
                                                                                                                                                       THEN /\ LET plog40 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value48).entries)] IN
                                                                                                                                                                 LET log48 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                   LET value524 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                     IF ((value524).cmd) = (LogConcat)
                                                                                                                                                                        THEN /\ plog' = [plog40 EXCEPT ![i] = ((plog40)[i]) \o ((value524).entries)]
                                                                                                                                                                             /\ log' = [log48 EXCEPT ![i] = ((log48)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                             /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                       "Failure of assertion at line 4469, column 41.")
                                                                                                                                                                             /\ LET result96 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                  /\ sm' = [sm EXCEPT ![i] = (result96)[1]]
                                                                                                                                                                                  /\ smDomain' = [smDomain EXCEPT ![i] = (result96)[2]]
                                                                                                                                                                                  /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                  /\ \/ /\ LET value672 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                             /\ ((network)[j]).enabled
                                                                                                                                                                                             /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                             /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value672})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     \/ /\ \/ /\ LET yielded_fd372 == FALSE IN
                                                                                                                                                                                                   /\ yielded_fd372
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ LET yielded_fd472 == TRUE IN
                                                                                                                                                                                                   /\ yielded_fd472
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        /\ UNCHANGED network
                                                                                                                                                                        ELSE /\ IF ((value524).cmd) = (LogPop)
                                                                                                                                                                                   THEN /\ plog' = [plog40 EXCEPT ![i] = SubSeq((plog40)[i], 1, (Len((plog40)[i])) - ((value524).cnt))]
                                                                                                                                                                                        /\ log' = [log48 EXCEPT ![i] = ((log48)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                  "Failure of assertion at line 4499, column 43.")
                                                                                                                                                                                        /\ LET result97 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result97)[1]]
                                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result97)[2]]
                                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                             /\ \/ /\ LET value673 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value673})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd373 == FALSE IN
                                                                                                                                                                                                              /\ yielded_fd373
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ LET yielded_fd473 == TRUE IN
                                                                                                                                                                                                              /\ yielded_fd473
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                                   ELSE /\ log' = [log48 EXCEPT ![i] = ((log48)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                  "Failure of assertion at line 4527, column 43.")
                                                                                                                                                                                        /\ LET result98 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result98)[1]]
                                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result98)[2]]
                                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                             /\ \/ /\ LET value674 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value674})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                        /\ plog' = plog40
                                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd374 == FALSE IN
                                                                                                                                                                                                              /\ yielded_fd374
                                                                                                                                                                                                              /\ plog' = plog40
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ LET yielded_fd474 == TRUE IN
                                                                                                                                                                                                              /\ yielded_fd474
                                                                                                                                                                                                              /\ plog' = plog40
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                       ELSE /\ IF ((value48).cmd) = (LogPop)
                                                                                                                                                                  THEN /\ LET plog41 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value48).cnt))] IN
                                                                                                                                                                            LET log49 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                              LET value525 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                                IF ((value525).cmd) = (LogConcat)
                                                                                                                                                                                   THEN /\ plog' = [plog41 EXCEPT ![i] = ((plog41)[i]) \o ((value525).entries)]
                                                                                                                                                                                        /\ log' = [log49 EXCEPT ![i] = ((log49)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                  "Failure of assertion at line 4569, column 43.")
                                                                                                                                                                                        /\ LET result99 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result99)[1]]
                                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result99)[2]]
                                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                             /\ \/ /\ LET value675 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value675})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd375 == FALSE IN
                                                                                                                                                                                                              /\ yielded_fd375
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ LET yielded_fd475 == TRUE IN
                                                                                                                                                                                                              /\ yielded_fd475
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                                   ELSE /\ IF ((value525).cmd) = (LogPop)
                                                                                                                                                                                              THEN /\ plog' = [plog41 EXCEPT ![i] = SubSeq((plog41)[i], 1, (Len((plog41)[i])) - ((value525).cnt))]
                                                                                                                                                                                                   /\ log' = [log49 EXCEPT ![i] = ((log49)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                             "Failure of assertion at line 4599, column 45.")
                                                                                                                                                                                                   /\ LET result100 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result100)[1]]
                                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result100)[2]]
                                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                        /\ \/ /\ LET value676 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value676})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd376 == FALSE IN
                                                                                                                                                                                                                         /\ yielded_fd376
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                                 \/ /\ LET yielded_fd476 == TRUE IN
                                                                                                                                                                                                                         /\ yielded_fd476
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                                              ELSE /\ log' = [log49 EXCEPT ![i] = ((log49)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                             "Failure of assertion at line 4627, column 45.")
                                                                                                                                                                                                   /\ LET result101 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result101)[1]]
                                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result101)[2]]
                                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                        /\ \/ /\ LET value677 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value677})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                   /\ plog' = plog41
                                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd377 == FALSE IN
                                                                                                                                                                                                                         /\ yielded_fd377
                                                                                                                                                                                                                         /\ plog' = plog41
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                                 \/ /\ LET yielded_fd477 == TRUE IN
                                                                                                                                                                                                                         /\ yielded_fd477
                                                                                                                                                                                                                         /\ plog' = plog41
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                  ELSE /\ LET log50 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                            LET value526 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                              IF ((value526).cmd) = (LogConcat)
                                                                                                                                                                                 THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value526).entries)]
                                                                                                                                                                                      /\ log' = [log50 EXCEPT ![i] = ((log50)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                "Failure of assertion at line 4667, column 43.")
                                                                                                                                                                                      /\ LET result102 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result102)[1]]
                                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result102)[2]]
                                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                           /\ \/ /\ LET value678 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value678})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd378 == FALSE IN
                                                                                                                                                                                                            /\ yielded_fd378
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ LET yielded_fd478 == TRUE IN
                                                                                                                                                                                                            /\ yielded_fd478
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                                                 ELSE /\ IF ((value526).cmd) = (LogPop)
                                                                                                                                                                                            THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value526).cnt))]
                                                                                                                                                                                                 /\ log' = [log50 EXCEPT ![i] = ((log50)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                           "Failure of assertion at line 4697, column 45.")
                                                                                                                                                                                                 /\ LET result103 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result103)[1]]
                                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result103)[2]]
                                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                      /\ \/ /\ LET value679 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value679})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd379 == FALSE IN
                                                                                                                                                                                                                       /\ yielded_fd379
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                               \/ /\ LET yielded_fd479 == TRUE IN
                                                                                                                                                                                                                       /\ yielded_fd479
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                                            ELSE /\ log' = [log50 EXCEPT ![i] = ((log50)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                           "Failure of assertion at line 4725, column 45.")
                                                                                                                                                                                                 /\ LET result104 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result104)[1]]
                                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result104)[2]]
                                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                      /\ \/ /\ LET value680 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value680})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd380 == FALSE IN
                                                                                                                                                                                                                       /\ yielded_fd380
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                               \/ /\ LET yielded_fd480 == TRUE IN
                                                                                                                                                                                                                       /\ yielded_fd480
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                                                 /\ plog' = plog
                                                                                                                             ELSE /\ IF (((m[self]).mterm) < ((currentTerm')[i])) \/ (((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state4)[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                                        THEN /\ \/ /\ LET value39 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value39})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                        /\ state' = state4
                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                \/ /\ \/ /\ LET yielded_fd118 == FALSE IN
                                                                                                                                                              /\ yielded_fd118
                                                                                                                                                              /\ state' = state4
                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                      \/ /\ LET yielded_fd211 == TRUE IN
                                                                                                                                                              /\ yielded_fd211
                                                                                                                                                              /\ state' = state4
                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                             /\ UNCHANGED << commitIndex, 
                                                                                                                                                             log, 
                                                                                                                                                             plog, 
                                                                                                                                                             sm, 
                                                                                                                                                             smDomain >>
                                                                                                                                        ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state4)[i]) = (Follower))) /\ (logOK), 
                                                                                                                                                       "Failure of assertion at line 4784, column 33.")
                                                                                                                                             /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                                  LET value49 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                                    IF ((value49).cmd) = (LogConcat)
                                                                                                                                                       THEN /\ LET plog42 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value49).entries)] IN
                                                                                                                                                                 LET log51 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                   LET value527 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                     IF ((value527).cmd) = (LogConcat)
                                                                                                                                                                        THEN /\ plog' = [plog42 EXCEPT ![i] = ((plog42)[i]) \o ((value527).entries)]
                                                                                                                                                                             /\ log' = [log51 EXCEPT ![i] = ((log51)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                             /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                       "Failure of assertion at line 4798, column 41.")
                                                                                                                                                                             /\ LET result105 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                  /\ sm' = [sm EXCEPT ![i] = (result105)[1]]
                                                                                                                                                                                  /\ smDomain' = [smDomain EXCEPT ![i] = (result105)[2]]
                                                                                                                                                                                  /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                  /\ \/ /\ LET value681 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                             /\ ((network)[j]).enabled
                                                                                                                                                                                             /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                             /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value681})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                             /\ state' = state4
                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     \/ /\ \/ /\ LET yielded_fd381 == FALSE IN
                                                                                                                                                                                                   /\ yielded_fd381
                                                                                                                                                                                                   /\ state' = state4
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ LET yielded_fd481 == TRUE IN
                                                                                                                                                                                                   /\ yielded_fd481
                                                                                                                                                                                                   /\ state' = state4
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        /\ UNCHANGED network
                                                                                                                                                                        ELSE /\ IF ((value527).cmd) = (LogPop)
                                                                                                                                                                                   THEN /\ plog' = [plog42 EXCEPT ![i] = SubSeq((plog42)[i], 1, (Len((plog42)[i])) - ((value527).cnt))]
                                                                                                                                                                                        /\ log' = [log51 EXCEPT ![i] = ((log51)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                  "Failure of assertion at line 4831, column 43.")
                                                                                                                                                                                        /\ LET result106 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result106)[1]]
                                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result106)[2]]
                                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                             /\ \/ /\ LET value682 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value682})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                        /\ state' = state4
                                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd382 == FALSE IN
                                                                                                                                                                                                              /\ yielded_fd382
                                                                                                                                                                                                              /\ state' = state4
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ LET yielded_fd482 == TRUE IN
                                                                                                                                                                                                              /\ yielded_fd482
                                                                                                                                                                                                              /\ state' = state4
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                                   ELSE /\ log' = [log51 EXCEPT ![i] = ((log51)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                  "Failure of assertion at line 4862, column 43.")
                                                                                                                                                                                        /\ LET result107 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result107)[1]]
                                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result107)[2]]
                                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                             /\ \/ /\ LET value683 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value683})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                        /\ plog' = plog42
                                                                                                                                                                                                        /\ state' = state4
                                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd383 == FALSE IN
                                                                                                                                                                                                              /\ yielded_fd383
                                                                                                                                                                                                              /\ plog' = plog42
                                                                                                                                                                                                              /\ state' = state4
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ LET yielded_fd483 == TRUE IN
                                                                                                                                                                                                              /\ yielded_fd483
                                                                                                                                                                                                              /\ plog' = plog42
                                                                                                                                                                                                              /\ state' = state4
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                       ELSE /\ IF ((value49).cmd) = (LogPop)
                                                                                                                                                                  THEN /\ LET plog43 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value49).cnt))] IN
                                                                                                                                                                            LET log52 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                              LET value528 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                                IF ((value528).cmd) = (LogConcat)
                                                                                                                                                                                   THEN /\ plog' = [plog43 EXCEPT ![i] = ((plog43)[i]) \o ((value528).entries)]
                                                                                                                                                                                        /\ log' = [log52 EXCEPT ![i] = ((log52)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                  "Failure of assertion at line 4907, column 43.")
                                                                                                                                                                                        /\ LET result108 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result108)[1]]
                                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result108)[2]]
                                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                             /\ \/ /\ LET value684 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value684})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                        /\ state' = state4
                                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd384 == FALSE IN
                                                                                                                                                                                                              /\ yielded_fd384
                                                                                                                                                                                                              /\ state' = state4
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ LET yielded_fd484 == TRUE IN
                                                                                                                                                                                                              /\ yielded_fd484
                                                                                                                                                                                                              /\ state' = state4
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                                   ELSE /\ IF ((value528).cmd) = (LogPop)
                                                                                                                                                                                              THEN /\ plog' = [plog43 EXCEPT ![i] = SubSeq((plog43)[i], 1, (Len((plog43)[i])) - ((value528).cnt))]
                                                                                                                                                                                                   /\ log' = [log52 EXCEPT ![i] = ((log52)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                             "Failure of assertion at line 4940, column 45.")
                                                                                                                                                                                                   /\ LET result109 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result109)[1]]
                                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result109)[2]]
                                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                        /\ \/ /\ LET value685 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value685})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                   /\ state' = state4
                                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd385 == FALSE IN
                                                                                                                                                                                                                         /\ yielded_fd385
                                                                                                                                                                                                                         /\ state' = state4
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                                 \/ /\ LET yielded_fd485 == TRUE IN
                                                                                                                                                                                                                         /\ yielded_fd485
                                                                                                                                                                                                                         /\ state' = state4
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                                              ELSE /\ log' = [log52 EXCEPT ![i] = ((log52)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                             "Failure of assertion at line 4971, column 45.")
                                                                                                                                                                                                   /\ LET result110 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result110)[1]]
                                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result110)[2]]
                                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                        /\ \/ /\ LET value686 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value686})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                   /\ plog' = plog43
                                                                                                                                                                                                                   /\ state' = state4
                                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd386 == FALSE IN
                                                                                                                                                                                                                         /\ yielded_fd386
                                                                                                                                                                                                                         /\ plog' = plog43
                                                                                                                                                                                                                         /\ state' = state4
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                                 \/ /\ LET yielded_fd486 == TRUE IN
                                                                                                                                                                                                                         /\ yielded_fd486
                                                                                                                                                                                                                         /\ plog' = plog43
                                                                                                                                                                                                                         /\ state' = state4
                                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                  ELSE /\ LET log53 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                            LET value529 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                              IF ((value529).cmd) = (LogConcat)
                                                                                                                                                                                 THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value529).entries)]
                                                                                                                                                                                      /\ log' = [log53 EXCEPT ![i] = ((log53)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                "Failure of assertion at line 5014, column 43.")
                                                                                                                                                                                      /\ LET result111 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result111)[1]]
                                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result111)[2]]
                                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                           /\ \/ /\ LET value687 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value687})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                      /\ state' = state4
                                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd387 == FALSE IN
                                                                                                                                                                                                            /\ yielded_fd387
                                                                                                                                                                                                            /\ state' = state4
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ LET yielded_fd487 == TRUE IN
                                                                                                                                                                                                            /\ yielded_fd487
                                                                                                                                                                                                            /\ state' = state4
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                                                 ELSE /\ IF ((value529).cmd) = (LogPop)
                                                                                                                                                                                            THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value529).cnt))]
                                                                                                                                                                                                 /\ log' = [log53 EXCEPT ![i] = ((log53)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                           "Failure of assertion at line 5047, column 45.")
                                                                                                                                                                                                 /\ LET result112 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result112)[1]]
                                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result112)[2]]
                                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                      /\ \/ /\ LET value688 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value688})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                 /\ state' = state4
                                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd388 == FALSE IN
                                                                                                                                                                                                                       /\ yielded_fd388
                                                                                                                                                                                                                       /\ state' = state4
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                               \/ /\ LET yielded_fd488 == TRUE IN
                                                                                                                                                                                                                       /\ yielded_fd488
                                                                                                                                                                                                                       /\ state' = state4
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                                            ELSE /\ log' = [log53 EXCEPT ![i] = ((log53)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                           "Failure of assertion at line 5078, column 45.")
                                                                                                                                                                                                 /\ LET result113 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result113)[1]]
                                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result113)[2]]
                                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                      /\ \/ /\ LET value689 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value689})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                                 /\ state' = state4
                                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd389 == FALSE IN
                                                                                                                                                                                                                       /\ yielded_fd389
                                                                                                                                                                                                                       /\ state' = state4
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                               \/ /\ LET yielded_fd489 == TRUE IN
                                                                                                                                                                                                                       /\ yielded_fd489
                                                                                                                                                                                                                       /\ state' = state4
                                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                                                 /\ plog' = plog
                                                                                                             ELSE /\ IF (((m[self]).mterm) = ((currentTerm')[i])) /\ (((state4)[i]) = (Candidate))
                                                                                                                        THEN /\ state' = [state4 EXCEPT ![i] = Follower]
                                                                                                                             /\ IF (((m[self]).mterm) < ((currentTerm')[i])) \/ (((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state')[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                                   THEN /\ \/ /\ LET value310 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value310})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                   /\ leader' = leader4
                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                           \/ /\ \/ /\ LET yielded_fd119 == FALSE IN
                                                                                                                                                         /\ yielded_fd119
                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                 \/ /\ LET yielded_fd212 == TRUE IN
                                                                                                                                                         /\ yielded_fd212
                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                              /\ UNCHANGED network
                                                                                                                                        /\ UNCHANGED << commitIndex, 
                                                                                                                                                        log, 
                                                                                                                                                        plog, 
                                                                                                                                                        sm, 
                                                                                                                                                        smDomain >>
                                                                                                                                   ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state')[i]) = (Follower))) /\ (logOK), 
                                                                                                                                                  "Failure of assertion at line 5144, column 31.")
                                                                                                                                        /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                             LET value410 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                               IF ((value410).cmd) = (LogConcat)
                                                                                                                                                  THEN /\ LET plog44 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value410).entries)] IN
                                                                                                                                                            LET log54 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                              LET value530 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                IF ((value530).cmd) = (LogConcat)
                                                                                                                                                                   THEN /\ plog' = [plog44 EXCEPT ![i] = ((plog44)[i]) \o ((value530).entries)]
                                                                                                                                                                        /\ log' = [log54 EXCEPT ![i] = ((log54)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                  "Failure of assertion at line 5158, column 39.")
                                                                                                                                                                        /\ LET result114 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result114)[1]]
                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result114)[2]]
                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                             /\ \/ /\ LET value690 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value690})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                        /\ leader' = leader4
                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd390 == FALSE IN
                                                                                                                                                                                              /\ yielded_fd390
                                                                                                                                                                                              /\ leader' = leader4
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                      \/ /\ LET yielded_fd490 == TRUE IN
                                                                                                                                                                                              /\ yielded_fd490
                                                                                                                                                                                              /\ leader' = leader4
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                   ELSE /\ IF ((value530).cmd) = (LogPop)
                                                                                                                                                                              THEN /\ plog' = [plog44 EXCEPT ![i] = SubSeq((plog44)[i], 1, (Len((plog44)[i])) - ((value530).cnt))]
                                                                                                                                                                                   /\ log' = [log54 EXCEPT ![i] = ((log54)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                             "Failure of assertion at line 5191, column 41.")
                                                                                                                                                                                   /\ LET result115 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result115)[1]]
                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result115)[2]]
                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                        /\ \/ /\ LET value691 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value691})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                   /\ leader' = leader4
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd391 == FALSE IN
                                                                                                                                                                                                         /\ yielded_fd391
                                                                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 \/ /\ LET yielded_fd491 == TRUE IN
                                                                                                                                                                                                         /\ yielded_fd491
                                                                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                              ELSE /\ log' = [log54 EXCEPT ![i] = ((log54)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                             "Failure of assertion at line 5222, column 41.")
                                                                                                                                                                                   /\ LET result116 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result116)[1]]
                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result116)[2]]
                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                        /\ \/ /\ LET value692 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value692})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                   /\ plog' = plog44
                                                                                                                                                                                                   /\ leader' = leader4
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd392 == FALSE IN
                                                                                                                                                                                                         /\ yielded_fd392
                                                                                                                                                                                                         /\ plog' = plog44
                                                                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 \/ /\ LET yielded_fd492 == TRUE IN
                                                                                                                                                                                                         /\ yielded_fd492
                                                                                                                                                                                                         /\ plog' = plog44
                                                                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                  ELSE /\ IF ((value410).cmd) = (LogPop)
                                                                                                                                                             THEN /\ LET plog45 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value410).cnt))] IN
                                                                                                                                                                       LET log55 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                         LET value531 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                           IF ((value531).cmd) = (LogConcat)
                                                                                                                                                                              THEN /\ plog' = [plog45 EXCEPT ![i] = ((plog45)[i]) \o ((value531).entries)]
                                                                                                                                                                                   /\ log' = [log55 EXCEPT ![i] = ((log55)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                             "Failure of assertion at line 5267, column 41.")
                                                                                                                                                                                   /\ LET result117 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result117)[1]]
                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result117)[2]]
                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                        /\ \/ /\ LET value693 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value693})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                   /\ leader' = leader4
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd393 == FALSE IN
                                                                                                                                                                                                         /\ yielded_fd393
                                                                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 \/ /\ LET yielded_fd493 == TRUE IN
                                                                                                                                                                                                         /\ yielded_fd493
                                                                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                              ELSE /\ IF ((value531).cmd) = (LogPop)
                                                                                                                                                                                         THEN /\ plog' = [plog45 EXCEPT ![i] = SubSeq((plog45)[i], 1, (Len((plog45)[i])) - ((value531).cnt))]
                                                                                                                                                                                              /\ log' = [log55 EXCEPT ![i] = ((log55)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                              /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                        "Failure of assertion at line 5300, column 43.")
                                                                                                                                                                                              /\ LET result118 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                   /\ sm' = [sm EXCEPT ![i] = (result118)[1]]
                                                                                                                                                                                                   /\ smDomain' = [smDomain EXCEPT ![i] = (result118)[2]]
                                                                                                                                                                                                   /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                   /\ \/ /\ LET value694 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                              /\ ((network)[j]).enabled
                                                                                                                                                                                                              /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                              /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value694})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                              /\ leader' = leader4
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ \/ /\ LET yielded_fd394 == FALSE IN
                                                                                                                                                                                                                    /\ yielded_fd394
                                                                                                                                                                                                                    /\ leader' = leader4
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            \/ /\ LET yielded_fd494 == TRUE IN
                                                                                                                                                                                                                    /\ yielded_fd494
                                                                                                                                                                                                                    /\ leader' = leader4
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         /\ UNCHANGED network
                                                                                                                                                                                         ELSE /\ log' = [log55 EXCEPT ![i] = ((log55)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                              /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                        "Failure of assertion at line 5331, column 43.")
                                                                                                                                                                                              /\ LET result119 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                   /\ sm' = [sm EXCEPT ![i] = (result119)[1]]
                                                                                                                                                                                                   /\ smDomain' = [smDomain EXCEPT ![i] = (result119)[2]]
                                                                                                                                                                                                   /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                   /\ \/ /\ LET value695 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                              /\ ((network)[j]).enabled
                                                                                                                                                                                                              /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                              /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value695})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                              /\ plog' = plog45
                                                                                                                                                                                                              /\ leader' = leader4
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ \/ /\ LET yielded_fd395 == FALSE IN
                                                                                                                                                                                                                    /\ yielded_fd395
                                                                                                                                                                                                                    /\ plog' = plog45
                                                                                                                                                                                                                    /\ leader' = leader4
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            \/ /\ LET yielded_fd495 == TRUE IN
                                                                                                                                                                                                                    /\ yielded_fd495
                                                                                                                                                                                                                    /\ plog' = plog45
                                                                                                                                                                                                                    /\ leader' = leader4
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         /\ UNCHANGED network
                                                                                                                                                             ELSE /\ LET log56 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                       LET value532 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                         IF ((value532).cmd) = (LogConcat)
                                                                                                                                                                            THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value532).entries)]
                                                                                                                                                                                 /\ log' = [log56 EXCEPT ![i] = ((log56)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 5374, column 41.")
                                                                                                                                                                                 /\ LET result120 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result120)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result120)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value696 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value696})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ leader' = leader4
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd396 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd396
                                                                                                                                                                                                       /\ leader' = leader4
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd496 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd496
                                                                                                                                                                                                       /\ leader' = leader4
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                            ELSE /\ IF ((value532).cmd) = (LogPop)
                                                                                                                                                                                       THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value532).cnt))]
                                                                                                                                                                                            /\ log' = [log56 EXCEPT ![i] = ((log56)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 5407, column 43.")
                                                                                                                                                                                            /\ LET result121 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result121)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result121)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value697 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value697})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ leader' = leader4
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd397 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd397
                                                                                                                                                                                                                  /\ leader' = leader4
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd497 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd497
                                                                                                                                                                                                                  /\ leader' = leader4
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                                       ELSE /\ log' = [log56 EXCEPT ![i] = ((log56)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 5438, column 43.")
                                                                                                                                                                                            /\ LET result122 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result122)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result122)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value698 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value698})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ leader' = leader4
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd398 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd398
                                                                                                                                                                                                                  /\ leader' = leader4
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd498 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd498
                                                                                                                                                                                                                  /\ leader' = leader4
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                                            /\ plog' = plog
                                                                                                                        ELSE /\ IF (((m[self]).mterm) < ((currentTerm')[i])) \/ (((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state4)[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                                   THEN /\ \/ /\ LET value311 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value311})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                   /\ leader' = leader4
                                                                                                                                                   /\ state' = state4
                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                           \/ /\ \/ /\ LET yielded_fd120 == FALSE IN
                                                                                                                                                         /\ yielded_fd120
                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                         /\ state' = state4
                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                 \/ /\ LET yielded_fd213 == TRUE IN
                                                                                                                                                         /\ yielded_fd213
                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                         /\ state' = state4
                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                              /\ UNCHANGED network
                                                                                                                                        /\ UNCHANGED << commitIndex, 
                                                                                                                                                        log, 
                                                                                                                                                        plog, 
                                                                                                                                                        sm, 
                                                                                                                                                        smDomain >>
                                                                                                                                   ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state4)[i]) = (Follower))) /\ (logOK), 
                                                                                                                                                  "Failure of assertion at line 5503, column 31.")
                                                                                                                                        /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                             LET value411 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                               IF ((value411).cmd) = (LogConcat)
                                                                                                                                                  THEN /\ LET plog46 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value411).entries)] IN
                                                                                                                                                            LET log57 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                              LET value533 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                IF ((value533).cmd) = (LogConcat)
                                                                                                                                                                   THEN /\ plog' = [plog46 EXCEPT ![i] = ((plog46)[i]) \o ((value533).entries)]
                                                                                                                                                                        /\ log' = [log57 EXCEPT ![i] = ((log57)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                  "Failure of assertion at line 5517, column 39.")
                                                                                                                                                                        /\ LET result123 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result123)[1]]
                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result123)[2]]
                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                             /\ \/ /\ LET value699 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value699})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                        /\ leader' = leader4
                                                                                                                                                                                        /\ state' = state4
                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd399 == FALSE IN
                                                                                                                                                                                              /\ yielded_fd399
                                                                                                                                                                                              /\ leader' = leader4
                                                                                                                                                                                              /\ state' = state4
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                      \/ /\ LET yielded_fd499 == TRUE IN
                                                                                                                                                                                              /\ yielded_fd499
                                                                                                                                                                                              /\ leader' = leader4
                                                                                                                                                                                              /\ state' = state4
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                   ELSE /\ IF ((value533).cmd) = (LogPop)
                                                                                                                                                                              THEN /\ plog' = [plog46 EXCEPT ![i] = SubSeq((plog46)[i], 1, (Len((plog46)[i])) - ((value533).cnt))]
                                                                                                                                                                                   /\ log' = [log57 EXCEPT ![i] = ((log57)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                             "Failure of assertion at line 5553, column 41.")
                                                                                                                                                                                   /\ LET result124 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result124)[1]]
                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result124)[2]]
                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                        /\ \/ /\ LET value6100 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6100})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                   /\ leader' = leader4
                                                                                                                                                                                                   /\ state' = state4
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd3100 == FALSE IN
                                                                                                                                                                                                         /\ yielded_fd3100
                                                                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                                                                         /\ state' = state4
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 \/ /\ LET yielded_fd4100 == TRUE IN
                                                                                                                                                                                                         /\ yielded_fd4100
                                                                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                                                                         /\ state' = state4
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                              ELSE /\ log' = [log57 EXCEPT ![i] = ((log57)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                             "Failure of assertion at line 5587, column 41.")
                                                                                                                                                                                   /\ LET result125 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result125)[1]]
                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result125)[2]]
                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                        /\ \/ /\ LET value6101 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6101})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                   /\ plog' = plog46
                                                                                                                                                                                                   /\ leader' = leader4
                                                                                                                                                                                                   /\ state' = state4
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd3101 == FALSE IN
                                                                                                                                                                                                         /\ yielded_fd3101
                                                                                                                                                                                                         /\ plog' = plog46
                                                                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                                                                         /\ state' = state4
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 \/ /\ LET yielded_fd4101 == TRUE IN
                                                                                                                                                                                                         /\ yielded_fd4101
                                                                                                                                                                                                         /\ plog' = plog46
                                                                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                                                                         /\ state' = state4
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                  ELSE /\ IF ((value411).cmd) = (LogPop)
                                                                                                                                                             THEN /\ LET plog47 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value411).cnt))] IN
                                                                                                                                                                       LET log58 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                         LET value534 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                           IF ((value534).cmd) = (LogConcat)
                                                                                                                                                                              THEN /\ plog' = [plog47 EXCEPT ![i] = ((plog47)[i]) \o ((value534).entries)]
                                                                                                                                                                                   /\ log' = [log58 EXCEPT ![i] = ((log58)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                   /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                             "Failure of assertion at line 5635, column 41.")
                                                                                                                                                                                   /\ LET result126 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                        /\ sm' = [sm EXCEPT ![i] = (result126)[1]]
                                                                                                                                                                                        /\ smDomain' = [smDomain EXCEPT ![i] = (result126)[2]]
                                                                                                                                                                                        /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                        /\ \/ /\ LET value6102 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                   /\ ((network)[j]).enabled
                                                                                                                                                                                                   /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                   /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6102})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                   /\ leader' = leader4
                                                                                                                                                                                                   /\ state' = state4
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ \/ /\ LET yielded_fd3102 == FALSE IN
                                                                                                                                                                                                         /\ yielded_fd3102
                                                                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                                                                         /\ state' = state4
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 \/ /\ LET yielded_fd4102 == TRUE IN
                                                                                                                                                                                                         /\ yielded_fd4102
                                                                                                                                                                                                         /\ leader' = leader4
                                                                                                                                                                                                         /\ state' = state4
                                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              /\ UNCHANGED network
                                                                                                                                                                              ELSE /\ IF ((value534).cmd) = (LogPop)
                                                                                                                                                                                         THEN /\ plog' = [plog47 EXCEPT ![i] = SubSeq((plog47)[i], 1, (Len((plog47)[i])) - ((value534).cnt))]
                                                                                                                                                                                              /\ log' = [log58 EXCEPT ![i] = ((log58)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                              /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                        "Failure of assertion at line 5671, column 43.")
                                                                                                                                                                                              /\ LET result127 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                   /\ sm' = [sm EXCEPT ![i] = (result127)[1]]
                                                                                                                                                                                                   /\ smDomain' = [smDomain EXCEPT ![i] = (result127)[2]]
                                                                                                                                                                                                   /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                   /\ \/ /\ LET value6103 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                              /\ ((network)[j]).enabled
                                                                                                                                                                                                              /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                              /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6103})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                              /\ leader' = leader4
                                                                                                                                                                                                              /\ state' = state4
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ \/ /\ LET yielded_fd3103 == FALSE IN
                                                                                                                                                                                                                    /\ yielded_fd3103
                                                                                                                                                                                                                    /\ leader' = leader4
                                                                                                                                                                                                                    /\ state' = state4
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            \/ /\ LET yielded_fd4103 == TRUE IN
                                                                                                                                                                                                                    /\ yielded_fd4103
                                                                                                                                                                                                                    /\ leader' = leader4
                                                                                                                                                                                                                    /\ state' = state4
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         /\ UNCHANGED network
                                                                                                                                                                                         ELSE /\ log' = [log58 EXCEPT ![i] = ((log58)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                              /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                        "Failure of assertion at line 5705, column 43.")
                                                                                                                                                                                              /\ LET result128 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                   /\ sm' = [sm EXCEPT ![i] = (result128)[1]]
                                                                                                                                                                                                   /\ smDomain' = [smDomain EXCEPT ![i] = (result128)[2]]
                                                                                                                                                                                                   /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                   /\ \/ /\ LET value6104 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                              /\ ((network)[j]).enabled
                                                                                                                                                                                                              /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                              /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6104})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                              /\ plog' = plog47
                                                                                                                                                                                                              /\ leader' = leader4
                                                                                                                                                                                                              /\ state' = state4
                                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                      \/ /\ \/ /\ LET yielded_fd3104 == FALSE IN
                                                                                                                                                                                                                    /\ yielded_fd3104
                                                                                                                                                                                                                    /\ plog' = plog47
                                                                                                                                                                                                                    /\ leader' = leader4
                                                                                                                                                                                                                    /\ state' = state4
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                            \/ /\ LET yielded_fd4104 == TRUE IN
                                                                                                                                                                                                                    /\ yielded_fd4104
                                                                                                                                                                                                                    /\ plog' = plog47
                                                                                                                                                                                                                    /\ leader' = leader4
                                                                                                                                                                                                                    /\ state' = state4
                                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                         /\ UNCHANGED network
                                                                                                                                                             ELSE /\ LET log59 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                       LET value535 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                         IF ((value535).cmd) = (LogConcat)
                                                                                                                                                                            THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value535).entries)]
                                                                                                                                                                                 /\ log' = [log59 EXCEPT ![i] = ((log59)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 5751, column 41.")
                                                                                                                                                                                 /\ LET result129 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result129)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result129)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value6105 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6105})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ leader' = leader4
                                                                                                                                                                                                 /\ state' = state4
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd3105 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd3105
                                                                                                                                                                                                       /\ leader' = leader4
                                                                                                                                                                                                       /\ state' = state4
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd4105 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd4105
                                                                                                                                                                                                       /\ leader' = leader4
                                                                                                                                                                                                       /\ state' = state4
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                            ELSE /\ IF ((value535).cmd) = (LogPop)
                                                                                                                                                                                       THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value535).cnt))]
                                                                                                                                                                                            /\ log' = [log59 EXCEPT ![i] = ((log59)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 5787, column 43.")
                                                                                                                                                                                            /\ LET result130 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result130)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result130)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value6106 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6106})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ leader' = leader4
                                                                                                                                                                                                            /\ state' = state4
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd3106 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd3106
                                                                                                                                                                                                                  /\ leader' = leader4
                                                                                                                                                                                                                  /\ state' = state4
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd4106 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd4106
                                                                                                                                                                                                                  /\ leader' = leader4
                                                                                                                                                                                                                  /\ state' = state4
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                                       ELSE /\ log' = [log59 EXCEPT ![i] = ((log59)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 5821, column 43.")
                                                                                                                                                                                            /\ LET result131 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result131)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result131)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value6107 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6107})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ leader' = leader4
                                                                                                                                                                                                            /\ state' = state4
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd3107 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd3107
                                                                                                                                                                                                                  /\ leader' = leader4
                                                                                                                                                                                                                  /\ state' = state4
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd4107 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd4107
                                                                                                                                                                                                                  /\ leader' = leader4
                                                                                                                                                                                                                  /\ state' = state4
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                                            /\ plog' = plog
                                                                                                                  /\ UNCHANGED leaderTimeout
                                                                                  ELSE /\ LET i == self IN
                                                                                            LET j == (m[self]).msource IN
                                                                                              LET logOK == (((m[self]).mprevLogIndex) = (0)) \/ (((((m[self]).mprevLogIndex) > (0)) /\ (((m[self]).mprevLogIndex) <= (Len((log)[i])))) /\ (((m[self]).mprevLogTerm) = ((((log)[i])[(m[self]).mprevLogIndex]).term))) IN
                                                                                                /\ Assert(((m[self]).mterm) <= ((currentTerm)[i]), 
                                                                                                          "Failure of assertion at line 5870, column 23.")
                                                                                                /\ IF ((m[self]).mterm) = ((currentTerm)[i])
                                                                                                      THEN /\ leader' = [leader EXCEPT ![i] = (m[self]).msource]
                                                                                                           /\ LET value23 == LeaderTimeoutReset IN
                                                                                                                /\ leaderTimeout' = value23
                                                                                                                /\ IF (((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Candidate))
                                                                                                                      THEN /\ state' = [state EXCEPT ![i] = Follower]
                                                                                                                           /\ IF (((m[self]).mterm) < ((currentTerm)[i])) \/ (((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state')[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                                 THEN /\ \/ /\ LET value312 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value312})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                         \/ /\ \/ /\ LET yielded_fd121 == FALSE IN
                                                                                                                                                       /\ yielded_fd121
                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                               \/ /\ LET yielded_fd214 == TRUE IN
                                                                                                                                                       /\ yielded_fd214
                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                            /\ UNCHANGED network
                                                                                                                                      /\ UNCHANGED << commitIndex, 
                                                                                                                                                      log, 
                                                                                                                                                      plog, 
                                                                                                                                                      sm, 
                                                                                                                                                      smDomain >>
                                                                                                                                 ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state')[i]) = (Follower))) /\ (logOK), 
                                                                                                                                                "Failure of assertion at line 5899, column 31.")
                                                                                                                                      /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                           LET value412 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                             IF ((value412).cmd) = (LogConcat)
                                                                                                                                                THEN /\ LET plog48 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value412).entries)] IN
                                                                                                                                                          LET log60 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                            LET value536 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                              IF ((value536).cmd) = (LogConcat)
                                                                                                                                                                 THEN /\ plog' = [plog48 EXCEPT ![i] = ((plog48)[i]) \o ((value536).entries)]
                                                                                                                                                                      /\ log' = [log60 EXCEPT ![i] = ((log60)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                "Failure of assertion at line 5913, column 39.")
                                                                                                                                                                      /\ LET result132 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result132)[1]]
                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result132)[2]]
                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                           /\ \/ /\ LET value6108 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6108})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd3108 == FALSE IN
                                                                                                                                                                                            /\ yielded_fd3108
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ LET yielded_fd4108 == TRUE IN
                                                                                                                                                                                            /\ yielded_fd4108
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                                 ELSE /\ IF ((value536).cmd) = (LogPop)
                                                                                                                                                                            THEN /\ plog' = [plog48 EXCEPT ![i] = SubSeq((plog48)[i], 1, (Len((plog48)[i])) - ((value536).cnt))]
                                                                                                                                                                                 /\ log' = [log60 EXCEPT ![i] = ((log60)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 5943, column 41.")
                                                                                                                                                                                 /\ LET result133 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result133)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result133)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value6109 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6109})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd3109 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd3109
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd4109 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd4109
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                            ELSE /\ log' = [log60 EXCEPT ![i] = ((log60)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 5971, column 41.")
                                                                                                                                                                                 /\ LET result134 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result134)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result134)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value6110 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6110})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ plog' = plog48
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd3110 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd3110
                                                                                                                                                                                                       /\ plog' = plog48
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd4110 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd4110
                                                                                                                                                                                                       /\ plog' = plog48
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                ELSE /\ IF ((value412).cmd) = (LogPop)
                                                                                                                                                           THEN /\ LET plog49 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value412).cnt))] IN
                                                                                                                                                                     LET log61 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                       LET value537 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                         IF ((value537).cmd) = (LogConcat)
                                                                                                                                                                            THEN /\ plog' = [plog49 EXCEPT ![i] = ((plog49)[i]) \o ((value537).entries)]
                                                                                                                                                                                 /\ log' = [log61 EXCEPT ![i] = ((log61)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 6013, column 41.")
                                                                                                                                                                                 /\ LET result135 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result135)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result135)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value6111 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6111})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd3111 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd3111
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd4111 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd4111
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                            ELSE /\ IF ((value537).cmd) = (LogPop)
                                                                                                                                                                                       THEN /\ plog' = [plog49 EXCEPT ![i] = SubSeq((plog49)[i], 1, (Len((plog49)[i])) - ((value537).cnt))]
                                                                                                                                                                                            /\ log' = [log61 EXCEPT ![i] = ((log61)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 6043, column 43.")
                                                                                                                                                                                            /\ LET result136 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result136)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result136)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value6112 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6112})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd3112 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd3112
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd4112 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd4112
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                                       ELSE /\ log' = [log61 EXCEPT ![i] = ((log61)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 6071, column 43.")
                                                                                                                                                                                            /\ LET result137 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result137)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result137)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value6113 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6113})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ plog' = plog49
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd3113 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd3113
                                                                                                                                                                                                                  /\ plog' = plog49
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd4113 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd4113
                                                                                                                                                                                                                  /\ plog' = plog49
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                           ELSE /\ LET log62 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                     LET value538 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                       IF ((value538).cmd) = (LogConcat)
                                                                                                                                                                          THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value538).entries)]
                                                                                                                                                                               /\ log' = [log62 EXCEPT ![i] = ((log62)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                         "Failure of assertion at line 6111, column 41.")
                                                                                                                                                                               /\ LET result138 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result138)[1]]
                                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result138)[2]]
                                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                    /\ \/ /\ LET value6114 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6114})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3114 == FALSE IN
                                                                                                                                                                                                     /\ yielded_fd3114
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ LET yielded_fd4114 == TRUE IN
                                                                                                                                                                                                     /\ yielded_fd4114
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                                                          ELSE /\ IF ((value538).cmd) = (LogPop)
                                                                                                                                                                                     THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value538).cnt))]
                                                                                                                                                                                          /\ log' = [log62 EXCEPT ![i] = ((log62)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                    "Failure of assertion at line 6141, column 43.")
                                                                                                                                                                                          /\ LET result139 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result139)[1]]
                                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result139)[2]]
                                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                               /\ \/ /\ LET value6115 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6115})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd3115 == FALSE IN
                                                                                                                                                                                                                /\ yielded_fd3115
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                        \/ /\ LET yielded_fd4115 == TRUE IN
                                                                                                                                                                                                                /\ yielded_fd4115
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                                                                     ELSE /\ log' = [log62 EXCEPT ![i] = ((log62)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                    "Failure of assertion at line 6169, column 43.")
                                                                                                                                                                                          /\ LET result140 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result140)[1]]
                                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result140)[2]]
                                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                               /\ \/ /\ LET value6116 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6116})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd3116 == FALSE IN
                                                                                                                                                                                                                /\ yielded_fd3116
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                        \/ /\ LET yielded_fd4116 == TRUE IN
                                                                                                                                                                                                                /\ yielded_fd4116
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                                                                          /\ plog' = plog
                                                                                                                      ELSE /\ IF (((m[self]).mterm) < ((currentTerm)[i])) \/ (((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                                 THEN /\ \/ /\ LET value313 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value313})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                         \/ /\ \/ /\ LET yielded_fd122 == FALSE IN
                                                                                                                                                       /\ yielded_fd122
                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                               \/ /\ LET yielded_fd215 == TRUE IN
                                                                                                                                                       /\ yielded_fd215
                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                            /\ UNCHANGED network
                                                                                                                                      /\ UNCHANGED << commitIndex, 
                                                                                                                                                      log, 
                                                                                                                                                      plog, 
                                                                                                                                                      sm, 
                                                                                                                                                      smDomain >>
                                                                                                                                 ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK), 
                                                                                                                                                "Failure of assertion at line 6225, column 31.")
                                                                                                                                      /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                           LET value413 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                             IF ((value413).cmd) = (LogConcat)
                                                                                                                                                THEN /\ LET plog50 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value413).entries)] IN
                                                                                                                                                          LET log63 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                            LET value539 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                              IF ((value539).cmd) = (LogConcat)
                                                                                                                                                                 THEN /\ plog' = [plog50 EXCEPT ![i] = ((plog50)[i]) \o ((value539).entries)]
                                                                                                                                                                      /\ log' = [log63 EXCEPT ![i] = ((log63)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                "Failure of assertion at line 6239, column 39.")
                                                                                                                                                                      /\ LET result141 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result141)[1]]
                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result141)[2]]
                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                           /\ \/ /\ LET value6117 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6117})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd3117 == FALSE IN
                                                                                                                                                                                            /\ yielded_fd3117
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ LET yielded_fd4117 == TRUE IN
                                                                                                                                                                                            /\ yielded_fd4117
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                                 ELSE /\ IF ((value539).cmd) = (LogPop)
                                                                                                                                                                            THEN /\ plog' = [plog50 EXCEPT ![i] = SubSeq((plog50)[i], 1, (Len((plog50)[i])) - ((value539).cnt))]
                                                                                                                                                                                 /\ log' = [log63 EXCEPT ![i] = ((log63)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 6269, column 41.")
                                                                                                                                                                                 /\ LET result142 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result142)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result142)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value6118 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6118})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd3118 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd3118
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd4118 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd4118
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                            ELSE /\ log' = [log63 EXCEPT ![i] = ((log63)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 6297, column 41.")
                                                                                                                                                                                 /\ LET result143 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result143)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result143)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value6119 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6119})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ plog' = plog50
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd3119 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd3119
                                                                                                                                                                                                       /\ plog' = plog50
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd4119 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd4119
                                                                                                                                                                                                       /\ plog' = plog50
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                ELSE /\ IF ((value413).cmd) = (LogPop)
                                                                                                                                                           THEN /\ LET plog51 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value413).cnt))] IN
                                                                                                                                                                     LET log64 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                       LET value540 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                         IF ((value540).cmd) = (LogConcat)
                                                                                                                                                                            THEN /\ plog' = [plog51 EXCEPT ![i] = ((plog51)[i]) \o ((value540).entries)]
                                                                                                                                                                                 /\ log' = [log64 EXCEPT ![i] = ((log64)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 6339, column 41.")
                                                                                                                                                                                 /\ LET result144 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result144)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result144)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value6120 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6120})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd3120 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd3120
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd4120 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd4120
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                            ELSE /\ IF ((value540).cmd) = (LogPop)
                                                                                                                                                                                       THEN /\ plog' = [plog51 EXCEPT ![i] = SubSeq((plog51)[i], 1, (Len((plog51)[i])) - ((value540).cnt))]
                                                                                                                                                                                            /\ log' = [log64 EXCEPT ![i] = ((log64)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 6369, column 43.")
                                                                                                                                                                                            /\ LET result145 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result145)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result145)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value6121 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6121})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd3121 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd3121
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd4121 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd4121
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                                       ELSE /\ log' = [log64 EXCEPT ![i] = ((log64)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                      "Failure of assertion at line 6397, column 43.")
                                                                                                                                                                                            /\ LET result146 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result146)[1]]
                                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result146)[2]]
                                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                                 /\ \/ /\ LET value6122 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6122})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                            /\ plog' = plog51
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd3122 == FALSE IN
                                                                                                                                                                                                                  /\ yielded_fd3122
                                                                                                                                                                                                                  /\ plog' = plog51
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                          \/ /\ LET yielded_fd4122 == TRUE IN
                                                                                                                                                                                                                  /\ yielded_fd4122
                                                                                                                                                                                                                  /\ plog' = plog51
                                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                           ELSE /\ LET log65 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                     LET value541 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                       IF ((value541).cmd) = (LogConcat)
                                                                                                                                                                          THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value541).entries)]
                                                                                                                                                                               /\ log' = [log65 EXCEPT ![i] = ((log65)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                         "Failure of assertion at line 6437, column 41.")
                                                                                                                                                                               /\ LET result147 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result147)[1]]
                                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result147)[2]]
                                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                    /\ \/ /\ LET value6123 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6123})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3123 == FALSE IN
                                                                                                                                                                                                     /\ yielded_fd3123
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ LET yielded_fd4123 == TRUE IN
                                                                                                                                                                                                     /\ yielded_fd4123
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                                                          ELSE /\ IF ((value541).cmd) = (LogPop)
                                                                                                                                                                                     THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value541).cnt))]
                                                                                                                                                                                          /\ log' = [log65 EXCEPT ![i] = ((log65)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                    "Failure of assertion at line 6467, column 43.")
                                                                                                                                                                                          /\ LET result148 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result148)[1]]
                                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result148)[2]]
                                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                               /\ \/ /\ LET value6124 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6124})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd3124 == FALSE IN
                                                                                                                                                                                                                /\ yielded_fd3124
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                        \/ /\ LET yielded_fd4124 == TRUE IN
                                                                                                                                                                                                                /\ yielded_fd4124
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                                                                     ELSE /\ log' = [log65 EXCEPT ![i] = ((log65)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                    "Failure of assertion at line 6495, column 43.")
                                                                                                                                                                                          /\ LET result149 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result149)[1]]
                                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result149)[2]]
                                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                               /\ \/ /\ LET value6125 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6125})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd3125 == FALSE IN
                                                                                                                                                                                                                /\ yielded_fd3125
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                        \/ /\ LET yielded_fd4125 == TRUE IN
                                                                                                                                                                                                                /\ yielded_fd4125
                                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                                                                          /\ plog' = plog
                                                                                                                           /\ state' = state
                                                                                                      ELSE /\ IF (((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Candidate))
                                                                                                                 THEN /\ state' = [state EXCEPT ![i] = Follower]
                                                                                                                      /\ IF (((m[self]).mterm) < ((currentTerm)[i])) \/ (((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state')[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                            THEN /\ \/ /\ LET value314 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value314})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                    \/ /\ \/ /\ LET yielded_fd123 == FALSE IN
                                                                                                                                                  /\ yielded_fd123
                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                          \/ /\ LET yielded_fd216 == TRUE IN
                                                                                                                                                  /\ yielded_fd216
                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                       /\ UNCHANGED network
                                                                                                                                 /\ UNCHANGED << commitIndex, 
                                                                                                                                                 log, 
                                                                                                                                                 plog, 
                                                                                                                                                 sm, 
                                                                                                                                                 smDomain >>
                                                                                                                            ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state')[i]) = (Follower))) /\ (logOK), 
                                                                                                                                           "Failure of assertion at line 6555, column 29.")
                                                                                                                                 /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                      LET value414 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                        IF ((value414).cmd) = (LogConcat)
                                                                                                                                           THEN /\ LET plog52 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value414).entries)] IN
                                                                                                                                                     LET log66 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                       LET value542 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                         IF ((value542).cmd) = (LogConcat)
                                                                                                                                                            THEN /\ plog' = [plog52 EXCEPT ![i] = ((plog52)[i]) \o ((value542).entries)]
                                                                                                                                                                 /\ log' = [log66 EXCEPT ![i] = ((log66)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                           "Failure of assertion at line 6569, column 37.")
                                                                                                                                                                 /\ LET result150 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result150)[1]]
                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result150)[2]]
                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                      /\ \/ /\ LET value6126 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6126})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd3126 == FALSE IN
                                                                                                                                                                                       /\ yielded_fd3126
                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                               \/ /\ LET yielded_fd4126 == TRUE IN
                                                                                                                                                                                       /\ yielded_fd4126
                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                            ELSE /\ IF ((value542).cmd) = (LogPop)
                                                                                                                                                                       THEN /\ plog' = [plog52 EXCEPT ![i] = SubSeq((plog52)[i], 1, (Len((plog52)[i])) - ((value542).cnt))]
                                                                                                                                                                            /\ log' = [log66 EXCEPT ![i] = ((log66)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                      "Failure of assertion at line 6599, column 39.")
                                                                                                                                                                            /\ LET result151 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result151)[1]]
                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result151)[2]]
                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                 /\ \/ /\ LET value6127 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6127})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd3127 == FALSE IN
                                                                                                                                                                                                  /\ yielded_fd3127
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          \/ /\ LET yielded_fd4127 == TRUE IN
                                                                                                                                                                                                  /\ yielded_fd4127
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                       ELSE /\ log' = [log66 EXCEPT ![i] = ((log66)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                      "Failure of assertion at line 6627, column 39.")
                                                                                                                                                                            /\ LET result152 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result152)[1]]
                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result152)[2]]
                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                 /\ \/ /\ LET value6128 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6128})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                            /\ plog' = plog52
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd3128 == FALSE IN
                                                                                                                                                                                                  /\ yielded_fd3128
                                                                                                                                                                                                  /\ plog' = plog52
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          \/ /\ LET yielded_fd4128 == TRUE IN
                                                                                                                                                                                                  /\ yielded_fd4128
                                                                                                                                                                                                  /\ plog' = plog52
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                           ELSE /\ IF ((value414).cmd) = (LogPop)
                                                                                                                                                      THEN /\ LET plog53 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value414).cnt))] IN
                                                                                                                                                                LET log67 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                  LET value543 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                    IF ((value543).cmd) = (LogConcat)
                                                                                                                                                                       THEN /\ plog' = [plog53 EXCEPT ![i] = ((plog53)[i]) \o ((value543).entries)]
                                                                                                                                                                            /\ log' = [log67 EXCEPT ![i] = ((log67)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                      "Failure of assertion at line 6669, column 39.")
                                                                                                                                                                            /\ LET result153 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result153)[1]]
                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result153)[2]]
                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                 /\ \/ /\ LET value6129 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6129})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd3129 == FALSE IN
                                                                                                                                                                                                  /\ yielded_fd3129
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          \/ /\ LET yielded_fd4129 == TRUE IN
                                                                                                                                                                                                  /\ yielded_fd4129
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                       ELSE /\ IF ((value543).cmd) = (LogPop)
                                                                                                                                                                                  THEN /\ plog' = [plog53 EXCEPT ![i] = SubSeq((plog53)[i], 1, (Len((plog53)[i])) - ((value543).cnt))]
                                                                                                                                                                                       /\ log' = [log67 EXCEPT ![i] = ((log67)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                       /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                 "Failure of assertion at line 6699, column 41.")
                                                                                                                                                                                       /\ LET result154 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                            /\ sm' = [sm EXCEPT ![i] = (result154)[1]]
                                                                                                                                                                                            /\ smDomain' = [smDomain EXCEPT ![i] = (result154)[2]]
                                                                                                                                                                                            /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                            /\ \/ /\ LET value6130 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                       /\ ((network)[j]).enabled
                                                                                                                                                                                                       /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                       /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6130})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ \/ /\ LET yielded_fd3130 == FALSE IN
                                                                                                                                                                                                             /\ yielded_fd3130
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     \/ /\ LET yielded_fd4130 == TRUE IN
                                                                                                                                                                                                             /\ yielded_fd4130
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  /\ UNCHANGED network
                                                                                                                                                                                  ELSE /\ log' = [log67 EXCEPT ![i] = ((log67)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                       /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                 "Failure of assertion at line 6727, column 41.")
                                                                                                                                                                                       /\ LET result155 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                            /\ sm' = [sm EXCEPT ![i] = (result155)[1]]
                                                                                                                                                                                            /\ smDomain' = [smDomain EXCEPT ![i] = (result155)[2]]
                                                                                                                                                                                            /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                            /\ \/ /\ LET value6131 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                       /\ ((network)[j]).enabled
                                                                                                                                                                                                       /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                       /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6131})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                       /\ plog' = plog53
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ \/ /\ LET yielded_fd3131 == FALSE IN
                                                                                                                                                                                                             /\ yielded_fd3131
                                                                                                                                                                                                             /\ plog' = plog53
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     \/ /\ LET yielded_fd4131 == TRUE IN
                                                                                                                                                                                                             /\ yielded_fd4131
                                                                                                                                                                                                             /\ plog' = plog53
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  /\ UNCHANGED network
                                                                                                                                                      ELSE /\ LET log68 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                LET value544 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                  IF ((value544).cmd) = (LogConcat)
                                                                                                                                                                     THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value544).entries)]
                                                                                                                                                                          /\ log' = [log68 EXCEPT ![i] = ((log68)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                    "Failure of assertion at line 6767, column 39.")
                                                                                                                                                                          /\ LET result156 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result156)[1]]
                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result156)[2]]
                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                               /\ \/ /\ LET value6132 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6132})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd3132 == FALSE IN
                                                                                                                                                                                                /\ yielded_fd3132
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        \/ /\ LET yielded_fd4132 == TRUE IN
                                                                                                                                                                                                /\ yielded_fd4132
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                                                     ELSE /\ IF ((value544).cmd) = (LogPop)
                                                                                                                                                                                THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value544).cnt))]
                                                                                                                                                                                     /\ log' = [log68 EXCEPT ![i] = ((log68)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                     /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                               "Failure of assertion at line 6797, column 41.")
                                                                                                                                                                                     /\ LET result157 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                          /\ sm' = [sm EXCEPT ![i] = (result157)[1]]
                                                                                                                                                                                          /\ smDomain' = [smDomain EXCEPT ![i] = (result157)[2]]
                                                                                                                                                                                          /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                          /\ \/ /\ LET value6133 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                     /\ ((network)[j]).enabled
                                                                                                                                                                                                     /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                     /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6133})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ \/ /\ LET yielded_fd3133 == FALSE IN
                                                                                                                                                                                                           /\ yielded_fd3133
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   \/ /\ LET yielded_fd4133 == TRUE IN
                                                                                                                                                                                                           /\ yielded_fd4133
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                /\ UNCHANGED network
                                                                                                                                                                                ELSE /\ log' = [log68 EXCEPT ![i] = ((log68)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                     /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                               "Failure of assertion at line 6825, column 41.")
                                                                                                                                                                                     /\ LET result158 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                          /\ sm' = [sm EXCEPT ![i] = (result158)[1]]
                                                                                                                                                                                          /\ smDomain' = [smDomain EXCEPT ![i] = (result158)[2]]
                                                                                                                                                                                          /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                          /\ \/ /\ LET value6134 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                     /\ ((network)[j]).enabled
                                                                                                                                                                                                     /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                     /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6134})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ \/ /\ LET yielded_fd3134 == FALSE IN
                                                                                                                                                                                                           /\ yielded_fd3134
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   \/ /\ LET yielded_fd4134 == TRUE IN
                                                                                                                                                                                                           /\ yielded_fd4134
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                /\ UNCHANGED network
                                                                                                                                                                                     /\ plog' = plog
                                                                                                                 ELSE /\ IF (((m[self]).mterm) < ((currentTerm)[i])) \/ (((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                            THEN /\ \/ /\ LET value315 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value315})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                    \/ /\ \/ /\ LET yielded_fd124 == FALSE IN
                                                                                                                                                  /\ yielded_fd124
                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                          \/ /\ LET yielded_fd217 == TRUE IN
                                                                                                                                                  /\ yielded_fd217
                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                       /\ UNCHANGED network
                                                                                                                                 /\ UNCHANGED << commitIndex, 
                                                                                                                                                 log, 
                                                                                                                                                 plog, 
                                                                                                                                                 sm, 
                                                                                                                                                 smDomain >>
                                                                                                                            ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK), 
                                                                                                                                           "Failure of assertion at line 6881, column 29.")
                                                                                                                                 /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                      LET value415 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                        IF ((value415).cmd) = (LogConcat)
                                                                                                                                           THEN /\ LET plog54 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value415).entries)] IN
                                                                                                                                                     LET log69 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                       LET value545 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                         IF ((value545).cmd) = (LogConcat)
                                                                                                                                                            THEN /\ plog' = [plog54 EXCEPT ![i] = ((plog54)[i]) \o ((value545).entries)]
                                                                                                                                                                 /\ log' = [log69 EXCEPT ![i] = ((log69)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                           "Failure of assertion at line 6895, column 37.")
                                                                                                                                                                 /\ LET result159 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result159)[1]]
                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result159)[2]]
                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                      /\ \/ /\ LET value6135 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6135})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd3135 == FALSE IN
                                                                                                                                                                                       /\ yielded_fd3135
                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                               \/ /\ LET yielded_fd4135 == TRUE IN
                                                                                                                                                                                       /\ yielded_fd4135
                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                            ELSE /\ IF ((value545).cmd) = (LogPop)
                                                                                                                                                                       THEN /\ plog' = [plog54 EXCEPT ![i] = SubSeq((plog54)[i], 1, (Len((plog54)[i])) - ((value545).cnt))]
                                                                                                                                                                            /\ log' = [log69 EXCEPT ![i] = ((log69)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                      "Failure of assertion at line 6925, column 39.")
                                                                                                                                                                            /\ LET result160 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result160)[1]]
                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result160)[2]]
                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                 /\ \/ /\ LET value6136 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6136})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd3136 == FALSE IN
                                                                                                                                                                                                  /\ yielded_fd3136
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          \/ /\ LET yielded_fd4136 == TRUE IN
                                                                                                                                                                                                  /\ yielded_fd4136
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                       ELSE /\ log' = [log69 EXCEPT ![i] = ((log69)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                      "Failure of assertion at line 6953, column 39.")
                                                                                                                                                                            /\ LET result161 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result161)[1]]
                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result161)[2]]
                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                 /\ \/ /\ LET value6137 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6137})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                            /\ plog' = plog54
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd3137 == FALSE IN
                                                                                                                                                                                                  /\ yielded_fd3137
                                                                                                                                                                                                  /\ plog' = plog54
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          \/ /\ LET yielded_fd4137 == TRUE IN
                                                                                                                                                                                                  /\ yielded_fd4137
                                                                                                                                                                                                  /\ plog' = plog54
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                           ELSE /\ IF ((value415).cmd) = (LogPop)
                                                                                                                                                      THEN /\ LET plog55 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value415).cnt))] IN
                                                                                                                                                                LET log70 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                  LET value546 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                    IF ((value546).cmd) = (LogConcat)
                                                                                                                                                                       THEN /\ plog' = [plog55 EXCEPT ![i] = ((plog55)[i]) \o ((value546).entries)]
                                                                                                                                                                            /\ log' = [log70 EXCEPT ![i] = ((log70)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                            /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                      "Failure of assertion at line 6995, column 39.")
                                                                                                                                                                            /\ LET result162 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                 /\ sm' = [sm EXCEPT ![i] = (result162)[1]]
                                                                                                                                                                                 /\ smDomain' = [smDomain EXCEPT ![i] = (result162)[2]]
                                                                                                                                                                                 /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                 /\ \/ /\ LET value6138 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                            /\ ((network)[j]).enabled
                                                                                                                                                                                            /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                            /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6138})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ \/ /\ LET yielded_fd3138 == FALSE IN
                                                                                                                                                                                                  /\ yielded_fd3138
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          \/ /\ LET yielded_fd4138 == TRUE IN
                                                                                                                                                                                                  /\ yielded_fd4138
                                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       /\ UNCHANGED network
                                                                                                                                                                       ELSE /\ IF ((value546).cmd) = (LogPop)
                                                                                                                                                                                  THEN /\ plog' = [plog55 EXCEPT ![i] = SubSeq((plog55)[i], 1, (Len((plog55)[i])) - ((value546).cnt))]
                                                                                                                                                                                       /\ log' = [log70 EXCEPT ![i] = ((log70)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                       /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                 "Failure of assertion at line 7025, column 41.")
                                                                                                                                                                                       /\ LET result163 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                            /\ sm' = [sm EXCEPT ![i] = (result163)[1]]
                                                                                                                                                                                            /\ smDomain' = [smDomain EXCEPT ![i] = (result163)[2]]
                                                                                                                                                                                            /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                            /\ \/ /\ LET value6139 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                       /\ ((network)[j]).enabled
                                                                                                                                                                                                       /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                       /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6139})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ \/ /\ LET yielded_fd3139 == FALSE IN
                                                                                                                                                                                                             /\ yielded_fd3139
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     \/ /\ LET yielded_fd4139 == TRUE IN
                                                                                                                                                                                                             /\ yielded_fd4139
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  /\ UNCHANGED network
                                                                                                                                                                                  ELSE /\ log' = [log70 EXCEPT ![i] = ((log70)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                       /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                 "Failure of assertion at line 7053, column 41.")
                                                                                                                                                                                       /\ LET result164 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                            /\ sm' = [sm EXCEPT ![i] = (result164)[1]]
                                                                                                                                                                                            /\ smDomain' = [smDomain EXCEPT ![i] = (result164)[2]]
                                                                                                                                                                                            /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                            /\ \/ /\ LET value6140 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                       /\ ((network)[j]).enabled
                                                                                                                                                                                                       /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                       /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6140})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                       /\ plog' = plog55
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ \/ /\ LET yielded_fd3140 == FALSE IN
                                                                                                                                                                                                             /\ yielded_fd3140
                                                                                                                                                                                                             /\ plog' = plog55
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                     \/ /\ LET yielded_fd4140 == TRUE IN
                                                                                                                                                                                                             /\ yielded_fd4140
                                                                                                                                                                                                             /\ plog' = plog55
                                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  /\ UNCHANGED network
                                                                                                                                                      ELSE /\ LET log71 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                LET value547 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                  IF ((value547).cmd) = (LogConcat)
                                                                                                                                                                     THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value547).entries)]
                                                                                                                                                                          /\ log' = [log71 EXCEPT ![i] = ((log71)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                    "Failure of assertion at line 7093, column 39.")
                                                                                                                                                                          /\ LET result165 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result165)[1]]
                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result165)[2]]
                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                               /\ \/ /\ LET value6141 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6141})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd3141 == FALSE IN
                                                                                                                                                                                                /\ yielded_fd3141
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        \/ /\ LET yielded_fd4141 == TRUE IN
                                                                                                                                                                                                /\ yielded_fd4141
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                                                     ELSE /\ IF ((value547).cmd) = (LogPop)
                                                                                                                                                                                THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value547).cnt))]
                                                                                                                                                                                     /\ log' = [log71 EXCEPT ![i] = ((log71)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                     /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                               "Failure of assertion at line 7123, column 41.")
                                                                                                                                                                                     /\ LET result166 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                          /\ sm' = [sm EXCEPT ![i] = (result166)[1]]
                                                                                                                                                                                          /\ smDomain' = [smDomain EXCEPT ![i] = (result166)[2]]
                                                                                                                                                                                          /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                          /\ \/ /\ LET value6142 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                     /\ ((network)[j]).enabled
                                                                                                                                                                                                     /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                     /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6142})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ \/ /\ LET yielded_fd3142 == FALSE IN
                                                                                                                                                                                                           /\ yielded_fd3142
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   \/ /\ LET yielded_fd4142 == TRUE IN
                                                                                                                                                                                                           /\ yielded_fd4142
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                /\ UNCHANGED network
                                                                                                                                                                                ELSE /\ log' = [log71 EXCEPT ![i] = ((log71)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                     /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                               "Failure of assertion at line 7151, column 41.")
                                                                                                                                                                                     /\ LET result167 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                          /\ sm' = [sm EXCEPT ![i] = (result167)[1]]
                                                                                                                                                                                          /\ smDomain' = [smDomain EXCEPT ![i] = (result167)[2]]
                                                                                                                                                                                          /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                          /\ \/ /\ LET value6143 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                     /\ ((network)[j]).enabled
                                                                                                                                                                                                     /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                     /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6143})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ \/ /\ LET yielded_fd3143 == FALSE IN
                                                                                                                                                                                                           /\ yielded_fd3143
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                   \/ /\ LET yielded_fd4143 == TRUE IN
                                                                                                                                                                                                           /\ yielded_fd4143
                                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                /\ UNCHANGED network
                                                                                                                                                                                     /\ plog' = plog
                                                                                                                      /\ state' = state
                                                                                                           /\ UNCHANGED << leader, 
                                                                                                                           leaderTimeout >>
                                                                                       /\ UNCHANGED << currentTerm, 
                                                                                                       votedFor >>
                                                                            /\ UNCHANGED << nextIndex, 
                                                                                            matchIndex, 
                                                                                            appendEntriesCh >>
                                                                       ELSE /\ IF ((m[self]).mtype) = (AppendEntriesResponse)
                                                                                  THEN /\ IF ((m[self]).mterm) > ((currentTerm)[self])
                                                                                             THEN /\ currentTerm' = [currentTerm EXCEPT ![self] = (m[self]).mterm]
                                                                                                  /\ state' = [state EXCEPT ![self] = Follower]
                                                                                                  /\ votedFor' = [votedFor EXCEPT ![self] = Nil]
                                                                                                  /\ leader' = [leader EXCEPT ![self] = Nil]
                                                                                                  /\ IF ((m[self]).mterm) < ((currentTerm')[self])
                                                                                                        THEN /\ TRUE
                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                             /\ UNCHANGED << nextIndex, 
                                                                                                                             matchIndex >>
                                                                                                        ELSE /\ LET i == self IN
                                                                                                                  LET j == (m[self]).msource IN
                                                                                                                    /\ Assert(((m[self]).mterm) = ((currentTerm')[i]), 
                                                                                                                              "Failure of assertion at line 7203, column 27.")
                                                                                                                    /\ IF (m[self]).msuccess
                                                                                                                          THEN /\ nextIndex' = [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = ((m[self]).mmatchIndex) + (1)]]
                                                                                                                               /\ matchIndex' = [matchIndex EXCEPT ![i] = [(matchIndex)[i] EXCEPT ![j] = (m[self]).mmatchIndex]]
                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                          ELSE /\ nextIndex' = [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = Max({(((nextIndex)[i])[j]) - (1), 1})]]
                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                               /\ UNCHANGED matchIndex
                                                                                             ELSE /\ IF ((m[self]).mterm) < ((currentTerm)[self])
                                                                                                        THEN /\ TRUE
                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                             /\ UNCHANGED << nextIndex, 
                                                                                                                             matchIndex >>
                                                                                                        ELSE /\ LET i == self IN
                                                                                                                  LET j == (m[self]).msource IN
                                                                                                                    /\ Assert(((m[self]).mterm) = ((currentTerm)[i]), 
                                                                                                                              "Failure of assertion at line 7223, column 27.")
                                                                                                                    /\ IF (m[self]).msuccess
                                                                                                                          THEN /\ nextIndex' = [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = ((m[self]).mmatchIndex) + (1)]]
                                                                                                                               /\ matchIndex' = [matchIndex EXCEPT ![i] = [(matchIndex)[i] EXCEPT ![j] = (m[self]).mmatchIndex]]
                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                          ELSE /\ nextIndex' = [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = Max({(((nextIndex)[i])[j]) - (1), 1})]]
                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                               /\ UNCHANGED matchIndex
                                                                                                  /\ UNCHANGED << state, 
                                                                                                                  currentTerm, 
                                                                                                                  votedFor, 
                                                                                                                  leader >>
                                                                                       /\ UNCHANGED << network, 
                                                                                                       log, 
                                                                                                       plog, 
                                                                                                       appendEntriesCh >>
                                                                                  ELSE /\ IF (((m[self]).mtype) = (ClientPutRequest)) \/ (((m[self]).mtype) = (ClientGetRequest))
                                                                                             THEN /\ IF ((state)[self]) = (Leader)
                                                                                                        THEN /\ LET entry == [term |-> (currentTerm)[self], cmd |-> (m[self]).mcmd, client |-> (m[self]).msource] IN
                                                                                                                  /\ log' = [log EXCEPT ![self] = Append((log)[self], entry)]
                                                                                                                  /\ LET value71 == [cmd |-> LogConcat, entries |-> <<entry>>] IN
                                                                                                                       IF ((value71).cmd) = (LogConcat)
                                                                                                                          THEN /\ plog' = [plog EXCEPT ![self] = ((plog)[self]) \o ((value71).entries)]
                                                                                                                               /\ LET value83 == TRUE IN
                                                                                                                                    /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value83)]
                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                          ELSE /\ IF ((value71).cmd) = (LogPop)
                                                                                                                                     THEN /\ plog' = [plog EXCEPT ![self] = SubSeq((plog)[self], 1, (Len((plog)[self])) - ((value71).cnt))]
                                                                                                                                          /\ LET value84 == TRUE IN
                                                                                                                                               /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value84)]
                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                     ELSE /\ LET value85 == TRUE IN
                                                                                                                                               /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value85)]
                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                          /\ plog' = plog
                                                                                                             /\ UNCHANGED network
                                                                                                        ELSE /\ LET i == self IN
                                                                                                                  LET j == (m[self]).msource IN
                                                                                                                    LET respType == IF (((m[self]).mcmd).type) = (Put) THEN ClientPutResponse ELSE ClientGetResponse IN
                                                                                                                      LET value91 == [mtype |-> respType, msuccess |-> FALSE, mresponse |-> [idx |-> ((m[self]).mcmd).idx, key |-> ((m[self]).mcmd).key], mleaderHint |-> (leader)[i], msource |-> i, mdest |-> j] IN
                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value91})), enabled |-> ((network)[j]).enabled]]
                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                             /\ UNCHANGED << log, 
                                                                                                                             plog, 
                                                                                                                             appendEntriesCh >>
                                                                                             ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                  /\ UNCHANGED << network, 
                                                                                                                  log, 
                                                                                                                  plog, 
                                                                                                                  appendEntriesCh >>
                                                                                       /\ UNCHANGED << state, 
                                                                                                       currentTerm, 
                                                                                                       nextIndex, 
                                                                                                       matchIndex, 
                                                                                                       votedFor, 
                                                                                                       leader >>
                                                                            /\ UNCHANGED << commitIndex, 
                                                                                            sm, 
                                                                                            smDomain, 
                                                                                            leaderTimeout >>
                                                                 /\ UNCHANGED << votesResponded, 
                                                                                 votesGranted, 
                                                                                 becomeLeaderCh >>
                         ELSE /\ IF ((m[self]).mtype) = (RequestVoteRequest)
                                    THEN /\ IF ((m[self]).mterm) > ((currentTerm)[self])
                                               THEN /\ currentTerm' = [currentTerm EXCEPT ![self] = (m[self]).mterm]
                                                    /\ state' = [state EXCEPT ![self] = Follower]
                                                    /\ LET votedFor5 == [votedFor EXCEPT ![self] = Nil] IN
                                                         /\ leader' = [leader EXCEPT ![self] = Nil]
                                                         /\ LET i == self IN
                                                              LET j == (m[self]).msource IN
                                                                LET logOK == (((m[self]).mlastLogTerm) > (LastTerm((log)[i]))) \/ ((((m[self]).mlastLogTerm) = (LastTerm((log)[i]))) /\ (((m[self]).mlastLogIndex) >= (Len((log)[i])))) IN
                                                                  LET grant == ((((m[self]).mterm) = ((currentTerm')[i])) /\ (logOK)) /\ (((votedFor5)[self]) \in ({Nil, j})) IN
                                                                    /\ Assert(((m[self]).mterm) <= ((currentTerm')[i]), 
                                                                              "Failure of assertion at line 7298, column 17.")
                                                                    /\ IF grant
                                                                          THEN /\ votedFor' = [votedFor5 EXCEPT ![i] = j]
                                                                               /\ \/ /\ LET value08 == [mtype |-> RequestVoteResponse, mterm |-> (currentTerm')[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j] IN
                                                                                          /\ ((network)[j]).enabled
                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value08})), enabled |-> ((network)[j]).enabled]]
                                                                                          /\ IF Debug
                                                                                                THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                  \/ /\ \/ /\ LET yielded_fd52 == FALSE IN
                                                                                                /\ yielded_fd52
                                                                                                /\ IF Debug
                                                                                                      THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                      ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                        \/ /\ LET yielded_fd08 == TRUE IN
                                                                                                /\ yielded_fd08
                                                                                                /\ IF Debug
                                                                                                      THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                      ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                     /\ UNCHANGED network
                                                                          ELSE /\ \/ /\ LET value09 == [mtype |-> RequestVoteResponse, mterm |-> (currentTerm')[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j] IN
                                                                                          /\ ((network)[j]).enabled
                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value09})), enabled |-> ((network)[j]).enabled]]
                                                                                          /\ IF Debug
                                                                                                THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                     /\ votedFor' = votedFor5
                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                ELSE /\ votedFor' = votedFor5
                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                  \/ /\ \/ /\ LET yielded_fd53 == FALSE IN
                                                                                                /\ yielded_fd53
                                                                                                /\ IF Debug
                                                                                                      THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                           /\ votedFor' = votedFor5
                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                      ELSE /\ votedFor' = votedFor5
                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                        \/ /\ LET yielded_fd09 == TRUE IN
                                                                                                /\ yielded_fd09
                                                                                                /\ IF Debug
                                                                                                      THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm')[i], grant>>)
                                                                                                           /\ votedFor' = votedFor5
                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                      ELSE /\ votedFor' = votedFor5
                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                     /\ UNCHANGED network
                                               ELSE /\ LET i == self IN
                                                         LET j == (m[self]).msource IN
                                                           LET logOK == (((m[self]).mlastLogTerm) > (LastTerm((log)[i]))) \/ ((((m[self]).mlastLogTerm) = (LastTerm((log)[i]))) /\ (((m[self]).mlastLogIndex) >= (Len((log)[i])))) IN
                                                             LET grant == ((((m[self]).mterm) = ((currentTerm)[i])) /\ (logOK)) /\ (((votedFor)[self]) \in ({Nil, j})) IN
                                                               /\ Assert(((m[self]).mterm) <= ((currentTerm)[i]), 
                                                                         "Failure of assertion at line 7388, column 15.")
                                                               /\ IF grant
                                                                     THEN /\ votedFor' = [votedFor EXCEPT ![i] = j]
                                                                          /\ \/ /\ LET value010 == [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j] IN
                                                                                     /\ ((network)[j]).enabled
                                                                                     /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                     /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value010})), enabled |-> ((network)[j]).enabled]]
                                                                                     /\ IF Debug
                                                                                           THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                           ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                             \/ /\ \/ /\ LET yielded_fd54 == FALSE IN
                                                                                           /\ yielded_fd54
                                                                                           /\ IF Debug
                                                                                                 THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                 ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                   \/ /\ LET yielded_fd010 == TRUE IN
                                                                                           /\ yielded_fd010
                                                                                           /\ IF Debug
                                                                                                 THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                 ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                /\ UNCHANGED network
                                                                     ELSE /\ \/ /\ LET value011 == [mtype |-> RequestVoteResponse, mterm |-> (currentTerm)[i], mvoteGranted |-> grant, msource |-> i, mdest |-> j] IN
                                                                                     /\ ((network)[j]).enabled
                                                                                     /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                     /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value011})), enabled |-> ((network)[j]).enabled]]
                                                                                     /\ IF Debug
                                                                                           THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                           ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                             \/ /\ \/ /\ LET yielded_fd55 == FALSE IN
                                                                                           /\ yielded_fd55
                                                                                           /\ IF Debug
                                                                                                 THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                 ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                   \/ /\ LET yielded_fd011 == TRUE IN
                                                                                           /\ yielded_fd011
                                                                                           /\ IF Debug
                                                                                                 THEN /\ PrintT(<<"HandleRequestVoteRequest", i, j, (currentTerm)[i], grant>>)
                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                 ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                /\ UNCHANGED network
                                                                          /\ UNCHANGED votedFor
                                                    /\ UNCHANGED << state, 
                                                                    currentTerm, 
                                                                    leader >>
                                         /\ UNCHANGED << commitIndex, 
                                                         nextIndex, matchIndex, 
                                                         log, plog, 
                                                         votesResponded, 
                                                         votesGranted, sm, 
                                                         smDomain, 
                                                         leaderTimeout, 
                                                         appendEntriesCh, 
                                                         becomeLeaderCh >>
                                    ELSE /\ IF ((m[self]).mtype) = (RequestVoteResponse)
                                               THEN /\ IF ((m[self]).mterm) > ((currentTerm)[self])
                                                          THEN /\ currentTerm' = [currentTerm EXCEPT ![self] = (m[self]).mterm]
                                                               /\ state' = [state EXCEPT ![self] = Follower]
                                                               /\ votedFor' = [votedFor EXCEPT ![self] = Nil]
                                                               /\ leader' = [leader EXCEPT ![self] = Nil]
                                                               /\ IF ((m[self]).mterm) < ((currentTerm')[self])
                                                                     THEN /\ TRUE
                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                          /\ UNCHANGED << votesResponded, 
                                                                                          votesGranted, 
                                                                                          becomeLeaderCh >>
                                                                     ELSE /\ LET i == self IN
                                                                               LET j == (m[self]).msource IN
                                                                                 /\ Assert(((m[self]).mterm) = ((currentTerm')[i]), 
                                                                                           "Failure of assertion at line 7480, column 19.")
                                                                                 /\ votesResponded' = [votesResponded EXCEPT ![i] = ((votesResponded)[i]) \union ({j})]
                                                                                 /\ IF (m[self]).mvoteGranted
                                                                                       THEN /\ votesGranted' = [votesGranted EXCEPT ![i] = ((votesGranted)[i]) \union ({j})]
                                                                                            /\ IF (((state')[i]) = (Candidate)) /\ (isQuorum((votesGranted')[i]))
                                                                                                  THEN /\ LET value112 == TRUE IN
                                                                                                            /\ becomeLeaderCh' = [becomeLeaderCh EXCEPT ![i] = Append((becomeLeaderCh)[i], value112)]
                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                  ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                       /\ UNCHANGED becomeLeaderCh
                                                                                       ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                            /\ UNCHANGED << votesGranted, 
                                                                                                            becomeLeaderCh >>
                                                          ELSE /\ IF ((m[self]).mterm) < ((currentTerm)[self])
                                                                     THEN /\ TRUE
                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                          /\ UNCHANGED << votesResponded, 
                                                                                          votesGranted, 
                                                                                          becomeLeaderCh >>
                                                                     ELSE /\ LET i == self IN
                                                                               LET j == (m[self]).msource IN
                                                                                 /\ Assert(((m[self]).mterm) = ((currentTerm)[i]), 
                                                                                           "Failure of assertion at line 7506, column 19.")
                                                                                 /\ votesResponded' = [votesResponded EXCEPT ![i] = ((votesResponded)[i]) \union ({j})]
                                                                                 /\ IF (m[self]).mvoteGranted
                                                                                       THEN /\ votesGranted' = [votesGranted EXCEPT ![i] = ((votesGranted)[i]) \union ({j})]
                                                                                            /\ IF (((state)[i]) = (Candidate)) /\ (isQuorum((votesGranted')[i]))
                                                                                                  THEN /\ LET value113 == TRUE IN
                                                                                                            /\ becomeLeaderCh' = [becomeLeaderCh EXCEPT ![i] = Append((becomeLeaderCh)[i], value113)]
                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                  ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                       /\ UNCHANGED becomeLeaderCh
                                                                                       ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                            /\ UNCHANGED << votesGranted, 
                                                                                                            becomeLeaderCh >>
                                                               /\ UNCHANGED << state, 
                                                                               currentTerm, 
                                                                               votedFor, 
                                                                               leader >>
                                                    /\ UNCHANGED << network, 
                                                                    commitIndex, 
                                                                    nextIndex, 
                                                                    matchIndex, 
                                                                    log, plog, 
                                                                    sm, 
                                                                    smDomain, 
                                                                    leaderTimeout, 
                                                                    appendEntriesCh >>
                                               ELSE /\ IF ((m[self]).mtype) = (AppendEntriesRequest)
                                                          THEN /\ IF ((m[self]).mterm) > ((currentTerm)[self])
                                                                     THEN /\ currentTerm' = [currentTerm EXCEPT ![self] = (m[self]).mterm]
                                                                          /\ LET state5 == [state EXCEPT ![self] = Follower] IN
                                                                               /\ votedFor' = [votedFor EXCEPT ![self] = Nil]
                                                                               /\ LET leader5 == [leader EXCEPT ![self] = Nil] IN
                                                                                    LET i == self IN
                                                                                      LET j == (m[self]).msource IN
                                                                                        LET logOK == (((m[self]).mprevLogIndex) = (0)) \/ (((((m[self]).mprevLogIndex) > (0)) /\ (((m[self]).mprevLogIndex) <= (Len((log)[i])))) /\ (((m[self]).mprevLogTerm) = ((((log)[i])[(m[self]).mprevLogIndex]).term))) IN
                                                                                          /\ Assert(((m[self]).mterm) <= ((currentTerm')[i]), 
                                                                                                    "Failure of assertion at line 7536, column 21.")
                                                                                          /\ IF ((m[self]).mterm) = ((currentTerm')[i])
                                                                                                THEN /\ leader' = [leader5 EXCEPT ![i] = (m[self]).msource]
                                                                                                     /\ LET value24 == LeaderTimeoutReset IN
                                                                                                          /\ leaderTimeout' = value24
                                                                                                          /\ IF (((m[self]).mterm) = ((currentTerm')[i])) /\ (((state5)[i]) = (Candidate))
                                                                                                                THEN /\ state' = [state5 EXCEPT ![i] = Follower]
                                                                                                                     /\ IF (((m[self]).mterm) < ((currentTerm')[i])) \/ (((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state')[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                           THEN /\ \/ /\ LET value316 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                           /\ ((network)[j]).enabled
                                                                                                                                           /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                           /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value316})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                   \/ /\ \/ /\ LET yielded_fd125 == FALSE IN
                                                                                                                                                 /\ yielded_fd125
                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                         \/ /\ LET yielded_fd218 == TRUE IN
                                                                                                                                                 /\ yielded_fd218
                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                      /\ UNCHANGED network
                                                                                                                                /\ UNCHANGED << commitIndex, 
                                                                                                                                                log, 
                                                                                                                                                plog, 
                                                                                                                                                sm, 
                                                                                                                                                smDomain >>
                                                                                                                           ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state')[i]) = (Follower))) /\ (logOK), 
                                                                                                                                          "Failure of assertion at line 7565, column 29.")
                                                                                                                                /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                     LET value416 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                       IF ((value416).cmd) = (LogConcat)
                                                                                                                                          THEN /\ LET plog56 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value416).entries)] IN
                                                                                                                                                    LET log72 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                      LET value548 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                        IF ((value548).cmd) = (LogConcat)
                                                                                                                                                           THEN /\ plog' = [plog56 EXCEPT ![i] = ((plog56)[i]) \o ((value548).entries)]
                                                                                                                                                                /\ log' = [log72 EXCEPT ![i] = ((log72)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                          "Failure of assertion at line 7579, column 37.")
                                                                                                                                                                /\ LET result168 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                     /\ sm' = [sm EXCEPT ![i] = (result168)[1]]
                                                                                                                                                                     /\ smDomain' = [smDomain EXCEPT ![i] = (result168)[2]]
                                                                                                                                                                     /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                     /\ \/ /\ LET value6144 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                /\ ((network)[j]).enabled
                                                                                                                                                                                /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6144})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                        \/ /\ \/ /\ LET yielded_fd3144 == FALSE IN
                                                                                                                                                                                      /\ yielded_fd3144
                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                              \/ /\ LET yielded_fd4144 == TRUE IN
                                                                                                                                                                                      /\ yielded_fd4144
                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                           /\ UNCHANGED network
                                                                                                                                                           ELSE /\ IF ((value548).cmd) = (LogPop)
                                                                                                                                                                      THEN /\ plog' = [plog56 EXCEPT ![i] = SubSeq((plog56)[i], 1, (Len((plog56)[i])) - ((value548).cnt))]
                                                                                                                                                                           /\ log' = [log72 EXCEPT ![i] = ((log72)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                           /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                     "Failure of assertion at line 7609, column 39.")
                                                                                                                                                                           /\ LET result169 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                /\ sm' = [sm EXCEPT ![i] = (result169)[1]]
                                                                                                                                                                                /\ smDomain' = [smDomain EXCEPT ![i] = (result169)[2]]
                                                                                                                                                                                /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                /\ \/ /\ LET value6145 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                           /\ ((network)[j]).enabled
                                                                                                                                                                                           /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                           /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6145})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                   \/ /\ \/ /\ LET yielded_fd3145 == FALSE IN
                                                                                                                                                                                                 /\ yielded_fd3145
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ LET yielded_fd4145 == TRUE IN
                                                                                                                                                                                                 /\ yielded_fd4145
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                      /\ UNCHANGED network
                                                                                                                                                                      ELSE /\ log' = [log72 EXCEPT ![i] = ((log72)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                           /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                     "Failure of assertion at line 7637, column 39.")
                                                                                                                                                                           /\ LET result170 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                /\ sm' = [sm EXCEPT ![i] = (result170)[1]]
                                                                                                                                                                                /\ smDomain' = [smDomain EXCEPT ![i] = (result170)[2]]
                                                                                                                                                                                /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                /\ \/ /\ LET value6146 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                           /\ ((network)[j]).enabled
                                                                                                                                                                                           /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                           /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6146})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                           /\ plog' = plog56
                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                   \/ /\ \/ /\ LET yielded_fd3146 == FALSE IN
                                                                                                                                                                                                 /\ yielded_fd3146
                                                                                                                                                                                                 /\ plog' = plog56
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ LET yielded_fd4146 == TRUE IN
                                                                                                                                                                                                 /\ yielded_fd4146
                                                                                                                                                                                                 /\ plog' = plog56
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                      /\ UNCHANGED network
                                                                                                                                          ELSE /\ IF ((value416).cmd) = (LogPop)
                                                                                                                                                     THEN /\ LET plog57 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value416).cnt))] IN
                                                                                                                                                               LET log73 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                 LET value549 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                   IF ((value549).cmd) = (LogConcat)
                                                                                                                                                                      THEN /\ plog' = [plog57 EXCEPT ![i] = ((plog57)[i]) \o ((value549).entries)]
                                                                                                                                                                           /\ log' = [log73 EXCEPT ![i] = ((log73)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                           /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                     "Failure of assertion at line 7679, column 39.")
                                                                                                                                                                           /\ LET result171 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                /\ sm' = [sm EXCEPT ![i] = (result171)[1]]
                                                                                                                                                                                /\ smDomain' = [smDomain EXCEPT ![i] = (result171)[2]]
                                                                                                                                                                                /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                /\ \/ /\ LET value6147 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                           /\ ((network)[j]).enabled
                                                                                                                                                                                           /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                           /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6147})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                   \/ /\ \/ /\ LET yielded_fd3147 == FALSE IN
                                                                                                                                                                                                 /\ yielded_fd3147
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ LET yielded_fd4147 == TRUE IN
                                                                                                                                                                                                 /\ yielded_fd4147
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                      /\ UNCHANGED network
                                                                                                                                                                      ELSE /\ IF ((value549).cmd) = (LogPop)
                                                                                                                                                                                 THEN /\ plog' = [plog57 EXCEPT ![i] = SubSeq((plog57)[i], 1, (Len((plog57)[i])) - ((value549).cnt))]
                                                                                                                                                                                      /\ log' = [log73 EXCEPT ![i] = ((log73)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                "Failure of assertion at line 7709, column 41.")
                                                                                                                                                                                      /\ LET result172 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result172)[1]]
                                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result172)[2]]
                                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                           /\ \/ /\ LET value6148 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6148})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd3148 == FALSE IN
                                                                                                                                                                                                            /\ yielded_fd3148
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ LET yielded_fd4148 == TRUE IN
                                                                                                                                                                                                            /\ yielded_fd4148
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                                                 ELSE /\ log' = [log73 EXCEPT ![i] = ((log73)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                "Failure of assertion at line 7737, column 41.")
                                                                                                                                                                                      /\ LET result173 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result173)[1]]
                                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result173)[2]]
                                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                           /\ \/ /\ LET value6149 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6149})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                      /\ plog' = plog57
                                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd3149 == FALSE IN
                                                                                                                                                                                                            /\ yielded_fd3149
                                                                                                                                                                                                            /\ plog' = plog57
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ LET yielded_fd4149 == TRUE IN
                                                                                                                                                                                                            /\ yielded_fd4149
                                                                                                                                                                                                            /\ plog' = plog57
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                     ELSE /\ LET log74 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                               LET value550 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                 IF ((value550).cmd) = (LogConcat)
                                                                                                                                                                    THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value550).entries)]
                                                                                                                                                                         /\ log' = [log74 EXCEPT ![i] = ((log74)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                         /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                   "Failure of assertion at line 7777, column 39.")
                                                                                                                                                                         /\ LET result174 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                              /\ sm' = [sm EXCEPT ![i] = (result174)[1]]
                                                                                                                                                                              /\ smDomain' = [smDomain EXCEPT ![i] = (result174)[2]]
                                                                                                                                                                              /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                              /\ \/ /\ LET value6150 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                         /\ ((network)[j]).enabled
                                                                                                                                                                                         /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                         /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6150})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                 \/ /\ \/ /\ LET yielded_fd3150 == FALSE IN
                                                                                                                                                                                               /\ yielded_fd3150
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       \/ /\ LET yielded_fd4150 == TRUE IN
                                                                                                                                                                                               /\ yielded_fd4150
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    /\ UNCHANGED network
                                                                                                                                                                    ELSE /\ IF ((value550).cmd) = (LogPop)
                                                                                                                                                                               THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value550).cnt))]
                                                                                                                                                                                    /\ log' = [log74 EXCEPT ![i] = ((log74)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                    /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                              "Failure of assertion at line 7807, column 41.")
                                                                                                                                                                                    /\ LET result175 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                         /\ sm' = [sm EXCEPT ![i] = (result175)[1]]
                                                                                                                                                                                         /\ smDomain' = [smDomain EXCEPT ![i] = (result175)[2]]
                                                                                                                                                                                         /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                         /\ \/ /\ LET value6151 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6151})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            \/ /\ \/ /\ LET yielded_fd3151 == FALSE IN
                                                                                                                                                                                                          /\ yielded_fd3151
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  \/ /\ LET yielded_fd4151 == TRUE IN
                                                                                                                                                                                                          /\ yielded_fd4151
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               /\ UNCHANGED network
                                                                                                                                                                               ELSE /\ log' = [log74 EXCEPT ![i] = ((log74)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                    /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                              "Failure of assertion at line 7835, column 41.")
                                                                                                                                                                                    /\ LET result176 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                         /\ sm' = [sm EXCEPT ![i] = (result176)[1]]
                                                                                                                                                                                         /\ smDomain' = [smDomain EXCEPT ![i] = (result176)[2]]
                                                                                                                                                                                         /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                         /\ \/ /\ LET value6152 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6152})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            \/ /\ \/ /\ LET yielded_fd3152 == FALSE IN
                                                                                                                                                                                                          /\ yielded_fd3152
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  \/ /\ LET yielded_fd4152 == TRUE IN
                                                                                                                                                                                                          /\ yielded_fd4152
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               /\ UNCHANGED network
                                                                                                                                                                                    /\ plog' = plog
                                                                                                                ELSE /\ IF (((m[self]).mterm) < ((currentTerm')[i])) \/ (((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state5)[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                           THEN /\ \/ /\ LET value317 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                           /\ ((network)[j]).enabled
                                                                                                                                           /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                           /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value317})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                           /\ state' = state5
                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                   \/ /\ \/ /\ LET yielded_fd126 == FALSE IN
                                                                                                                                                 /\ yielded_fd126
                                                                                                                                                 /\ state' = state5
                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                         \/ /\ LET yielded_fd219 == TRUE IN
                                                                                                                                                 /\ yielded_fd219
                                                                                                                                                 /\ state' = state5
                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                      /\ UNCHANGED network
                                                                                                                                /\ UNCHANGED << commitIndex, 
                                                                                                                                                log, 
                                                                                                                                                plog, 
                                                                                                                                                sm, 
                                                                                                                                                smDomain >>
                                                                                                                           ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state5)[i]) = (Follower))) /\ (logOK), 
                                                                                                                                          "Failure of assertion at line 7894, column 29.")
                                                                                                                                /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                     LET value417 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                       IF ((value417).cmd) = (LogConcat)
                                                                                                                                          THEN /\ LET plog58 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value417).entries)] IN
                                                                                                                                                    LET log75 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                      LET value551 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                        IF ((value551).cmd) = (LogConcat)
                                                                                                                                                           THEN /\ plog' = [plog58 EXCEPT ![i] = ((plog58)[i]) \o ((value551).entries)]
                                                                                                                                                                /\ log' = [log75 EXCEPT ![i] = ((log75)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                          "Failure of assertion at line 7908, column 37.")
                                                                                                                                                                /\ LET result177 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                     /\ sm' = [sm EXCEPT ![i] = (result177)[1]]
                                                                                                                                                                     /\ smDomain' = [smDomain EXCEPT ![i] = (result177)[2]]
                                                                                                                                                                     /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                     /\ \/ /\ LET value6153 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                /\ ((network)[j]).enabled
                                                                                                                                                                                /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6153})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                /\ state' = state5
                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                        \/ /\ \/ /\ LET yielded_fd3153 == FALSE IN
                                                                                                                                                                                      /\ yielded_fd3153
                                                                                                                                                                                      /\ state' = state5
                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                              \/ /\ LET yielded_fd4153 == TRUE IN
                                                                                                                                                                                      /\ yielded_fd4153
                                                                                                                                                                                      /\ state' = state5
                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                           /\ UNCHANGED network
                                                                                                                                                           ELSE /\ IF ((value551).cmd) = (LogPop)
                                                                                                                                                                      THEN /\ plog' = [plog58 EXCEPT ![i] = SubSeq((plog58)[i], 1, (Len((plog58)[i])) - ((value551).cnt))]
                                                                                                                                                                           /\ log' = [log75 EXCEPT ![i] = ((log75)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                           /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                     "Failure of assertion at line 7941, column 39.")
                                                                                                                                                                           /\ LET result178 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                /\ sm' = [sm EXCEPT ![i] = (result178)[1]]
                                                                                                                                                                                /\ smDomain' = [smDomain EXCEPT ![i] = (result178)[2]]
                                                                                                                                                                                /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                /\ \/ /\ LET value6154 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                           /\ ((network)[j]).enabled
                                                                                                                                                                                           /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                           /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6154})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                           /\ state' = state5
                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                   \/ /\ \/ /\ LET yielded_fd3154 == FALSE IN
                                                                                                                                                                                                 /\ yielded_fd3154
                                                                                                                                                                                                 /\ state' = state5
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ LET yielded_fd4154 == TRUE IN
                                                                                                                                                                                                 /\ yielded_fd4154
                                                                                                                                                                                                 /\ state' = state5
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                      /\ UNCHANGED network
                                                                                                                                                                      ELSE /\ log' = [log75 EXCEPT ![i] = ((log75)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                           /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                     "Failure of assertion at line 7972, column 39.")
                                                                                                                                                                           /\ LET result179 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                /\ sm' = [sm EXCEPT ![i] = (result179)[1]]
                                                                                                                                                                                /\ smDomain' = [smDomain EXCEPT ![i] = (result179)[2]]
                                                                                                                                                                                /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                /\ \/ /\ LET value6155 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                           /\ ((network)[j]).enabled
                                                                                                                                                                                           /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                           /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6155})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                           /\ plog' = plog58
                                                                                                                                                                                           /\ state' = state5
                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                   \/ /\ \/ /\ LET yielded_fd3155 == FALSE IN
                                                                                                                                                                                                 /\ yielded_fd3155
                                                                                                                                                                                                 /\ plog' = plog58
                                                                                                                                                                                                 /\ state' = state5
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ LET yielded_fd4155 == TRUE IN
                                                                                                                                                                                                 /\ yielded_fd4155
                                                                                                                                                                                                 /\ plog' = plog58
                                                                                                                                                                                                 /\ state' = state5
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                      /\ UNCHANGED network
                                                                                                                                          ELSE /\ IF ((value417).cmd) = (LogPop)
                                                                                                                                                     THEN /\ LET plog59 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value417).cnt))] IN
                                                                                                                                                               LET log76 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                                 LET value552 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                   IF ((value552).cmd) = (LogConcat)
                                                                                                                                                                      THEN /\ plog' = [plog59 EXCEPT ![i] = ((plog59)[i]) \o ((value552).entries)]
                                                                                                                                                                           /\ log' = [log76 EXCEPT ![i] = ((log76)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                           /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                     "Failure of assertion at line 8017, column 39.")
                                                                                                                                                                           /\ LET result180 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                /\ sm' = [sm EXCEPT ![i] = (result180)[1]]
                                                                                                                                                                                /\ smDomain' = [smDomain EXCEPT ![i] = (result180)[2]]
                                                                                                                                                                                /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                /\ \/ /\ LET value6156 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                           /\ ((network)[j]).enabled
                                                                                                                                                                                           /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                           /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6156})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                           /\ state' = state5
                                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                   \/ /\ \/ /\ LET yielded_fd3156 == FALSE IN
                                                                                                                                                                                                 /\ yielded_fd3156
                                                                                                                                                                                                 /\ state' = state5
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ LET yielded_fd4156 == TRUE IN
                                                                                                                                                                                                 /\ yielded_fd4156
                                                                                                                                                                                                 /\ state' = state5
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                      /\ UNCHANGED network
                                                                                                                                                                      ELSE /\ IF ((value552).cmd) = (LogPop)
                                                                                                                                                                                 THEN /\ plog' = [plog59 EXCEPT ![i] = SubSeq((plog59)[i], 1, (Len((plog59)[i])) - ((value552).cnt))]
                                                                                                                                                                                      /\ log' = [log76 EXCEPT ![i] = ((log76)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                "Failure of assertion at line 8050, column 41.")
                                                                                                                                                                                      /\ LET result181 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result181)[1]]
                                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result181)[2]]
                                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                           /\ \/ /\ LET value6157 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6157})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                      /\ state' = state5
                                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd3157 == FALSE IN
                                                                                                                                                                                                            /\ yielded_fd3157
                                                                                                                                                                                                            /\ state' = state5
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ LET yielded_fd4157 == TRUE IN
                                                                                                                                                                                                            /\ yielded_fd4157
                                                                                                                                                                                                            /\ state' = state5
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                                                 ELSE /\ log' = [log76 EXCEPT ![i] = ((log76)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                                "Failure of assertion at line 8081, column 41.")
                                                                                                                                                                                      /\ LET result182 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result182)[1]]
                                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result182)[2]]
                                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                           /\ \/ /\ LET value6158 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6158})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                      /\ plog' = plog59
                                                                                                                                                                                                      /\ state' = state5
                                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd3158 == FALSE IN
                                                                                                                                                                                                            /\ yielded_fd3158
                                                                                                                                                                                                            /\ plog' = plog59
                                                                                                                                                                                                            /\ state' = state5
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                    \/ /\ LET yielded_fd4158 == TRUE IN
                                                                                                                                                                                                            /\ yielded_fd4158
                                                                                                                                                                                                            /\ plog' = plog59
                                                                                                                                                                                                            /\ state' = state5
                                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                     ELSE /\ LET log77 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                               LET value553 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                                 IF ((value553).cmd) = (LogConcat)
                                                                                                                                                                    THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value553).entries)]
                                                                                                                                                                         /\ log' = [log77 EXCEPT ![i] = ((log77)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                         /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                   "Failure of assertion at line 8124, column 39.")
                                                                                                                                                                         /\ LET result183 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                              /\ sm' = [sm EXCEPT ![i] = (result183)[1]]
                                                                                                                                                                              /\ smDomain' = [smDomain EXCEPT ![i] = (result183)[2]]
                                                                                                                                                                              /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                              /\ \/ /\ LET value6159 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                         /\ ((network)[j]).enabled
                                                                                                                                                                                         /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                         /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6159})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                         /\ state' = state5
                                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                 \/ /\ \/ /\ LET yielded_fd3159 == FALSE IN
                                                                                                                                                                                               /\ yielded_fd3159
                                                                                                                                                                                               /\ state' = state5
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       \/ /\ LET yielded_fd4159 == TRUE IN
                                                                                                                                                                                               /\ yielded_fd4159
                                                                                                                                                                                               /\ state' = state5
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    /\ UNCHANGED network
                                                                                                                                                                    ELSE /\ IF ((value553).cmd) = (LogPop)
                                                                                                                                                                               THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value553).cnt))]
                                                                                                                                                                                    /\ log' = [log77 EXCEPT ![i] = ((log77)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                    /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                              "Failure of assertion at line 8157, column 41.")
                                                                                                                                                                                    /\ LET result184 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                         /\ sm' = [sm EXCEPT ![i] = (result184)[1]]
                                                                                                                                                                                         /\ smDomain' = [smDomain EXCEPT ![i] = (result184)[2]]
                                                                                                                                                                                         /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                         /\ \/ /\ LET value6160 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6160})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                    /\ state' = state5
                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            \/ /\ \/ /\ LET yielded_fd3160 == FALSE IN
                                                                                                                                                                                                          /\ yielded_fd3160
                                                                                                                                                                                                          /\ state' = state5
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  \/ /\ LET yielded_fd4160 == TRUE IN
                                                                                                                                                                                                          /\ yielded_fd4160
                                                                                                                                                                                                          /\ state' = state5
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               /\ UNCHANGED network
                                                                                                                                                                               ELSE /\ log' = [log77 EXCEPT ![i] = ((log77)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                    /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                              "Failure of assertion at line 8188, column 41.")
                                                                                                                                                                                    /\ LET result185 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                         /\ sm' = [sm EXCEPT ![i] = (result185)[1]]
                                                                                                                                                                                         /\ smDomain' = [smDomain EXCEPT ![i] = (result185)[2]]
                                                                                                                                                                                         /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                         /\ \/ /\ LET value6161 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6161})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                    /\ state' = state5
                                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            \/ /\ \/ /\ LET yielded_fd3161 == FALSE IN
                                                                                                                                                                                                          /\ yielded_fd3161
                                                                                                                                                                                                          /\ state' = state5
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                                  \/ /\ LET yielded_fd4161 == TRUE IN
                                                                                                                                                                                                          /\ yielded_fd4161
                                                                                                                                                                                                          /\ state' = state5
                                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               /\ UNCHANGED network
                                                                                                                                                                                    /\ plog' = plog
                                                                                                ELSE /\ IF (((m[self]).mterm) = ((currentTerm')[i])) /\ (((state5)[i]) = (Candidate))
                                                                                                           THEN /\ state' = [state5 EXCEPT ![i] = Follower]
                                                                                                                /\ IF (((m[self]).mterm) < ((currentTerm')[i])) \/ (((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state')[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                      THEN /\ \/ /\ LET value318 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value318})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                      /\ leader' = leader5
                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                              \/ /\ \/ /\ LET yielded_fd127 == FALSE IN
                                                                                                                                            /\ yielded_fd127
                                                                                                                                            /\ leader' = leader5
                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                    \/ /\ LET yielded_fd220 == TRUE IN
                                                                                                                                            /\ yielded_fd220
                                                                                                                                            /\ leader' = leader5
                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                 /\ UNCHANGED network
                                                                                                                           /\ UNCHANGED << commitIndex, 
                                                                                                                                           log, 
                                                                                                                                           plog, 
                                                                                                                                           sm, 
                                                                                                                                           smDomain >>
                                                                                                                      ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state')[i]) = (Follower))) /\ (logOK), 
                                                                                                                                     "Failure of assertion at line 8254, column 27.")
                                                                                                                           /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                LET value418 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                  IF ((value418).cmd) = (LogConcat)
                                                                                                                                     THEN /\ LET plog60 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value418).entries)] IN
                                                                                                                                               LET log78 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                 LET value554 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                   IF ((value554).cmd) = (LogConcat)
                                                                                                                                                      THEN /\ plog' = [plog60 EXCEPT ![i] = ((plog60)[i]) \o ((value554).entries)]
                                                                                                                                                           /\ log' = [log78 EXCEPT ![i] = ((log78)[i]) \o ((m[self]).mentries)]
                                                                                                                                                           /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                     "Failure of assertion at line 8268, column 35.")
                                                                                                                                                           /\ LET result186 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                /\ sm' = [sm EXCEPT ![i] = (result186)[1]]
                                                                                                                                                                /\ smDomain' = [smDomain EXCEPT ![i] = (result186)[2]]
                                                                                                                                                                /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                /\ \/ /\ LET value6162 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                           /\ ((network)[j]).enabled
                                                                                                                                                                           /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                           /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6162})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                           /\ leader' = leader5
                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                   \/ /\ \/ /\ LET yielded_fd3162 == FALSE IN
                                                                                                                                                                                 /\ yielded_fd3162
                                                                                                                                                                                 /\ leader' = leader5
                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                         \/ /\ LET yielded_fd4162 == TRUE IN
                                                                                                                                                                                 /\ yielded_fd4162
                                                                                                                                                                                 /\ leader' = leader5
                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                      /\ UNCHANGED network
                                                                                                                                                      ELSE /\ IF ((value554).cmd) = (LogPop)
                                                                                                                                                                 THEN /\ plog' = [plog60 EXCEPT ![i] = SubSeq((plog60)[i], 1, (Len((plog60)[i])) - ((value554).cnt))]
                                                                                                                                                                      /\ log' = [log78 EXCEPT ![i] = ((log78)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                "Failure of assertion at line 8301, column 37.")
                                                                                                                                                                      /\ LET result187 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result187)[1]]
                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result187)[2]]
                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                           /\ \/ /\ LET value6163 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6163})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                      /\ leader' = leader5
                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd3163 == FALSE IN
                                                                                                                                                                                            /\ yielded_fd3163
                                                                                                                                                                                            /\ leader' = leader5
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ LET yielded_fd4163 == TRUE IN
                                                                                                                                                                                            /\ yielded_fd4163
                                                                                                                                                                                            /\ leader' = leader5
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                                 ELSE /\ log' = [log78 EXCEPT ![i] = ((log78)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                "Failure of assertion at line 8332, column 37.")
                                                                                                                                                                      /\ LET result188 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result188)[1]]
                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result188)[2]]
                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                           /\ \/ /\ LET value6164 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6164})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                      /\ plog' = plog60
                                                                                                                                                                                      /\ leader' = leader5
                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd3164 == FALSE IN
                                                                                                                                                                                            /\ yielded_fd3164
                                                                                                                                                                                            /\ plog' = plog60
                                                                                                                                                                                            /\ leader' = leader5
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ LET yielded_fd4164 == TRUE IN
                                                                                                                                                                                            /\ yielded_fd4164
                                                                                                                                                                                            /\ plog' = plog60
                                                                                                                                                                                            /\ leader' = leader5
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                     ELSE /\ IF ((value418).cmd) = (LogPop)
                                                                                                                                                THEN /\ LET plog61 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value418).cnt))] IN
                                                                                                                                                          LET log79 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                            LET value555 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                              IF ((value555).cmd) = (LogConcat)
                                                                                                                                                                 THEN /\ plog' = [plog61 EXCEPT ![i] = ((plog61)[i]) \o ((value555).entries)]
                                                                                                                                                                      /\ log' = [log79 EXCEPT ![i] = ((log79)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                "Failure of assertion at line 8377, column 37.")
                                                                                                                                                                      /\ LET result189 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result189)[1]]
                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result189)[2]]
                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                           /\ \/ /\ LET value6165 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6165})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                      /\ leader' = leader5
                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd3165 == FALSE IN
                                                                                                                                                                                            /\ yielded_fd3165
                                                                                                                                                                                            /\ leader' = leader5
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ LET yielded_fd4165 == TRUE IN
                                                                                                                                                                                            /\ yielded_fd4165
                                                                                                                                                                                            /\ leader' = leader5
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                                 ELSE /\ IF ((value555).cmd) = (LogPop)
                                                                                                                                                                            THEN /\ plog' = [plog61 EXCEPT ![i] = SubSeq((plog61)[i], 1, (Len((plog61)[i])) - ((value555).cnt))]
                                                                                                                                                                                 /\ log' = [log79 EXCEPT ![i] = ((log79)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 8410, column 39.")
                                                                                                                                                                                 /\ LET result190 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result190)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result190)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value6166 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6166})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ leader' = leader5
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd3166 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd3166
                                                                                                                                                                                                       /\ leader' = leader5
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd4166 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd4166
                                                                                                                                                                                                       /\ leader' = leader5
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                            ELSE /\ log' = [log79 EXCEPT ![i] = ((log79)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 8441, column 39.")
                                                                                                                                                                                 /\ LET result191 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result191)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result191)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value6167 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6167})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ plog' = plog61
                                                                                                                                                                                                 /\ leader' = leader5
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd3167 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd3167
                                                                                                                                                                                                       /\ plog' = plog61
                                                                                                                                                                                                       /\ leader' = leader5
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd4167 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd4167
                                                                                                                                                                                                       /\ plog' = plog61
                                                                                                                                                                                                       /\ leader' = leader5
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                ELSE /\ LET log80 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                          LET value556 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                            IF ((value556).cmd) = (LogConcat)
                                                                                                                                                               THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value556).entries)]
                                                                                                                                                                    /\ log' = [log80 EXCEPT ![i] = ((log80)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                    /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                              "Failure of assertion at line 8484, column 37.")
                                                                                                                                                                    /\ LET result192 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                         /\ sm' = [sm EXCEPT ![i] = (result192)[1]]
                                                                                                                                                                         /\ smDomain' = [smDomain EXCEPT ![i] = (result192)[2]]
                                                                                                                                                                         /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                         /\ \/ /\ LET value6168 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6168})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                    /\ leader' = leader5
                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                            \/ /\ \/ /\ LET yielded_fd3168 == FALSE IN
                                                                                                                                                                                          /\ yielded_fd3168
                                                                                                                                                                                          /\ leader' = leader5
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ LET yielded_fd4168 == TRUE IN
                                                                                                                                                                                          /\ yielded_fd4168
                                                                                                                                                                                          /\ leader' = leader5
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                               /\ UNCHANGED network
                                                                                                                                                               ELSE /\ IF ((value556).cmd) = (LogPop)
                                                                                                                                                                          THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value556).cnt))]
                                                                                                                                                                               /\ log' = [log80 EXCEPT ![i] = ((log80)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                         "Failure of assertion at line 8517, column 39.")
                                                                                                                                                                               /\ LET result193 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result193)[1]]
                                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result193)[2]]
                                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                    /\ \/ /\ LET value6169 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6169})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                               /\ leader' = leader5
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3169 == FALSE IN
                                                                                                                                                                                                     /\ yielded_fd3169
                                                                                                                                                                                                     /\ leader' = leader5
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ LET yielded_fd4169 == TRUE IN
                                                                                                                                                                                                     /\ yielded_fd4169
                                                                                                                                                                                                     /\ leader' = leader5
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                                                          ELSE /\ log' = [log80 EXCEPT ![i] = ((log80)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                         "Failure of assertion at line 8548, column 39.")
                                                                                                                                                                               /\ LET result194 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result194)[1]]
                                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result194)[2]]
                                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                    /\ \/ /\ LET value6170 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6170})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                               /\ leader' = leader5
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3170 == FALSE IN
                                                                                                                                                                                                     /\ yielded_fd3170
                                                                                                                                                                                                     /\ leader' = leader5
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ LET yielded_fd4170 == TRUE IN
                                                                                                                                                                                                     /\ yielded_fd4170
                                                                                                                                                                                                     /\ leader' = leader5
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                                                               /\ plog' = plog
                                                                                                           ELSE /\ IF (((m[self]).mterm) < ((currentTerm')[i])) \/ (((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state5)[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                      THEN /\ \/ /\ LET value319 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value319})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                      /\ leader' = leader5
                                                                                                                                      /\ state' = state5
                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                              \/ /\ \/ /\ LET yielded_fd128 == FALSE IN
                                                                                                                                            /\ yielded_fd128
                                                                                                                                            /\ leader' = leader5
                                                                                                                                            /\ state' = state5
                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                    \/ /\ LET yielded_fd221 == TRUE IN
                                                                                                                                            /\ yielded_fd221
                                                                                                                                            /\ leader' = leader5
                                                                                                                                            /\ state' = state5
                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                 /\ UNCHANGED network
                                                                                                                           /\ UNCHANGED << commitIndex, 
                                                                                                                                           log, 
                                                                                                                                           plog, 
                                                                                                                                           sm, 
                                                                                                                                           smDomain >>
                                                                                                                      ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm')[i])) /\ (((state5)[i]) = (Follower))) /\ (logOK), 
                                                                                                                                     "Failure of assertion at line 8613, column 27.")
                                                                                                                           /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                                LET value419 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                  IF ((value419).cmd) = (LogConcat)
                                                                                                                                     THEN /\ LET plog62 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value419).entries)] IN
                                                                                                                                               LET log81 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                 LET value557 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                   IF ((value557).cmd) = (LogConcat)
                                                                                                                                                      THEN /\ plog' = [plog62 EXCEPT ![i] = ((plog62)[i]) \o ((value557).entries)]
                                                                                                                                                           /\ log' = [log81 EXCEPT ![i] = ((log81)[i]) \o ((m[self]).mentries)]
                                                                                                                                                           /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                     "Failure of assertion at line 8627, column 35.")
                                                                                                                                                           /\ LET result195 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                /\ sm' = [sm EXCEPT ![i] = (result195)[1]]
                                                                                                                                                                /\ smDomain' = [smDomain EXCEPT ![i] = (result195)[2]]
                                                                                                                                                                /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                /\ \/ /\ LET value6171 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                           /\ ((network)[j]).enabled
                                                                                                                                                                           /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                           /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6171})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                           /\ leader' = leader5
                                                                                                                                                                           /\ state' = state5
                                                                                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                   \/ /\ \/ /\ LET yielded_fd3171 == FALSE IN
                                                                                                                                                                                 /\ yielded_fd3171
                                                                                                                                                                                 /\ leader' = leader5
                                                                                                                                                                                 /\ state' = state5
                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                         \/ /\ LET yielded_fd4171 == TRUE IN
                                                                                                                                                                                 /\ yielded_fd4171
                                                                                                                                                                                 /\ leader' = leader5
                                                                                                                                                                                 /\ state' = state5
                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                      /\ UNCHANGED network
                                                                                                                                                      ELSE /\ IF ((value557).cmd) = (LogPop)
                                                                                                                                                                 THEN /\ plog' = [plog62 EXCEPT ![i] = SubSeq((plog62)[i], 1, (Len((plog62)[i])) - ((value557).cnt))]
                                                                                                                                                                      /\ log' = [log81 EXCEPT ![i] = ((log81)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                "Failure of assertion at line 8663, column 37.")
                                                                                                                                                                      /\ LET result196 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result196)[1]]
                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result196)[2]]
                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                           /\ \/ /\ LET value6172 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6172})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                      /\ leader' = leader5
                                                                                                                                                                                      /\ state' = state5
                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd3172 == FALSE IN
                                                                                                                                                                                            /\ yielded_fd3172
                                                                                                                                                                                            /\ leader' = leader5
                                                                                                                                                                                            /\ state' = state5
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ LET yielded_fd4172 == TRUE IN
                                                                                                                                                                                            /\ yielded_fd4172
                                                                                                                                                                                            /\ leader' = leader5
                                                                                                                                                                                            /\ state' = state5
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                                 ELSE /\ log' = [log81 EXCEPT ![i] = ((log81)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                "Failure of assertion at line 8697, column 37.")
                                                                                                                                                                      /\ LET result197 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result197)[1]]
                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result197)[2]]
                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                           /\ \/ /\ LET value6173 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6173})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                      /\ plog' = plog62
                                                                                                                                                                                      /\ leader' = leader5
                                                                                                                                                                                      /\ state' = state5
                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd3173 == FALSE IN
                                                                                                                                                                                            /\ yielded_fd3173
                                                                                                                                                                                            /\ plog' = plog62
                                                                                                                                                                                            /\ leader' = leader5
                                                                                                                                                                                            /\ state' = state5
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ LET yielded_fd4173 == TRUE IN
                                                                                                                                                                                            /\ yielded_fd4173
                                                                                                                                                                                            /\ plog' = plog62
                                                                                                                                                                                            /\ leader' = leader5
                                                                                                                                                                                            /\ state' = state5
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                     ELSE /\ IF ((value419).cmd) = (LogPop)
                                                                                                                                                THEN /\ LET plog63 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value419).cnt))] IN
                                                                                                                                                          LET log82 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                            LET value558 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                              IF ((value558).cmd) = (LogConcat)
                                                                                                                                                                 THEN /\ plog' = [plog63 EXCEPT ![i] = ((plog63)[i]) \o ((value558).entries)]
                                                                                                                                                                      /\ log' = [log82 EXCEPT ![i] = ((log82)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                      /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                "Failure of assertion at line 8745, column 37.")
                                                                                                                                                                      /\ LET result198 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                           /\ sm' = [sm EXCEPT ![i] = (result198)[1]]
                                                                                                                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = (result198)[2]]
                                                                                                                                                                           /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                           /\ \/ /\ LET value6174 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                      /\ ((network)[j]).enabled
                                                                                                                                                                                      /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                      /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6174})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                      /\ leader' = leader5
                                                                                                                                                                                      /\ state' = state5
                                                                                                                                                                                      /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                              \/ /\ \/ /\ LET yielded_fd3174 == FALSE IN
                                                                                                                                                                                            /\ yielded_fd3174
                                                                                                                                                                                            /\ leader' = leader5
                                                                                                                                                                                            /\ state' = state5
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                    \/ /\ LET yielded_fd4174 == TRUE IN
                                                                                                                                                                                            /\ yielded_fd4174
                                                                                                                                                                                            /\ leader' = leader5
                                                                                                                                                                                            /\ state' = state5
                                                                                                                                                                                            /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                 /\ UNCHANGED network
                                                                                                                                                                 ELSE /\ IF ((value558).cmd) = (LogPop)
                                                                                                                                                                            THEN /\ plog' = [plog63 EXCEPT ![i] = SubSeq((plog63)[i], 1, (Len((plog63)[i])) - ((value558).cnt))]
                                                                                                                                                                                 /\ log' = [log82 EXCEPT ![i] = ((log82)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 8781, column 39.")
                                                                                                                                                                                 /\ LET result199 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result199)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result199)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value6175 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6175})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ leader' = leader5
                                                                                                                                                                                                 /\ state' = state5
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd3175 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd3175
                                                                                                                                                                                                       /\ leader' = leader5
                                                                                                                                                                                                       /\ state' = state5
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd4175 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd4175
                                                                                                                                                                                                       /\ leader' = leader5
                                                                                                                                                                                                       /\ state' = state5
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                                            ELSE /\ log' = [log82 EXCEPT ![i] = ((log82)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                                 /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                           "Failure of assertion at line 8815, column 39.")
                                                                                                                                                                                 /\ LET result200 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                      /\ sm' = [sm EXCEPT ![i] = (result200)[1]]
                                                                                                                                                                                      /\ smDomain' = [smDomain EXCEPT ![i] = (result200)[2]]
                                                                                                                                                                                      /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                      /\ \/ /\ LET value6176 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                                 /\ ((network)[j]).enabled
                                                                                                                                                                                                 /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                                 /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6176})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                                 /\ plog' = plog63
                                                                                                                                                                                                 /\ leader' = leader5
                                                                                                                                                                                                 /\ state' = state5
                                                                                                                                                                                                 /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                         \/ /\ \/ /\ LET yielded_fd3176 == FALSE IN
                                                                                                                                                                                                       /\ yielded_fd3176
                                                                                                                                                                                                       /\ plog' = plog63
                                                                                                                                                                                                       /\ leader' = leader5
                                                                                                                                                                                                       /\ state' = state5
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                               \/ /\ LET yielded_fd4176 == TRUE IN
                                                                                                                                                                                                       /\ yielded_fd4176
                                                                                                                                                                                                       /\ plog' = plog63
                                                                                                                                                                                                       /\ leader' = leader5
                                                                                                                                                                                                       /\ state' = state5
                                                                                                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                            /\ UNCHANGED network
                                                                                                                                                ELSE /\ LET log83 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                          LET value559 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                            IF ((value559).cmd) = (LogConcat)
                                                                                                                                                               THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value559).entries)]
                                                                                                                                                                    /\ log' = [log83 EXCEPT ![i] = ((log83)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                    /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                              "Failure of assertion at line 8861, column 37.")
                                                                                                                                                                    /\ LET result201 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                         /\ sm' = [sm EXCEPT ![i] = (result201)[1]]
                                                                                                                                                                         /\ smDomain' = [smDomain EXCEPT ![i] = (result201)[2]]
                                                                                                                                                                         /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                         /\ \/ /\ LET value6177 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6177})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                    /\ leader' = leader5
                                                                                                                                                                                    /\ state' = state5
                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                            \/ /\ \/ /\ LET yielded_fd3177 == FALSE IN
                                                                                                                                                                                          /\ yielded_fd3177
                                                                                                                                                                                          /\ leader' = leader5
                                                                                                                                                                                          /\ state' = state5
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ LET yielded_fd4177 == TRUE IN
                                                                                                                                                                                          /\ yielded_fd4177
                                                                                                                                                                                          /\ leader' = leader5
                                                                                                                                                                                          /\ state' = state5
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                               /\ UNCHANGED network
                                                                                                                                                               ELSE /\ IF ((value559).cmd) = (LogPop)
                                                                                                                                                                          THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value559).cnt))]
                                                                                                                                                                               /\ log' = [log83 EXCEPT ![i] = ((log83)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                         "Failure of assertion at line 8897, column 39.")
                                                                                                                                                                               /\ LET result202 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result202)[1]]
                                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result202)[2]]
                                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                    /\ \/ /\ LET value6178 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6178})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                               /\ leader' = leader5
                                                                                                                                                                                               /\ state' = state5
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3178 == FALSE IN
                                                                                                                                                                                                     /\ yielded_fd3178
                                                                                                                                                                                                     /\ leader' = leader5
                                                                                                                                                                                                     /\ state' = state5
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ LET yielded_fd4178 == TRUE IN
                                                                                                                                                                                                     /\ yielded_fd4178
                                                                                                                                                                                                     /\ leader' = leader5
                                                                                                                                                                                                     /\ state' = state5
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                                                          ELSE /\ log' = [log83 EXCEPT ![i] = ((log83)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                         "Failure of assertion at line 8931, column 39.")
                                                                                                                                                                               /\ LET result203 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result203)[1]]
                                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result203)[2]]
                                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                    /\ \/ /\ LET value6179 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm')[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6179})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                               /\ leader' = leader5
                                                                                                                                                                                               /\ state' = state5
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3179 == FALSE IN
                                                                                                                                                                                                     /\ yielded_fd3179
                                                                                                                                                                                                     /\ leader' = leader5
                                                                                                                                                                                                     /\ state' = state5
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ LET yielded_fd4179 == TRUE IN
                                                                                                                                                                                                     /\ yielded_fd4179
                                                                                                                                                                                                     /\ leader' = leader5
                                                                                                                                                                                                     /\ state' = state5
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                                                               /\ plog' = plog
                                                                                                     /\ UNCHANGED leaderTimeout
                                                                     ELSE /\ LET i == self IN
                                                                               LET j == (m[self]).msource IN
                                                                                 LET logOK == (((m[self]).mprevLogIndex) = (0)) \/ (((((m[self]).mprevLogIndex) > (0)) /\ (((m[self]).mprevLogIndex) <= (Len((log)[i])))) /\ (((m[self]).mprevLogTerm) = ((((log)[i])[(m[self]).mprevLogIndex]).term))) IN
                                                                                   /\ Assert(((m[self]).mterm) <= ((currentTerm)[i]), 
                                                                                             "Failure of assertion at line 8980, column 19.")
                                                                                   /\ IF ((m[self]).mterm) = ((currentTerm)[i])
                                                                                         THEN /\ leader' = [leader EXCEPT ![i] = (m[self]).msource]
                                                                                              /\ LET value25 == LeaderTimeoutReset IN
                                                                                                   /\ leaderTimeout' = value25
                                                                                                   /\ IF (((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Candidate))
                                                                                                         THEN /\ state' = [state EXCEPT ![i] = Follower]
                                                                                                              /\ IF (((m[self]).mterm) < ((currentTerm)[i])) \/ (((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state')[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                    THEN /\ \/ /\ LET value320 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value320})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                            \/ /\ \/ /\ LET yielded_fd129 == FALSE IN
                                                                                                                                          /\ yielded_fd129
                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                  \/ /\ LET yielded_fd222 == TRUE IN
                                                                                                                                          /\ yielded_fd222
                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                               /\ UNCHANGED network
                                                                                                                         /\ UNCHANGED << commitIndex, 
                                                                                                                                         log, 
                                                                                                                                         plog, 
                                                                                                                                         sm, 
                                                                                                                                         smDomain >>
                                                                                                                    ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state')[i]) = (Follower))) /\ (logOK), 
                                                                                                                                   "Failure of assertion at line 9009, column 27.")
                                                                                                                         /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                              LET value420 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                IF ((value420).cmd) = (LogConcat)
                                                                                                                                   THEN /\ LET plog64 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value420).entries)] IN
                                                                                                                                             LET log84 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                               LET value560 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                 IF ((value560).cmd) = (LogConcat)
                                                                                                                                                    THEN /\ plog' = [plog64 EXCEPT ![i] = ((plog64)[i]) \o ((value560).entries)]
                                                                                                                                                         /\ log' = [log84 EXCEPT ![i] = ((log84)[i]) \o ((m[self]).mentries)]
                                                                                                                                                         /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                   "Failure of assertion at line 9023, column 35.")
                                                                                                                                                         /\ LET result204 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                              /\ sm' = [sm EXCEPT ![i] = (result204)[1]]
                                                                                                                                                              /\ smDomain' = [smDomain EXCEPT ![i] = (result204)[2]]
                                                                                                                                                              /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                              /\ \/ /\ LET value6180 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                         /\ ((network)[j]).enabled
                                                                                                                                                                         /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                         /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6180})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                 \/ /\ \/ /\ LET yielded_fd3180 == FALSE IN
                                                                                                                                                                               /\ yielded_fd3180
                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                       \/ /\ LET yielded_fd4180 == TRUE IN
                                                                                                                                                                               /\ yielded_fd4180
                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                    /\ UNCHANGED network
                                                                                                                                                    ELSE /\ IF ((value560).cmd) = (LogPop)
                                                                                                                                                               THEN /\ plog' = [plog64 EXCEPT ![i] = SubSeq((plog64)[i], 1, (Len((plog64)[i])) - ((value560).cnt))]
                                                                                                                                                                    /\ log' = [log84 EXCEPT ![i] = ((log84)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                    /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                              "Failure of assertion at line 9053, column 37.")
                                                                                                                                                                    /\ LET result205 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                         /\ sm' = [sm EXCEPT ![i] = (result205)[1]]
                                                                                                                                                                         /\ smDomain' = [smDomain EXCEPT ![i] = (result205)[2]]
                                                                                                                                                                         /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                         /\ \/ /\ LET value6181 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6181})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                            \/ /\ \/ /\ LET yielded_fd3181 == FALSE IN
                                                                                                                                                                                          /\ yielded_fd3181
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ LET yielded_fd4181 == TRUE IN
                                                                                                                                                                                          /\ yielded_fd4181
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                               /\ UNCHANGED network
                                                                                                                                                               ELSE /\ log' = [log84 EXCEPT ![i] = ((log84)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                    /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                              "Failure of assertion at line 9081, column 37.")
                                                                                                                                                                    /\ LET result206 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                         /\ sm' = [sm EXCEPT ![i] = (result206)[1]]
                                                                                                                                                                         /\ smDomain' = [smDomain EXCEPT ![i] = (result206)[2]]
                                                                                                                                                                         /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                         /\ \/ /\ LET value6182 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6182})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                    /\ plog' = plog64
                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                            \/ /\ \/ /\ LET yielded_fd3182 == FALSE IN
                                                                                                                                                                                          /\ yielded_fd3182
                                                                                                                                                                                          /\ plog' = plog64
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ LET yielded_fd4182 == TRUE IN
                                                                                                                                                                                          /\ yielded_fd4182
                                                                                                                                                                                          /\ plog' = plog64
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                               /\ UNCHANGED network
                                                                                                                                   ELSE /\ IF ((value420).cmd) = (LogPop)
                                                                                                                                              THEN /\ LET plog65 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value420).cnt))] IN
                                                                                                                                                        LET log85 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                          LET value561 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                            IF ((value561).cmd) = (LogConcat)
                                                                                                                                                               THEN /\ plog' = [plog65 EXCEPT ![i] = ((plog65)[i]) \o ((value561).entries)]
                                                                                                                                                                    /\ log' = [log85 EXCEPT ![i] = ((log85)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                    /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                              "Failure of assertion at line 9123, column 37.")
                                                                                                                                                                    /\ LET result207 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                         /\ sm' = [sm EXCEPT ![i] = (result207)[1]]
                                                                                                                                                                         /\ smDomain' = [smDomain EXCEPT ![i] = (result207)[2]]
                                                                                                                                                                         /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                         /\ \/ /\ LET value6183 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6183})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                            \/ /\ \/ /\ LET yielded_fd3183 == FALSE IN
                                                                                                                                                                                          /\ yielded_fd3183
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ LET yielded_fd4183 == TRUE IN
                                                                                                                                                                                          /\ yielded_fd4183
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                               /\ UNCHANGED network
                                                                                                                                                               ELSE /\ IF ((value561).cmd) = (LogPop)
                                                                                                                                                                          THEN /\ plog' = [plog65 EXCEPT ![i] = SubSeq((plog65)[i], 1, (Len((plog65)[i])) - ((value561).cnt))]
                                                                                                                                                                               /\ log' = [log85 EXCEPT ![i] = ((log85)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                         "Failure of assertion at line 9153, column 39.")
                                                                                                                                                                               /\ LET result208 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result208)[1]]
                                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result208)[2]]
                                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                    /\ \/ /\ LET value6184 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6184})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3184 == FALSE IN
                                                                                                                                                                                                     /\ yielded_fd3184
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ LET yielded_fd4184 == TRUE IN
                                                                                                                                                                                                     /\ yielded_fd4184
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                                                          ELSE /\ log' = [log85 EXCEPT ![i] = ((log85)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                         "Failure of assertion at line 9181, column 39.")
                                                                                                                                                                               /\ LET result209 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result209)[1]]
                                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result209)[2]]
                                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                    /\ \/ /\ LET value6185 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6185})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                               /\ plog' = plog65
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3185 == FALSE IN
                                                                                                                                                                                                     /\ yielded_fd3185
                                                                                                                                                                                                     /\ plog' = plog65
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ LET yielded_fd4185 == TRUE IN
                                                                                                                                                                                                     /\ yielded_fd4185
                                                                                                                                                                                                     /\ plog' = plog65
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                              ELSE /\ LET log86 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                        LET value562 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                          IF ((value562).cmd) = (LogConcat)
                                                                                                                                                             THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value562).entries)]
                                                                                                                                                                  /\ log' = [log86 EXCEPT ![i] = ((log86)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                  /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                            "Failure of assertion at line 9221, column 37.")
                                                                                                                                                                  /\ LET result210 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                       /\ sm' = [sm EXCEPT ![i] = (result210)[1]]
                                                                                                                                                                       /\ smDomain' = [smDomain EXCEPT ![i] = (result210)[2]]
                                                                                                                                                                       /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                       /\ \/ /\ LET value6186 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                  /\ ((network)[j]).enabled
                                                                                                                                                                                  /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                  /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6186})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                          \/ /\ \/ /\ LET yielded_fd3186 == FALSE IN
                                                                                                                                                                                        /\ yielded_fd3186
                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                \/ /\ LET yielded_fd4186 == TRUE IN
                                                                                                                                                                                        /\ yielded_fd4186
                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                             /\ UNCHANGED network
                                                                                                                                                             ELSE /\ IF ((value562).cmd) = (LogPop)
                                                                                                                                                                        THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value562).cnt))]
                                                                                                                                                                             /\ log' = [log86 EXCEPT ![i] = ((log86)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                             /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                       "Failure of assertion at line 9251, column 39.")
                                                                                                                                                                             /\ LET result211 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                  /\ sm' = [sm EXCEPT ![i] = (result211)[1]]
                                                                                                                                                                                  /\ smDomain' = [smDomain EXCEPT ![i] = (result211)[2]]
                                                                                                                                                                                  /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                  /\ \/ /\ LET value6187 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                             /\ ((network)[j]).enabled
                                                                                                                                                                                             /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                             /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6187})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     \/ /\ \/ /\ LET yielded_fd3187 == FALSE IN
                                                                                                                                                                                                   /\ yielded_fd3187
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ LET yielded_fd4187 == TRUE IN
                                                                                                                                                                                                   /\ yielded_fd4187
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        /\ UNCHANGED network
                                                                                                                                                                        ELSE /\ log' = [log86 EXCEPT ![i] = ((log86)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                             /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                       "Failure of assertion at line 9279, column 39.")
                                                                                                                                                                             /\ LET result212 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                  /\ sm' = [sm EXCEPT ![i] = (result212)[1]]
                                                                                                                                                                                  /\ smDomain' = [smDomain EXCEPT ![i] = (result212)[2]]
                                                                                                                                                                                  /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                  /\ \/ /\ LET value6188 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                             /\ ((network)[j]).enabled
                                                                                                                                                                                             /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                             /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6188})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     \/ /\ \/ /\ LET yielded_fd3188 == FALSE IN
                                                                                                                                                                                                   /\ yielded_fd3188
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ LET yielded_fd4188 == TRUE IN
                                                                                                                                                                                                   /\ yielded_fd4188
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        /\ UNCHANGED network
                                                                                                                                                                             /\ plog' = plog
                                                                                                         ELSE /\ IF (((m[self]).mterm) < ((currentTerm)[i])) \/ (((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                                    THEN /\ \/ /\ LET value321 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value321})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                            \/ /\ \/ /\ LET yielded_fd130 == FALSE IN
                                                                                                                                          /\ yielded_fd130
                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                  \/ /\ LET yielded_fd223 == TRUE IN
                                                                                                                                          /\ yielded_fd223
                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                               /\ UNCHANGED network
                                                                                                                         /\ UNCHANGED << commitIndex, 
                                                                                                                                         log, 
                                                                                                                                         plog, 
                                                                                                                                         sm, 
                                                                                                                                         smDomain >>
                                                                                                                    ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK), 
                                                                                                                                   "Failure of assertion at line 9335, column 27.")
                                                                                                                         /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                              LET value421 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                                IF ((value421).cmd) = (LogConcat)
                                                                                                                                   THEN /\ LET plog66 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value421).entries)] IN
                                                                                                                                             LET log87 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                               LET value563 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                 IF ((value563).cmd) = (LogConcat)
                                                                                                                                                    THEN /\ plog' = [plog66 EXCEPT ![i] = ((plog66)[i]) \o ((value563).entries)]
                                                                                                                                                         /\ log' = [log87 EXCEPT ![i] = ((log87)[i]) \o ((m[self]).mentries)]
                                                                                                                                                         /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                   "Failure of assertion at line 9349, column 35.")
                                                                                                                                                         /\ LET result213 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                              /\ sm' = [sm EXCEPT ![i] = (result213)[1]]
                                                                                                                                                              /\ smDomain' = [smDomain EXCEPT ![i] = (result213)[2]]
                                                                                                                                                              /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                              /\ \/ /\ LET value6189 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                         /\ ((network)[j]).enabled
                                                                                                                                                                         /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                         /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6189})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                         /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                 \/ /\ \/ /\ LET yielded_fd3189 == FALSE IN
                                                                                                                                                                               /\ yielded_fd3189
                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                       \/ /\ LET yielded_fd4189 == TRUE IN
                                                                                                                                                                               /\ yielded_fd4189
                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                    /\ UNCHANGED network
                                                                                                                                                    ELSE /\ IF ((value563).cmd) = (LogPop)
                                                                                                                                                               THEN /\ plog' = [plog66 EXCEPT ![i] = SubSeq((plog66)[i], 1, (Len((plog66)[i])) - ((value563).cnt))]
                                                                                                                                                                    /\ log' = [log87 EXCEPT ![i] = ((log87)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                    /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                              "Failure of assertion at line 9379, column 37.")
                                                                                                                                                                    /\ LET result214 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                         /\ sm' = [sm EXCEPT ![i] = (result214)[1]]
                                                                                                                                                                         /\ smDomain' = [smDomain EXCEPT ![i] = (result214)[2]]
                                                                                                                                                                         /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                         /\ \/ /\ LET value6190 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6190})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                            \/ /\ \/ /\ LET yielded_fd3190 == FALSE IN
                                                                                                                                                                                          /\ yielded_fd3190
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ LET yielded_fd4190 == TRUE IN
                                                                                                                                                                                          /\ yielded_fd4190
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                               /\ UNCHANGED network
                                                                                                                                                               ELSE /\ log' = [log87 EXCEPT ![i] = ((log87)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                    /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                              "Failure of assertion at line 9407, column 37.")
                                                                                                                                                                    /\ LET result215 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                         /\ sm' = [sm EXCEPT ![i] = (result215)[1]]
                                                                                                                                                                         /\ smDomain' = [smDomain EXCEPT ![i] = (result215)[2]]
                                                                                                                                                                         /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                         /\ \/ /\ LET value6191 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6191})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                    /\ plog' = plog66
                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                            \/ /\ \/ /\ LET yielded_fd3191 == FALSE IN
                                                                                                                                                                                          /\ yielded_fd3191
                                                                                                                                                                                          /\ plog' = plog66
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ LET yielded_fd4191 == TRUE IN
                                                                                                                                                                                          /\ yielded_fd4191
                                                                                                                                                                                          /\ plog' = plog66
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                               /\ UNCHANGED network
                                                                                                                                   ELSE /\ IF ((value421).cmd) = (LogPop)
                                                                                                                                              THEN /\ LET plog67 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value421).cnt))] IN
                                                                                                                                                        LET log88 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                          LET value564 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                            IF ((value564).cmd) = (LogConcat)
                                                                                                                                                               THEN /\ plog' = [plog67 EXCEPT ![i] = ((plog67)[i]) \o ((value564).entries)]
                                                                                                                                                                    /\ log' = [log88 EXCEPT ![i] = ((log88)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                    /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                              "Failure of assertion at line 9449, column 37.")
                                                                                                                                                                    /\ LET result216 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                         /\ sm' = [sm EXCEPT ![i] = (result216)[1]]
                                                                                                                                                                         /\ smDomain' = [smDomain EXCEPT ![i] = (result216)[2]]
                                                                                                                                                                         /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                         /\ \/ /\ LET value6192 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6192})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                            \/ /\ \/ /\ LET yielded_fd3192 == FALSE IN
                                                                                                                                                                                          /\ yielded_fd3192
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ LET yielded_fd4192 == TRUE IN
                                                                                                                                                                                          /\ yielded_fd4192
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                               /\ UNCHANGED network
                                                                                                                                                               ELSE /\ IF ((value564).cmd) = (LogPop)
                                                                                                                                                                          THEN /\ plog' = [plog67 EXCEPT ![i] = SubSeq((plog67)[i], 1, (Len((plog67)[i])) - ((value564).cnt))]
                                                                                                                                                                               /\ log' = [log88 EXCEPT ![i] = ((log88)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                         "Failure of assertion at line 9479, column 39.")
                                                                                                                                                                               /\ LET result217 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result217)[1]]
                                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result217)[2]]
                                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                    /\ \/ /\ LET value6193 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6193})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3193 == FALSE IN
                                                                                                                                                                                                     /\ yielded_fd3193
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ LET yielded_fd4193 == TRUE IN
                                                                                                                                                                                                     /\ yielded_fd4193
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                                                          ELSE /\ log' = [log88 EXCEPT ![i] = ((log88)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                         "Failure of assertion at line 9507, column 39.")
                                                                                                                                                                               /\ LET result218 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result218)[1]]
                                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result218)[2]]
                                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                    /\ \/ /\ LET value6194 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6194})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                               /\ plog' = plog67
                                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3194 == FALSE IN
                                                                                                                                                                                                     /\ yielded_fd3194
                                                                                                                                                                                                     /\ plog' = plog67
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                             \/ /\ LET yielded_fd4194 == TRUE IN
                                                                                                                                                                                                     /\ yielded_fd4194
                                                                                                                                                                                                     /\ plog' = plog67
                                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                              ELSE /\ LET log89 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                        LET value565 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                          IF ((value565).cmd) = (LogConcat)
                                                                                                                                                             THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value565).entries)]
                                                                                                                                                                  /\ log' = [log89 EXCEPT ![i] = ((log89)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                  /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                            "Failure of assertion at line 9547, column 37.")
                                                                                                                                                                  /\ LET result219 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                       /\ sm' = [sm EXCEPT ![i] = (result219)[1]]
                                                                                                                                                                       /\ smDomain' = [smDomain EXCEPT ![i] = (result219)[2]]
                                                                                                                                                                       /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                       /\ \/ /\ LET value6195 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                  /\ ((network)[j]).enabled
                                                                                                                                                                                  /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                  /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6195})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                          \/ /\ \/ /\ LET yielded_fd3195 == FALSE IN
                                                                                                                                                                                        /\ yielded_fd3195
                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                \/ /\ LET yielded_fd4195 == TRUE IN
                                                                                                                                                                                        /\ yielded_fd4195
                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                             /\ UNCHANGED network
                                                                                                                                                             ELSE /\ IF ((value565).cmd) = (LogPop)
                                                                                                                                                                        THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value565).cnt))]
                                                                                                                                                                             /\ log' = [log89 EXCEPT ![i] = ((log89)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                             /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                       "Failure of assertion at line 9577, column 39.")
                                                                                                                                                                             /\ LET result220 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                  /\ sm' = [sm EXCEPT ![i] = (result220)[1]]
                                                                                                                                                                                  /\ smDomain' = [smDomain EXCEPT ![i] = (result220)[2]]
                                                                                                                                                                                  /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                  /\ \/ /\ LET value6196 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                             /\ ((network)[j]).enabled
                                                                                                                                                                                             /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                             /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6196})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     \/ /\ \/ /\ LET yielded_fd3196 == FALSE IN
                                                                                                                                                                                                   /\ yielded_fd3196
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ LET yielded_fd4196 == TRUE IN
                                                                                                                                                                                                   /\ yielded_fd4196
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        /\ UNCHANGED network
                                                                                                                                                                        ELSE /\ log' = [log89 EXCEPT ![i] = ((log89)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                             /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                       "Failure of assertion at line 9605, column 39.")
                                                                                                                                                                             /\ LET result221 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                                  /\ sm' = [sm EXCEPT ![i] = (result221)[1]]
                                                                                                                                                                                  /\ smDomain' = [smDomain EXCEPT ![i] = (result221)[2]]
                                                                                                                                                                                  /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                                  /\ \/ /\ LET value6197 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                             /\ ((network)[j]).enabled
                                                                                                                                                                                             /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                             /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6197})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     \/ /\ \/ /\ LET yielded_fd3197 == FALSE IN
                                                                                                                                                                                                   /\ yielded_fd3197
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                           \/ /\ LET yielded_fd4197 == TRUE IN
                                                                                                                                                                                                   /\ yielded_fd4197
                                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        /\ UNCHANGED network
                                                                                                                                                                             /\ plog' = plog
                                                                                                              /\ state' = state
                                                                                         ELSE /\ IF (((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Candidate))
                                                                                                    THEN /\ state' = [state EXCEPT ![i] = Follower]
                                                                                                         /\ IF (((m[self]).mterm) < ((currentTerm)[i])) \/ (((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state')[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                               THEN /\ \/ /\ LET value322 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value322})), enabled |-> ((network)[j]).enabled]]
                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                       \/ /\ \/ /\ LET yielded_fd131 == FALSE IN
                                                                                                                                     /\ yielded_fd131
                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                             \/ /\ LET yielded_fd224 == TRUE IN
                                                                                                                                     /\ yielded_fd224
                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                          /\ UNCHANGED network
                                                                                                                    /\ UNCHANGED << commitIndex, 
                                                                                                                                    log, 
                                                                                                                                    plog, 
                                                                                                                                    sm, 
                                                                                                                                    smDomain >>
                                                                                                               ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state')[i]) = (Follower))) /\ (logOK), 
                                                                                                                              "Failure of assertion at line 9665, column 25.")
                                                                                                                    /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                         LET value422 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                           IF ((value422).cmd) = (LogConcat)
                                                                                                                              THEN /\ LET plog68 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value422).entries)] IN
                                                                                                                                        LET log90 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                          LET value566 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                            IF ((value566).cmd) = (LogConcat)
                                                                                                                                               THEN /\ plog' = [plog68 EXCEPT ![i] = ((plog68)[i]) \o ((value566).entries)]
                                                                                                                                                    /\ log' = [log90 EXCEPT ![i] = ((log90)[i]) \o ((m[self]).mentries)]
                                                                                                                                                    /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                              "Failure of assertion at line 9679, column 33.")
                                                                                                                                                    /\ LET result222 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                         /\ sm' = [sm EXCEPT ![i] = (result222)[1]]
                                                                                                                                                         /\ smDomain' = [smDomain EXCEPT ![i] = (result222)[2]]
                                                                                                                                                         /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                         /\ \/ /\ LET value6198 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6198})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                            \/ /\ \/ /\ LET yielded_fd3198 == FALSE IN
                                                                                                                                                                          /\ yielded_fd3198
                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                  \/ /\ LET yielded_fd4198 == TRUE IN
                                                                                                                                                                          /\ yielded_fd4198
                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                               /\ UNCHANGED network
                                                                                                                                               ELSE /\ IF ((value566).cmd) = (LogPop)
                                                                                                                                                          THEN /\ plog' = [plog68 EXCEPT ![i] = SubSeq((plog68)[i], 1, (Len((plog68)[i])) - ((value566).cnt))]
                                                                                                                                                               /\ log' = [log90 EXCEPT ![i] = ((log90)[i]) \o ((m[self]).mentries)]
                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                         "Failure of assertion at line 9709, column 35.")
                                                                                                                                                               /\ LET result223 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result223)[1]]
                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result223)[2]]
                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                    /\ \/ /\ LET value6199 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6199})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3199 == FALSE IN
                                                                                                                                                                                     /\ yielded_fd3199
                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                             \/ /\ LET yielded_fd4199 == TRUE IN
                                                                                                                                                                                     /\ yielded_fd4199
                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                                          ELSE /\ log' = [log90 EXCEPT ![i] = ((log90)[i]) \o ((m[self]).mentries)]
                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                         "Failure of assertion at line 9737, column 35.")
                                                                                                                                                               /\ LET result224 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result224)[1]]
                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result224)[2]]
                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                    /\ \/ /\ LET value6200 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6200})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                               /\ plog' = plog68
                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3200 == FALSE IN
                                                                                                                                                                                     /\ yielded_fd3200
                                                                                                                                                                                     /\ plog' = plog68
                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                             \/ /\ LET yielded_fd4200 == TRUE IN
                                                                                                                                                                                     /\ yielded_fd4200
                                                                                                                                                                                     /\ plog' = plog68
                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                              ELSE /\ IF ((value422).cmd) = (LogPop)
                                                                                                                                         THEN /\ LET plog69 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value422).cnt))] IN
                                                                                                                                                   LET log91 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                     LET value567 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                       IF ((value567).cmd) = (LogConcat)
                                                                                                                                                          THEN /\ plog' = [plog69 EXCEPT ![i] = ((plog69)[i]) \o ((value567).entries)]
                                                                                                                                                               /\ log' = [log91 EXCEPT ![i] = ((log91)[i]) \o ((m[self]).mentries)]
                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                         "Failure of assertion at line 9779, column 35.")
                                                                                                                                                               /\ LET result225 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result225)[1]]
                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result225)[2]]
                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                    /\ \/ /\ LET value6201 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6201})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3201 == FALSE IN
                                                                                                                                                                                     /\ yielded_fd3201
                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                             \/ /\ LET yielded_fd4201 == TRUE IN
                                                                                                                                                                                     /\ yielded_fd4201
                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                                          ELSE /\ IF ((value567).cmd) = (LogPop)
                                                                                                                                                                     THEN /\ plog' = [plog69 EXCEPT ![i] = SubSeq((plog69)[i], 1, (Len((plog69)[i])) - ((value567).cnt))]
                                                                                                                                                                          /\ log' = [log91 EXCEPT ![i] = ((log91)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                    "Failure of assertion at line 9809, column 37.")
                                                                                                                                                                          /\ LET result226 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result226)[1]]
                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result226)[2]]
                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                               /\ \/ /\ LET value6202 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6202})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd3202 == FALSE IN
                                                                                                                                                                                                /\ yielded_fd3202
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        \/ /\ LET yielded_fd4202 == TRUE IN
                                                                                                                                                                                                /\ yielded_fd4202
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                                                     ELSE /\ log' = [log91 EXCEPT ![i] = ((log91)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                    "Failure of assertion at line 9837, column 37.")
                                                                                                                                                                          /\ LET result227 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result227)[1]]
                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result227)[2]]
                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                               /\ \/ /\ LET value6203 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6203})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                          /\ plog' = plog69
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd3203 == FALSE IN
                                                                                                                                                                                                /\ yielded_fd3203
                                                                                                                                                                                                /\ plog' = plog69
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        \/ /\ LET yielded_fd4203 == TRUE IN
                                                                                                                                                                                                /\ yielded_fd4203
                                                                                                                                                                                                /\ plog' = plog69
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                         ELSE /\ LET log92 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                   LET value568 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                     IF ((value568).cmd) = (LogConcat)
                                                                                                                                                        THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value568).entries)]
                                                                                                                                                             /\ log' = [log92 EXCEPT ![i] = ((log92)[i]) \o ((m[self]).mentries)]
                                                                                                                                                             /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                       "Failure of assertion at line 9877, column 35.")
                                                                                                                                                             /\ LET result228 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                  /\ sm' = [sm EXCEPT ![i] = (result228)[1]]
                                                                                                                                                                  /\ smDomain' = [smDomain EXCEPT ![i] = (result228)[2]]
                                                                                                                                                                  /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                  /\ \/ /\ LET value6204 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                             /\ ((network)[j]).enabled
                                                                                                                                                                             /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                             /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6204})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                     \/ /\ \/ /\ LET yielded_fd3204 == FALSE IN
                                                                                                                                                                                   /\ yielded_fd3204
                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                           \/ /\ LET yielded_fd4204 == TRUE IN
                                                                                                                                                                                   /\ yielded_fd4204
                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                        /\ UNCHANGED network
                                                                                                                                                        ELSE /\ IF ((value568).cmd) = (LogPop)
                                                                                                                                                                   THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value568).cnt))]
                                                                                                                                                                        /\ log' = [log92 EXCEPT ![i] = ((log92)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                  "Failure of assertion at line 9907, column 37.")
                                                                                                                                                                        /\ LET result229 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result229)[1]]
                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result229)[2]]
                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                             /\ \/ /\ LET value6205 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6205})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd3205 == FALSE IN
                                                                                                                                                                                              /\ yielded_fd3205
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                      \/ /\ LET yielded_fd4205 == TRUE IN
                                                                                                                                                                                              /\ yielded_fd4205
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                   ELSE /\ log' = [log92 EXCEPT ![i] = ((log92)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                  "Failure of assertion at line 9935, column 37.")
                                                                                                                                                                        /\ LET result230 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result230)[1]]
                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result230)[2]]
                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                             /\ \/ /\ LET value6206 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6206})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd3206 == FALSE IN
                                                                                                                                                                                              /\ yielded_fd3206
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                      \/ /\ LET yielded_fd4206 == TRUE IN
                                                                                                                                                                                              /\ yielded_fd4206
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                        /\ plog' = plog
                                                                                                    ELSE /\ IF (((m[self]).mterm) < ((currentTerm)[i])) \/ (((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (~ (logOK)))
                                                                                                               THEN /\ \/ /\ LET value323 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> FALSE, mmatchIndex |-> 0, msource |-> i, mdest |-> j] IN
                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value323})), enabled |-> ((network)[j]).enabled]]
                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                       \/ /\ \/ /\ LET yielded_fd132 == FALSE IN
                                                                                                                                     /\ yielded_fd132
                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                             \/ /\ LET yielded_fd225 == TRUE IN
                                                                                                                                     /\ yielded_fd225
                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                          /\ UNCHANGED network
                                                                                                                    /\ UNCHANGED << commitIndex, 
                                                                                                                                    log, 
                                                                                                                                    plog, 
                                                                                                                                    sm, 
                                                                                                                                    smDomain >>
                                                                                                               ELSE /\ Assert(((((m[self]).mterm) = ((currentTerm)[i])) /\ (((state)[i]) = (Follower))) /\ (logOK), 
                                                                                                                              "Failure of assertion at line 9991, column 25.")
                                                                                                                    /\ LET index == ((m[self]).mprevLogIndex) + (1) IN
                                                                                                                         LET value423 == [cmd |-> LogPop, cnt |-> (Len((log)[i])) - ((m[self]).mprevLogIndex)] IN
                                                                                                                           IF ((value423).cmd) = (LogConcat)
                                                                                                                              THEN /\ LET plog70 == [plog EXCEPT ![i] = ((plog)[i]) \o ((value423).entries)] IN
                                                                                                                                        LET log93 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                          LET value569 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                            IF ((value569).cmd) = (LogConcat)
                                                                                                                                               THEN /\ plog' = [plog70 EXCEPT ![i] = ((plog70)[i]) \o ((value569).entries)]
                                                                                                                                                    /\ log' = [log93 EXCEPT ![i] = ((log93)[i]) \o ((m[self]).mentries)]
                                                                                                                                                    /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                              "Failure of assertion at line 10005, column 33.")
                                                                                                                                                    /\ LET result231 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                         /\ sm' = [sm EXCEPT ![i] = (result231)[1]]
                                                                                                                                                         /\ smDomain' = [smDomain EXCEPT ![i] = (result231)[2]]
                                                                                                                                                         /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                         /\ \/ /\ LET value6207 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                    /\ ((network)[j]).enabled
                                                                                                                                                                    /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                    /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6207})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                    /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                            \/ /\ \/ /\ LET yielded_fd3207 == FALSE IN
                                                                                                                                                                          /\ yielded_fd3207
                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                  \/ /\ LET yielded_fd4207 == TRUE IN
                                                                                                                                                                          /\ yielded_fd4207
                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                               /\ UNCHANGED network
                                                                                                                                               ELSE /\ IF ((value569).cmd) = (LogPop)
                                                                                                                                                          THEN /\ plog' = [plog70 EXCEPT ![i] = SubSeq((plog70)[i], 1, (Len((plog70)[i])) - ((value569).cnt))]
                                                                                                                                                               /\ log' = [log93 EXCEPT ![i] = ((log93)[i]) \o ((m[self]).mentries)]
                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                         "Failure of assertion at line 10035, column 35.")
                                                                                                                                                               /\ LET result232 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result232)[1]]
                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result232)[2]]
                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                    /\ \/ /\ LET value6208 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6208})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3208 == FALSE IN
                                                                                                                                                                                     /\ yielded_fd3208
                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                             \/ /\ LET yielded_fd4208 == TRUE IN
                                                                                                                                                                                     /\ yielded_fd4208
                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                                          ELSE /\ log' = [log93 EXCEPT ![i] = ((log93)[i]) \o ((m[self]).mentries)]
                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                         "Failure of assertion at line 10063, column 35.")
                                                                                                                                                               /\ LET result233 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result233)[1]]
                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result233)[2]]
                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                    /\ \/ /\ LET value6209 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6209})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                               /\ plog' = plog70
                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3209 == FALSE IN
                                                                                                                                                                                     /\ yielded_fd3209
                                                                                                                                                                                     /\ plog' = plog70
                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                             \/ /\ LET yielded_fd4209 == TRUE IN
                                                                                                                                                                                     /\ yielded_fd4209
                                                                                                                                                                                     /\ plog' = plog70
                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                              ELSE /\ IF ((value423).cmd) = (LogPop)
                                                                                                                                         THEN /\ LET plog71 == [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value423).cnt))] IN
                                                                                                                                                   LET log94 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                     LET value570 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                       IF ((value570).cmd) = (LogConcat)
                                                                                                                                                          THEN /\ plog' = [plog71 EXCEPT ![i] = ((plog71)[i]) \o ((value570).entries)]
                                                                                                                                                               /\ log' = [log94 EXCEPT ![i] = ((log94)[i]) \o ((m[self]).mentries)]
                                                                                                                                                               /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                         "Failure of assertion at line 10105, column 35.")
                                                                                                                                                               /\ LET result234 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                    /\ sm' = [sm EXCEPT ![i] = (result234)[1]]
                                                                                                                                                                    /\ smDomain' = [smDomain EXCEPT ![i] = (result234)[2]]
                                                                                                                                                                    /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                    /\ \/ /\ LET value6210 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                               /\ ((network)[j]).enabled
                                                                                                                                                                               /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                               /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6210})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                               /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                       \/ /\ \/ /\ LET yielded_fd3210 == FALSE IN
                                                                                                                                                                                     /\ yielded_fd3210
                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                             \/ /\ LET yielded_fd4210 == TRUE IN
                                                                                                                                                                                     /\ yielded_fd4210
                                                                                                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                          /\ UNCHANGED network
                                                                                                                                                          ELSE /\ IF ((value570).cmd) = (LogPop)
                                                                                                                                                                     THEN /\ plog' = [plog71 EXCEPT ![i] = SubSeq((plog71)[i], 1, (Len((plog71)[i])) - ((value570).cnt))]
                                                                                                                                                                          /\ log' = [log94 EXCEPT ![i] = ((log94)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                    "Failure of assertion at line 10135, column 37.")
                                                                                                                                                                          /\ LET result235 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result235)[1]]
                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result235)[2]]
                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                               /\ \/ /\ LET value6211 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6211})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd3211 == FALSE IN
                                                                                                                                                                                                /\ yielded_fd3211
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        \/ /\ LET yielded_fd4211 == TRUE IN
                                                                                                                                                                                                /\ yielded_fd4211
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                                                     ELSE /\ log' = [log94 EXCEPT ![i] = ((log94)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                          /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                    "Failure of assertion at line 10163, column 37.")
                                                                                                                                                                          /\ LET result236 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                               /\ sm' = [sm EXCEPT ![i] = (result236)[1]]
                                                                                                                                                                               /\ smDomain' = [smDomain EXCEPT ![i] = (result236)[2]]
                                                                                                                                                                               /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                               /\ \/ /\ LET value6212 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                          /\ ((network)[j]).enabled
                                                                                                                                                                                          /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                          /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6212})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                          /\ plog' = plog71
                                                                                                                                                                                          /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                  \/ /\ \/ /\ LET yielded_fd3212 == FALSE IN
                                                                                                                                                                                                /\ yielded_fd3212
                                                                                                                                                                                                /\ plog' = plog71
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                        \/ /\ LET yielded_fd4212 == TRUE IN
                                                                                                                                                                                                /\ yielded_fd4212
                                                                                                                                                                                                /\ plog' = plog71
                                                                                                                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                     /\ UNCHANGED network
                                                                                                                                         ELSE /\ LET log95 == [log EXCEPT ![i] = SubSeq((log)[i], 1, (m[self]).mprevLogIndex)] IN
                                                                                                                                                   LET value571 == [cmd |-> LogConcat, entries |-> (m[self]).mentries] IN
                                                                                                                                                     IF ((value571).cmd) = (LogConcat)
                                                                                                                                                        THEN /\ plog' = [plog EXCEPT ![i] = ((plog)[i]) \o ((value571).entries)]
                                                                                                                                                             /\ log' = [log95 EXCEPT ![i] = ((log95)[i]) \o ((m[self]).mentries)]
                                                                                                                                                             /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                       "Failure of assertion at line 10203, column 35.")
                                                                                                                                                             /\ LET result237 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                  /\ sm' = [sm EXCEPT ![i] = (result237)[1]]
                                                                                                                                                                  /\ smDomain' = [smDomain EXCEPT ![i] = (result237)[2]]
                                                                                                                                                                  /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                  /\ \/ /\ LET value6213 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                             /\ ((network)[j]).enabled
                                                                                                                                                                             /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                             /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6213})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                             /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                     \/ /\ \/ /\ LET yielded_fd3213 == FALSE IN
                                                                                                                                                                                   /\ yielded_fd3213
                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                           \/ /\ LET yielded_fd4213 == TRUE IN
                                                                                                                                                                                   /\ yielded_fd4213
                                                                                                                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                        /\ UNCHANGED network
                                                                                                                                                        ELSE /\ IF ((value571).cmd) = (LogPop)
                                                                                                                                                                   THEN /\ plog' = [plog EXCEPT ![i] = SubSeq((plog)[i], 1, (Len((plog)[i])) - ((value571).cnt))]
                                                                                                                                                                        /\ log' = [log95 EXCEPT ![i] = ((log95)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                  "Failure of assertion at line 10233, column 37.")
                                                                                                                                                                        /\ LET result238 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result238)[1]]
                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result238)[2]]
                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                             /\ \/ /\ LET value6214 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6214})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd3214 == FALSE IN
                                                                                                                                                                                              /\ yielded_fd3214
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                      \/ /\ LET yielded_fd4214 == TRUE IN
                                                                                                                                                                                              /\ yielded_fd4214
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                   ELSE /\ log' = [log95 EXCEPT ![i] = ((log95)[i]) \o ((m[self]).mentries)]
                                                                                                                                                                        /\ Assert(((m[self]).mcommitIndex) <= (Len((log')[i])), 
                                                                                                                                                                                  "Failure of assertion at line 10261, column 37.")
                                                                                                                                                                        /\ LET result239 == ApplyLog((log')[i], ((commitIndex)[i]) + (1), (m[self]).mcommitIndex, (sm)[i], (smDomain)[i]) IN
                                                                                                                                                                             /\ sm' = [sm EXCEPT ![i] = (result239)[1]]
                                                                                                                                                                             /\ smDomain' = [smDomain EXCEPT ![i] = (result239)[2]]
                                                                                                                                                                             /\ commitIndex' = [commitIndex EXCEPT ![i] = Max({(commitIndex)[i], (m[self]).mcommitIndex})]
                                                                                                                                                                             /\ \/ /\ LET value6215 == [mtype |-> AppendEntriesResponse, mterm |-> (currentTerm)[i], msuccess |-> TRUE, mmatchIndex |-> ((m[self]).mprevLogIndex) + (Len((m[self]).mentries)), msource |-> i, mdest |-> j] IN
                                                                                                                                                                                        /\ ((network)[j]).enabled
                                                                                                                                                                                        /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                                                                                                        /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value6215})), enabled |-> ((network)[j]).enabled]]
                                                                                                                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                \/ /\ \/ /\ LET yielded_fd3215 == FALSE IN
                                                                                                                                                                                              /\ yielded_fd3215
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                      \/ /\ LET yielded_fd4215 == TRUE IN
                                                                                                                                                                                              /\ yielded_fd4215
                                                                                                                                                                                              /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                                                                                   /\ UNCHANGED network
                                                                                                                                                                        /\ plog' = plog
                                                                                                         /\ state' = state
                                                                                              /\ UNCHANGED << leader, 
                                                                                                              leaderTimeout >>
                                                                          /\ UNCHANGED << currentTerm, 
                                                                                          votedFor >>
                                                               /\ UNCHANGED << nextIndex, 
                                                                               matchIndex, 
                                                                               appendEntriesCh >>
                                                          ELSE /\ IF ((m[self]).mtype) = (AppendEntriesResponse)
                                                                     THEN /\ IF ((m[self]).mterm) > ((currentTerm)[self])
                                                                                THEN /\ currentTerm' = [currentTerm EXCEPT ![self] = (m[self]).mterm]
                                                                                     /\ state' = [state EXCEPT ![self] = Follower]
                                                                                     /\ votedFor' = [votedFor EXCEPT ![self] = Nil]
                                                                                     /\ leader' = [leader EXCEPT ![self] = Nil]
                                                                                     /\ IF ((m[self]).mterm) < ((currentTerm')[self])
                                                                                           THEN /\ TRUE
                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                /\ UNCHANGED << nextIndex, 
                                                                                                                matchIndex >>
                                                                                           ELSE /\ LET i == self IN
                                                                                                     LET j == (m[self]).msource IN
                                                                                                       /\ Assert(((m[self]).mterm) = ((currentTerm')[i]), 
                                                                                                                 "Failure of assertion at line 10313, column 23.")
                                                                                                       /\ IF (m[self]).msuccess
                                                                                                             THEN /\ nextIndex' = [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = ((m[self]).mmatchIndex) + (1)]]
                                                                                                                  /\ matchIndex' = [matchIndex EXCEPT ![i] = [(matchIndex)[i] EXCEPT ![j] = (m[self]).mmatchIndex]]
                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                             ELSE /\ nextIndex' = [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = Max({(((nextIndex)[i])[j]) - (1), 1})]]
                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                  /\ UNCHANGED matchIndex
                                                                                ELSE /\ IF ((m[self]).mterm) < ((currentTerm)[self])
                                                                                           THEN /\ TRUE
                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                /\ UNCHANGED << nextIndex, 
                                                                                                                matchIndex >>
                                                                                           ELSE /\ LET i == self IN
                                                                                                     LET j == (m[self]).msource IN
                                                                                                       /\ Assert(((m[self]).mterm) = ((currentTerm)[i]), 
                                                                                                                 "Failure of assertion at line 10333, column 23.")
                                                                                                       /\ IF (m[self]).msuccess
                                                                                                             THEN /\ nextIndex' = [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = ((m[self]).mmatchIndex) + (1)]]
                                                                                                                  /\ matchIndex' = [matchIndex EXCEPT ![i] = [(matchIndex)[i] EXCEPT ![j] = (m[self]).mmatchIndex]]
                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                             ELSE /\ nextIndex' = [nextIndex EXCEPT ![i] = [(nextIndex)[i] EXCEPT ![j] = Max({(((nextIndex)[i])[j]) - (1), 1})]]
                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                  /\ UNCHANGED matchIndex
                                                                                     /\ UNCHANGED << state, 
                                                                                                     currentTerm, 
                                                                                                     votedFor, 
                                                                                                     leader >>
                                                                          /\ UNCHANGED << network, 
                                                                                          log, 
                                                                                          plog, 
                                                                                          appendEntriesCh >>
                                                                     ELSE /\ IF (((m[self]).mtype) = (ClientPutRequest)) \/ (((m[self]).mtype) = (ClientGetRequest))
                                                                                THEN /\ IF ((state)[self]) = (Leader)
                                                                                           THEN /\ LET entry == [term |-> (currentTerm)[self], cmd |-> (m[self]).mcmd, client |-> (m[self]).msource] IN
                                                                                                     /\ log' = [log EXCEPT ![self] = Append((log)[self], entry)]
                                                                                                     /\ LET value72 == [cmd |-> LogConcat, entries |-> <<entry>>] IN
                                                                                                          IF ((value72).cmd) = (LogConcat)
                                                                                                             THEN /\ plog' = [plog EXCEPT ![self] = ((plog)[self]) \o ((value72).entries)]
                                                                                                                  /\ LET value86 == TRUE IN
                                                                                                                       /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value86)]
                                                                                                                       /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                             ELSE /\ IF ((value72).cmd) = (LogPop)
                                                                                                                        THEN /\ plog' = [plog EXCEPT ![self] = SubSeq((plog)[self], 1, (Len((plog)[self])) - ((value72).cnt))]
                                                                                                                             /\ LET value87 == TRUE IN
                                                                                                                                  /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value87)]
                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                        ELSE /\ LET value88 == TRUE IN
                                                                                                                                  /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![self] = Append((appendEntriesCh)[self], value88)]
                                                                                                                                  /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                                             /\ plog' = plog
                                                                                                /\ UNCHANGED network
                                                                                           ELSE /\ LET i == self IN
                                                                                                     LET j == (m[self]).msource IN
                                                                                                       LET respType == IF (((m[self]).mcmd).type) = (Put) THEN ClientPutResponse ELSE ClientGetResponse IN
                                                                                                         LET value92 == [mtype |-> respType, msuccess |-> FALSE, mresponse |-> [idx |-> ((m[self]).mcmd).idx, key |-> ((m[self]).mcmd).key], mleaderHint |-> (leader)[i], msource |-> i, mdest |-> j] IN
                                                                                                           /\ ((network)[j]).enabled
                                                                                                           /\ (BagCardinality(((network)[j]).queue)) < (BufferSize)
                                                                                                           /\ network' = [network EXCEPT ![j] = [queue |-> (((network)[j]).queue) (+) (SetToBag({value92})), enabled |-> ((network)[j]).enabled]]
                                                                                                           /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                                /\ UNCHANGED << log, 
                                                                                                                plog, 
                                                                                                                appendEntriesCh >>
                                                                                ELSE /\ pc' = [pc EXCEPT ![self] = "serverLoop"]
                                                                                     /\ UNCHANGED << network, 
                                                                                                     log, 
                                                                                                     plog, 
                                                                                                     appendEntriesCh >>
                                                                          /\ UNCHANGED << state, 
                                                                                          currentTerm, 
                                                                                          nextIndex, 
                                                                                          matchIndex, 
                                                                                          votedFor, 
                                                                                          leader >>
                                                               /\ UNCHANGED << commitIndex, 
                                                                               sm, 
                                                                               smDomain, 
                                                                               leaderTimeout >>
                                                    /\ UNCHANGED << votesResponded, 
                                                                    votesGranted, 
                                                                    becomeLeaderCh >>
                   /\ UNCHANGED << fd, reqCh, respCh, requestVoteSrvId, 
                                   appendEntriesSrvId, advanceCommitIndexSrvId, 
                                   becomeLeaderSrvId, crasherSrvId, idx, m, 
                                   srvId, idx0, srvId0, idx1, srvId1, 
                                   newCommitIndex, srvId2, srvId3, leader0, 
                                   req, resp, reqIdx, timeout, srvId4 >>

s0(self) == serverLoop(self) \/ handleMsg(self)

serverRequestVoteLoop(self) == /\ pc[self] = "serverRequestVoteLoop"
                               /\ IF TRUE
                                     THEN /\ IF ExploreFail
                                                THEN /\ LET yielded_network20 == ((network)[srvId0[self]]).enabled IN
                                                          IF ~ (yielded_network20)
                                                             THEN /\ FALSE
                                                                  /\ \/ /\ LET yielded_leaderTimeout1 == TRUE IN
                                                                             /\ yielded_leaderTimeout1
                                                                             /\ \E len00 \in (0) .. (BagCardinality(((network)[srvId0[self]]).queue)):
                                                                                  LET yielded_network30 == len00 IN
                                                                                    /\ (yielded_network30) = (0)
                                                                                    /\ ((state)[srvId0[self]]) \in ({Follower, Candidate})
                                                                                    /\ LET i3 == srvId0[self] IN
                                                                                         /\ state' = [state EXCEPT ![i3] = Candidate]
                                                                                         /\ currentTerm' = [currentTerm EXCEPT ![i3] = ((currentTerm)[i3]) + (1)]
                                                                                         /\ votedFor' = [votedFor EXCEPT ![i3] = i3]
                                                                                         /\ votesResponded' = [votesResponded EXCEPT ![i3] = {i3}]
                                                                                         /\ votesGranted' = [votesGranted EXCEPT ![i3] = {i3}]
                                                                                         /\ leader' = [leader EXCEPT ![i3] = Nil]
                                                                                         /\ IF Debug
                                                                                               THEN /\ PrintT(<<"ServerTimeout", i3, (currentTerm')[i3]>>)
                                                                                                    /\ idx0' = [idx0 EXCEPT ![self] = 1]
                                                                                                    /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                                               ELSE /\ idx0' = [idx0 EXCEPT ![self] = 1]
                                                                                                    /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                     \/ /\ LET yielded_leaderTimeout00 == FALSE IN
                                                                             /\ yielded_leaderTimeout00
                                                                             /\ \E len01 \in (0) .. (BagCardinality(((network)[srvId0[self]]).queue)):
                                                                                  LET yielded_network31 == len01 IN
                                                                                    /\ (yielded_network31) = (0)
                                                                                    /\ ((state)[srvId0[self]]) \in ({Follower, Candidate})
                                                                                    /\ LET i4 == srvId0[self] IN
                                                                                         /\ state' = [state EXCEPT ![i4] = Candidate]
                                                                                         /\ currentTerm' = [currentTerm EXCEPT ![i4] = ((currentTerm)[i4]) + (1)]
                                                                                         /\ votedFor' = [votedFor EXCEPT ![i4] = i4]
                                                                                         /\ votesResponded' = [votesResponded EXCEPT ![i4] = {i4}]
                                                                                         /\ votesGranted' = [votesGranted EXCEPT ![i4] = {i4}]
                                                                                         /\ leader' = [leader EXCEPT ![i4] = Nil]
                                                                                         /\ IF Debug
                                                                                               THEN /\ PrintT(<<"ServerTimeout", i4, (currentTerm')[i4]>>)
                                                                                                    /\ idx0' = [idx0 EXCEPT ![self] = 1]
                                                                                                    /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                                               ELSE /\ idx0' = [idx0 EXCEPT ![self] = 1]
                                                                                                    /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                             ELSE /\ \/ /\ LET yielded_leaderTimeout2 == TRUE IN
                                                                             /\ yielded_leaderTimeout2
                                                                             /\ \E len02 \in (0) .. (BagCardinality(((network)[srvId0[self]]).queue)):
                                                                                  LET yielded_network32 == len02 IN
                                                                                    /\ (yielded_network32) = (0)
                                                                                    /\ ((state)[srvId0[self]]) \in ({Follower, Candidate})
                                                                                    /\ LET i5 == srvId0[self] IN
                                                                                         /\ state' = [state EXCEPT ![i5] = Candidate]
                                                                                         /\ currentTerm' = [currentTerm EXCEPT ![i5] = ((currentTerm)[i5]) + (1)]
                                                                                         /\ votedFor' = [votedFor EXCEPT ![i5] = i5]
                                                                                         /\ votesResponded' = [votesResponded EXCEPT ![i5] = {i5}]
                                                                                         /\ votesGranted' = [votesGranted EXCEPT ![i5] = {i5}]
                                                                                         /\ leader' = [leader EXCEPT ![i5] = Nil]
                                                                                         /\ IF Debug
                                                                                               THEN /\ PrintT(<<"ServerTimeout", i5, (currentTerm')[i5]>>)
                                                                                                    /\ idx0' = [idx0 EXCEPT ![self] = 1]
                                                                                                    /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                                               ELSE /\ idx0' = [idx0 EXCEPT ![self] = 1]
                                                                                                    /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                     \/ /\ LET yielded_leaderTimeout01 == FALSE IN
                                                                             /\ yielded_leaderTimeout01
                                                                             /\ \E len03 \in (0) .. (BagCardinality(((network)[srvId0[self]]).queue)):
                                                                                  LET yielded_network33 == len03 IN
                                                                                    /\ (yielded_network33) = (0)
                                                                                    /\ ((state)[srvId0[self]]) \in ({Follower, Candidate})
                                                                                    /\ LET i6 == srvId0[self] IN
                                                                                         /\ state' = [state EXCEPT ![i6] = Candidate]
                                                                                         /\ currentTerm' = [currentTerm EXCEPT ![i6] = ((currentTerm)[i6]) + (1)]
                                                                                         /\ votedFor' = [votedFor EXCEPT ![i6] = i6]
                                                                                         /\ votesResponded' = [votesResponded EXCEPT ![i6] = {i6}]
                                                                                         /\ votesGranted' = [votesGranted EXCEPT ![i6] = {i6}]
                                                                                         /\ leader' = [leader EXCEPT ![i6] = Nil]
                                                                                         /\ IF Debug
                                                                                               THEN /\ PrintT(<<"ServerTimeout", i6, (currentTerm')[i6]>>)
                                                                                                    /\ idx0' = [idx0 EXCEPT ![self] = 1]
                                                                                                    /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                                               ELSE /\ idx0' = [idx0 EXCEPT ![self] = 1]
                                                                                                    /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                ELSE /\ \/ /\ LET yielded_leaderTimeout3 == TRUE IN
                                                                /\ yielded_leaderTimeout3
                                                                /\ \E len04 \in (0) .. (BagCardinality(((network)[srvId0[self]]).queue)):
                                                                     LET yielded_network34 == len04 IN
                                                                       /\ (yielded_network34) = (0)
                                                                       /\ ((state)[srvId0[self]]) \in ({Follower, Candidate})
                                                                       /\ LET i7 == srvId0[self] IN
                                                                            /\ state' = [state EXCEPT ![i7] = Candidate]
                                                                            /\ currentTerm' = [currentTerm EXCEPT ![i7] = ((currentTerm)[i7]) + (1)]
                                                                            /\ votedFor' = [votedFor EXCEPT ![i7] = i7]
                                                                            /\ votesResponded' = [votesResponded EXCEPT ![i7] = {i7}]
                                                                            /\ votesGranted' = [votesGranted EXCEPT ![i7] = {i7}]
                                                                            /\ leader' = [leader EXCEPT ![i7] = Nil]
                                                                            /\ IF Debug
                                                                                  THEN /\ PrintT(<<"ServerTimeout", i7, (currentTerm')[i7]>>)
                                                                                       /\ idx0' = [idx0 EXCEPT ![self] = 1]
                                                                                       /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                                  ELSE /\ idx0' = [idx0 EXCEPT ![self] = 1]
                                                                                       /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                        \/ /\ LET yielded_leaderTimeout02 == FALSE IN
                                                                /\ yielded_leaderTimeout02
                                                                /\ \E len05 \in (0) .. (BagCardinality(((network)[srvId0[self]]).queue)):
                                                                     LET yielded_network35 == len05 IN
                                                                       /\ (yielded_network35) = (0)
                                                                       /\ ((state)[srvId0[self]]) \in ({Follower, Candidate})
                                                                       /\ LET i8 == srvId0[self] IN
                                                                            /\ state' = [state EXCEPT ![i8] = Candidate]
                                                                            /\ currentTerm' = [currentTerm EXCEPT ![i8] = ((currentTerm)[i8]) + (1)]
                                                                            /\ votedFor' = [votedFor EXCEPT ![i8] = i8]
                                                                            /\ votesResponded' = [votesResponded EXCEPT ![i8] = {i8}]
                                                                            /\ votesGranted' = [votesGranted EXCEPT ![i8] = {i8}]
                                                                            /\ leader' = [leader EXCEPT ![i8] = Nil]
                                                                            /\ IF Debug
                                                                                  THEN /\ PrintT(<<"ServerTimeout", i8, (currentTerm')[i8]>>)
                                                                                       /\ idx0' = [idx0 EXCEPT ![self] = 1]
                                                                                       /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                                  ELSE /\ idx0' = [idx0 EXCEPT ![self] = 1]
                                                                                       /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                     ELSE /\ pc' = [pc EXCEPT ![self] = "Done"]
                                          /\ UNCHANGED << state, currentTerm, 
                                                          votedFor, 
                                                          votesResponded, 
                                                          votesGranted, leader, 
                                                          idx0 >>
                               /\ UNCHANGED << network, fd, commitIndex, 
                                               nextIndex, matchIndex, log, 
                                               plog, sm, smDomain, 
                                               leaderTimeout, appendEntriesCh, 
                                               becomeLeaderCh, reqCh, respCh, 
                                               requestVoteSrvId, 
                                               appendEntriesSrvId, 
                                               advanceCommitIndexSrvId, 
                                               becomeLeaderSrvId, crasherSrvId, 
                                               idx, m, srvId, srvId0, idx1, 
                                               srvId1, newCommitIndex, srvId2, 
                                               srvId3, leader0, req, resp, 
                                               reqIdx, timeout, srvId4 >>

requestVoteLoop(self) == /\ pc[self] = "requestVoteLoop"
                         /\ IF (idx0[self]) <= (NumServers)
                               THEN /\ IF ExploreFail
                                          THEN /\ LET yielded_network40 == ((network)[srvId0[self]]).enabled IN
                                                    IF ~ (yielded_network40)
                                                       THEN /\ FALSE
                                                            /\ IF (idx0[self]) # (srvId0[self])
                                                                  THEN /\ \/ /\ LET value100 == [mtype |-> RequestVoteRequest, mterm |-> (currentTerm)[srvId0[self]], mlastLogTerm |-> LastTerm((log)[srvId0[self]]), mlastLogIndex |-> Len((log)[srvId0[self]]), msource |-> srvId0[self], mdest |-> idx0[self]] IN
                                                                                  /\ ((network)[idx0[self]]).enabled
                                                                                  /\ (BagCardinality(((network)[idx0[self]]).queue)) < (BufferSize)
                                                                                  /\ network' = [network EXCEPT ![idx0[self]] = [queue |-> (((network)[idx0[self]]).queue) (+) (SetToBag({value100})), enabled |-> ((network)[idx0[self]]).enabled]]
                                                                                  /\ idx0' = [idx0 EXCEPT ![self] = (idx0[self]) + (1)]
                                                                                  /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                          \/ /\ \/ /\ LET yielded_fd56 == FALSE IN
                                                                                        /\ yielded_fd56
                                                                                        /\ idx0' = [idx0 EXCEPT ![self] = (idx0[self]) + (1)]
                                                                                        /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                                \/ /\ LET yielded_fd60 == TRUE IN
                                                                                        /\ yielded_fd60
                                                                                        /\ idx0' = [idx0 EXCEPT ![self] = (idx0[self]) + (1)]
                                                                                        /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                             /\ UNCHANGED network
                                                                  ELSE /\ idx0' = [idx0 EXCEPT ![self] = (idx0[self]) + (1)]
                                                                       /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                       /\ UNCHANGED network
                                                       ELSE /\ IF (idx0[self]) # (srvId0[self])
                                                                  THEN /\ \/ /\ LET value101 == [mtype |-> RequestVoteRequest, mterm |-> (currentTerm)[srvId0[self]], mlastLogTerm |-> LastTerm((log)[srvId0[self]]), mlastLogIndex |-> Len((log)[srvId0[self]]), msource |-> srvId0[self], mdest |-> idx0[self]] IN
                                                                                  /\ ((network)[idx0[self]]).enabled
                                                                                  /\ (BagCardinality(((network)[idx0[self]]).queue)) < (BufferSize)
                                                                                  /\ network' = [network EXCEPT ![idx0[self]] = [queue |-> (((network)[idx0[self]]).queue) (+) (SetToBag({value101})), enabled |-> ((network)[idx0[self]]).enabled]]
                                                                                  /\ idx0' = [idx0 EXCEPT ![self] = (idx0[self]) + (1)]
                                                                                  /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                          \/ /\ \/ /\ LET yielded_fd57 == FALSE IN
                                                                                        /\ yielded_fd57
                                                                                        /\ idx0' = [idx0 EXCEPT ![self] = (idx0[self]) + (1)]
                                                                                        /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                                \/ /\ LET yielded_fd61 == TRUE IN
                                                                                        /\ yielded_fd61
                                                                                        /\ idx0' = [idx0 EXCEPT ![self] = (idx0[self]) + (1)]
                                                                                        /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                             /\ UNCHANGED network
                                                                  ELSE /\ idx0' = [idx0 EXCEPT ![self] = (idx0[self]) + (1)]
                                                                       /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                       /\ UNCHANGED network
                                          ELSE /\ IF (idx0[self]) # (srvId0[self])
                                                     THEN /\ \/ /\ LET value102 == [mtype |-> RequestVoteRequest, mterm |-> (currentTerm)[srvId0[self]], mlastLogTerm |-> LastTerm((log)[srvId0[self]]), mlastLogIndex |-> Len((log)[srvId0[self]]), msource |-> srvId0[self], mdest |-> idx0[self]] IN
                                                                     /\ ((network)[idx0[self]]).enabled
                                                                     /\ (BagCardinality(((network)[idx0[self]]).queue)) < (BufferSize)
                                                                     /\ network' = [network EXCEPT ![idx0[self]] = [queue |-> (((network)[idx0[self]]).queue) (+) (SetToBag({value102})), enabled |-> ((network)[idx0[self]]).enabled]]
                                                                     /\ idx0' = [idx0 EXCEPT ![self] = (idx0[self]) + (1)]
                                                                     /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                             \/ /\ \/ /\ LET yielded_fd58 == FALSE IN
                                                                           /\ yielded_fd58
                                                                           /\ idx0' = [idx0 EXCEPT ![self] = (idx0[self]) + (1)]
                                                                           /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                   \/ /\ LET yielded_fd62 == TRUE IN
                                                                           /\ yielded_fd62
                                                                           /\ idx0' = [idx0 EXCEPT ![self] = (idx0[self]) + (1)]
                                                                           /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                                /\ UNCHANGED network
                                                     ELSE /\ idx0' = [idx0 EXCEPT ![self] = (idx0[self]) + (1)]
                                                          /\ pc' = [pc EXCEPT ![self] = "requestVoteLoop"]
                                                          /\ UNCHANGED network
                               ELSE /\ pc' = [pc EXCEPT ![self] = "serverRequestVoteLoop"]
                                    /\ UNCHANGED << network, idx0 >>
                         /\ UNCHANGED << fd, state, currentTerm, commitIndex, 
                                         nextIndex, matchIndex, log, plog, 
                                         votedFor, votesResponded, 
                                         votesGranted, leader, sm, smDomain, 
                                         leaderTimeout, appendEntriesCh, 
                                         becomeLeaderCh, reqCh, respCh, 
                                         requestVoteSrvId, appendEntriesSrvId, 
                                         advanceCommitIndexSrvId, 
                                         becomeLeaderSrvId, crasherSrvId, idx, 
                                         m, srvId, srvId0, idx1, srvId1, 
                                         newCommitIndex, srvId2, srvId3, 
                                         leader0, req, resp, reqIdx, timeout, 
                                         srvId4 >>

s1(self) == serverRequestVoteLoop(self) \/ requestVoteLoop(self)

serverAppendEntriesLoop(self) == /\ pc[self] = "serverAppendEntriesLoop"
                                 /\ \/ /\ (Len((appendEntriesCh)[srvId1[self]])) > (0)
                                       /\ LET res0 == Head((appendEntriesCh)[srvId1[self]]) IN
                                            /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![srvId1[self]] = Tail((appendEntriesCh)[srvId1[self]])]
                                            /\ LET yielded_appendEntriesCh == res0 IN
                                                 IF yielded_appendEntriesCh
                                                    THEN /\ IF ExploreFail
                                                               THEN /\ LET yielded_network50 == ((network)[srvId1[self]]).enabled IN
                                                                         IF ~ (yielded_network50)
                                                                            THEN /\ FALSE
                                                                                 /\ ((state)[srvId1[self]]) = (Leader)
                                                                                 /\ idx1' = [idx1 EXCEPT ![self] = 1]
                                                                                 /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                                            ELSE /\ ((state)[srvId1[self]]) = (Leader)
                                                                                 /\ idx1' = [idx1 EXCEPT ![self] = 1]
                                                                                 /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                               ELSE /\ ((state)[srvId1[self]]) = (Leader)
                                                                    /\ idx1' = [idx1 EXCEPT ![self] = 1]
                                                                    /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                    ELSE /\ pc' = [pc EXCEPT ![self] = "Done"]
                                                         /\ idx1' = idx1
                                    \/ /\ ((appendEntriesCh)[srvId1[self]]) = (<<>>)
                                       /\ LET yielded_appendEntriesCh0 == TRUE IN
                                            IF yielded_appendEntriesCh0
                                               THEN /\ IF ExploreFail
                                                          THEN /\ LET yielded_network51 == ((network)[srvId1[self]]).enabled IN
                                                                    IF ~ (yielded_network51)
                                                                       THEN /\ FALSE
                                                                            /\ ((state)[srvId1[self]]) = (Leader)
                                                                            /\ idx1' = [idx1 EXCEPT ![self] = 1]
                                                                            /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                                       ELSE /\ ((state)[srvId1[self]]) = (Leader)
                                                                            /\ idx1' = [idx1 EXCEPT ![self] = 1]
                                                                            /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                          ELSE /\ ((state)[srvId1[self]]) = (Leader)
                                                               /\ idx1' = [idx1 EXCEPT ![self] = 1]
                                                               /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                               ELSE /\ pc' = [pc EXCEPT ![self] = "Done"]
                                                    /\ idx1' = idx1
                                       /\ UNCHANGED appendEntriesCh
                                 /\ UNCHANGED << network, fd, state, 
                                                 currentTerm, commitIndex, 
                                                 nextIndex, matchIndex, log, 
                                                 plog, votedFor, 
                                                 votesResponded, votesGranted, 
                                                 leader, sm, smDomain, 
                                                 leaderTimeout, becomeLeaderCh, 
                                                 reqCh, respCh, 
                                                 requestVoteSrvId, 
                                                 appendEntriesSrvId, 
                                                 advanceCommitIndexSrvId, 
                                                 becomeLeaderSrvId, 
                                                 crasherSrvId, idx, m, srvId, 
                                                 idx0, srvId0, srvId1, 
                                                 newCommitIndex, srvId2, 
                                                 srvId3, leader0, req, resp, 
                                                 reqIdx, timeout, srvId4 >>

appendEntriesLoop(self) == /\ pc[self] = "appendEntriesLoop"
                           /\ IF (((state)[srvId1[self]]) = (Leader)) /\ ((idx1[self]) <= (NumServers))
                                 THEN /\ IF ExploreFail
                                            THEN /\ LET yielded_network60 == ((network)[srvId1[self]]).enabled IN
                                                      IF ~ (yielded_network60)
                                                         THEN /\ FALSE
                                                              /\ IF (idx1[self]) # (srvId1[self])
                                                                    THEN /\ LET prevLogIndex3 == (((nextIndex)[srvId1[self]])[idx1[self]]) - (1) IN
                                                                              LET prevLogTerm3 == IF (prevLogIndex3) > (0) THEN (((log)[srvId1[self]])[prevLogIndex3]).term ELSE 0 IN
                                                                                LET entries3 == SubSeq((log)[srvId1[self]], ((nextIndex)[srvId1[self]])[idx1[self]], Len((log)[srvId1[self]])) IN
                                                                                  \/ /\ LET value114 == [mtype |-> AppendEntriesRequest, mterm |-> (currentTerm)[srvId1[self]], mprevLogIndex |-> prevLogIndex3, mprevLogTerm |-> prevLogTerm3, mentries |-> entries3, mcommitIndex |-> (commitIndex)[srvId1[self]], msource |-> srvId1[self], mdest |-> idx1[self]] IN
                                                                                          /\ ((network)[idx1[self]]).enabled
                                                                                          /\ (BagCardinality(((network)[idx1[self]]).queue)) < (BufferSize)
                                                                                          /\ network' = [network EXCEPT ![idx1[self]] = [queue |-> (((network)[idx1[self]]).queue) (+) (SetToBag({value114})), enabled |-> ((network)[idx1[self]]).enabled]]
                                                                                          /\ idx1' = [idx1 EXCEPT ![self] = (idx1[self]) + (1)]
                                                                                          /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                                                  \/ /\ \/ /\ LET yielded_fd70 == FALSE IN
                                                                                                /\ yielded_fd70
                                                                                                /\ idx1' = [idx1 EXCEPT ![self] = (idx1[self]) + (1)]
                                                                                                /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                                                        \/ /\ LET yielded_fd80 == TRUE IN
                                                                                                /\ yielded_fd80
                                                                                                /\ idx1' = [idx1 EXCEPT ![self] = (idx1[self]) + (1)]
                                                                                                /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                                                     /\ UNCHANGED network
                                                                    ELSE /\ idx1' = [idx1 EXCEPT ![self] = (idx1[self]) + (1)]
                                                                         /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                                         /\ UNCHANGED network
                                                         ELSE /\ IF (idx1[self]) # (srvId1[self])
                                                                    THEN /\ LET prevLogIndex4 == (((nextIndex)[srvId1[self]])[idx1[self]]) - (1) IN
                                                                              LET prevLogTerm4 == IF (prevLogIndex4) > (0) THEN (((log)[srvId1[self]])[prevLogIndex4]).term ELSE 0 IN
                                                                                LET entries4 == SubSeq((log)[srvId1[self]], ((nextIndex)[srvId1[self]])[idx1[self]], Len((log)[srvId1[self]])) IN
                                                                                  \/ /\ LET value115 == [mtype |-> AppendEntriesRequest, mterm |-> (currentTerm)[srvId1[self]], mprevLogIndex |-> prevLogIndex4, mprevLogTerm |-> prevLogTerm4, mentries |-> entries4, mcommitIndex |-> (commitIndex)[srvId1[self]], msource |-> srvId1[self], mdest |-> idx1[self]] IN
                                                                                          /\ ((network)[idx1[self]]).enabled
                                                                                          /\ (BagCardinality(((network)[idx1[self]]).queue)) < (BufferSize)
                                                                                          /\ network' = [network EXCEPT ![idx1[self]] = [queue |-> (((network)[idx1[self]]).queue) (+) (SetToBag({value115})), enabled |-> ((network)[idx1[self]]).enabled]]
                                                                                          /\ idx1' = [idx1 EXCEPT ![self] = (idx1[self]) + (1)]
                                                                                          /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                                                  \/ /\ \/ /\ LET yielded_fd71 == FALSE IN
                                                                                                /\ yielded_fd71
                                                                                                /\ idx1' = [idx1 EXCEPT ![self] = (idx1[self]) + (1)]
                                                                                                /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                                                        \/ /\ LET yielded_fd81 == TRUE IN
                                                                                                /\ yielded_fd81
                                                                                                /\ idx1' = [idx1 EXCEPT ![self] = (idx1[self]) + (1)]
                                                                                                /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                                                     /\ UNCHANGED network
                                                                    ELSE /\ idx1' = [idx1 EXCEPT ![self] = (idx1[self]) + (1)]
                                                                         /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                                         /\ UNCHANGED network
                                            ELSE /\ IF (idx1[self]) # (srvId1[self])
                                                       THEN /\ LET prevLogIndex5 == (((nextIndex)[srvId1[self]])[idx1[self]]) - (1) IN
                                                                 LET prevLogTerm5 == IF (prevLogIndex5) > (0) THEN (((log)[srvId1[self]])[prevLogIndex5]).term ELSE 0 IN
                                                                   LET entries5 == SubSeq((log)[srvId1[self]], ((nextIndex)[srvId1[self]])[idx1[self]], Len((log)[srvId1[self]])) IN
                                                                     \/ /\ LET value116 == [mtype |-> AppendEntriesRequest, mterm |-> (currentTerm)[srvId1[self]], mprevLogIndex |-> prevLogIndex5, mprevLogTerm |-> prevLogTerm5, mentries |-> entries5, mcommitIndex |-> (commitIndex)[srvId1[self]], msource |-> srvId1[self], mdest |-> idx1[self]] IN
                                                                             /\ ((network)[idx1[self]]).enabled
                                                                             /\ (BagCardinality(((network)[idx1[self]]).queue)) < (BufferSize)
                                                                             /\ network' = [network EXCEPT ![idx1[self]] = [queue |-> (((network)[idx1[self]]).queue) (+) (SetToBag({value116})), enabled |-> ((network)[idx1[self]]).enabled]]
                                                                             /\ idx1' = [idx1 EXCEPT ![self] = (idx1[self]) + (1)]
                                                                             /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                                     \/ /\ \/ /\ LET yielded_fd72 == FALSE IN
                                                                                   /\ yielded_fd72
                                                                                   /\ idx1' = [idx1 EXCEPT ![self] = (idx1[self]) + (1)]
                                                                                   /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                                           \/ /\ LET yielded_fd82 == TRUE IN
                                                                                   /\ yielded_fd82
                                                                                   /\ idx1' = [idx1 EXCEPT ![self] = (idx1[self]) + (1)]
                                                                                   /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                                        /\ UNCHANGED network
                                                       ELSE /\ idx1' = [idx1 EXCEPT ![self] = (idx1[self]) + (1)]
                                                            /\ pc' = [pc EXCEPT ![self] = "appendEntriesLoop"]
                                                            /\ UNCHANGED network
                                 ELSE /\ pc' = [pc EXCEPT ![self] = "serverAppendEntriesLoop"]
                                      /\ UNCHANGED << network, idx1 >>
                           /\ UNCHANGED << fd, state, currentTerm, commitIndex, 
                                           nextIndex, matchIndex, log, plog, 
                                           votedFor, votesResponded, 
                                           votesGranted, leader, sm, smDomain, 
                                           leaderTimeout, appendEntriesCh, 
                                           becomeLeaderCh, reqCh, respCh, 
                                           requestVoteSrvId, 
                                           appendEntriesSrvId, 
                                           advanceCommitIndexSrvId, 
                                           becomeLeaderSrvId, crasherSrvId, 
                                           idx, m, srvId, idx0, srvId0, srvId1, 
                                           newCommitIndex, srvId2, srvId3, 
                                           leader0, req, resp, reqIdx, timeout, 
                                           srvId4 >>

s2(self) == serverAppendEntriesLoop(self) \/ appendEntriesLoop(self)

serverAdvanceCommitIndexLoop(self) == /\ pc[self] = "serverAdvanceCommitIndexLoop"
                                      /\ IF TRUE
                                            THEN /\ IF ExploreFail
                                                       THEN /\ LET yielded_network70 == ((network)[srvId2[self]]).enabled IN
                                                                 IF ~ (yielded_network70)
                                                                    THEN /\ FALSE
                                                                         /\ ((state)[srvId2[self]]) = (Leader)
                                                                         /\ LET i == srvId2[self] IN
                                                                              LET maxAgreeIndex == FindMaxAgreeIndex((log)[i], i, (matchIndex)[i]) IN
                                                                                LET nCommitIndex == IF ((maxAgreeIndex) # (Nil)) /\ (((((log)[i])[maxAgreeIndex]).term) = ((currentTerm)[i])) THEN maxAgreeIndex ELSE (commitIndex)[i] IN
                                                                                  /\ newCommitIndex' = [newCommitIndex EXCEPT ![self] = nCommitIndex]
                                                                                  /\ Assert((newCommitIndex'[self]) >= ((commitIndex)[i]), 
                                                                                            "Failure of assertion at line 10872, column 17.")
                                                                                  /\ pc' = [pc EXCEPT ![self] = "applyLoop"]
                                                                    ELSE /\ ((state)[srvId2[self]]) = (Leader)
                                                                         /\ LET i == srvId2[self] IN
                                                                              LET maxAgreeIndex == FindMaxAgreeIndex((log)[i], i, (matchIndex)[i]) IN
                                                                                LET nCommitIndex == IF ((maxAgreeIndex) # (Nil)) /\ (((((log)[i])[maxAgreeIndex]).term) = ((currentTerm)[i])) THEN maxAgreeIndex ELSE (commitIndex)[i] IN
                                                                                  /\ newCommitIndex' = [newCommitIndex EXCEPT ![self] = nCommitIndex]
                                                                                  /\ Assert((newCommitIndex'[self]) >= ((commitIndex)[i]), 
                                                                                            "Failure of assertion at line 10883, column 17.")
                                                                                  /\ pc' = [pc EXCEPT ![self] = "applyLoop"]
                                                       ELSE /\ ((state)[srvId2[self]]) = (Leader)
                                                            /\ LET i == srvId2[self] IN
                                                                 LET maxAgreeIndex == FindMaxAgreeIndex((log)[i], i, (matchIndex)[i]) IN
                                                                   LET nCommitIndex == IF ((maxAgreeIndex) # (Nil)) /\ (((((log)[i])[maxAgreeIndex]).term) = ((currentTerm)[i])) THEN maxAgreeIndex ELSE (commitIndex)[i] IN
                                                                     /\ newCommitIndex' = [newCommitIndex EXCEPT ![self] = nCommitIndex]
                                                                     /\ Assert((newCommitIndex'[self]) >= ((commitIndex)[i]), 
                                                                               "Failure of assertion at line 10896, column 13.")
                                                                     /\ pc' = [pc EXCEPT ![self] = "applyLoop"]
                                            ELSE /\ pc' = [pc EXCEPT ![self] = "Done"]
                                                 /\ UNCHANGED newCommitIndex
                                      /\ UNCHANGED << network, fd, state, 
                                                      currentTerm, commitIndex, 
                                                      nextIndex, matchIndex, 
                                                      log, plog, votedFor, 
                                                      votesResponded, 
                                                      votesGranted, leader, sm, 
                                                      smDomain, leaderTimeout, 
                                                      appendEntriesCh, 
                                                      becomeLeaderCh, reqCh, 
                                                      respCh, requestVoteSrvId, 
                                                      appendEntriesSrvId, 
                                                      advanceCommitIndexSrvId, 
                                                      becomeLeaderSrvId, 
                                                      crasherSrvId, idx, m, 
                                                      srvId, idx0, srvId0, 
                                                      idx1, srvId1, srvId2, 
                                                      srvId3, leader0, req, 
                                                      resp, reqIdx, timeout, 
                                                      srvId4 >>

applyLoop(self) == /\ pc[self] = "applyLoop"
                   /\ IF ((commitIndex)[srvId2[self]]) < (newCommitIndex[self])
                         THEN /\ IF ExploreFail
                                    THEN /\ LET yielded_network80 == ((network)[srvId2[self]]).enabled IN
                                              IF ~ (yielded_network80)
                                                 THEN /\ FALSE
                                                      /\ commitIndex' = [commitIndex EXCEPT ![srvId2[self]] = ((commitIndex)[srvId2[self]]) + (1)]
                                                      /\ LET i == srvId2[self] IN
                                                           LET k == (commitIndex')[i] IN
                                                             LET entry == ((log)[i])[k] IN
                                                               LET cmd == (entry).cmd IN
                                                                 LET respType == IF ((cmd).type) = (Put) THEN ClientPutResponse ELSE ClientGetResponse IN
                                                                   IF ((cmd).type) = (Put)
                                                                      THEN /\ sm' = [sm EXCEPT ![i] = (((cmd).key) :> ((cmd).value)) @@ ((sm)[i])]
                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = ((smDomain)[i]) \union ({(cmd).key})]
                                                                           /\ LET reqOk == ((cmd).key) \in ((smDomain')[i]) IN
                                                                                LET value120 == [mtype |-> respType, msuccess |-> TRUE, mresponse |-> [idx |-> (cmd).idx, key |-> (cmd).key, value |-> IF reqOk THEN ((sm')[i])[(cmd).key] ELSE Nil, ok |-> reqOk], mleaderHint |-> i, msource |-> i, mdest |-> (entry).client] IN
                                                                                  /\ ((network)[(entry).client]).enabled
                                                                                  /\ (BagCardinality(((network)[(entry).client]).queue)) < (BufferSize)
                                                                                  /\ network' = [network EXCEPT ![(entry).client] = [queue |-> (((network)[(entry).client]).queue) (+) (SetToBag({value120})), enabled |-> ((network)[(entry).client]).enabled]]
                                                                                  /\ pc' = [pc EXCEPT ![self] = "applyLoop"]
                                                                      ELSE /\ LET reqOk == ((cmd).key) \in ((smDomain)[i]) IN
                                                                                LET value121 == [mtype |-> respType, msuccess |-> TRUE, mresponse |-> [idx |-> (cmd).idx, key |-> (cmd).key, value |-> IF reqOk THEN ((sm)[i])[(cmd).key] ELSE Nil, ok |-> reqOk], mleaderHint |-> i, msource |-> i, mdest |-> (entry).client] IN
                                                                                  /\ ((network)[(entry).client]).enabled
                                                                                  /\ (BagCardinality(((network)[(entry).client]).queue)) < (BufferSize)
                                                                                  /\ network' = [network EXCEPT ![(entry).client] = [queue |-> (((network)[(entry).client]).queue) (+) (SetToBag({value121})), enabled |-> ((network)[(entry).client]).enabled]]
                                                                                  /\ pc' = [pc EXCEPT ![self] = "applyLoop"]
                                                                           /\ UNCHANGED << sm, 
                                                                                           smDomain >>
                                                 ELSE /\ commitIndex' = [commitIndex EXCEPT ![srvId2[self]] = ((commitIndex)[srvId2[self]]) + (1)]
                                                      /\ LET i == srvId2[self] IN
                                                           LET k == (commitIndex')[i] IN
                                                             LET entry == ((log)[i])[k] IN
                                                               LET cmd == (entry).cmd IN
                                                                 LET respType == IF ((cmd).type) = (Put) THEN ClientPutResponse ELSE ClientGetResponse IN
                                                                   IF ((cmd).type) = (Put)
                                                                      THEN /\ sm' = [sm EXCEPT ![i] = (((cmd).key) :> ((cmd).value)) @@ ((sm)[i])]
                                                                           /\ smDomain' = [smDomain EXCEPT ![i] = ((smDomain)[i]) \union ({(cmd).key})]
                                                                           /\ LET reqOk == ((cmd).key) \in ((smDomain')[i]) IN
                                                                                LET value122 == [mtype |-> respType, msuccess |-> TRUE, mresponse |-> [idx |-> (cmd).idx, key |-> (cmd).key, value |-> IF reqOk THEN ((sm')[i])[(cmd).key] ELSE Nil, ok |-> reqOk], mleaderHint |-> i, msource |-> i, mdest |-> (entry).client] IN
                                                                                  /\ ((network)[(entry).client]).enabled
                                                                                  /\ (BagCardinality(((network)[(entry).client]).queue)) < (BufferSize)
                                                                                  /\ network' = [network EXCEPT ![(entry).client] = [queue |-> (((network)[(entry).client]).queue) (+) (SetToBag({value122})), enabled |-> ((network)[(entry).client]).enabled]]
                                                                                  /\ pc' = [pc EXCEPT ![self] = "applyLoop"]
                                                                      ELSE /\ LET reqOk == ((cmd).key) \in ((smDomain)[i]) IN
                                                                                LET value123 == [mtype |-> respType, msuccess |-> TRUE, mresponse |-> [idx |-> (cmd).idx, key |-> (cmd).key, value |-> IF reqOk THEN ((sm)[i])[(cmd).key] ELSE Nil, ok |-> reqOk], mleaderHint |-> i, msource |-> i, mdest |-> (entry).client] IN
                                                                                  /\ ((network)[(entry).client]).enabled
                                                                                  /\ (BagCardinality(((network)[(entry).client]).queue)) < (BufferSize)
                                                                                  /\ network' = [network EXCEPT ![(entry).client] = [queue |-> (((network)[(entry).client]).queue) (+) (SetToBag({value123})), enabled |-> ((network)[(entry).client]).enabled]]
                                                                                  /\ pc' = [pc EXCEPT ![self] = "applyLoop"]
                                                                           /\ UNCHANGED << sm, 
                                                                                           smDomain >>
                                    ELSE /\ commitIndex' = [commitIndex EXCEPT ![srvId2[self]] = ((commitIndex)[srvId2[self]]) + (1)]
                                         /\ LET i == srvId2[self] IN
                                              LET k == (commitIndex')[i] IN
                                                LET entry == ((log)[i])[k] IN
                                                  LET cmd == (entry).cmd IN
                                                    LET respType == IF ((cmd).type) = (Put) THEN ClientPutResponse ELSE ClientGetResponse IN
                                                      IF ((cmd).type) = (Put)
                                                         THEN /\ sm' = [sm EXCEPT ![i] = (((cmd).key) :> ((cmd).value)) @@ ((sm)[i])]
                                                              /\ smDomain' = [smDomain EXCEPT ![i] = ((smDomain)[i]) \union ({(cmd).key})]
                                                              /\ LET reqOk == ((cmd).key) \in ((smDomain')[i]) IN
                                                                   LET value124 == [mtype |-> respType, msuccess |-> TRUE, mresponse |-> [idx |-> (cmd).idx, key |-> (cmd).key, value |-> IF reqOk THEN ((sm')[i])[(cmd).key] ELSE Nil, ok |-> reqOk], mleaderHint |-> i, msource |-> i, mdest |-> (entry).client] IN
                                                                     /\ ((network)[(entry).client]).enabled
                                                                     /\ (BagCardinality(((network)[(entry).client]).queue)) < (BufferSize)
                                                                     /\ network' = [network EXCEPT ![(entry).client] = [queue |-> (((network)[(entry).client]).queue) (+) (SetToBag({value124})), enabled |-> ((network)[(entry).client]).enabled]]
                                                                     /\ pc' = [pc EXCEPT ![self] = "applyLoop"]
                                                         ELSE /\ LET reqOk == ((cmd).key) \in ((smDomain)[i]) IN
                                                                   LET value125 == [mtype |-> respType, msuccess |-> TRUE, mresponse |-> [idx |-> (cmd).idx, key |-> (cmd).key, value |-> IF reqOk THEN ((sm)[i])[(cmd).key] ELSE Nil, ok |-> reqOk], mleaderHint |-> i, msource |-> i, mdest |-> (entry).client] IN
                                                                     /\ ((network)[(entry).client]).enabled
                                                                     /\ (BagCardinality(((network)[(entry).client]).queue)) < (BufferSize)
                                                                     /\ network' = [network EXCEPT ![(entry).client] = [queue |-> (((network)[(entry).client]).queue) (+) (SetToBag({value125})), enabled |-> ((network)[(entry).client]).enabled]]
                                                                     /\ pc' = [pc EXCEPT ![self] = "applyLoop"]
                                                              /\ UNCHANGED << sm, 
                                                                              smDomain >>
                         ELSE /\ pc' = [pc EXCEPT ![self] = "serverAdvanceCommitIndexLoop"]
                              /\ UNCHANGED << network, commitIndex, sm, 
                                              smDomain >>
                   /\ UNCHANGED << fd, state, currentTerm, nextIndex, 
                                   matchIndex, log, plog, votedFor, 
                                   votesResponded, votesGranted, leader, 
                                   leaderTimeout, appendEntriesCh, 
                                   becomeLeaderCh, reqCh, respCh, 
                                   requestVoteSrvId, appendEntriesSrvId, 
                                   advanceCommitIndexSrvId, becomeLeaderSrvId, 
                                   crasherSrvId, idx, m, srvId, idx0, srvId0, 
                                   idx1, srvId1, newCommitIndex, srvId2, 
                                   srvId3, leader0, req, resp, reqIdx, timeout, 
                                   srvId4 >>

s3(self) == serverAdvanceCommitIndexLoop(self) \/ applyLoop(self)

serverBecomeLeaderLoop(self) == /\ pc[self] = "serverBecomeLeaderLoop"
                                /\ \/ /\ (Len((becomeLeaderCh)[srvId3[self]])) > (0)
                                      /\ LET res1 == Head((becomeLeaderCh)[srvId3[self]]) IN
                                           /\ becomeLeaderCh' = [becomeLeaderCh EXCEPT ![srvId3[self]] = Tail((becomeLeaderCh)[srvId3[self]])]
                                           /\ LET yielded_becomeLeaderCh == res1 IN
                                                IF yielded_becomeLeaderCh
                                                   THEN /\ IF ExploreFail
                                                              THEN /\ LET yielded_network90 == ((network)[srvId3[self]]).enabled IN
                                                                        IF ~ (yielded_network90)
                                                                           THEN /\ FALSE
                                                                                /\ ((state)[srvId3[self]]) = (Candidate)
                                                                                /\ isQuorum((votesGranted)[srvId3[self]])
                                                                                /\ LET i == srvId3[self] IN
                                                                                     /\ state' = [state EXCEPT ![i] = Leader]
                                                                                     /\ nextIndex' = [nextIndex EXCEPT ![i] = [j \in ServerSet |-> (Len((log)[i])) + (1)]]
                                                                                     /\ matchIndex' = [matchIndex EXCEPT ![i] = [j \in ServerSet |-> 0]]
                                                                                     /\ leader' = [leader EXCEPT ![i] = i]
                                                                                     /\ LET value130 == TRUE IN
                                                                                          /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![srvId3[self]] = Append((appendEntriesCh)[srvId3[self]], value130)]
                                                                                          /\ IF Debug
                                                                                                THEN /\ PrintT(<<"BecomeLeader", i, (currentTerm)[i], (state')[i], (leader')[i]>>)
                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverBecomeLeaderLoop"]
                                                                                                ELSE /\ pc' = [pc EXCEPT ![self] = "serverBecomeLeaderLoop"]
                                                                           ELSE /\ ((state)[srvId3[self]]) = (Candidate)
                                                                                /\ isQuorum((votesGranted)[srvId3[self]])
                                                                                /\ LET i == srvId3[self] IN
                                                                                     /\ state' = [state EXCEPT ![i] = Leader]
                                                                                     /\ nextIndex' = [nextIndex EXCEPT ![i] = [j \in ServerSet |-> (Len((log)[i])) + (1)]]
                                                                                     /\ matchIndex' = [matchIndex EXCEPT ![i] = [j \in ServerSet |-> 0]]
                                                                                     /\ leader' = [leader EXCEPT ![i] = i]
                                                                                     /\ LET value131 == TRUE IN
                                                                                          /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![srvId3[self]] = Append((appendEntriesCh)[srvId3[self]], value131)]
                                                                                          /\ IF Debug
                                                                                                THEN /\ PrintT(<<"BecomeLeader", i, (currentTerm)[i], (state')[i], (leader')[i]>>)
                                                                                                     /\ pc' = [pc EXCEPT ![self] = "serverBecomeLeaderLoop"]
                                                                                                ELSE /\ pc' = [pc EXCEPT ![self] = "serverBecomeLeaderLoop"]
                                                              ELSE /\ ((state)[srvId3[self]]) = (Candidate)
                                                                   /\ isQuorum((votesGranted)[srvId3[self]])
                                                                   /\ LET i == srvId3[self] IN
                                                                        /\ state' = [state EXCEPT ![i] = Leader]
                                                                        /\ nextIndex' = [nextIndex EXCEPT ![i] = [j \in ServerSet |-> (Len((log)[i])) + (1)]]
                                                                        /\ matchIndex' = [matchIndex EXCEPT ![i] = [j \in ServerSet |-> 0]]
                                                                        /\ leader' = [leader EXCEPT ![i] = i]
                                                                        /\ LET value132 == TRUE IN
                                                                             /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![srvId3[self]] = Append((appendEntriesCh)[srvId3[self]], value132)]
                                                                             /\ IF Debug
                                                                                   THEN /\ PrintT(<<"BecomeLeader", i, (currentTerm)[i], (state')[i], (leader')[i]>>)
                                                                                        /\ pc' = [pc EXCEPT ![self] = "serverBecomeLeaderLoop"]
                                                                                   ELSE /\ pc' = [pc EXCEPT ![self] = "serverBecomeLeaderLoop"]
                                                   ELSE /\ pc' = [pc EXCEPT ![self] = "Done"]
                                                        /\ UNCHANGED << state, 
                                                                        nextIndex, 
                                                                        matchIndex, 
                                                                        leader, 
                                                                        appendEntriesCh >>
                                   \/ /\ ((becomeLeaderCh)[srvId3[self]]) = (<<>>)
                                      /\ LET yielded_becomeLeaderCh0 == TRUE IN
                                           IF yielded_becomeLeaderCh0
                                              THEN /\ IF ExploreFail
                                                         THEN /\ LET yielded_network91 == ((network)[srvId3[self]]).enabled IN
                                                                   IF ~ (yielded_network91)
                                                                      THEN /\ FALSE
                                                                           /\ ((state)[srvId3[self]]) = (Candidate)
                                                                           /\ isQuorum((votesGranted)[srvId3[self]])
                                                                           /\ LET i == srvId3[self] IN
                                                                                /\ state' = [state EXCEPT ![i] = Leader]
                                                                                /\ nextIndex' = [nextIndex EXCEPT ![i] = [j \in ServerSet |-> (Len((log)[i])) + (1)]]
                                                                                /\ matchIndex' = [matchIndex EXCEPT ![i] = [j \in ServerSet |-> 0]]
                                                                                /\ leader' = [leader EXCEPT ![i] = i]
                                                                                /\ LET value133 == TRUE IN
                                                                                     /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![srvId3[self]] = Append((appendEntriesCh)[srvId3[self]], value133)]
                                                                                     /\ IF Debug
                                                                                           THEN /\ PrintT(<<"BecomeLeader", i, (currentTerm)[i], (state')[i], (leader')[i]>>)
                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverBecomeLeaderLoop"]
                                                                                           ELSE /\ pc' = [pc EXCEPT ![self] = "serverBecomeLeaderLoop"]
                                                                      ELSE /\ ((state)[srvId3[self]]) = (Candidate)
                                                                           /\ isQuorum((votesGranted)[srvId3[self]])
                                                                           /\ LET i == srvId3[self] IN
                                                                                /\ state' = [state EXCEPT ![i] = Leader]
                                                                                /\ nextIndex' = [nextIndex EXCEPT ![i] = [j \in ServerSet |-> (Len((log)[i])) + (1)]]
                                                                                /\ matchIndex' = [matchIndex EXCEPT ![i] = [j \in ServerSet |-> 0]]
                                                                                /\ leader' = [leader EXCEPT ![i] = i]
                                                                                /\ LET value134 == TRUE IN
                                                                                     /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![srvId3[self]] = Append((appendEntriesCh)[srvId3[self]], value134)]
                                                                                     /\ IF Debug
                                                                                           THEN /\ PrintT(<<"BecomeLeader", i, (currentTerm)[i], (state')[i], (leader')[i]>>)
                                                                                                /\ pc' = [pc EXCEPT ![self] = "serverBecomeLeaderLoop"]
                                                                                           ELSE /\ pc' = [pc EXCEPT ![self] = "serverBecomeLeaderLoop"]
                                                         ELSE /\ ((state)[srvId3[self]]) = (Candidate)
                                                              /\ isQuorum((votesGranted)[srvId3[self]])
                                                              /\ LET i == srvId3[self] IN
                                                                   /\ state' = [state EXCEPT ![i] = Leader]
                                                                   /\ nextIndex' = [nextIndex EXCEPT ![i] = [j \in ServerSet |-> (Len((log)[i])) + (1)]]
                                                                   /\ matchIndex' = [matchIndex EXCEPT ![i] = [j \in ServerSet |-> 0]]
                                                                   /\ leader' = [leader EXCEPT ![i] = i]
                                                                   /\ LET value135 == TRUE IN
                                                                        /\ appendEntriesCh' = [appendEntriesCh EXCEPT ![srvId3[self]] = Append((appendEntriesCh)[srvId3[self]], value135)]
                                                                        /\ IF Debug
                                                                              THEN /\ PrintT(<<"BecomeLeader", i, (currentTerm)[i], (state')[i], (leader')[i]>>)
                                                                                   /\ pc' = [pc EXCEPT ![self] = "serverBecomeLeaderLoop"]
                                                                              ELSE /\ pc' = [pc EXCEPT ![self] = "serverBecomeLeaderLoop"]
                                              ELSE /\ pc' = [pc EXCEPT ![self] = "Done"]
                                                   /\ UNCHANGED << state, 
                                                                   nextIndex, 
                                                                   matchIndex, 
                                                                   leader, 
                                                                   appendEntriesCh >>
                                      /\ UNCHANGED becomeLeaderCh
                                /\ UNCHANGED << network, fd, currentTerm, 
                                                commitIndex, log, plog, 
                                                votedFor, votesResponded, 
                                                votesGranted, sm, smDomain, 
                                                leaderTimeout, reqCh, respCh, 
                                                requestVoteSrvId, 
                                                appendEntriesSrvId, 
                                                advanceCommitIndexSrvId, 
                                                becomeLeaderSrvId, 
                                                crasherSrvId, idx, m, srvId, 
                                                idx0, srvId0, idx1, srvId1, 
                                                newCommitIndex, srvId2, srvId3, 
                                                leader0, req, resp, reqIdx, 
                                                timeout, srvId4 >>

s4(self) == serverBecomeLeaderLoop(self)

clientLoop(self) == /\ pc[self] = "clientLoop"
                    /\ IF TRUE
                          THEN /\ \E req00 \in AllReqs:
                                    LET yielded_reqCh0 == req00 IN
                                      /\ req' = [req EXCEPT ![self] = yielded_reqCh0]
                                      /\ reqIdx' = [reqIdx EXCEPT ![self] = (reqIdx[self]) + (1)]
                                      /\ pc' = [pc EXCEPT ![self] = "sndReq"]
                          ELSE /\ pc' = [pc EXCEPT ![self] = "Done"]
                               /\ UNCHANGED << req, reqIdx >>
                    /\ UNCHANGED << network, fd, state, currentTerm, 
                                    commitIndex, nextIndex, matchIndex, log, 
                                    plog, votedFor, votesResponded, 
                                    votesGranted, leader, sm, smDomain, 
                                    leaderTimeout, appendEntriesCh, 
                                    becomeLeaderCh, reqCh, respCh, 
                                    requestVoteSrvId, appendEntriesSrvId, 
                                    advanceCommitIndexSrvId, becomeLeaderSrvId, 
                                    crasherSrvId, idx, m, srvId, idx0, srvId0, 
                                    idx1, srvId1, newCommitIndex, srvId2, 
                                    srvId3, leader0, resp, timeout, srvId4 >>

sndReq(self) == /\ pc[self] = "sndReq"
                /\ IF (leader0[self]) = (Nil)
                      THEN /\ \E srv1 \in ServerSet:
                                /\ leader0' = [leader0 EXCEPT ![self] = srv1]
                                /\ IF Debug
                                      THEN /\ PrintT(<<"ClientSndReq", self, leader0'[self], reqIdx[self], req[self]>>)
                                           /\ IF ((req[self]).type) = (Put)
                                                 THEN /\ \/ /\ LET value140 == [mtype |-> ClientPutRequest, mcmd |-> [idx |-> reqIdx[self], type |-> Put, key |-> (req[self]).key, value |-> (req[self]).value], msource |-> self, mdest |-> leader0'[self]] IN
                                                                 /\ ((network)[leader0'[self]]).enabled
                                                                 /\ (BagCardinality(((network)[leader0'[self]]).queue)) < (BufferSize)
                                                                 /\ network' = [network EXCEPT ![leader0'[self]] = [queue |-> (((network)[leader0'[self]]).queue) (+) (SetToBag({value140})), enabled |-> ((network)[leader0'[self]]).enabled]]
                                                                 /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                         \/ /\ \/ /\ LET yielded_fd90 == FALSE IN
                                                                       /\ yielded_fd90
                                                                       /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                               \/ /\ LET yielded_fd100 == TRUE IN
                                                                       /\ yielded_fd100
                                                                       /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                            /\ UNCHANGED network
                                                 ELSE /\ IF ((req[self]).type) = (Get)
                                                            THEN /\ \/ /\ LET value150 == [mtype |-> ClientGetRequest, mcmd |-> [idx |-> reqIdx[self], type |-> Get, key |-> (req[self]).key], msource |-> self, mdest |-> leader0'[self]] IN
                                                                            /\ ((network)[leader0'[self]]).enabled
                                                                            /\ (BagCardinality(((network)[leader0'[self]]).queue)) < (BufferSize)
                                                                            /\ network' = [network EXCEPT ![leader0'[self]] = [queue |-> (((network)[leader0'[self]]).queue) (+) (SetToBag({value150})), enabled |-> ((network)[leader0'[self]]).enabled]]
                                                                            /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                                    \/ /\ \/ /\ LET yielded_fd1110 == FALSE IN
                                                                                  /\ yielded_fd1110
                                                                                  /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                                          \/ /\ LET yielded_fd1210 == TRUE IN
                                                                                  /\ yielded_fd1210
                                                                                  /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                                       /\ UNCHANGED network
                                                            ELSE /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                                 /\ UNCHANGED network
                                      ELSE /\ IF ((req[self]).type) = (Put)
                                                 THEN /\ \/ /\ LET value141 == [mtype |-> ClientPutRequest, mcmd |-> [idx |-> reqIdx[self], type |-> Put, key |-> (req[self]).key, value |-> (req[self]).value], msource |-> self, mdest |-> leader0'[self]] IN
                                                                 /\ ((network)[leader0'[self]]).enabled
                                                                 /\ (BagCardinality(((network)[leader0'[self]]).queue)) < (BufferSize)
                                                                 /\ network' = [network EXCEPT ![leader0'[self]] = [queue |-> (((network)[leader0'[self]]).queue) (+) (SetToBag({value141})), enabled |-> ((network)[leader0'[self]]).enabled]]
                                                                 /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                         \/ /\ \/ /\ LET yielded_fd91 == FALSE IN
                                                                       /\ yielded_fd91
                                                                       /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                               \/ /\ LET yielded_fd101 == TRUE IN
                                                                       /\ yielded_fd101
                                                                       /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                            /\ UNCHANGED network
                                                 ELSE /\ IF ((req[self]).type) = (Get)
                                                            THEN /\ \/ /\ LET value151 == [mtype |-> ClientGetRequest, mcmd |-> [idx |-> reqIdx[self], type |-> Get, key |-> (req[self]).key], msource |-> self, mdest |-> leader0'[self]] IN
                                                                            /\ ((network)[leader0'[self]]).enabled
                                                                            /\ (BagCardinality(((network)[leader0'[self]]).queue)) < (BufferSize)
                                                                            /\ network' = [network EXCEPT ![leader0'[self]] = [queue |-> (((network)[leader0'[self]]).queue) (+) (SetToBag({value151})), enabled |-> ((network)[leader0'[self]]).enabled]]
                                                                            /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                                    \/ /\ \/ /\ LET yielded_fd1111 == FALSE IN
                                                                                  /\ yielded_fd1111
                                                                                  /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                                          \/ /\ LET yielded_fd1211 == TRUE IN
                                                                                  /\ yielded_fd1211
                                                                                  /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                                       /\ UNCHANGED network
                                                            ELSE /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                                 /\ UNCHANGED network
                      ELSE /\ IF Debug
                                 THEN /\ PrintT(<<"ClientSndReq", self, leader0[self], reqIdx[self], req[self]>>)
                                      /\ IF ((req[self]).type) = (Put)
                                            THEN /\ \/ /\ LET value142 == [mtype |-> ClientPutRequest, mcmd |-> [idx |-> reqIdx[self], type |-> Put, key |-> (req[self]).key, value |-> (req[self]).value], msource |-> self, mdest |-> leader0[self]] IN
                                                            /\ ((network)[leader0[self]]).enabled
                                                            /\ (BagCardinality(((network)[leader0[self]]).queue)) < (BufferSize)
                                                            /\ network' = [network EXCEPT ![leader0[self]] = [queue |-> (((network)[leader0[self]]).queue) (+) (SetToBag({value142})), enabled |-> ((network)[leader0[self]]).enabled]]
                                                            /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                    \/ /\ \/ /\ LET yielded_fd92 == FALSE IN
                                                                  /\ yielded_fd92
                                                                  /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                          \/ /\ LET yielded_fd102 == TRUE IN
                                                                  /\ yielded_fd102
                                                                  /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                       /\ UNCHANGED network
                                            ELSE /\ IF ((req[self]).type) = (Get)
                                                       THEN /\ \/ /\ LET value152 == [mtype |-> ClientGetRequest, mcmd |-> [idx |-> reqIdx[self], type |-> Get, key |-> (req[self]).key], msource |-> self, mdest |-> leader0[self]] IN
                                                                       /\ ((network)[leader0[self]]).enabled
                                                                       /\ (BagCardinality(((network)[leader0[self]]).queue)) < (BufferSize)
                                                                       /\ network' = [network EXCEPT ![leader0[self]] = [queue |-> (((network)[leader0[self]]).queue) (+) (SetToBag({value152})), enabled |-> ((network)[leader0[self]]).enabled]]
                                                                       /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                               \/ /\ \/ /\ LET yielded_fd1112 == FALSE IN
                                                                             /\ yielded_fd1112
                                                                             /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                                     \/ /\ LET yielded_fd1212 == TRUE IN
                                                                             /\ yielded_fd1212
                                                                             /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                                  /\ UNCHANGED network
                                                       ELSE /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                            /\ UNCHANGED network
                                 ELSE /\ IF ((req[self]).type) = (Put)
                                            THEN /\ \/ /\ LET value143 == [mtype |-> ClientPutRequest, mcmd |-> [idx |-> reqIdx[self], type |-> Put, key |-> (req[self]).key, value |-> (req[self]).value], msource |-> self, mdest |-> leader0[self]] IN
                                                            /\ ((network)[leader0[self]]).enabled
                                                            /\ (BagCardinality(((network)[leader0[self]]).queue)) < (BufferSize)
                                                            /\ network' = [network EXCEPT ![leader0[self]] = [queue |-> (((network)[leader0[self]]).queue) (+) (SetToBag({value143})), enabled |-> ((network)[leader0[self]]).enabled]]
                                                            /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                    \/ /\ \/ /\ LET yielded_fd93 == FALSE IN
                                                                  /\ yielded_fd93
                                                                  /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                          \/ /\ LET yielded_fd103 == TRUE IN
                                                                  /\ yielded_fd103
                                                                  /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                       /\ UNCHANGED network
                                            ELSE /\ IF ((req[self]).type) = (Get)
                                                       THEN /\ \/ /\ LET value153 == [mtype |-> ClientGetRequest, mcmd |-> [idx |-> reqIdx[self], type |-> Get, key |-> (req[self]).key], msource |-> self, mdest |-> leader0[self]] IN
                                                                       /\ ((network)[leader0[self]]).enabled
                                                                       /\ (BagCardinality(((network)[leader0[self]]).queue)) < (BufferSize)
                                                                       /\ network' = [network EXCEPT ![leader0[self]] = [queue |-> (((network)[leader0[self]]).queue) (+) (SetToBag({value153})), enabled |-> ((network)[leader0[self]]).enabled]]
                                                                       /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                               \/ /\ \/ /\ LET yielded_fd1113 == FALSE IN
                                                                             /\ yielded_fd1113
                                                                             /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                                     \/ /\ LET yielded_fd1213 == TRUE IN
                                                                             /\ yielded_fd1213
                                                                             /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                                  /\ UNCHANGED network
                                                       ELSE /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                            /\ UNCHANGED network
                           /\ UNCHANGED leader0
                /\ UNCHANGED << fd, state, currentTerm, commitIndex, nextIndex, 
                                matchIndex, log, plog, votedFor, 
                                votesResponded, votesGranted, leader, sm, 
                                smDomain, leaderTimeout, appendEntriesCh, 
                                becomeLeaderCh, reqCh, respCh, 
                                requestVoteSrvId, appendEntriesSrvId, 
                                advanceCommitIndexSrvId, becomeLeaderSrvId, 
                                crasherSrvId, idx, m, srvId, idx0, srvId0, 
                                idx1, srvId1, newCommitIndex, srvId2, srvId3, 
                                req, resp, reqIdx, timeout, srvId4 >>

rcvResp(self) == /\ pc[self] = "rcvResp"
                 /\ \/ /\ Assert(((network)[self]).enabled, 
                                 "Failure of assertion at line 11382, column 9.")
                       /\ (BagCardinality(((network)[self]).queue)) > (0)
                       /\ \E readMsg10 \in BagToSet(((network)[self]).queue):
                            /\ network' = [network EXCEPT ![self] = [queue |-> (((network)[self]).queue) (-) (SetToBag({readMsg10})), enabled |-> ((network)[self]).enabled]]
                            /\ LET yielded_network100 == readMsg10 IN
                                 /\ resp' = [resp EXCEPT ![self] = yielded_network100]
                                 /\ IF Debug
                                       THEN /\ PrintT(<<"ClientRcvResp", self, leader0[self], reqIdx[self], resp'[self]>>)
                                            /\ Assert(((resp'[self]).mdest) = (self), 
                                                      "Failure of assertion at line 11390, column 15.")
                                            /\ IF (((resp'[self]).mresponse).idx) # (reqIdx[self])
                                                  THEN /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                       /\ UNCHANGED << respCh, 
                                                                       leader0 >>
                                                  ELSE /\ leader0' = [leader0 EXCEPT ![self] = (resp'[self]).mleaderHint]
                                                       /\ Assert(((((req[self]).type) = (Get)) => (((resp'[self]).mtype) = (ClientGetResponse))) /\ ((((req[self]).type) = (Put)) => (((resp'[self]).mtype) = (ClientPutResponse))), 
                                                                 "Failure of assertion at line 11395, column 17.")
                                                       /\ IF ~ ((resp'[self]).msuccess)
                                                             THEN /\ pc' = [pc EXCEPT ![self] = "sndReq"]
                                                                  /\ UNCHANGED respCh
                                                             ELSE /\ Assert(((((resp'[self]).mresponse).idx) = (reqIdx[self])) /\ ((((resp'[self]).mresponse).key) = ((req[self]).key)), 
                                                                            "Failure of assertion at line 11399, column 19.")
                                                                  /\ respCh' = resp'[self]
                                                                  /\ IF Debug
                                                                        THEN /\ PrintT(<<"ClientRcvChDone", self, leader0'[self], reqIdx[self], resp'[self]>>)
                                                                             /\ pc' = [pc EXCEPT ![self] = "clientLoop"]
                                                                        ELSE /\ pc' = [pc EXCEPT ![self] = "clientLoop"]
                                       ELSE /\ Assert(((resp'[self]).mdest) = (self), 
                                                      "Failure of assertion at line 11410, column 15.")
                                            /\ IF (((resp'[self]).mresponse).idx) # (reqIdx[self])
                                                  THEN /\ pc' = [pc EXCEPT ![self] = "rcvResp"]
                                                       /\ UNCHANGED << respCh, 
                                                                       leader0 >>
                                                  ELSE /\ leader0' = [leader0 EXCEPT ![self] = (resp'[self]).mleaderHint]
                                                       /\ Assert(((((req[self]).type) = (Get)) => (((resp'[self]).mtype) = (ClientGetResponse))) /\ ((((req[self]).type) = (Put)) => (((resp'[self]).mtype) = (ClientPutResponse))), 
                                                                 "Failure of assertion at line 11415, column 17.")
                                                       /\ IF ~ ((resp'[self]).msuccess)
                                                             THEN /\ pc' = [pc EXCEPT ![self] = "sndReq"]
                                                                  /\ UNCHANGED respCh
                                                             ELSE /\ Assert(((((resp'[self]).mresponse).idx) = (reqIdx[self])) /\ ((((resp'[self]).mresponse).key) = ((req[self]).key)), 
                                                                            "Failure of assertion at line 11419, column 19.")
                                                                  /\ respCh' = resp'[self]
                                                                  /\ IF Debug
                                                                        THEN /\ PrintT(<<"ClientRcvChDone", self, leader0'[self], reqIdx[self], resp'[self]>>)
                                                                             /\ pc' = [pc EXCEPT ![self] = "clientLoop"]
                                                                        ELSE /\ pc' = [pc EXCEPT ![self] = "clientLoop"]
                    \/ /\ \/ /\ LET yielded_fd133 == FALSE IN
                                  \E len10 \in (0) .. (BagCardinality(((network)[self]).queue)):
                                    LET yielded_network110 == len10 IN
                                      \/ /\ LET yielded_timeout1 == TRUE IN
                                              /\ ((yielded_fd133) /\ ((yielded_network110) = (0))) \/ (yielded_timeout1)
                                              /\ IF Debug
                                                    THEN /\ PrintT(<<"ClientTimeout", self, leader0[self], reqIdx[self]>>)
                                                         /\ leader0' = [leader0 EXCEPT ![self] = Nil]
                                                         /\ pc' = [pc EXCEPT ![self] = "sndReq"]
                                                    ELSE /\ leader0' = [leader0 EXCEPT ![self] = Nil]
                                                         /\ pc' = [pc EXCEPT ![self] = "sndReq"]
                                      \/ /\ LET yielded_timeout00 == FALSE IN
                                              /\ ((yielded_fd133) /\ ((yielded_network110) = (0))) \/ (yielded_timeout00)
                                              /\ IF Debug
                                                    THEN /\ PrintT(<<"ClientTimeout", self, leader0[self], reqIdx[self]>>)
                                                         /\ leader0' = [leader0 EXCEPT ![self] = Nil]
                                                         /\ pc' = [pc EXCEPT ![self] = "sndReq"]
                                                    ELSE /\ leader0' = [leader0 EXCEPT ![self] = Nil]
                                                         /\ pc' = [pc EXCEPT ![self] = "sndReq"]
                          \/ /\ LET yielded_fd140 == TRUE IN
                                  \E len11 \in (0) .. (BagCardinality(((network)[self]).queue)):
                                    LET yielded_network111 == len11 IN
                                      \/ /\ LET yielded_timeout2 == TRUE IN
                                              /\ ((yielded_fd140) /\ ((yielded_network111) = (0))) \/ (yielded_timeout2)
                                              /\ IF Debug
                                                    THEN /\ PrintT(<<"ClientTimeout", self, leader0[self], reqIdx[self]>>)
                                                         /\ leader0' = [leader0 EXCEPT ![self] = Nil]
                                                         /\ pc' = [pc EXCEPT ![self] = "sndReq"]
                                                    ELSE /\ leader0' = [leader0 EXCEPT ![self] = Nil]
                                                         /\ pc' = [pc EXCEPT ![self] = "sndReq"]
                                      \/ /\ LET yielded_timeout01 == FALSE IN
                                              /\ ((yielded_fd140) /\ ((yielded_network111) = (0))) \/ (yielded_timeout01)
                                              /\ IF Debug
                                                    THEN /\ PrintT(<<"ClientTimeout", self, leader0[self], reqIdx[self]>>)
                                                         /\ leader0' = [leader0 EXCEPT ![self] = Nil]
                                                         /\ pc' = [pc EXCEPT ![self] = "sndReq"]
                                                    ELSE /\ leader0' = [leader0 EXCEPT ![self] = Nil]
                                                         /\ pc' = [pc EXCEPT ![self] = "sndReq"]
                       /\ UNCHANGED <<network, respCh, resp>>
                 /\ UNCHANGED << fd, state, currentTerm, commitIndex, 
                                 nextIndex, matchIndex, log, plog, votedFor, 
                                 votesResponded, votesGranted, leader, sm, 
                                 smDomain, leaderTimeout, appendEntriesCh, 
                                 becomeLeaderCh, reqCh, requestVoteSrvId, 
                                 appendEntriesSrvId, advanceCommitIndexSrvId, 
                                 becomeLeaderSrvId, crasherSrvId, idx, m, 
                                 srvId, idx0, srvId0, idx1, srvId1, 
                                 newCommitIndex, srvId2, srvId3, req, reqIdx, 
                                 timeout, srvId4 >>

client(self) == clientLoop(self) \/ sndReq(self) \/ rcvResp(self)

serverCrash(self) == /\ pc[self] = "serverCrash"
                     /\ LET value160 == FALSE IN
                          /\ network' = [network EXCEPT ![srvId4[self]] = [queue |-> ((network)[srvId4[self]]).queue, enabled |-> value160]]
                          /\ pc' = [pc EXCEPT ![self] = "fdUpdate"]
                     /\ UNCHANGED << fd, state, currentTerm, commitIndex, 
                                     nextIndex, matchIndex, log, plog, 
                                     votedFor, votesResponded, votesGranted, 
                                     leader, sm, smDomain, leaderTimeout, 
                                     appendEntriesCh, becomeLeaderCh, reqCh, 
                                     respCh, requestVoteSrvId, 
                                     appendEntriesSrvId, 
                                     advanceCommitIndexSrvId, 
                                     becomeLeaderSrvId, crasherSrvId, idx, m, 
                                     srvId, idx0, srvId0, idx1, srvId1, 
                                     newCommitIndex, srvId2, srvId3, leader0, 
                                     req, resp, reqIdx, timeout, srvId4 >>

fdUpdate(self) == /\ pc[self] = "fdUpdate"
                  /\ LET value170 == TRUE IN
                       /\ fd' = [fd EXCEPT ![srvId4[self]] = value170]
                       /\ pc' = [pc EXCEPT ![self] = "Done"]
                  /\ UNCHANGED << network, state, currentTerm, commitIndex, 
                                  nextIndex, matchIndex, log, plog, votedFor, 
                                  votesResponded, votesGranted, leader, sm, 
                                  smDomain, leaderTimeout, appendEntriesCh, 
                                  becomeLeaderCh, reqCh, respCh, 
                                  requestVoteSrvId, appendEntriesSrvId, 
                                  advanceCommitIndexSrvId, becomeLeaderSrvId, 
                                  crasherSrvId, idx, m, srvId, idx0, srvId0, 
                                  idx1, srvId1, newCommitIndex, srvId2, srvId3, 
                                  leader0, req, resp, reqIdx, timeout, srvId4 >>

crasher(self) == serverCrash(self) \/ fdUpdate(self)

(* Allow infinite stuttering to prevent deadlock on termination. *)
Terminating == /\ \A self \in ProcSet: pc[self] = "Done"
               /\ UNCHANGED vars

Next == (\E self \in ServerSet: s0(self))
           \/ (\E self \in ServerRequestVoteSet: s1(self))
           \/ (\E self \in ServerAppendEntriesSet: s2(self))
           \/ (\E self \in ServerAdvanceCommitIndexSet: s3(self))
           \/ (\E self \in ServerBecomeLeaderSet: s4(self))
           \/ (\E self \in ClientSet: client(self))
           \/ (\E self \in ServerCrasherSet: crasher(self))
           \/ Terminating

Spec == /\ Init /\ [][Next]_vars
        /\ \A self \in ServerSet : WF_vars(s0(self))
        /\ \A self \in ServerRequestVoteSet : WF_vars(s1(self))
        /\ \A self \in ServerAppendEntriesSet : WF_vars(s2(self))
        /\ \A self \in ServerAdvanceCommitIndexSet : WF_vars(s3(self))
        /\ \A self \in ServerBecomeLeaderSet : WF_vars(s4(self))
        /\ \A self \in ClientSet : WF_vars(client(self))
        /\ \A self \in ServerCrasherSet : WF_vars(crasher(self))

Termination == <>(\A self \in ProcSet: pc[self] = "Done")

\* END TRANSLATION  TLA-f157040c4fee3bde8856de68970be59d

\* Constraints

LimitTerm == \A i \in ServerSet: currentTerm[i] < MaxTerm
LimitCommitIndex == \A i \in ServerSet: commitIndex[i] < MaxCommitIndex

LimitNodeFailure == Cardinality({i \in ServerSet: \lnot network[i].enabled}) <= MaxNodeFail

MCConstraint ==
    /\ LimitTerm
    /\ LimitCommitIndex
    /\ LimitNodeFailure

\* Invariants

ElectionSafety == \lnot (\E i, j \in ServerSet:
                                        /\ i /= j
                                        /\ currentTerm[i] = currentTerm[j]
                                        /\ state[i] = Leader
                                        /\ state[j] = Leader)

LogMatching == \A i, j \in ServerSet:
                        \A k \in 1..Min({Len(log[i]), Len(log[j])}):
                            log[i][k].term = log[j][k].term
                                => SubSeq(log[i], 1, k) = SubSeq(log[j], 1, k)

LeaderCompleteness == \A i \in ServerSet:
                        \A logIdx \in DOMAIN log[i]:
                          logIdx <= commitIndex[i] =>
                            \A j \in ServerSet:
                              state[j] = Leader /\ currentTerm[j] >= log[i][logIdx].term =>
                                /\ logIdx \in DOMAIN log[j]
                                /\ log[i][logIdx] = log[j][logIdx]

StateMachineSafety == \A i, j \in ServerSet:
                            \A k \in 1..Min({commitIndex[i], commitIndex[j]}):
                                        log[i][k] = log[j][k]

ApplyLogOK == \A i, j \in ServerSet:
                    commitIndex[i] = commitIndex[j] => 
                        /\ sm[i] = sm[j]
                        /\ smDomain[i] = smDomain[j]

plogOK == \A i \in ServerSet: log[i] = plog[i]

TermOK == \A i \in ServerSet: currentTerm[i] <= MaxTerm
CommitIndexOK == \A i \in ServerSet: commitIndex[i] <= MaxCommitIndex
NodeFailOK == Cardinality({i \in ServerSet: \lnot network[i].enabled}) <= MaxNodeFail+1

\* Properties

LeaderAppendOnly == [][\A i \in ServerSet:
                        (state[i] = Leader /\ state'[i] = Leader)
                            => log[i] = SubSeq(log'[i], 1, Len(log[i]))]_vars

ClientRcvResp(i) == pc[i] = "rcvResp" ~> pc[i] = "clientLoop"
ClientsOK == \A i \in ClientSet: ClientRcvResp(i)

\* Expected this to be violated if NumServers > 1,
\* but TLC doesn't report violation in case of NumServers = 2 because 
\* of using temporal properties and state constraints at the same time. 
\* TLC reports violation when NumServers = 3.
ElectionLiveness == []<>(\E i \in ServerSet: state[i] = Leader)

=============================================================================
